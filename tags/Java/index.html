<!DOCTYPE html><html lang="en" data-astro-cid-tge3q7ae> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/png" href="/src/assets/icon.png"><link rel="stylesheet" href="/styles/global.css"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="èŒ¶ç†çš„åšå®¢" href="https://charlesix59.github.io/rss.xml"><meta name="generator" content="Astro v5.16.6"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://charlesix59.github.io/tags/Java/"><!-- Primary Meta Tags --><title>Java - èŒ¶ç†çš„åšå®¢</title><meta name="title" content="Java - èŒ¶ç†çš„åšå®¢"><meta name="description" content="æŸ¥çœ‹æ‰€æœ‰å…³äº Java çš„æ–‡ç«  (3 ç¯‡)"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://charlesix59.github.io/tags/Java/"><meta property="og:title" content="Java - èŒ¶ç†çš„åšå®¢"><meta property="og:description" content="æŸ¥çœ‹æ‰€æœ‰å…³äº Java çš„æ–‡ç«  (3 ç¯‡)"><meta property="og:image" content="https://charlesix59.github.io/_astro/default.DOL7xRHI.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://charlesix59.github.io/tags/Java/"><meta property="twitter:title" content="Java - èŒ¶ç†çš„åšå®¢"><meta property="twitter:description" content="æŸ¥çœ‹æ‰€æœ‰å…³äº Java çš„æ–‡ç«  (3 ç¯‡)"><meta property="twitter:image" content="https://charlesix59.github.io/_astro/default.DOL7xRHI.png"><link rel="stylesheet" href="/_astro/about.CafuXOta.css">
<style>.card-link[data-astro-cid-dohjnao5]{text-decoration:none;color:inherit}.card[data-astro-cid-dohjnao5]{display:flex;gap:1.5rem;padding:1.5rem;border-radius:0;transition:all .3s ease;background:#fff;box-shadow:0 2px 8px #0000001a}.card[data-astro-cid-dohjnao5]:hover{box-shadow:0 4px 16px #00000026;transform:translateY(-2px)}.card-image[data-astro-cid-dohjnao5]{flex-shrink:0;width:10rem;height:10rem;border-radius:0;overflow:hidden;background:#f0f0f0}.card-image[data-astro-cid-dohjnao5] img[data-astro-cid-dohjnao5]{width:100%;height:100%;object-fit:cover}.card-content[data-astro-cid-dohjnao5]{flex:1;display:flex;flex-direction:column;justify-content:center;min-width:0}.card-title[data-astro-cid-dohjnao5]{margin:0 0 .5rem;font-size:1.1rem;font-weight:600;color:rgb(var(--black));line-height:1.4;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.card-description[data-astro-cid-dohjnao5]{margin:0;font-size:.95rem;color:rgb(var(--gray));line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}@media(max-width:640px){.card[data-astro-cid-dohjnao5]{padding:1rem;gap:1rem}.card-image[data-astro-cid-dohjnao5]{width:8rem;height:8rem}.card-title[data-astro-cid-dohjnao5]{font-size:1rem}.card-description[data-astro-cid-dohjnao5]{font-size:.9rem;-webkit-line-clamp:1}}.card-list[data-astro-cid-p3vyftr4]{display:flex;flex-direction:column;gap:2px;margin-top:2rem}.card-item[data-astro-cid-p3vyftr4]{background:transparent}@media(max-width:640px){.card-list[data-astro-cid-p3vyftr4]{gap:2px;margin-top:1.5rem}}
main[data-astro-cid-tge3q7ae]{width:100%;max-width:960px;margin:0 auto;padding:2rem 1rem;box-sizing:border-box}.tag-header[data-astro-cid-tge3q7ae]{margin-bottom:3rem}.tag-header-content[data-astro-cid-tge3q7ae]{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}.back-link[data-astro-cid-tge3q7ae]{display:inline-flex;align-items:center;gap:.5rem;color:rgb(var(--accent));text-decoration:none;font-weight:500;transition:all .3s ease}.back-link[data-astro-cid-tge3q7ae]:hover{gap:1rem}.back-link[data-astro-cid-tge3q7ae]:before{content:"â†"}.tag-title[data-astro-cid-tge3q7ae]{display:inline-block;font-size:2.5rem;margin:0;color:rgb(var(--black));padding:.5rem 1.5rem;background:linear-gradient(135deg,#2680d9,#26d980);color:#fff;border-radius:20px}.tag-info[data-astro-cid-tge3q7ae]{display:flex;gap:2rem;margin-top:1rem;color:rgb(var(--gray));font-size:1.1rem}.tag-info-item[data-astro-cid-tge3q7ae]{display:flex;align-items:center;gap:.5rem}.tag-info-icon[data-astro-cid-tge3q7ae]{font-size:1.3rem}.empty-state[data-astro-cid-tge3q7ae]{text-align:center;padding:3rem 1rem;color:rgb(var(--gray))}.empty-state[data-astro-cid-tge3q7ae] p[data-astro-cid-tge3q7ae]{font-size:1.1rem}@media(max-width:768px){main[data-astro-cid-tge3q7ae]{padding:1.5rem .75rem}.tag-header[data-astro-cid-tge3q7ae]{margin-bottom:2rem}.tag-header-content[data-astro-cid-tge3q7ae]{flex-direction:column;align-items:flex-start;gap:.5rem}.back-link[data-astro-cid-tge3q7ae]{font-size:.95rem}.tag-title[data-astro-cid-tge3q7ae]{font-size:2rem;padding:.4rem 1rem}.tag-info[data-astro-cid-tge3q7ae]{flex-direction:column;gap:.5rem;font-size:1rem}}@media(max-width:480px){main[data-astro-cid-tge3q7ae]{padding:1rem .5rem}.tag-header[data-astro-cid-tge3q7ae]{margin-bottom:1.5rem}.tag-title[data-astro-cid-tge3q7ae]{font-size:1.5rem;padding:.3rem .8rem}.tag-info[data-astro-cid-tge3q7ae]{font-size:.9rem;gap:.3rem}.tag-info-icon[data-astro-cid-tge3q7ae]{font-size:1.1rem}.back-link[data-astro-cid-tge3q7ae]{font-size:.9rem}}
</style></head> <body data-astro-cid-tge3q7ae> <header data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>èŒ¶ç†çš„åšå®¢</a></h2> <div class="internal-links" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> é¦–é¡µ </a>  <a href="/tags" class="active" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> æ ‡ç­¾ </a>  <a href="/about" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> å…³äºæˆ‘ </a>  </div> <div class="social-links" data-astro-cid-3ef6ksr2> <a href="https://https://github.com/charlesix59" target="_blank" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>find me on Github</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg> </a> </div> </nav> </header>  <main data-astro-cid-tge3q7ae> <section class="tag-header" data-astro-cid-tge3q7ae> <div class="tag-header-content" data-astro-cid-tge3q7ae> <a href="/tags/" class="back-link" data-astro-cid-tge3q7ae>è¿”å›æ ‡ç­¾äº‘</a> </div> <h1 class="tag-title" data-astro-cid-tge3q7ae>Java</h1> <div class="tag-info" data-astro-cid-tge3q7ae> <div class="tag-info-item" data-astro-cid-tge3q7ae> <span class="tag-info-icon" data-astro-cid-tge3q7ae>ğŸ“</span> <span data-astro-cid-tge3q7ae>3 ç¯‡æ–‡ç« </span> </div> <div class="tag-info-item" data-astro-cid-tge3q7ae> <span class="tag-info-icon" data-astro-cid-tge3q7ae>ğŸ“…</span> <span data-astro-cid-tge3q7ae>æœ€æ–°: 2024/12/19</span> </div> </div> </section> <div class="card-list" data-astro-cid-p3vyftr4> <div class="card-item" data-astro-cid-p3vyftr4> <a href="/blog/subject/hadoop/" class="card-link" data-astro-cid-dohjnao5> <div class="card" data-astro-cid-dohjnao5> <div class="card-image" data-astro-cid-dohjnao5>  </div> <div class="card-content" data-astro-cid-dohjnao5> <h3 class="card-title" data-astro-cid-dohjnao5>Hadoop çŸ¥è¯†æ•´ç†</h3> <p class="card-description" data-astro-cid-dohjnao5># hadoopçŸ¥è¯†ç‚¹æ•´ç†

## ç¬¬ä¸€ç«  å¤§æ•°æ®çš„æ¦‚å¿µ

å¤§æ•°æ®æ˜¯æŒ‡æ— æ³•ç”¨ç°æœ‰çš„è½¯ä»¶å·¥å…·æå–ã€å­˜å‚¨ã€æœç´¢ã€å…±äº«ã€åˆ†æå’Œå¤„ç†çš„æµ·é‡çš„å¤æ‚çš„æ•°æ®å›¾é›†ã€‚

### ç‰¹å¾

**4ä¸ªV**ï¼š

- Volumeï¼šæ•°æ®ä½“é‡å·¨å¤§

- Varietyï¼šæ•°æ®ç§ç±»ç¹å¤š

- Valueï¼šæ•°æ®ä»·å€¼å¯†åº¦ä½

- Velocityï¼šå¤„ç†é€Ÿåº¦å¿«

### hadoopç”Ÿæ€åœˆ

å¤§æ•°æ®å·¥å…·ä¸»è¦åŒ…æ‹¬ï¼šHadoopã€Hbaseã€ZooKeeperã€Hiveã€Mahoutã€Sqoopã€Stormç­‰

#### Hadoop

**Doug Cutting**å¼€å‘ï¼Œå—åˆ°**Map/Reduce**å¯å‘ï¼Œæ ¸å¿ƒæ˜¯**MapReduceç¼–ç¨‹æ¨¡å‹å’ŒHDFSåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ**ã€‚

é‡‡ç”¨åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³ï¼ŒMapç”¨æ¥åˆ‡åˆ†å¤§çš„æ•°æ®ï¼ŒReduceç”¨æ¥åˆå¹¶Mapè®¡ç®—çš„ç»“æœã€‚

HDFS åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œä¸ºæµ·é‡æ•°æ®æä¾›å­˜å‚¨æœåŠ¡ï¼Œå°†å¤§æ–‡ä»¶æ‹†åˆ†ä¸ºå—ï¼Œå¤šèŠ‚ç‚¹å­˜æ”¾ï¼Œå…·æœ‰é«˜ååé‡ã€é«˜å®¹é”™æ€§çš„ç‰¹ç‚¹ã€‚

#### HBASE

HBASEæ˜¯Apacheå¼€æºçš„KVå‹æ•°æ®åº“ï¼Œæ˜¯å»ºç«‹åœ¨HDFSä¹‹ä¸Šï¼Œæä¾›é«˜å¯é æ€§ã€é«˜æ€§èƒ½ã€åˆ—å­˜å‚¨ã€å¯ä¼¸ç¼©ã€å®æ—¶è¯»å†™çš„æ•°æ®åº“ç³»ç»Ÿã€‚

ä»…æ”¯æŒå•è¡Œäº‹åŠ¡ã€‚

ä¸»è¦ç”¨æ¥å­˜å‚¨éç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–çš„æ¾æ•£æ•°æ®ã€‚

#### Hive

Apache Hiveæ•°æ®ä»“åº“è½¯ä»¶æä¾›å¯¹å­˜å‚¨åœ¨åˆ†å¸ƒå¼ä¸­çš„å¤§å‹æ•°æ®é›†çš„æŸ¥è¯¢å’Œç®¡ç†ï¼Œå®ƒæœ¬äº‹æ˜¯å»ºç«‹åœ¨Hadoopä¹‹ä¸Šçš„

#### Storm

Apache Stormæ˜¯ä¸€ä¸ªå…è´¹ã€å¼€æºçš„åˆ†å¸ƒå¼å®æ—¶è®¡ç®—æœºç³»ç»Ÿï¼Œç®€åŒ–äº†æ•°æ®æµçš„å¯é å¤„ç†ã€‚

#### ZooKeeper

zooKeeperæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€åˆ†å¸ƒå¼çš„å¼€æºåˆ†å¸ƒå¼åº”ç”¨åè°ƒæœåŠ¡ï¼Œä»–æ˜¯stormã€hbaseçš„é‡è¦ç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€è‡´æ€§æœåŠ¡çš„è½¯ä»¶ã€‚

æœåŠ¡ç«¯è·‘åœ¨JAVAä¸Š

ZooKeeperæœ‰ä¸¤ä¸ªè§’è‰²ï¼Œä¸€ä¸ªæ˜¯leaderï¼Œè´Ÿè´£å†™æœåŠ¡å’Œæ•°æ®åŒæ­¥ï¼Œå‰©ä¸‹çš„æ˜¯followerï¼Œæä¾›è¯»æœåŠ¡ã€‚

**ç‰¹ç‚¹**ï¼š

- é¡ºåºä¸€è‡´æ€§ï¼šæŒ‰ç…§å®¢æˆ·ç«¯å‘é€è¯·æ±‚çš„é¡ºåºæ›´æ–°æ•°æ®

- åŸå­æ€§

- å•ä¸€æ€§ï¼šæ— è®ºå®¢æˆ·ç«¯è¿æ¥å“ªä¸ªserveréƒ½çœ‹åˆ°åŒä¸€ä¸ªè§†å›¾

- å¯é æ€§ï¼šä¸€æ—¦æ•°æ®æ›´æ–°æˆåŠŸå°†ä¸€ç›´ä¿æŒï¼Œç›´åˆ°æ–°çš„æ›´æ–°

- åŠæ—¶æ€§ï¼šå®¢æˆ·ä¼šåœ¨ä¸€ä¸ªç¡®å®šçš„æ—¶é—´å†…å¾—åˆ°æœ€æ–°çš„æ•°æ®

**è¿ç”¨åœºæ™¯**ï¼š

- æ•°æ®å‘å¸ƒè®¢é˜…

- åç©ºé—´æœåŠ¡

- åˆ†å¸ƒå¼é€šçŸ¥

- åˆ†å¸ƒå¼é”

- é›†ç¾¤ç®¡ç†

#### sqoop

sqoopæ˜¯Apacheé¡¶çº§é¡¹ç›®ï¼Œå…è®¸ç”¨æˆ·å°†æ•°æ®ä»å…³ç³»å‹æ•°æ®åº“ä¸­æŠ½å–æ•°æ®åˆ°Hadoopä¸­

#### mahout

mahoutæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®æŒ–æ˜å·¥å…·ï¼Œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœºå™¨å­¦ä¹ ç®—æ³•çš„é›†åˆï¼ŒåŒ…æ‹¬åˆ†å¸ƒå¼ååŒè¿‡æ»¤çš„å®ç°ã€åˆ†ç±»ã€èšç±»ç­‰

### Hadoopå†å²å’Œç‰ˆæœ¬

å†å²ï¼š

- 2011å¹´12æœˆï¼ŒApacheåŸºé‡‘ä¼šå‘å¸ƒäº†Apache Hadoop ç‰ˆæœ¬1.0

- 2013å¹´8æœˆï¼Œç‰ˆæœ¬2.0.6å¯ç”¨

- 2017å¹´12æœˆå‘å¸ƒApache Hadoop3

å‘è¡Œç‰ˆï¼š

Hadoopæœ‰è®¸å¤šå˜ä½“ï¼š

- Cloudera Hadoopåˆ†å¸ƒï¼šæ˜¯Coludera Enterpriseçš„æ ¸å¿ƒï¼ŒåŒ…æ‹¬Apache Hadoopã€Apache Sparkï¼ŒApache Kafka ä»¥åŠåå¤šä¸ªå…¶ä»–ç´§å¯†ç»§æ‰¿çš„é¢†å…ˆå¼€æºé¡¹ç›®

- Hortonworks Hadoopåˆ†å¸ƒï¼šæ˜¯åŸºäºYARNçš„å®‰å…¨æ€§å¼ºã€ä¼ä¸šå°±ç»ªçš„å¼€æºç‰ˆæœ¬

- MapR Hadoopåˆ†å¸ƒï¼šæ˜¯Hadoopçš„å®Œæˆæ•´ä¼ä¸šçº§å‘è¡Œç‰ˆ

- PivotalHDï¼šæ˜¯é¢†å…ˆçš„åŸºäºæ ‡å‡†çš„Hadoopè¯¥å‘è¡Œç‰ˆï¼Œä¸ºBusiness Data Lakeæ¶æ„å¥ å®šäº†åŸºç¡€

ä¼˜åŠ¿ï¼š

- é«˜å¯é æ€§

- é«˜æ‹“å±•æ€§

- é«˜æ•ˆæ€§

- é«˜å®¹é”™æ€§

## ç¬¬äºŒç«  Hadoop ç»„æˆä¸ç»“æ„

Hadoop1çš„ä¸‰å¤§æ ¸å¿ƒæ¨¡å—ï¼š

- Commonæ¨¡å—ï¼šæ”¯æŒå…¶ä»–æ¨¡å—çš„å·¥å…·æ¨¡å—

- HDFSæ¨¡å—ï¼šä¸€ä¸ªé«˜å¯é ã€é«˜ååé‡çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ

- MapReduceæ¨¡å—ï¼šä¸€ä¸ªåˆ†å¸ƒå¼çš„èµ„æºè°ƒåº¦å’Œç¦»çº¿å¹¶è¡Œè®¡ç®—ç³»ç»Ÿ

Hadoop2çš„ç»„æˆï¼š

MapReduceæ¨¡å—ä»…ä½œä¸ºåˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶å­˜åœ¨ï¼Œèµ„æºè°ƒåº¦åŠŸèƒ½äº¤ç»™YARNæ¥è°ƒåº¦å¤„ç†

### HDFS

ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚

HDFçš„è®¾è®¡é€‚åˆä¸€æ¬¡å†™å…¥å¤šæ¬¡è¯»å‡ºçš„åœºæ™¯ä¸”ä¸æ”¯æŒæ–‡ä»¶ä¿®æ”¹ã€‚é€‚åˆç”¨æ¥åšæ•°æ®åˆ†æï¼Œå¹¶ä¸é€‚åˆåšç½‘ç›˜ä½¿ç”¨ã€‚

Master-Slaveç»“æ„ï¼ŒMasteræ˜¯NameNodeï¼ŒSlaveæ˜¯DataNode

clientèŒè´£å¦‚ä¸‹ï¼š

- æ–‡ä»¶åˆ‡åˆ†

- ä¸NameNodeäº¤äº’è·å–æ–‡ä»¶çš„ä½ç½®ä¿¡æ¯

- ä¸DataNodeäº¤äº’è¯»å–æˆ–å†™å…¥æ•°æ®

- æä¾›ä¸€äº›æ˜æ‹æ¥ç®¡ç†HDFSï¼Œæ¯”å¦‚å¯åŠ¨æˆ–è€…å…³é—­HDFS

- å¯ä»¥é€šè¿‡ä¸€äº›å‘½ä»¤æ¥è®¿é—®HDFS

NameNodeèŒè´£å¦‚ä¸‹ï¼š

- é…ç½®å‰¯æœ¬ç­–ç•¥

- å¤„ç†clientè¯»å†™è¯·æ±‚

- ç®¡ç†blockï¼ˆæ•°æ®å—ï¼‰æ˜ å°„ä¿¡æ¯ï¼Œä»¥å…ƒæ•°æ®çš„å½¢å¼å­˜å‚¨åœ¨Fsimageé•œåƒæ–‡ä»¶ä¸­

- ç®¡ç†HDFSå‘½åç©ºé—´

DataNodeçš„èŒè´£ï¼š

- æ‰§è¡Œå®é™…çš„æ•°æ®å—

- æ‰§è¡Œæ•°æ®å—çš„è¯»å†™æ“ä½œ

SecondaryNameNodeï¼Œç¬¬äºŒåç§°èŠ‚ç‚¹ï¼Œå¹¶éåç§°èŠ‚ç‚¹çš„çƒ­å¤‡ï¼Œæ™‹æ¡£NameNodeé‡å¯æˆ–è€…çƒ­å¤‡NameNodeæ¿€æ´»æ—¶å°†å®•æœºå‰æ‰€ä¿ç•™é›†ç¾¤çš„å¿«ç…§å‘é€ç»™NameNodeä»¥æ¢å¤æ­¤å‰é›†ç¾¤çš„çŠ¶æ€ã€‚å…·ä½“åŠŸèƒ½ä¸ºï¼š

- å­˜è¾…NameNodeï¼Œåˆ†æ‹…å…¶å·¥ä½œé‡

- å®šæœŸåˆå¹¶Fsimageå’ŒEditsï¼Œå¹¶æ¨é€ç»™NameNode

- åœ¨ç´§æ€¥æƒ…å†µä¸‹å¯è¾…åŠ©æ¢å¤NameNode

ä¼˜ç‚¹ï¼š

- é«˜å®¹é”™æ€§

- é€‚åˆå¤§æ•°æ®å¤„ç†

- æ”¯æŒæµå¼æ•°æ®è®¿é—®

- å¯æ„å»ºåœ¨å»‰ä»·æœºå™¨ä¸Š

ç¼ºç‚¹ï¼š

- ä¸é€‚åˆä½å»¶æ—¶æ•°æ®è®¿é—®

- æ— æ³•é«˜æ•ˆçš„å¯¹å¤§é‡å°æ–‡ä»¶è¿›è¡Œå­˜å‚¨

- ä¸æ”¯æŒå¹¶å‘å†™å…¥æ–‡ä»¶å’Œéšæœºä¿®æ”¹

### YARNæ¶æ„

MRv1çš„å±€é™ï¼š

- æ‰©å±•æ€§å·®

- å¯é æ€§å·®

- èµ„æºåˆ©ç”¨ç‡ä½

- æ— æ³•æ”¯æŒå¤šç§è®¡ç®—æœºæ¡†æ¶

YARNæ˜¯ä¸€ä¸ªå¼¹æ€§è®¡ç®—å¹³å°ï¼Œä»–çš„ç›®æ ‡å·²ç»ä¸å±€é™äºæ”¯æŒMapReduceä¸€ç§è®¡ç®—æ¡†æ¶ï¼Œè€Œæ˜¯æœç€å¯¹å¤šç§æ¡†æ¶çš„ç»Ÿä¸€ç®¡ç†å‰è¿›

ä¼˜ç‚¹ï¼š

- èµ„æºåˆ©ç”¨ç‡é«˜

- è¿ç»´æˆæœ¬ä½

- æ•°æ®å…±äº«

å¯¹æ¯”ï¼š

|             | V1                                                               | V2                                                                         |
| ----------- | ---------------------------------------------------------------- | -------------------------------------------------------------------------- |
| åŸºæœ¬æ¡†æ¶        | JobTrackerç”±èµ„æºç®¡ç†å’Œä½œä¸šæ§åˆ¶ä¸¤éƒ¨åˆ†ç»„æˆ                                        | å°†JobTrackerçš„ä¸¤ä¸ªåŠŸèƒ½æ‹†åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œèµ„æºç®¡ç†è¿›ç¨‹è´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„èµ„æºï¼Œè€Œä½œä¸šæ§åˆ¶åˆ™æ˜¯ç›´æ¥ä¸åº”ç”¨ç¨‹åºç›¸å…³çš„æ¨¡å—ï¼Œæ¯ä¸ªè¿›ç¨‹åªè´Ÿè´£ä¸€ä¸ªä½œä¸š |
| ç¼–ç¨‹æ¨¡å‹ä¸æ•°æ®å¤„ç†å¼•æ“ |                                                                  | MRv2é‡ç”¨äº†v1ä¸­çš„ç¼–ç¨‹æ¨¡å‹ä¸æ•°æ®å¤„ç†å¼•æ“                                                     |
| è¿è¡Œæ—¶ç¯å¢ƒ       | ç”±JobTrackerå’ŒTaskTrackerä¸¤ç±»æœåŠ¡ç»„æˆï¼ŒJTè´Ÿè´£èµ„æºå’Œä»»åŠ¡çš„ç®¡ç†ä¸è°ƒåº¦ï¼ŒTTè´Ÿè´£å•ä¸ªèŠ‚ç‚¹çš„èµ„æºç®¡ç†å’Œä»»åŠ¡è¿›è¡Œ | å°†èµ„æºéƒ¨ç®¡ç†ä¸åº”ç”¨ç¨‹åºç®¡ç†åˆ†å¼€ï¼Œåˆ†åˆ«åˆYARNå’ŒApplicationMasterè´Ÿè´£                                |

#### YARNåŸºæœ¬æ¶æ„

æ€»ä½“ä¸Šä»ç„¶æ˜¯Master/Slaveæ¶æ„

YARNçš„ç»„æˆæˆåˆ†å¦‚ä¸‹ï¼š

- ResourceManagerï¼šä¸€ä¸ªå…¨å±€çš„èµ„æºç®¡ç†å™¨ï¼Œè´Ÿè´£æ•´ä¸ªç³»ç»Ÿçš„èµ„æºç®¡ç†ä¸åˆ†é…ã€‚å®ƒç”±ä¸¤ä¸ªç»„ä»¶æ„æˆï¼š
  
  - è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ï¼šæ ¹æ®å®¹é‡ã€é˜Ÿåˆ—ç­‰é™åˆ¶æ¡ä»¶å°†èµ„æºåˆ†é…ç»™å„ä¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº
  
  - åº”ç”¨ç¨‹åºç®¡ç†å™¨ï¼ˆApplication Manager ASMï¼‰ï¼šè´Ÿè´£æ•´ä¸ªç³»ç»Ÿä¸­æ‰€æœ‰åº”ç”¨ç¨‹åº

- ApplicationMasterï¼ˆAMï¼‰çš„ä¸»è¦åŠŸèƒ½æœ‰ï¼š
  
  - ä¸RMè°ƒåº¦å™¨åå•†ä»¥è·å–èµ„æºï¼ˆContainerï¼‰
  
  - å°†å¾—åˆ°çš„ä»»åŠ¡è¿›ä¸€æ­¥åˆ†ç»™å†…éƒ¨ä»»åŠ¡
  
  - ä¸NMé€šä¿¡ä»¥å¯åŠ¨/åœæ­¢ä»»åŠ¡
  
  - ç›‘æ§æ‰€æœ‰ä»»åŠ¡è¿è¡ŒçŠ¶æ€

- NodeManagerï¼šæ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šèµ„æºå’Œä»»åŠ¡ç®¡ç†å™¨

- Containerï¼šæ˜¯YARNå±±ä¸­çš„èµ„æºæŠ½è±¡ï¼Œå®ƒå°è£…äº†æŸä¸ªèŠ‚ç‚¹ä¸Šçš„å¤šç»´åº¦èµ„æº

## ç¬¬ä¸‰ç«  Hadoopè¿è¡Œæ¨¡å¼ä¸å¤§æ•°æ®æŠ€æœ¯æ¡†æ¶

Hadoopçš„è¿è¡Œæ¨¡å¼ä¸»è¦æœ‰å››ç§ï¼š

- æœ¬åœ°æ¨¡å¼

- ä¼ªåˆ†å¸ƒå¼

- å…¨åˆ†å¸ƒå¼

- é«˜å¯ç”¨æ¨¡å¼

### ä¼ªåˆ†å¸ƒå¼æ¨¡å¼

Hadoopå¯ä»¥è¿è¡Œåœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå…¶ä¸­æ¯ä¸€ä¸ªHadoopå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨å•ç‹¬çš„Javaè¿›ç¨‹ä¸­ï¼Œè¿™ä¸ªæ¨¡å¼ç§°ä¹‹ä¸ºä¼ªåˆ†å¸ƒå¼æ¨¡å¼ã€‚Hadoopæ‰€æœ‰è¿›ç¨‹éƒ½è¿è¡Œåœ¨ä¸€å°æœåŠ¡å™¨ä»¥æ¨¡æ‹Ÿå…¨åˆ†å¸ƒå¼æ¨¡å¼ï¼Œå¸¸ç”¨äºå­¦ä¹ é˜¶æ®µã€‚

åå°çš„äº”ä¸ªè¿›ç¨‹ä¸ºï¼š

- NameNode

- DataNode

- SecondaryNameNode

- ResourceManager

- NodeManager

### é«˜å¯ç”¨æ¨¡å¼

Hadoopæ˜¯ä¸€ç§ä¸»ä»å¼æ¶æ„ï¼Œè¿™æ ·å°±ä¼šæœ‰**å•ç‚¹æ•…éšœ**çš„é—®é¢˜

## HDFS

- æ•°æ®å—ï¼ˆblockï¼‰
  
  - HDFSé»˜è®¤çš„æœ€åŸºæœ¬çš„å­˜å‚¨å•ä½æ˜¯128MBçš„æ•°æ®å—
  
  - 128Mä¸ºä¸€å—
  
  - ä¸€ä¸ªæ–‡ä»¶å¦‚æœå°äºä¸€ä¸ªæ•°æ®å—çš„å¤§å°ï¼Œå¹¶ä¸å ç”¨æ•´ä¸ªæ•°æ®å—çš„ç©ºé—´

- å­˜æ”¾ç­–ç•¥ï¼ˆ3å‰¯æœ¬ï¼‰
  
  - ç¬¬ä¸€ä¸ªå’ŒclientåŒnode
  
  - ç¬¬äºŒä¸ªæ”¾åœ¨ä¸ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸åŒæœºæ¶ä¸­çš„éšæœºçš„ä¸€ä¸ªnode
  
  - ç¬¬ä¸‰ä¸ªæ”¾åœ¨ä¸ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸åŒçš„æœºæ¶ä¸­ä¸ç¬¬äºŒä¸ªä¸åŒçš„éšæœºnodeä¸­

- NameNode å’ŒDataNode
  
  - HDFSä½“ç³»ç»“æ„ä¸­æœ‰ä¸¤ç±»èŠ‚ç‚¹ï¼Œä¸€ç±»æ˜¯NameNode ( Master) ï¼Œåˆå«&quot;å…ƒæ•°æ®èŠ‚ç‚¹&quot;;å¦ä¸€ç±»æ˜¯DataNode (Slave) ï¼Œåˆå«&quot;æ•°æ® èŠ‚ç‚¹â€ã€‚
  
  - å…ƒæ•°æ®èŠ‚ç‚¹ç”¨æ¥ç®¡ç†æ–‡ä»¶ç³»ç»Ÿçš„å‘½åç©ºé—´ï¼Œä½œç”¨å¦‚ä¸‹ï¼š
    
    - å…¶å°†æ‰€æœ‰çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„å…ƒæ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ ç³»ç»Ÿæ ‘ä¸­
    
    - è¿™äº›ä¿¡æ¯ä¹Ÿä¼šåœ¨ç¡¬ç›˜ä¸Šä¿å­˜æˆä»¥ä¸‹æ–‡ä»¶:å‘½åç©ºé—´é•œåƒ(namespace image)åŠä¿®æ”¹æ—¥å¿—(edit log)
    
    - è¿˜ä¿å­˜äº†ä¸€ä¸ªæ–‡ä»¶åŒ…æ‹¬å“ªäº›æ•°æ®å—ï¼Œåˆ†å¸ƒåœ¨å“ªäº›æ•°æ®èŠ‚ç‚¹ä¸Šï¼Œç„¶è€Œè¿™äº›ä¿¡æ¯å¹¶ä¸å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼Œè€Œæ˜¯åœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ä»æ•°æ®èŠ‚ç‚¹æ”¶é›†è€Œæˆçš„
  
  - æ•°æ®èŠ‚ç‚¹æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çœŸæ­£å­˜å‚¨æ•°æ®çš„åœ°æ–¹ï¼Œä½œç”¨å¦‚ä¸‹:
    
    - å®¢æˆ·ç«¯(clien)æˆ–è€… å…ƒæ•°æ®ä¿¡æ¯(namenode)å¯ä»¥å‘æ•°æ®èŠ‚ç‚¹è¯·æ±‚å†™å…¥æˆ–è€…è¯»å‡ºæ•°æ®å—
    
    - å‘¨æœŸæ€§çš„å‘å…ƒæ•°æ®èŠ‚ç‚¹å›æŠ¥å…¶å­˜å‚¨çš„æ•°æ®å—ä¿¡æ¯
  
  - `hadoop.tmp.dir`ï¼Œä¸´æ—¶ç›®å½•ï¼Œå…¶ä»–ä¸´æ—¶ç›®å½•çš„çˆ¶ç›®å½•ï¼Œé»˜è®¤ `/tmp/hadoop-${user.name}`ï¼Œåœ¨`core-site.xml`ä¸­é…ç½®
  
  - å…ƒæ•°æ®èŠ‚ç‚¹ç›®å½•ç»“æ„ï¼Œåœ¨`hdfs-site.xml`ä¸­é…ç½®`dfs.name.dir`å‚æ•°ï¼Œä»¥`,`åˆ†éš”ï¼Œé»˜è®¤åœ¨`{hadoop.tmp.dir}/dir/name`

- æ•°æ®èŠ‚ç‚¹ç›®å½•ç»“æ„
  
  - åœ¨`hdfs-site.xml`ä¸­é…ç½®å‚æ•°`dfs.data.dir`ï¼Œä»¥`,`åˆ†éš”

- HDFSé€šä¿¡åè®®
  
  - æ‰€æœ‰HDFSé€šä¿¡åè®®éƒ½æ˜¯æ„å»ºåœ¨TCP/IPåè®®ä¸Šçš„

- HDFSå®‰å…¨æ¨¡å¼
  
  - Namenodeå¯åŠ¨åä¼šè¿›å…¥ä¸€ç§ç§°ä¸ºå®‰å…¨æ¨¡å¼çš„ç‰¹æ®ŠçŠ¶æ€ã€‚å¤„äºå®‰å…¨æ¨¡å¼çš„Namenodeæ˜¯ä¸ä¼šè¿›è¡Œæ•°æ®å—çš„å¤åˆ¶çš„ã€‚Namenodeä»æ‰€æœ‰çš„DataNodeæ¥å—å¿ƒè·³ä¿¡å·å’Œå—çŠ¶æ€æŠ¥å‘Š

**Name Nodeã€DataNode å’ŒClient**

- Namencodte æ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç´ ç»Ÿä¸­çš„ç®¡ç†è€…ï¼Œ ä¸»è¦è´Ÿè´£ç®¡ç† æ–‡ä»¶ç³»ç»Ÿçš„å‘½åç©ºé—´ã€é›†ç¾¤é…ç½®ä¿¡æ¯å’Œå­˜å‚¨å—çš„å¤åˆ¶ç­‰ã€‚NameNode ä¼šå°†æ–‡ä»¶ç³»ç»Ÿçš„Meta-data å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿™äº›ä¿¡æ¯ä¸»è¦åŒ…æ‹¬äº†æ–‡ä»¶ä¿¡æ¯ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”çš„æ–‡ä»¶å—çš„ä¿¡æ¯å’Œæ¯ä¸ª æ–‡ä»¶å—DataNodeçš„ä¿¡æ¯ç­‰ã€‚

- DataNodeæ˜¯æ–‡ä»¶å­˜å‚¨çš„åŸºæœ¬å•å…ƒï¼Œ å®ƒå°†Block å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¿å­˜äº†Block çš„meta-data,åŒæ—¶ å‘¨æœŸæ€§åœ°å°†æ‰€æœ‰å­˜åœ¨çš„Blockä¿¡æ¯å‘é€ç»™NameNode.

- Client å°±æ˜¯éœ€è¦è·å–åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶çš„åº”ç”¨ç¨‹åºã€‚

- Clientè¯»å–æ–‡ä»¶ä¿¡æ¯

### Hadoop Shellå‘½ä»¤

å®é™…ä¸Šæ˜¯å±æ€§ï¼Œå‘½ä»¤ä¸ºï¼š`hadoop fs -xx`

- `cat`:

- `chgrp`: change group

- `chmod`:

- `chown`

- `copyFromLocal`

- `copyToLocal`

- `cp`: copy

- `du`ï¼šæ˜¾ç¤ºç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶çš„å¤§å°

- `dus`ï¼šæ˜¾ç¤ºå•ä¸ªæ–‡ä»¶å¤§å°

- `expunge`ï¼šæ¸…ç©ºå›æ”¶ç«™

- `get`ï¼šå¤åˆ¶åˆ°æœ¬åœ°

- `getmerge`ï¼šå°† source dir ä¸­çš„æ–‡ä»¶é“¾æ¥æˆ local target dir

- ls

- lsrï¼šé€’å½’ls

- mkdir

- movefromLocal

- mv

- putï¼šæœ¬åœ°åˆ°è¿œç¨‹

- rm

- rmrï¼šé€’å½’rm

- setrepï¼šæ”¹å˜å‰¯æœ¬æ•°

- statï¼šè¿”å›æŒ‡å®šè·¯å¾„çš„ç»Ÿè®¡ä¿¡æ¯

- tailï¼šå°†å°¾éƒ¨1kbçš„å­—èŠ‚è¾“å‡ºåˆ°stdout

- testï¼šæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨

- textï¼šå°†æºæ–‡ä»¶è¾“å‡ºä¸ºæ–‡æœ¬æ ¼å¼

- touchzï¼šæ–°å»ºä¸€ä¸ª0è‡ªå·±çš„æ–‡ä»¶

Hadoopç®¡ç†å‘½ä»¤ï¼š

- distcpï¼šåˆ†å¸ƒå¼æ‹·è´ï¼ˆé›†ç¾¤ä¹‹é—´ï¼‰

- fsckï¼šæ£€æŸ¥æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å¥åº·æƒ…å†µ

- jarï¼šè¿è¡Œjavaæ–‡ä»¶

- jobï¼šç”¨äºå’ŒMapReduceäº¤äº’

- balancerï¼šè¿è¡Œé›†ç¾¤å¹³è¡¡å·¥å…·

- dfsadminï¼šè¿è¡Œä¸€ä¸ªdfs adminå®¢æˆ·ç«¯

- namenodeï¼š è¿è¡Œnamenode

### javaæ¥å£

Hadoopä¸­å…³äºæ–‡ä»¶æ“ä½œç±»åŸºæœ¬éƒ½åœ¨`org.apache.hadoop.fs`åŒ…ä¸­

Hadoopç±»åº“ä¸­æœ€ç»ˆé¢å‘ç”¨æˆ·æä¾›æ¥å£æ˜¯`FileSystem`

```java
// è·å–FileSystemå…·ä½“ç±»
static FileSystem get(Configuration conf);
// å†™æ–‡ä»¶
public FSDataOutputStream create(Path f) throws IOException;
//è¯»æ–‡ä»¶
// ä¸Šä¼ æ–‡ä»¶åˆ°HDFS
public void copyFileLocalFile(Path src,Path dist);
// é‡å‘½åæ–‡ä»¶
public abstract boolean rename(Path src, Path dist);
// åˆ é™¤æ–‡ä»¶&amp;ç›®å½•
public abstract boolean delete(Path f, boolean recursive) throws IOException;
// åˆ›å»ºç›®å½•
public boolean mkdirs(Path f) throws IOException;
// éå†ç›®å½•
public abstract FileStatus[] listStatus(Path f) throws FileNotFoundException, IOException
```

## MapReduce

```java
public void map(Object Key,Text value,Context context)
throws IOExcetion, InterruptedException{
    
}
```

### MapReduceå·¥ä½œåŸç†

MapReduceæ¡†æ¶çš„è¿ä½œå®Œå…¨åŸºäºâ€œé”®å€¼å¯¹â€ï¼Œå³æ•°æ®çš„è¾“å…¥æ˜¯ä¸€æ‰¹â€œé”®å€¼å¯¹â€ (key-value) ï¼Œç”Ÿæˆçš„ç»“æœä¹Ÿæ˜¯æ‰¹â€œé”®å€¼å¯¹â€ï¼Œåªæ˜¯æœ‰æ—¶å€™å®ƒä»¬çš„ç±»å‹ä¸ä¸€æ ·è€Œå·²ã€‚Keyå’Œvalueçš„ç±»ç”±äºéœ€è¦æ”¯æŒè¢«åºåˆ—åŒ– (Serealire) æ“ä½œï¼Œæ‰€ä»¥å®ƒä»¬å¿…é¡»è¦å®ç°`Writable` æ¥å£ï¼Œè€Œä¸”keyçš„ç±»è¿˜å¿…é¡»å®ç°`WirtableComparable`æ¥å£ï¼Œä½¿å¾—å¯ä»¥è®©æ¡†æ¶å¯¹æ•°æ®é›†çš„æ‰§è¡Œæ’åºæ“ä½œï¼ŒMapRedtreè¿è¡Œæœºåˆ¶ï¼ŒæŒ‰ç…§æ—¶é—´é¡ºåºåŒ…æ‹¬:è¾“å…¥åˆ†ç‰‡(input split)ã€map é˜¶æ®µã€combiner é˜¶æ®µã€shuffleé˜¶æ®µå’Œreduceé˜¶æ®µã€‚

åœ¨è¿›è¡Œmapè®¡ç®—ä¹‹å‰ï¼ŒMapReduceä¼šæ ¹æ®è¾“å…¥æ–‡ä»¶è®¡ç®—è¾“å…¥åˆ†ç‰‡

### YARNè¿è¡Œæµç¨‹

1. JobClient å‘YARYä¸­æäº¤åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­ åŒ…æ‹¬ApplicationMaster ç¨‹åºã€å¯åŠ¨ApplicationMasterçš„å‘½ä»¤ã€ç”¨æˆ·ç¨‹åºã€ç¯å¢ƒå˜é‡ã€ä½œä¸šä¿¡æ¯ã€æ–‡ä»¶ä½ç½®ä¿¡æ¯ç­‰

2. RecourseManagerä¸ºè¯¥åº”ç”¨ç¨‹åºåˆ†é…ç¬¬ä¸€ä¸ª Container. å¹¶ä¸å¯¹åº”çš„ Node-Manager é€šä¿¡ï¼ˆé€šè¿‡å¿ƒè·³æ–¹å¼ï¼‰ï¼Œæ›´æ±‚å®ƒåœ¨è¿™ä¸ªContainerä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„ApplicationMaster 

3. ApplicationMasteré¦–å…ˆå‘ReoourceManageræ³¨å†Œï¼Œè¿™æ ·ç”¨ æˆ·å¯ä»¥ç›´æ¥é€šè¿‡ResourceManageræŸ¥çœ‹åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ã€‚ç„¶åå®ƒå°†ä¸ºå„ä¸ªä»»åŠ¡ç”³è¯·èµ„æºï¼Œå¹¶ç›‘æ§å®ƒçš„è¿è¡ŒçŠ¶ï¼Œç›´åˆ°è¿è¡Œç»“æŸ

4.  ApplicationMaster é‡‡ç”¨è½®è¯¢çš„æ–¹å¼é€šè¿‡RPCåè®®å‘ResourceManagerç”³è¯·å’Œé¢†å–èµ„æº

5. ä¸€æ—¦ApplicationMasterç”³è¯·åˆ°èµ„æºåï¼Œä¾¿ä¸å¯¹åº”çš„NodeManageré€šä¿¡ï¼Œè¦æ±‚å®ƒå¯åŠ¨ä»»åŠ¡

6. NodeManagerä¸ºä»»åŠ¡è®¾ç½®å¥½è¿è¡Œç¯å¢ƒ(åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€JARåŒ…ã€äºŒè¿›åˆ¶ç¨‹åºç­‰)åï¼Œå°†ä»»åŠ¡å¯åŠ¨å‘½ä»¤å†™åˆ°ä¸€ä¸ªè„šæœ¬ä¸­ï¼Œ å¹¶é€šè¿‡è¿è¡Œè¯¥è„šæœ¬å¯åŠ¨ä»»åŠ¡ã€‚

7. å„ä¸ªä»»åŠ¡é€šè¿‡æŸä¸ªRPCåè®®å‘AplcationMasteræ±‡æŠ¥è‡ªå·±çš„çŠ¶æ€å’Œè¿›åº¦ï¼Œä»¥è®©ApplicationMasteréšæ—¶æŒæ¡å„ä¸ªä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œä»è€Œå¯ä»¥åœ¨ä»»åŠ¡å¤±è´¥æ—¶é‡æ–°å¯åŠ¨ä»»åŠ¡ã€‚

8. åº”ç”¨ç¨‹åºè¿è¡Œå®Œæˆåï¼Œ ApplicationMasterå‘ResourceManageræ³¨é”€å¹¶å…³é—­è‡ªå·±

### ä½œä¸šå…³é”®è¿‡ç¨‹è¯¦è§£

**map**ï¼šmapä»»åŠ¡æœ€ç»ˆæ˜¯äº¤ç»™Mapä»»åŠ¡æ‰§è¡Œå™¨

**Reduce**ï¼šä»æ‰€æœ‰mapèŠ‚ç‚¹å–åˆ°å±äºè‡ªå·±çš„mapè¾“å‡º

**Partitioner**ï¼šå½“Mapperå¤„ç†å¥½æ•°æ®åï¼Œéœ€è¦ä½¿ç”¨Partitionerï¼ˆåˆ†åŒºå™¨ï¼‰ç¡®å®šæ€æ ·åˆç†åœ°å°†Mapperè¾“å‡ºåˆ†é…åˆ°Reduceä¸Š

**Combiner**ï¼šç›¸å½“äºä¸€ä¸ªæœ¬åœ°çš„Reduceï¼Œä¸»è¦æ˜¯å¯¹Mapperè¾“å‡ºçš„å¤§é‡æœ¬åœ°æ–‡ä»¶è¿›è¡Œä¸€æ¬¡åˆå¹¶ã€‚Combinerå‡½æ•°æ‰§è¡Œæ—¶æœºå¯èƒ½æ˜¯åœ¨mapçš„mergeæ“ä½œå®Œæˆä¹‹å‰

### MapReduceå„ç§è¾“å…¥è¾“å‡º

**InputFormat**ï¼šè´Ÿè´£å¤„ç†MRçš„è¾“å…¥éƒ¨åˆ†ï¼Œæ¥å†³å®šMapçš„æ•°é‡ï¼ŒInputFormat

**FileInputFormat**ï¼šæ˜¯æ‰€æœ‰ä»¥æ–‡ä»¶ä½œä¸ºæ•°æ®æºçš„InputFormatå®ç°çš„åŸºç±»ï¼ŒFileInputFormatä¿å­˜ä½œä¸ºjobè¾“å…¥çš„æ‰€æœ‰æ–‡ä»¶

## MapReduce è®¾è®¡æ¨¡å¼

- **è¿‡æ»¤å™¨æ¨¡å¼**ï¼šè®¾å®šæŸç§æ¡ä»¶ï¼Œå½“è´Ÿè´£æ¡ä»¶æ—¶ä¿ç•™æ•°æ®ï¼Œä¸ç¬¦åˆæ¡ä»¶æ—¶ä¸¢å¼ƒæ•°æ®

- **Top N**ï¼šæ ¹æ®æ•°æ®é›†çš„æ’åï¼Œè·å–å‰Næ¡è®°å½•

- **å»é‡æ¨¡å¼**ï¼šå»é‡

- **æ•°æ®é‡ç»„**ï¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ’æ•´ç†æ•°æ®ã€‚æ•°æ®é‡ç»„è¦æ±‚åˆ’åˆ†çš„åˆ†åŒºæ•°é‡å·²ç»ç¡®å®šï¼Œåˆ’åˆ†åˆ†åŒºçš„æ¡ä»¶å·²ç»ç¡®å®š

-</p> </div> </div> </a>  </div><div class="card-item" data-astro-cid-p3vyftr4> <a href="/blog/subject/springcloud/" class="card-link" data-astro-cid-dohjnao5> <div class="card" data-astro-cid-dohjnao5> <div class="card-image" data-astro-cid-dohjnao5>  </div> <div class="card-content" data-astro-cid-dohjnao5> <h3 class="card-title" data-astro-cid-dohjnao5>SpringCloud çŸ¥è¯†æ•´ç†</h3> <p class="card-description" data-astro-cid-dohjnao5># SpringCloud çŸ¥è¯†ç‚¹æ¢³ç†

## ç¬¬äºŒç«   æ„å»ºspring cloud

### SpringBootç›®å½•ç»“æ„

- `src/main/java`ï¼šä¸»ç¨‹åºå…¥å£

- `src/main/resources`ï¼šé…ç½®ç›®å½•

- `src/test`ï¼šå•å…ƒæµ‹è¯•ç›®å½•

### Springbootä¾èµ–

Starter POMs æ˜¯ä¸€ç³»åˆ—è½»ä¾¿çš„ä¾èµ–åŒ…ï¼Œæ˜¯ä¸€å¥—ä¸€ç«™å¼çš„Springç›¸å…³æŠ€æœ¯çš„è§£å†³æ–¹æ¡ˆã€‚

SpringBootçš„StarterPOMsé‡‡ç”¨ `spring-boot-starter-*`å‘½åï¼Œ`*`è¡¨ç¤ºä¸€ä¸ªç‰¹åˆ«çš„åŠŸèƒ½æ¨¡å—ã€‚

æˆ‘ä»¬ç”¨åˆ°çš„POMsæœ‰ï¼š

- `spring-boot-starter-web`ï¼šå…¨æ ˆWebå¼€å‘æ¨¡å—

- `spring-boot-starter-test`ï¼šé€šç”¨æµ‹è¯•æ¨¡å—

### é…ç½®è¯¦è§£

springboot çš„é»˜è®¤é…ç½®æ–‡ä»¶ä½ç½®ä¸º `src/main/resources/application.properties`

#### è‡ªå®šä¹‰å‚æ•°

åœ¨application.yamlä¸­

```yaml
book:
    name: springboot
    author: charles
```

åœ¨javaä¸­

```java
@Component
@Data
public class Book{
    @Value(&quot;${book.name})
    private String name;
}
```

`@value` å±æ€§åœ¨åŠ è½½é…ç½®æ—¶æ”¯æŒä¸¤ç§è¡¨è¾¾å¼ï¼š

- PlaceHolderæ–¹å¼ï¼Œæ ¼å¼å¦‚ä¸Šï¼Œä¸º`${*}`

- SpELè¡¨è¾¾å¼ï¼Œæ ¼å¼ä¸º`#{*}`

#### å¤šç¯å¢ƒé…ç½®

å¤šç¯å¢ƒé…ç½®çš„æ–‡ä»¶åéœ€è¦æ»¡è¶³ `application-{profiles}.yaml`çš„æ ¼å¼ï¼Œå…¶ä¸­profileå¯¹åº”ä½ çš„ç¯å¢ƒè¡¨ç¤ºï¼š

- devï¼šå¼€å‘

- testï¼šæµ‹è¯•

- prodï¼šç”Ÿäº§

åŠ è½½é‚£ä¸ªç¯å¢ƒéœ€è¦åœ¨`application.yaml`ä¸­è®¾ç½®`spring.profile.active=*`å±æ€§

#### åŠ è½½é¡ºåº

springbootå±æ€§åŠ è½½é¡ºåºå¦‚ä¸‹ï¼š

1. åœ¨å‘½ä»¤è¡Œä¸­ä¼ å…¥çš„å‚æ•°ã€‚

2. SPRING APPLICATION JSONä¸­çš„å±æ€§ã€‚SPRING APPIATION JSONæ˜¯ä»¥JSONæ ¼å¼é…ç½®åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­çš„å†…å®¹

3. Java.comp/envä¸­çš„JNDIå±æ€§

4. Javaçš„ç³»ç»Ÿå±æ€§ï¼Œå¯ä»¥é€šè¿‡`System.getProperties ()`è·å¾—çš„å†…å®¹

5. æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒå˜é‡

6. é€šè¿‡`random.*`é…ç½®çš„éšæœºå±æ€§

7. ä½äºå½“å‰åº”ç”¨ jaråŒ…ä¹‹å¤–ï¼Œé’ˆå¯¹ä¸åŒ{profile}ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å†…å®¹ï¼Œä¾‹å¦‚`application- {profile} .properties`æˆ–æ˜¯YAMLå®šä¹‰çš„é…ç½®æ–‡ä»¶ã€‚

8. ä½äºå½“å‰åº”ç”¨jaråŒ…ä¹‹å†…ï¼Œé’ˆå¯¹ä¸åŒ{profile}ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å†…å®¹ï¼Œä¾‹å¦‚`aplication- {profilel} .properties` æˆ–æ˜¯YAMLå®šä¹‰çš„é…ç½®æ–‡ä»¶ã€‚

9. ä½äºå½“å‰åº”ç”¨jaråŒ…ä¹‹å¤–çš„`application.properties`å’ŒYAMLé…ç½®å†…å®¹

10. ä½äºå½“å‰åº”ç”¨jaråŒ…ä¹‹å†…çš„`application. properties`å’ŒYAMLé…ç½®å†…å®¹ã€‚

11. åœ¨`@Configuration `æ³¨è§£ä¿®æ”¹çš„ç±»ä¸­ï¼Œé€šè¿‡`@PropertySource` æ³¨è§£å®šä¹‰çš„å±æ€§ã€‚

12. åº”ç”¨é»˜è®¤å±æ€§ï¼Œä½¿ç”¨`SpringApplication setDefautProperties`å®šä¹‰çš„å†…å®¹

ä¼˜å…ˆçº§æŒ‰ä¸Šé¢çš„é¡ºåºç”±é«˜åˆ°ä½

### actuator

è¦æƒ³ä½¿ç”¨actuatoréœ€è¦æ·»åŠ ä¾èµ–ï¼š`spring-boot-starter-actuator`ï¼Œç„¶ååœ¨applicationæ·»åŠ å¦‚ä¸‹é…ç½®ä»¥æš´éœ²å…¨éƒ¨ç«¯ç‚¹ï¼š

```yaml
management:
    endpotints:
        web:
            exposure:
                include: &#39;*&#39;
```

actuatorçš„åŸç”Ÿæ–­ç‚¹åˆ†ä¸ºä¸‰ç±»ï¼š

- åº”ç”¨é…ç½®ç±»
  
  - `/beans`ï¼šè·å–ä¸Šä¸‹æ–‡æ‰€æœ‰çš„Beanï¼Œæ¯ä¸ªBeanéƒ½åŒ…å«ä»¥ä¸‹ä¿¡æ¯
    
    - scopeï¼šä½œç”¨åŸŸ
    
    - typeï¼šjavaç±»å‹
    
    - resourceï¼šclassæ–‡ä»¶çš„å…·ä½“è·¯å¾„
    
    - dependenciesï¼šä¾èµ–çš„beançš„åç§°
  
  - `/configprops`ï¼šé…ç½®å±æ€§
    
    - profixï¼šå±æ€§å‰ç¼€
    
    - propertiesï¼šå„ä¸ªå±æ€§çš„åç§°å’Œå€¼
  
  - `/env`ï¼šç”¨æ¥è·å–åº”ç”¨æ‰€æœ‰å¯ç”¨çš„ç¯å¢ƒå±æ€§æŠ¥å‘Š
  
  - `/mapping`ï¼šç”¨æ¥è¿”å›æ‰€æœ‰springMVCæ§åˆ¶å™¨çš„æ˜ å°„å…³ç³»

- åº¦é‡æŒ‡æ ‡ç±»
  
  - `/metrics`ï¼šè¿”å›å½“å‰åº”ç”¨çš„å„ç§é‡è¦æŒ‡æ ‡
  
  - `/health`ï¼šç”¨æ¥è·å–åº”ç”¨çš„å„ç±»å¥åº·æŒ‡æ ‡ä¿¡æ¯ï¼Œå½“é¡¹ç›®è¾ƒä¸ºç®€å•æ—¶ï¼Œåªæ ‡è¯†å‡ºåº”ç”¨çš„çŠ¶æ€
    
    - UNKNOWNï¼šæœªçŸ¥çŠ¶æ€ï¼Œ503
    
    - UPï¼šæ­£å¸¸ï¼Œ200
    
    - DOWNï¼šå¤±è´¥ï¼Œ503
    
    - OUT_OF_SERVICEï¼šä¸æä¾›å¯¹å¤–æœåŠ¡ï¼Œ200

- æ“ä½œæ§åˆ¶ç±»
  
  - `/shutdown`ï¼šåªæä¾›äº†è¿™ä¸€ä¸ªï¼Œä¸æ”¯æŒgetè¯·æ±‚

## ç¬¬ä¸‰ç«  æœåŠ¡æ²»ç† Alibaba Nacos

### å¸¸è§æ–¹æ¡ˆ

`Spring Cloud Eureka`ï¼šæ—¢åŒ…å«äº†æœåŠ¡ç«¯ç»„ä»¶ï¼ŒåˆåŒ…å«äº†å®¢æˆ·ç«¯ç»„ä»¶ï¼Œå¹¶ä¸”æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å‡é€šè¿‡javaç¼–å†™

`zookeeper`ï¼šä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ï¼Œæ˜¯Chubbyçš„ä¸€ä¸ªå¼€æºå®ç°ï¼Œæ˜¯Hadoopå’ŒHbaseçš„é‡è¦ç»„ä»¶

`Consul`ï¼šæ‰€ä»¥ä¸€ä¸ªæœåŠ¡ç½‘ç»œçš„è§£å†³æ–¹æ¡ˆï¼Œä»–æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„é«˜å¯ç”¨çš„ç³»ç»Ÿï¼Œè€Œä¸”å¼€å‘ä½¿ç”¨éƒ½å¾ˆç®€ä¾¿ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„æ§åˆ¶å¹³é¢ï¼Œå®ƒçš„ä¸»è¦ç‰¹ç‚¹æ˜¯ï¼šæœåŠ¡å‘ç°ã€å¥åº·æ£€æŸ¥ã€é”®å€¼å­˜å‚¨ã€å®‰å…¨æœåŠ¡é€šä¿¡ã€å¤šæ•°æ®ä¸­å¿ƒ

`Nacos`ï¼šå¸®åŠ©å‘ç°ã€é…ç½®å’Œç®¡ç†å¾®æœåŠ¡

### Nacos

ä¿®æ”¹ç«¯å£ï¼šé»˜è®¤ç«¯å£8848ï¼Œå¯ä»¥è¿›å…¥nacos/confç›®å½•ä¿®æ”¹`application.propertoes`çš„`server.port`å±æ€§

å¯åŠ¨ï¼šè¿è¡Œ`startup.cmd -m standalone`ï¼ˆå•ä¾‹æ¨¡å¼è¿è¡Œï¼‰

è®¿é—®ï¼šé»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯nacos

#### æ³¨å†ŒæœåŠ¡æä¾›è€…

```yml
spring:
    application:
        name: #è¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡åç§°
        cloud:
            nacos:
                server-addr: localhost:8848 #æœåŠ¡ç«¯åœ°å€
```

#### æœåŠ¡å‘ç°ä¸æ¶ˆè´¹

```java
@Bean
@LoadBalanced
public RestTemplete restTemplete(){
    // ...
}
```

## ç¬¬å››ç«  è´Ÿè½½å‡è¡¡ Ribbon

SpringCloud Ribbonæ˜¯ä¸€ä¸ªåŸºäºHTTPå’ŒTCPçš„**å®¢æˆ·ç«¯**è´Ÿè½½å‡è¡¡å·¥å…·ï¼Œä»–åŸºäºNetflix Ribbonå®ç°ã€‚

è™½ç„¶å®ƒåªæ˜¯ä¸€ä¸ªå·¥å…·ç±»æ¡†æ¶ï¼Œä¸åƒæœåŠ¡æ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒã€APIç½‘å…³é‚£æ ·éœ€è¦ç‹¬ç«‹éƒ¨ç½²ï¼Œä½†æ˜¯å®ƒå‡ ä¹å­˜åœ¨åœ¨æ¯ä¸€ä¸ªSpringCloudæ„å»ºçš„å¾®æœåŠ¡å’ŒåŸºç¡€è®¾æ–½ä¸­ã€‚

å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡æœ€å¤§çš„ä¸åŒç‚¹åœ¨äºæœåŠ¡æ¸…å•æ‰€å­˜å‚¨çš„ä½ç½®ã€‚

- æœåŠ¡æä¾›è€…åªéœ€è¦å¯åŠ¨å¤šä¸ªæœåŠ¡å®ä¾‹å¹¶æ³¨å†Œåˆ°ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒæˆ–æ˜¯å¤šä¸ªç›¸å…³è”çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒ

- æœåŠ¡æ¶ˆè´¹è€…ç›´æ¥é€šè¿‡è°ƒç”¨è¢«@LoadBalancedæ³¨è§£ä¿®é¥°è¿‡çš„RestTemplateæ¥å®ç°é¢å‘æœåŠ¡çš„æ¥å£è°ƒç”¨

### åˆ†æ

è´Ÿè½½å‡è¡¡å™¨åº”è¯¥å…·å¤‡è¿™æ ·å‡ ç§èƒ½åŠ›ï¼š

- `ServiceInstance choose(String serviceId)`ï¼šæ ¹æ®ä¼ å…¥çš„æœåŠ¡åä»è´Ÿè½½å‡è¡¡å™¨ä¸­æŒ‘é€‰ä¸€ä¸ªå¯¹åº”æœåŠ¡çš„å®ä¾‹

- `T excute(String serviceId, LoadBalancerRequest request)`ï¼šä½¿ç”¨ä»è´Ÿè½½å‡è¡¡å™¨ä¸­æŒ‘é€‰å‡ºçš„æœåŠ¡å®ä¾‹æ¥æ‰§è¡Œè¯·æ±‚å†…å®¹

- `URI reconstuctURI(ServiceInstance instance, URI origianl)`ï¼šä¸ºç³»ç»Ÿæ„å»ºåˆé€‚çš„hostzportå½¢å¼çš„URI

### è´Ÿè½½å‡è¡¡å™¨

- AbstractLoadBalancer æ˜¯ ILoadBanlancer æ¥å£çš„æŠ½è±¡å®ç°ï¼Œåœ¨è¯¥æŠ½è±¡ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªå…³äºæœåŠ¡å®ä¾‹çš„åˆ†ç»„æšä¸¾ç±»ServerGroup

- BaseLoadBalancer æ˜¯ Ribbonè´Ÿè½½å‡è¡¡å™¨çš„åŸºç¡€å®ç°ç±»

- DynamicServerListLoadBalancerç±»æ˜¯ç»§æ‰¿äºBaseLoadBalancerç±»ï¼Œä»–æ˜¯å¯¹åŸºç¡€è´Ÿè½½å‡è¡¡å™¨çš„æ‰©å±•

- ZoneAwareLoadBalancer è´Ÿè½½å‡è¡¡å™¨æ˜¯å¯¹ DynamicServerListLoadBalancerçš„æ‰©å±•

### è´Ÿè½½å‡è¡¡ç­–ç•¥

- AbstractLoadBalancerRuleï¼Œè´Ÿè½½å‡è¡¡å™¨ç­–ç•¥æŠ½è±¡ç±»ï¼Œåœ¨è¯¥æŠ½è±¡ç±»ä¸­å®šä¹‰äº†è´Ÿè½½å‡è¡¡å™¨ILoadBalancerå¯¹è±¡

- ClientConfigEnabledRoundRobinRule,è¯¥ç­–ç•¥è¾ƒä¸ºç‰¹æ®Šï¼Œä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒæœ¬èº«å¹¶æ²¡æœ‰å®ç°ä»€ä¹ˆç‰¹æ®Šçš„å¤„ç†é€»è¾‘ï¼Œä»–åœ¨å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªRoundRobinRuleç­–ç•¥

- PredicateBaseRuleï¼Œæ˜¯ä¸€ä¸ªæŠ½è±¡ç­–ç•¥ï¼Œç»§æ‰¿äº†ClientConfigEnabledRoundRobinRuleï¼Œä»å…¶å‘½åä¸­å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªä¸€ä¸ªåŸºäºPredicateå®ç°çš„ç­–ç•¥

| å†…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ç±»                 | è§„åˆ™æè¿°                                                                                                                                                               |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| RoundRobinRule            | ç®€å•è½®è¯¢æœåŠ¡åˆ—è¡¨æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚å®ƒæ˜¯Rbboné»˜è®¤çš„è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚                                                                                                                                   |
| AvailabilityFilteringRule | å¯¹ä»¥ä¸‹ä¸¤ç§æœåŠ¡å™¨è¿›è¡Œå¿½ç•¥: (1) åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°æœåŠ¡å™¨å¦‚æœ3æ¬¡è¿æ¥å¤±è´¥ï¼Œè¿™å°æœåŠ¡å™¨å°±ä¼šè¢«è®¾ç½®ä¸ºçŸ­è·¯â€çŠ¶æ€ã€‚çŸ­è·¯çŠ¶æ€å°†æŒç»­30ç§’ï¼Œå¦‚æœå†æ¬¡è¿æ¥å¤±è´¥ï¼ŒçŸ­è·¯çš„æŒç»­æ—¶é—´å°±ä¼šå‡ ä½•çº§åœ°å¢åŠ ã€‚(2) å¹¶å‘æ•°è¿‡é«˜çš„æœåŠ¡å™¨ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å™¨çš„å¹¶å‘è¿æ¥æ•°è¿‡é«˜ï¼Œé…ç½®äº†AvailabiliyFilteringRuleè§„åˆ™çš„å®¢æˆ·ç«¯ä¹Ÿä¼šå°†å…¶å¿½ç•¥ã€‚ |
| WeightedResponseTimeRule  | ä¸ºæ¯ä¸€ä¸ªæœåŠ¡å™¨èµ‹äºˆä¸€ä¸ªæƒé‡å€¼ã€‚ æœåŠ¡å™¨å“åº”æ—¶é—´è¶Šé•¿ï¼Œè¿™ä¸ªæœåŠ¡å™¨çš„æƒé‡å°±è¶Šå°ã€‚è¿™ä¸ªè§„åˆ™ä¼šéšæœºé€‰æ‹©æœåŠ¡å™¨ï¼Œè¿™ä¸ªæƒé‡å€¼ä¼šå½±å“æœåŠ¡å™¨çš„é€‰æ‹©ã€‚                                                                                                 |
| ZoneAvoidanceRule         | ä»¥åŒºåŸŸå¯ç”¨çš„æœåŠ¡å™¨ä¸ºåŸºç¡€è¿›è¡ŒæœåŠ¡å™¨çš„é€‰æ‹©ã€‚ä½¿ç”¨Zoneå¯¹æœåŠ¡å™¨è¿›è¡Œåˆ†ç±»ï¼Œè¿™ä¸ªZomeå¯ä»¥ç†è§£ä¸ºä¸ªæœºæˆ¿ã€ä¸€ä¸ªæœºæ¶ç­‰ã€‚è€Œåå†å¯¹Zomeå†…çš„å¤šä¸ªæœåŠ¡åšè½®è¯¢                                                                                         |
| BestvailableRule          | å¿½ç•¥é‚£äº›çŸ­è·¯çš„æœåŠ¡å™¨ï¼Œå¹¶é€‰æ‹©å¹¶å‘æ•°è¾ƒä½çš„æœåŠ¡å™¨ã€‚                                                                                                                                           |
| RandomRule                | éšæœºé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡å™¨                                                                                                                                                       |
| RetryRule                 | é‡è¯•æœºåˆ¶çš„é€‰æ‹©é€»è¾‘                                                                                                                                                          |
| NacosRule                 | æ”¯æŒä¼˜å…ˆè°ƒç”¨åŒä¸ªé›†ç¾¤å®ä¾‹çš„ rbbonè´Ÿè½½å‡è¡¡è§„åˆ™                                                                                                                                          |

### é…ç½®è¯¦è§£

#### è‡ªåŠ¨åŒ–é…ç½®

Ribbonèƒ½å¤Ÿè‡ªåŠ¨é…ç½®ä¸‹é¢è¿™äº›æ¥å£çš„å®ç°

- IClientConfig: Ribonçš„å®¢æˆ·ç«¯é…ç½®ï¼Œ é»˜è®¤é‡‡ç”¨com.netflix.client.config.DefaultlCientCnfigimplå®ç°

- IRule: Ribbonçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé»˜è®¤é‡‡ç”¨com.netflix.loadbalancer,ZoneAvoidanceRuleå®ç°ï¼Œè¯¥ç­–ç•¥èƒ½å¤Ÿåœ¨å¤šåŒºåŸŸç¯å¢ƒä¸‹é€‰å‡ºæœ€ä½³åŒºåŸŸçš„å®ä¾‹è¿›è¡Œè®¿é—®ã€‚

- IPing: Ribbonçš„å®ä¾‹æ£€æŸ¥ç­–ç•¥ï¼Œé»˜è®¤é‡‡ç”¨com.netfix.loadbalancer.DummyPingå®ç°ï¼Œè¯¥æ£€æŸ¥ç­–ç•¥æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å®ç°ï¼Œå®é™…ä¸Šå®ƒå¹¶ä¸ä¼šæ£€æŸ¥å®ä¾‹æ˜¯å¦å¯ç”¨ï¼Œè€Œæ˜¯å§‹ç»ˆè¿”å›true,é»˜è®¤è®¤ä¸ºæ‰€æœ‰æœä¸Šé¢åŠ¡å®ä¾‹éƒ½æ˜¯å¯ç”¨çš„ã€‚

- ServerList: æœåŠ¡å®ä¾‹æ¸…å•çš„ç»´æŠ¤æœºåˆ¶ï¼Œé»˜è®¤é‡‡ç”¨com.netfix.loadbalancer.ConfigurationBasedServerListå®ç°ã€‚

- ServerListFilter: æœåŠ¡å®ä¾‹æ¸…å•è¿‡æ»¤æœºåˆ¶ï¼Œé»˜è®¤é‡‡ç”¨org.springrameworkcloud.netflix.ribbon.ZomeAwareKiadBakabcerå®ç°ï¼Œè¯¥ç­–ç•¥èƒ½å¤Ÿä¼˜å…ˆè¿‡æ»¤å‡ºä¸è¯·æ±‚è°ƒç”¨æ–¹å¤„äºåŒåŒºåŸŸçš„æœåŠ¡å®ä¾‹ã€‚

- lLoadBalancer: è´Ÿè½½å‡è¡¡å™¨ï¼Œé»˜è®¤é‡‡ç”¨com.netflix.loadbalancer.ZoneAwareloadBalancerå®ç°ï¼Œå®ƒå…·å¤‡äº†åŒºåŸŸæ„ŸçŸ¥çš„èƒ½åŠ›ã€‚

é’ˆå¯¹ä¸€äº›ä¸ªæ€§åŒ–éœ€æ±‚å¯ä»¥åœ¨springbootä¸­åˆ›å»ºå¯¹åº”çš„å®ç°å®ä¾‹å³å¯è¦†ç›–é»˜è®¤é…ç½®ï¼Œæ¯”å¦‚

```java
@Bean
public Irule rule(){
    return new NacosRule();
}
```

#### å‚æ•°é…ç½®

å¯¹äºRIbbonçš„é…ç½®æœ‰ä¸¤ç§ï¼š

- å…¨å±€é…ç½®ï¼šä½¿ç”¨`ribbon.&lt;key&gt; = &lt;value&gt;`æ ¼å¼è¿›è¡Œé…ç½®

- æŒ‡å®šå®¢æˆ·ç«¯é…ç½®ï¼š`&lt;client&gt;.ribbon.&lt;key&gt;=&lt;value&gt;`çš„æ ¼å¼è¿›è¡Œé…ç½®

**IRuleé…ç½®**ï¼š

```yaml
userservice:
    ribbon:
        NFLoadBalancerRuleClassName: &lt;value&gt; # è´Ÿè½½å‡è¡¡è§„åˆ™ç±»å…¨å
```

**é¥¥é¥¿åŠ è½½**ï¼š

```yml
ribbon:
    eager-load:
        enabled:true
        client:
            - userservice
```

**ä¸Nacosç»“åˆ**

```yaml
spring:
    application:
        name: userservice #æœåŠ¡åç§°
    cloud:
        nacos:
            server-addr: &lt;value&gt; #æœåŠ¡ç«¯åœ°å€
            discovery:
                cluster-name: &lt;value&gt; # åŒºåŸŸé›†ç¾¤åç§°
```

**é‡è¯•æœºåˆ¶**

```yaml
userservice:
    ribbon:
        ConnectTimeout: 200 #é“¾æ¥è¶…æ—¶æ—¶é—´
        ReadTimeout: 200 #è¯·æ±‚è¶…æ—¶æ—¶é—´
        OkToRetryOnAllOperations: true #æ˜¯å¦å¯¹æ‰€æœ‰æ“ä½œéƒ½å…è®¸é‡è¯•
        MaxAutoRetriesNextServer: 2 # åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°
        MaxAutoRetries: 1 # å½“å‰å®ä¾‹çš„é‡è¯•æ¬¡æ•°
```

## ç¬¬äº”ç«  æœåŠ¡å®¹é”™ä¿æŠ¤ Hystrix

å¿«é€Ÿå…¥é—¨ï¼š

```java
@EnableCircuitBreaker //å¯åŠ¨æ–­è·¯å™¨
```

### åˆ†æ

#### å‘½ä»¤æ‰§è¡Œ

- `execute()` åŒæ­¥æ‰§è¡Œï¼Œä»ä¾èµ–çš„æœåŠ¡è¿”å›ä¸ªå•ä¸€çš„ç»“æœå¯¹è±¡ï¼Œæˆ–æ˜¯åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸

- `queue()` å¼‚æ­¥æ‰§è¡Œï¼Œ ç›´æ¥è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†æœåŠ¡æ‰§è¡Œç»“æŸæ—¶è¦è¿”å›å•ä¸€ç»“æœå¯¹è±¡ã€‚

- `observe()` è¿”å›æ¥è‡ªä¾èµ–é¡¹çš„å“åº”çš„Observableå¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœ,å®ƒæ˜¯ä¸€ä¸ªhot Observable

- `toObservable()` åŒæ ·ä¼šè¿”å› Observable å¯¹è±¡ï¼Œä¹Ÿä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœï¼Œä½†å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªcold Observableã€‚

#### æ–­è·¯å™¨æ˜¯å¦æ‰“å¼€

- å¦‚æœæ–­è·¯å™¨æ˜¯æ‰“å¼€çš„ï¼Œé‚£ä¹ˆHystrixä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œè€Œæ˜¯è½¬åˆ°fallbackå¤„ç†é€»è¾‘

- å¦‚æœæ–­è·¯å™¨å…³é—­ï¼Œåˆ™ä¼šæ£€æµ‹æ˜¯å¦æœ‰å¯ç”¨èµ„æºæ‰§è¡Œå‘½ä»¤

#### è¯·æ±‚æ–¹æ³•

- `HystrixCommand.run()` è¿”å›ä¸€ä¸ªå•ä¸€çš„ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸

- `HystrixObservableCommand,constuct()` è¿”å›ä¸€ä¸ªObservable å¯¹è±¡æ¥å‘å°„å¤šä¸ªç»“æœæˆ–é€šè¿‡ onError å‘é€é”™è¯¯é€šçŸ¥

#### è®¡ç®—æ–­è·¯å™¨å¥åº·åº¦

Hystrixä¼šå°† æˆåŠŸ ã€ å¤±è´¥ ã€ æ‹’ç» ã€ è¶…æ—¶ç­‰ä¿¡æ¯æŠ¥å‘Šç»™æ–­è·¯å™¨

#### fallbackå¤„ç†

- `execute()` : æŠ›å‡ºå¼‚å¸¸ã€‚

- `queue()`: æ­£å¸¸è¿”å›Futureå¯¹è±¡ï¼Œä½†æ˜¯å½“è°ƒç”¨get 0æ¥è·å–ç»“æœçš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

- `observe()`: æ­£å¸¸è¿”å›Observable å¯¹è±¡ï¼Œå½“è®¢é˜…å®ƒçš„æ—¶å€™ï¼Œå°†ç«‹å³é€šè¿‡è°ƒç”¨è®¢é˜…è€…çš„onErroræ–¹æ³•æ¥é€šçŸ¥ä¸­æ­¢è¯·æ±‚ã€‚

- `tobservable()`: æ­£å¸¸è¿”å›Obsevableå¯¹è±¡ï¼Œå½“è®¢é˜…å®ƒçš„æ—¶å€™ï¼Œ å°†é€šè¿‡è°ƒç”¨è®¢é˜…è€…çš„onErroræ–¹æ³•æ¥é€šçŸ¥ä¸­æ­¢è¯·æ±‚ã€‚

#### æˆåŠŸçš„å“åº”

- `exeoute()` ä»¥ä¸queue ç›¸åŒçš„æ–¹å¼è·å–ä¸€ä¸ªFuture,ç„¶ååœ¨è¿™ä¸ªFuture ä¸Šè°ƒç”¨get()è·å–ç”±Observableå‘å‡ºçš„å•ä¸ªå€¼

- `queue()` å°†Obervableè½¬æ¢ä¸ºä¸€ä¸ªBlockingObservable,ä»¥ä¾¿å®ƒå¯ä»¥è¢«è½¬æ¢ä¸ºä¸€ä¸ªFutureç„¶åè¿”å›è¿™ä¸ªFuture

- `observe ()` åœ¨toObservable()äº§ç”ŸåŸå§‹Observable ä¹‹åç«‹å³è®¢é˜…å®ƒï¼Œè®©å‘½ä»¤èƒ½å¤Ÿé©¬ä¸Šå¼€å§‹å¼‚æ­¥æ‰§è¡Œï¼Œäº•è¿”å›ä¸€ä¸ª Observableå¯¹è±¡ï¼Œå½“è°ƒç”¨å®ƒçš„subscribeæ—¶ï¼Œå°†é‡æ–°äº§ç”Ÿç»“æœå’Œé€šçŸ¥ç»™è®¢é˜…è€…ã€‚

- `toObservable()` è¿”å›æœ€åŸå§‹çš„Observable,å¿…é¡»é€šè¿‡è®¢é˜…å®ƒæ‰ä¼šçœŸæ­£è§¦å‘å‘½ä»¤çš„æ‰§è¡Œæµç¨‹ã€‚

### æ–­è·¯å™¨

ä¸‰ä¸ªæŠ½è±¡æ–¹æ³•ï¼š

- `allowRequest()`ï¼šæ¯ä¸ªHystrixçš„å‘½ä»¤çš„è¯·æ±‚éƒ½é€šè¿‡ä»–å»åˆ¤æ–­æ˜¯å¦è¢«æ‰§è¡Œ

- `isOpen()`ï¼šè¿”å›å½“å‰æ–­è·¯å™¨æ˜¯å¦æ‰“å¼€

- `markSuccess()`ï¼šé—­åˆæ–­è·¯å™¨

#### åˆ›å»ºè¯·æ±‚å‘½ä»¤

```java
@GetMapping(&quot;/{param}&quot;)
@HystrixCommand(fallbackMethod = &quot;showAppInfoFallback&quot;)
public String showAppInfo(@PathVariable(&quot;param&quot;) String params){
    String url = &quot;...&quot;;
    return restTemplate.getForObject(url,String.class);
}
```

#### å®šä¹‰æœåŠ¡é™çº§

```java
public String showAppInfoFallback(String param){
    return &quot;busy&quot;;
}
```

```java
/**
* æœåŠ¡é™çº§æ–¹æ³•
*/
@HystrixCommand(fallbackMethod = &quot;showAppInfoCallback&quot;)
public String ShowAppInfoFallback(String param){
    ...
}
```

#### å¼‚å¸¸è·å–

æ³¨è§£é…ç½®æ–¹å¼çš„å®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦fallbackå®ç°æ–¹æ³•çš„å‚æ•°ä¸­å¢åŠ Throwableå¯¹è±¡çš„å®šä¹‰ï¼Œè¿™æ ·åœ¨æ–¹æ³•å†…éƒ¨å°±å¯ä»¥è·å–é™¤æ³•æœåŠ¡é™çº§çš„å…·ä½“å¼‚å¸¸å†…å®¹äº†

```java
public String showAppInfoFallBack(String param,Throwable exception){
//    ...something
}
```

#### @Hystrixæ³¨è§£

```java
@HystrixCommand(fallbackMethod = &quot;...&quot;
                ignoreException = {Exception.class}
                commandKey = &quot;...&quot;
                groupKey = &quot;...&quot;
                threadPoolKey = &quot;...&quot;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â )
```

#### è¯·æ±‚ç¼“å­˜

| æ³¨è§£           | æè¿°                                                                                                                     | å±æ€§                        |
| ------------ | ---------------------------------------------------------------------------------------------------------------------- | ------------------------- |
| @CacheResult | è¯¥æ³¨è§£ç”¨æ¥æ ‡è®°è¯·æ±‚å‘½ä»¤è¿”å›çš„ç»“æœcacheKeyMethodåº”è¯¥è¢«ç¼“å­˜ï¼Œå®ƒå¿…é¡»ä¸@HystrixCommandæ³¨è§£ç»“åˆä½¿ç”¨                                                          | cacheKeyMethod            |
| @CacheRemove | è¯¥æ³¨è§£ç”¨æ¥è®©è¯·æ±‚å‘½ä»¤çš„ç¼“å­˜å¤±æ•ˆ,å¤±æ•ˆçš„ç¼“å­˜æ ¹æ®å®šä¹‰çš„Keyå†³å®š                                                                                        | commandKey,cacheKeyMethod |
| @CacheKey    | è¯¥æ³¨è§£ç”¨æ¥åœ¨è¯·æ±‚å‘½ä»¤çš„å‚æ•°ä¸Šæ ‡è®°ï¼Œä½¿å…¶ä½œä¸ºç¼“å­˜çš„Keyå€¼ï¼Œå¦‚æœæ²¡æœ‰æ ‡æ³¨åˆ™ä¼šä½¿ç”¨æ‰€æœ‰å‚æ•°ã€‚å¦‚æœåŒæ—¶è¿˜ä½¿ç”¨äº†@CacheResultå’Œ@CacheRemoveæ³¨è§£çš„cacheKeyMethodæ–¹æ³•æŒ‡å®šç¼“å­˜Keyçš„ç”Ÿæˆï¼Œé‚£ä¹ˆè¯¥æ³¨è§£å°†ä¸ä¼šèµ·ä½œç”¨ | value                     |

#### è®¾ç½®è¯·æ±‚ç¼“å­˜

```java
@CacheResult
```

å®šä¹‰ä¸€ä¸ªfilter

```java
HystrixRequestContext context = HystrixRequestContext.initializeContext();
```

#### å®šä¹‰ç¼“å­˜key

```java
@HystrixCommand(fallbackMethod = &quot;showAppInfoCallback&quot;)
@CacheResult(CacheKeyMethod = &quot;cacheKey&quot;)
public User getUserInfo(@PathVariable(&quot;id&quot;) @CacheKey String id){
    // something
}

public String cacheKey(String id){
    return id;
}
```

#### ç¼“å­˜æ¸…ç†

`@CacheRemove`æ³¨è§£çš„`commandKey`å±æ€§æ˜¯å¿…é¡»è¦æŒ‡å®šçš„ï¼Œå®ƒç”¨æ¥æŒ‡æ˜éœ€è¦ä½¿ç”¨è¯·æ±‚ç¼“å­˜çš„è¯·æ±‚å‘½ä»¤ï¼Œå› ä¸ºåªæœ‰é€šè¿‡è¯¥å±æ€§çš„é…ç½®ï¼ŒHystrixæ‰èƒ½çŸ¥é“æ­£ç¡®çš„è¯·æ±‚å‘½ä»¤ç¼“å­˜ä½ç½®ã€

#### æ³¨è§£è¯·æ±‚åˆå¹¶

`@HystrixCollapser`

#### è¯·æ±‚åˆå¹¶çš„é¢å¤–å¼€é”€

- è¯·æ±‚å‘½ä»¤æœ¬èº«çš„å»¶è¿Ÿ

- å»¶è¿Ÿæ—¶é—´çª—å†…çš„å¹¶å‘é‡

### å±æ€§è¯¦è§£

4ä¸ªä¸åŒä¼˜å…ˆçº§åˆ«çš„é…ç½®(ä¼˜å…ˆçº§ç”±ä½åˆ°é«˜)ï¼š

- å…¨å±€æ•°è®¤å€¼:å¦‚æœæ²¡æœ‰è®¾ç½®ä¸‹é¢ä¸‰ä¸ªçº§åˆ«çš„å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æ˜¯é»˜è®¤å€¼ã€‚ç”±äºè¯¥å±æ€§é€šè¿‡ä»£ç å®šä¹‰ï¼Œæ‰€ä»¥å¯¹äºè¿™ä¸ªçº§åˆ«ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨å®ƒåœ¨ä»£ç ä¸­å®šä¹‰çš„é»˜è®¤å€¼å³å¯ã€‚

- å…¨åŒé…ç½®å±æ€§:é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰å…¨å±€å±æ€§å€¼ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶æˆ–åœ¨ä¸SpringCloud Comfigå’ŒSpring Cloud Buså®ç°çš„åŠ¨æ€åˆ·æ–°é…ç½®åŠŸèƒ½é…åˆä¸‹ï¼Œå¯ä»¥å®ç°å¯¹â€œå…¨å±€é»˜è®¤å€¼â€çš„è¦†ç›–ä»¥åŠåœ¨è¿è¡ŒæœŸå¯¹â€œå…¨å±€é»˜è®¤å€¼â€çš„åŠ¨æ€è°ƒæ•´

- å®ä¾‹é»˜è®¤å€¼ã€‚é€šè¿‡ä»£ç ä¸ºå®ä¾‹å®šä¹‰çš„é»˜è®¤å€¼ã€‚é€šè¿‡ä»£ç çš„æ–¹å¼ä¸ºå®ä¾‹è®¾ç½®å±æ€§å€¼æ¥è¦†ç›–é»˜è®¤çš„å…¨åŒé…ç½®ã€‚

- å®ä¾‹é…ç½®å±æ€§ã€‚é€šè¿‡é…ç½®æ–‡ä»¶æ¥ä¸ºæŒ‡å®šçš„å®ä¾‹è¿›è¡Œå±æ€§é…ç½®ï¼Œä»¥è¦†ç›–å‰é¢çš„ä¸‰ä¸ªé»˜è®¤å€¼

**Commandå±æ€§**

| å±æ€§çº§åˆ«   | é»˜è®¤å€¼ã€é…ç½®æ–¹å¼ã€é…ç½®å±æ€§                                                              |
| ------ | -------------------------------------------------------------------------- |
| å…¨å±€é»˜è®¤å€¼  | THRAD                                                                      |
| å…¨å±€é…ç½®å±æ€§ | Hystrix.command.default.execution.isolation.strategy                       |
| å®ä¾‹é»˜è®¤å€¼  | å¯é€šè¿‡@HystrixProperty(name = &quot;excution.isolation.strategy&quot; value = &quot;THREAD&quot;) |
| å®ä¾‹é…ç½®å±æ€§ | hystrix.command.HystrixCommandKey.execution.isolation.strategy             |

### Hystrix ä»ªè¡¨ç›˜

ä¸ºå¯åŠ¨ç±»åŠ ä¸Š@EnableHystrixDashboard, å¯ç”¨Hystrix DashBoardåŠŸèƒ½

Hystrix DashBoard æ”¯æŒä¸‰ç§ä¸åŒçš„ç›‘æ§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š

- é»˜è®¤çš„é›†ç¾¤ç›‘æ§ï¼Œé€šè¿‡URL `http://hostname:port/turbine.stream`å¼€å¯

- æŒ‡å®šçš„é›†ç¾¤ç›‘æ§ï¼Œé€šè¿‡URL `http://hostname:port/turbine.stream?cluster=[clusterName]`å¼€å¯

- å•ä½“åº”ç”¨çš„ç›‘æ§ï¼Œé€šè¿‡URL `http://hostname:port/hystrix.stream`å¼€å¯

ç›‘æ§ç•Œé¢å„é¡¹å…ƒç´ çš„æ„ä¹‰ï¼š

å®å¿ƒåœ†ï¼šé¢œè‰²è¡¨ç¤ºå¥åº·ç¨‹åº¦ï¼Œå¤§å°è¡¨ç¤ºè¯·æ±‚æµé‡

æ›²çº¿ï¼šç”¨æ¥è®°å½•ä¸¤åˆ†é’Ÿå†…æµé‡çš„ç›¸å¯¹å˜åŒ–

### Turbineé›†ç¾¤ç›‘æ§

é€šè¿‡å¯åŠ¨ç±»åŠ `@EnableTurbine`æ³¨è§£å¼€å¯

## ç¬¬å…­ç«  å£°æ˜å¼æœåŠ¡è°ƒç”¨ Feign

å¯ç”¨Feignï¼šåœ¨å¯åŠ¨ç±»æ·»åŠ `@EnableFeignClients`æ³¨è§£

å®šä¹‰æœåŠ¡æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ªæ¥å£(Interface)ï¼Œé€šè¿‡`@FeignClient`æ³¨è§£æŒ‡å®šæœåŠ¡åæ¥ç»‘å®šæœåŠ¡ï¼Œç„¶åå†ä½¿ç”¨Spring MVCæ³¨è§£æ¥ç»‘å®šå…·ä½“è¯¥æœåŠ¡æä¾›çš„RESTæ¥å£ï¼ˆè¿™é‡ŒæœåŠ¡åä¸åŒºåˆ†å¤§å°å†™ï¼‰

### å‚æ•°ç»‘å®š

```java
// è·å–å‚æ•°
public String hello(@RequestParam(&quot;name&quot;) String name){}
// è·å–è·¯å¾„å˜é‡
public String hello(@PathVariable(&quot;id&quot;) String name){}
// è·å–header
public String hello(@RequestHeader String name){}
// è·å–body
public String hello(String name){@RequestBody User user}
```

### é…ç½®

#### Ribbon

å…¨å±€é…ç½®

```yaml
ribbon:
    NFLoadBalancerRuleClassName: * #è´Ÿè½½å‡è¡¡è§„åˆ™å…¨ç±»å
    ConnectTimeout: 200 #é“¾æ¥è¶…æ—¶æ—¶é—´
    ReadTimeout: 200 #è¯·æ±‚è¶…æ—¶æ—¶é—´
    OkToRetryOnAllOperations: true #æ˜¯å¦å¯¹æ‰€æœ‰æ“ä½œéƒ½å…è®¸é‡è¯•
    MaxAutoRetriesNextServer: 2 # åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°
    MaxAutoRetries: 1 # å½“å‰å®ä¾‹çš„é‡è¯•æ¬¡æ•°
```

æŒ‡å®šæœåŠ¡é…ç½®

```yaml
userservice:
    ribbon:
        NFLoadBalancerRuleClassName: * #è´Ÿè½½å‡è¡¡è§„åˆ™å…¨ç±»å
        ConnectTimeout: 200 #é“¾æ¥è¶…æ—¶æ—¶é—´
        ReadTimeout: 200 #è¯·æ±‚è¶…æ—¶æ—¶é—´
        OkToRetryOnAllOperations: true #æ˜¯å¦å¯¹æ‰€æœ‰æ“ä½œéƒ½å…è®¸é‡è¯•
        MaxAutoRetriesNextServer: 2 # åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°
        MaxAutoRetries: 1 # å½“å‰å®ä¾‹çš„é‡è¯•æ¬¡æ•°
```

#### Hystrix

å…¨å±€é…ç½®

```yaml
hystrix:
    command:
        default:
            execution:
                isolation:
                    thread:
                        timeoutInMilliseconds: 5000
```

**ç¦ç”¨Hystrix**

é€šè¿‡`feign.hystrix.enable = false` æ¥å…³é—­Hystrixæˆ– `hystrix.command.default.execution.timeout.enabled = false`æ¥å…³é—­ç†”æ–­åŠŸèƒ½

å¦‚æœè¦å±€éƒ¨ç¦ç”¨ï¼Œéœ€è¦ä½¿ç”¨`@Scope(&quot;protoype&quot;)`æ³¨è§£æ¥æŒ‡å®šé…ç½®å®ä¾‹

**æœåŠ¡é™çº§é…ç½®**

```java
@FeignClient(value = &quot;userservice&quot;, fallback= UserClientFallback.class)
public interface UserClient{
    ...
}
```

#### è¯·æ±‚å‹ç¼©

```yaml
feign:
    compression:
        request:
            enable: true
        response:
            enable: false
```

å¯ä»¥é’ˆå¯¹è¯·æ±‚çš„æ•°æ®ç±»å‹ä»¥åŠè§¦å‘å‹ç¼©çš„å¤§å°ä¸‹é™è¿›è¡Œè®¾ç½®

```yaml
feign:
    compression:
        request:
            enable: true
            mime-types: text/html, application/xml. application/json
            min-request-size: 1024 # è®¾ç½®è§¦å‘å‹ç¼©çš„å¤§å°ä¸‹é™
```

#### æ—¥å¿—é…ç½®

Feignçš„Loggerçº§åˆ«æœ‰ä¸‹é¢å››ç§ï¼š

- NONEï¼šä¸è®°å½•ä»»ä½•ä¿¡æ¯

- BASICï¼šé‡‘é¸¡è·¯è¯·æ±‚æ–¹æ³•ã€URLä»¥åŠå“åº”ç å’Œæ‰§è¡Œæ—¶é—´

- HEADERSï¼šé™¤äº†BASICä¹‹å¤–è¿˜è®°å½•è¯·æ±‚å’Œå“åº”å¤´

- FULLï¼šè®°å½•æ‰€æœ‰è¯·æ±‚ä¸å“åº”çš„æ˜ç»†

å…¨å±€é…ç½®

```yaml
feign:
    client:
        config:
            metaDataClient:
                connect-timeout: 3000
                read-timeout: 3000
            default:
                loggerLevel: FULL
```

å±€éƒ¨é…ç½®

```yaml
feign:
    client:
        config:
            metaDataClient:
                connect-timeout: 3000
                read-timeout: 3000
            userservice: # æœåŠ¡åç§°
                loggerLevel: BASIC
```

Javaé…ç½®ç±»

```java
public class UserClientConfig(){
    @Bean
    public Logger.Level feignLoggerLevel(){
        return Logger.Level.FULL;
    }
}
```</p> </div> </div> </a>  </div><div class="card-item" data-astro-cid-p3vyftr4> <a href="/blog/subject/ssm/" class="card-link" data-astro-cid-dohjnao5> <div class="card" data-astro-cid-dohjnao5> <div class="card-image" data-astro-cid-dohjnao5>  </div> <div class="card-content" data-astro-cid-dohjnao5> <h3 class="card-title" data-astro-cid-dohjnao5>SSM &amp; SpringBoot 138é—®138ç­”</h3> <p class="card-description" data-astro-cid-dohjnao5># SSM 73é—®

## mybaits 21é—®

### Mybaitsä¸Hibernateçš„å¼‚åŒï¼Ÿ

Hibernateä¸MyBatiséƒ½æ˜¯ORMæ¡†æ¶ï¼Œéƒ½æœ‰ç›¸åº”çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥ç”Ÿæˆç®€å•åŸºæœ¬çš„DAOå±‚æ–¹æ³•ã€‚

Mybaitsæ˜¯åŠORMæ¡†æ¶ï¼ŒHibernateæ˜¯å…¨ORMæ¡†æ¶

Mybaitséœ€è¦æ‰‹åŠ¨å†™SQLè¯­å¥ï¼ŒHibernateä¸éœ€è¦

### ä»€ä¹ˆæ˜¯ORMï¼Ÿ

**å¯¹è±¡å…³ç³»æ˜ å°„**ï¼ˆè‹±è¯­ï¼š**Object Relational Mapping**ï¼Œç®€ç§°**ORM**ï¼Œæˆ–**O/RM**ï¼Œæˆ–**O/R mapping**ï¼‰ï¼Œæ˜¯ä¸€ç§ç¨‹åºè®¾è®¡æŠ€æœ¯ï¼Œç”¨äºå®ç°é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€é‡Œä¸åŒç±»å‹ç³»ç»Ÿçš„æ•°æ®ä¹‹é—´çš„è½¬æ¢ã€‚

ç›®çš„æ˜¯**ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹æ³•æ“çºµæ•°æ®åº“**

### mybatisæ€ä¹ˆé…ç½®ç¯å¢ƒä¿¡æ¯ï¼Ÿ

```xml
&lt;environments default=&quot;development&quot;&gt;
&lt;!--        default:é»˜è®¤çš„ç¯å¢ƒ ID--&gt;
    &lt;environment id=&quot;development&quot;&gt;
&lt;!--            äº‹åŠ¡ç®¡ç†å™¨çš„é…ç½®
å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Spring + MyBatisï¼Œåˆ™æ²¡æœ‰å¿…è¦é…ç½®äº‹åŠ¡ç®¡ç†å™¨
 - JDBC â€“ è¿™ä¸ªé…ç½®å°±æ˜¯ç›´æ¥ä½¿ç”¨äº† JDBC çš„æäº¤å’Œå›æ»šè®¾ç½®ï¼Œå®ƒä¾èµ–äºä»æ•°æ®æºå¾—åˆ°çš„è¿æ¥æ¥ç®¡ç†äº‹åŠ¡èŒƒå›´ã€‚
 - MANAGED â€“ è¿™ä¸ªé…ç½®å‡ ä¹æ²¡åšä»€ä¹ˆã€‚å®ƒä»æ¥ä¸æäº¤æˆ–å›æ»šä¸€ä¸ªè¿æ¥ï¼Œè€Œæ˜¯è®©å®¹å™¨æ¥ç®¡ç†äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ
--&gt;
        &lt;transactionManager type=&quot;JDBC&quot;&gt;
            &lt;property name=&quot;...&quot; value=&quot;...&quot;/&gt;
        &lt;/transactionManager&gt;
&lt;!--            æ•°æ®æºçš„é…ç½®--&gt;
        &lt;dataSource type=&quot;POOLED&quot;&gt;
            &lt;property name=&quot;driver&quot; value=&quot;${driver}&quot;/&gt;
            &lt;property name=&quot;url&quot; value=&quot;${url}&quot;/&gt;
            &lt;property name=&quot;username&quot; value=&quot;${username}&quot;/&gt;
            &lt;property name=&quot;password&quot; value=&quot;${password}&quot;/&gt;
        &lt;/dataSource&gt;
    &lt;/environment&gt;
&lt;/environments&gt;
```

### mybaitsçš„settingæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

è¿™æ˜¯ MyBatis ä¸­æä¸ºé‡è¦çš„è°ƒæ•´è®¾ç½®ï¼Œå®ƒä»¬ä¼šæ”¹å˜ MyBatis çš„è¿è¡Œæ—¶è¡Œä¸ºã€‚ä¸‹è¡¨æè¿°äº†è®¾ç½®ä¸­å„é¡¹çš„æ„å›¾ã€é»˜è®¤å€¼ç­‰ã€‚

| è®¾ç½®å‚æ•°                         | æè¿°                                                                                                                                                              | æœ‰æ•ˆå€¼                                                                                                    | é»˜è®¤å€¼                                                                                   |
|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
| cacheEnabled                 | è¯¥é…ç½®å½±å“çš„æ‰€æœ‰æ˜ å°„å™¨ä¸­é…ç½®çš„ç¼“å­˜çš„å…¨å±€å¼€å…³ã€‚                                                                                                                                         | true,false                                                                                             | true                                                                                  |
| lazyLoadingEnabled           | å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ã€‚ ç‰¹å®šå…³è”å…³ç³»ä¸­å¯é€šè¿‡è®¾ç½®`fetchType`å±æ€§æ¥è¦†ç›–è¯¥é¡¹çš„å¼€å…³çŠ¶æ€ã€‚                                                                                               | true,false                                                                                             | false                                                                                 |
| aggressiveLazyLoading        | å½“å¯ç”¨æ—¶ï¼Œå¯¹ä»»æ„å»¶è¿Ÿå±æ€§çš„è°ƒç”¨ä¼šä½¿å¸¦æœ‰å»¶è¿ŸåŠ è½½å±æ€§çš„å¯¹è±¡å®Œæ•´åŠ è½½ï¼›åä¹‹ï¼Œæ¯ç§å±æ€§å°†ä¼šæŒ‰éœ€åŠ è½½ã€‚                                                                                                                 | true,false                                                                                             | false ï¼ˆåœ¨ 3.4.1 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­é»˜è®¤ä¸º trueï¼‰                                                       |
| multipleResultSetsEnabled    | æ˜¯å¦å…è®¸å•ä¸€è¯­å¥è¿”å›å¤šç»“æœé›†ï¼ˆéœ€è¦å…¼å®¹é©±åŠ¨ï¼‰ã€‚                                                                                                                                         | true,false                                                                                             | true                                                                                  |
| useColumnLabel               | ä½¿ç”¨åˆ—æ ‡ç­¾ä»£æ›¿åˆ—åã€‚ä¸åŒçš„é©±åŠ¨åœ¨è¿™æ–¹é¢ä¼šæœ‰ä¸åŒçš„è¡¨ç°ï¼Œ å…·ä½“å¯å‚è€ƒç›¸å…³é©±åŠ¨æ–‡æ¡£æˆ–é€šè¿‡æµ‹è¯•è¿™ä¸¤ç§ä¸åŒçš„æ¨¡å¼æ¥è§‚å¯Ÿæ‰€ç”¨é©±åŠ¨çš„ç»“æœã€‚                                                                                                 | true,false                                                                                             | true                                                                                  |
| useGeneratedKeys             | å…è®¸ JDBC æ”¯æŒè‡ªåŠ¨ç”Ÿæˆä¸»é”®ï¼Œéœ€è¦é©±åŠ¨å…¼å®¹ã€‚ å¦‚æœè®¾ç½®ä¸º true åˆ™è¿™ä¸ªè®¾ç½®å¼ºåˆ¶ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆä¸»é”®ï¼Œå°½ç®¡ä¸€äº›é©±åŠ¨ä¸èƒ½å…¼å®¹ä½†ä»å¯æ­£å¸¸å·¥ä½œï¼ˆæ¯”å¦‚ Derbyï¼‰ã€‚                                                                                | true,false                                                                                             | False                                                                                 |
| autoMappingBehavior          | æŒ‡å®š MyBatis åº”å¦‚ä½•è‡ªåŠ¨æ˜ å°„åˆ—åˆ°å­—æ®µæˆ–å±æ€§ã€‚ NONE è¡¨ç¤ºå–æ¶ˆè‡ªåŠ¨æ˜ å°„ï¼›PARTIAL åªä¼šè‡ªåŠ¨æ˜ å°„æ²¡æœ‰å®šä¹‰åµŒå¥—ç»“æœé›†æ˜ å°„çš„ç»“æœé›†ã€‚ FULL ä¼šè‡ªåŠ¨æ˜ å°„ä»»æ„å¤æ‚çš„ç»“æœé›†ï¼ˆæ— è®ºæ˜¯å¦åµŒå¥—ï¼‰ã€‚                                                             | NONE, PARTIAL, FULL                                                                                    | PARTIAL                                                                               |
| defaultExecutorType          | é…ç½®é»˜è®¤çš„æ‰§è¡Œå™¨ã€‚SIMPLE å°±æ˜¯æ™®é€šçš„æ‰§è¡Œå™¨ï¼›REUSE æ‰§è¡Œå™¨ä¼šé‡ç”¨é¢„å¤„ç†è¯­å¥ï¼ˆprepared statementsï¼‰ï¼› BATCH æ‰§è¡Œå™¨å°†é‡ç”¨è¯­å¥å¹¶æ‰§è¡Œæ‰¹é‡æ›´æ–°ã€‚                                                                         | SIMPLE REUSE BATCH                                                                                     | SIMPLE                                                                                |
| defaultStatementTimeout      | è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå®ƒå†³å®šé©±åŠ¨ç­‰å¾…æ•°æ®åº“å“åº”çš„ç§’æ•°ã€‚                                                                                                                                         | Any positive integer                                                                                   | Not Set (null)                                                                        |
| safeRowBoundsEnabled         | å…è®¸åœ¨åµŒå¥—è¯­å¥ä¸­ä½¿ç”¨åˆ†é¡µï¼ˆRowBoundsï¼‰ã€‚                                                                                                                                        | true,false                                                                                             | False                                                                                 |
| mapUnderscoreToCamelCase     | æ˜¯å¦å¼€å¯è‡ªåŠ¨é©¼å³°å‘½åè§„åˆ™ï¼ˆcamel caseï¼‰æ˜ å°„ï¼Œå³ä»ç»å…¸æ•°æ®åº“åˆ—å A_COLUMN åˆ°ç»å…¸ Java å±æ€§å aColumn çš„ç±»ä¼¼æ˜ å°„ã€‚                                                                                       | true, false                                                                                            | False                                                                                 |
| localCacheScope              | MyBatis åˆ©ç”¨æœ¬åœ°ç¼“å­˜æœºåˆ¶ï¼ˆLocal Cacheï¼‰é˜²æ­¢å¾ªç¯å¼•ç”¨ï¼ˆcircular referencesï¼‰å’ŒåŠ é€Ÿé‡å¤åµŒå¥—æŸ¥è¯¢ã€‚ é»˜è®¤å€¼ä¸º SESSIONï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šç¼“å­˜ä¸€ä¸ªä¼šè¯ä¸­æ‰§è¡Œçš„æ‰€æœ‰æŸ¥è¯¢ã€‚ è‹¥è®¾ç½®å€¼ä¸º STATEMENTï¼Œæœ¬åœ°ä¼šè¯ä»…ç”¨åœ¨è¯­å¥æ‰§è¡Œä¸Šï¼Œå¯¹ç›¸åŒ SqlSession çš„ä¸åŒè°ƒç”¨å°†ä¸ä¼šå…±äº«æ•°æ®ã€‚ | SESSION,STATEMENT                                                                                      | SESSION                                                                               |
| jdbcTypeForNull              | å½“æ²¡æœ‰ä¸ºå‚æ•°æä¾›ç‰¹å®šçš„ JDBC ç±»å‹æ—¶ï¼Œä¸ºç©ºå€¼æŒ‡å®š JDBC ç±»å‹ã€‚ æŸäº›é©±åŠ¨éœ€è¦æŒ‡å®šåˆ—çš„ JDBC ç±»å‹ï¼Œå¤šæ•°æƒ…å†µç›´æ¥ç”¨ä¸€èˆ¬ç±»å‹å³å¯ï¼Œæ¯”å¦‚ NULLã€VARCHAR æˆ– OTHERã€‚                                                                   | JdbcType enumeration. Most common are: NULL, VARCHAR and OTHER                                         | OTHER                                                                                 |
| lazyLoadTriggerMethods       | æŒ‡å®šå“ªä¸ªå¯¹è±¡çš„æ–¹æ³•è§¦å‘ä¸€æ¬¡å»¶è¿ŸåŠ è½½ã€‚                                                                                                                                              | A method name list separated by commas                                                                 | equals,clone,hashCode,toString                                                        |
| defaultScriptingLanguage     | æŒ‡å®šåŠ¨æ€ SQL ç”Ÿæˆçš„é»˜è®¤è¯­è¨€ã€‚                                                                                                                                               | A type alias or fully qualified class name.                                                            | org.&lt;br/&gt;apache&lt;br/&gt;.ibatis.&lt;br/&gt;scripting.&lt;br/&gt;xmltags.&lt;br/&gt;XMLDynamicLanguageDriver |
| callSettersOnNulls           | æŒ‡å®šå½“ç»“æœé›†ä¸­å€¼ä¸º null çš„æ—¶å€™æ˜¯å¦è°ƒç”¨æ˜ å°„å¯¹è±¡çš„ setterï¼ˆmap å¯¹è±¡æ—¶ä¸º putï¼‰æ–¹æ³•ï¼Œè¿™å¯¹äºæœ‰ Map.keySet() ä¾èµ–æˆ– null å€¼åˆå§‹åŒ–çš„æ—¶å€™æ˜¯æœ‰ç”¨çš„ã€‚æ³¨æ„åŸºæœ¬ç±»å‹ï¼ˆintã€booleanç­‰ï¼‰æ˜¯ä¸èƒ½è®¾ç½®æˆ null çš„ã€‚                                    | true,false                                                                                             | false                                                                                 |
| logPrefix                    | æŒ‡å®š MyBatis å¢åŠ åˆ°æ—¥å¿—åç§°çš„å‰ç¼€ã€‚                                                                                                                                          | Any String                                                                                             | Not set                                                                               |
| logImpl                      | æŒ‡å®š MyBatis æ‰€ç”¨æ—¥å¿—çš„å…·ä½“å®ç°ï¼ŒæœªæŒ‡å®šæ—¶å°†è‡ªåŠ¨æŸ¥æ‰¾ã€‚                                                                                                                                 | SLF4J&lt;br/&gt;,LOG4J&lt;br/&gt;,LOG4J2,&lt;br/&gt;JDK_LOGGING,&lt;br/&gt;COMMONS_LOGGING,&lt;br/&gt;STDOUT_LOGGING,&lt;br/&gt;NO_LOGGING | Not set                                                                               |
| proxyFactory&lt;br&gt;&lt;br&gt;         | æŒ‡å®š Mybatis åˆ›å»ºå…·æœ‰å»¶è¿ŸåŠ è½½èƒ½åŠ›çš„å¯¹è±¡æ‰€ç”¨åˆ°çš„ä»£ç†å·¥å…·ã€‚                                                                                                                               | CGLIB JAVASSIST                                                                                        | CGLIB&lt;br&gt;&lt;br&gt;                                                                         |
| vfslmpl&lt;br&gt;&lt;br&gt;              | æŒ‡å®š VFS çš„å®ç°                                                                                                                                                      | è‡ªå®šä¹‰ VFS çš„å®ç°çš„ç±»å…¨é™å®šåï¼Œä»¥é€—å·åˆ†éš”ã€‚                                                                               | no set&lt;br&gt;&lt;br&gt;                                                                        |
| useActualParamName&lt;br&gt;&lt;br&gt;   | å…è®¸ä½¿ç”¨æ–¹æ³•ç­¾åä¸­çš„åç§°ä½œä¸ºè¯­å¥å‚æ•°åç§°ã€‚ ä¸ºäº†ä½¿ç”¨è¯¥ç‰¹æ€§ï¼Œä½ çš„é¡¹ç›®å¿…é¡»é‡‡ç”¨ Java 8 ç¼–è¯‘ï¼Œå¹¶ä¸”åŠ ä¸ŠÂ `-parameters`Â é€‰é¡¹ã€‚ï¼ˆæ–°å¢äº 3.4.1ï¼‰                                                                              | true \\                                                                                                | false                                                                                 |
| configurationFactory&lt;br&gt;&lt;br&gt; | æŒ‡å®šä¸€ä¸ªæä¾›Â `Configuration`Â å®ä¾‹çš„ç±»ã€‚ è¿™ä¸ªè¢«è¿”å›çš„ Configuration å®ä¾‹ç”¨æ¥åŠ è½½è¢«ååºåˆ—åŒ–å¯¹è±¡çš„å»¶è¿ŸåŠ è½½å±æ€§å€¼ã€‚ è¿™ä¸ªç±»å¿…é¡»åŒ…å«ä¸€ä¸ªç­¾åä¸º`static Configuration getConfiguration()`Â çš„æ–¹æ³•ã€‚ï¼ˆæ–°å¢äº 3.2.3ï¼‰                  | ç±»å‹åˆ«åæˆ–è€…å…¨ç±»å.                                                                                             | no set                                                                                |

ä¸€ä¸ªé…ç½®å®Œæ•´çš„ settings å…ƒç´ çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š

```xml
&lt;settings&gt;
  &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;
  &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;
  &lt;setting name=&quot;multipleResultSetsEnabled&quot; value=&quot;true&quot;/&gt;
  &lt;setting name=&quot;useColumnLabel&quot; value=&quot;true&quot;/&gt;
  &lt;setting name=&quot;useGeneratedKeys&quot; value=&quot;false&quot;/&gt;
  &lt;setting name=&quot;autoMappingBehavior&quot; value=&quot;PARTIAL&quot;/&gt;
  &lt;setting name=&quot;defaultExecutorType&quot; value=&quot;SIMPLE&quot;/&gt;
  &lt;setting name=&quot;defaultStatementTimeout&quot; value=&quot;25&quot;/&gt;
  &lt;setting name=&quot;safeRowBoundsEnabled&quot; value=&quot;false&quot;/&gt;
  &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;false&quot;/&gt;
  &lt;setting name=&quot;localCacheScope&quot; value=&quot;SESSION&quot;/&gt;
  &lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;OTHER&quot;/&gt;
  &lt;setting name=&quot;lazyLoadTriggerMethods&quot; value=&quot;equals,clone,hashCode,toString&quot;/&gt;
&lt;/settings&gt;
```

### å¦‚ä½•é…ç½®ç±»å‹åˆ«åï¼Ÿ

ç±»å‹åˆ«åæ˜¯ä¸º Java ç±»å‹è®¾ç½®ä¸€ä¸ªçŸ­çš„åå­—,å­˜åœ¨çš„æ„ä¹‰ä»…åœ¨äºç”¨æ¥å‡å°‘ç±»å®Œå…¨é™å®šåçš„å†—ä½™ã€‚ä¾‹å¦‚:

```xml
&lt;typeAliases&gt;
  &lt;typeAlias alias=&quot;Author&quot; type=&quot;domain.blog.Author&quot;/&gt;
  &lt;typeAlias alias=&quot;Blog&quot; type=&quot;domain.blog.Blog&quot;/&gt;
  &lt;typeAlias alias=&quot;Comment&quot; type=&quot;domain.blog.Comment&quot;/&gt;
  &lt;typeAlias alias=&quot;Post&quot; type=&quot;domain.blog.Post&quot;/&gt;
  &lt;typeAlias alias=&quot;Section&quot; type=&quot;domain.blog.Section&quot;/&gt;
  &lt;typeAlias alias=&quot;Tag&quot; type=&quot;domain.blog.Tag&quot;/&gt;
&lt;/typeAliases&gt;
```

å½“è¿™æ ·é…ç½®æ—¶ï¼Œ`Blog`å¯ä»¥ç”¨åœ¨ä»»ä½•ä½¿ç”¨`domain.blog.Blog`çš„åœ°æ–¹ã€‚

ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªåŒ…åï¼ŒMyBatis ä¼šåœ¨åŒ…åä¸‹é¢æœç´¢éœ€è¦çš„ Java Beanï¼Œæ¯”å¦‚:

```xml
&lt;typeAliases&gt;
  &lt;package name=&quot;domain.blog&quot;/&gt;
&lt;/typeAliases&gt;
```

æ¯ä¸€ä¸ªåœ¨åŒ… `domain.blog` ä¸­çš„ Java Beanï¼Œåœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Bean çš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«åã€‚ æ¯”å¦‚ `domain.blog.Author` çš„åˆ«åä¸º `author`ï¼›è‹¥æœ‰æ³¨è§£ï¼Œåˆ™åˆ«åä¸ºå…¶æ³¨è§£å€¼ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

```java
    @Alias(&quot;author&quot;)
    public class Author {
        ...
    }
```

### ä¸‰ç§æ•°æ®æºç±»å‹çš„åŒºåˆ«ï¼Ÿ

**UNPOOLED**â€“ è¿™ä¸ªæ•°æ®æºçš„å®ç°åªæ˜¯æ¯æ¬¡è¢«è¯·æ±‚æ—¶æ‰“å¼€å’Œå…³é—­è¿æ¥ã€‚è™½ç„¶ä¸€ç‚¹æ…¢ï¼Œå®ƒå¯¹åœ¨åŠæ—¶å¯ç”¨è¿æ¥æ–¹é¢æ²¡æœ‰æ€§èƒ½è¦æ±‚çš„ç®€å•åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚

**POOLED**â€“ è¿™ç§æ•°æ®æºçš„å®ç°åˆ©ç”¨&quot;æ± &quot;çš„æ¦‚å¿µå°† JDBC è¿æ¥å¯¹è±¡ç»„ç»‡èµ·æ¥ï¼Œé¿å…äº†åˆ›å»ºæ–°çš„è¿æ¥å®ä¾‹æ—¶æ‰€å¿…éœ€çš„åˆå§‹åŒ–å’Œè®¤è¯æ—¶é—´ã€‚ è¿™æ˜¯ä¸€ç§ä½¿å¾—å¹¶å‘ Web åº”ç”¨å¿«é€Ÿå“åº”è¯·æ±‚çš„æµè¡Œå¤„ç†æ–¹å¼ã€‚

**JNDI**â€“ è¿™ä¸ªæ•°æ®æºçš„å®ç°æ˜¯ä¸ºäº†èƒ½åœ¨å¦‚ EJB æˆ–åº”ç”¨æœåŠ¡å™¨è¿™ç±»å®¹å™¨ä¸­ä½¿ç”¨ï¼Œå®¹å™¨å¯ä»¥é›†ä¸­æˆ–åœ¨å¤–éƒ¨é…ç½®æ•°æ®æºï¼Œç„¶åæ”¾ç½®ä¸€ä¸ª JNDI ä¸Šä¸‹æ–‡çš„å¼•ç”¨ã€‚

### å¦‚ä½•æŒ‡å®šæ˜ å°„æ–‡ä»¶ï¼Ÿ

æœ€ä½³çš„æ–¹å¼æ˜¯å‘Šè¯‰ MyBatis åˆ°å“ªé‡Œå»æ‰¾æ˜ å°„æ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨ç›¸å¯¹äºç±»è·¯å¾„çš„èµ„æºå¼•ç”¨ï¼Œ æˆ–å®Œå…¨é™å®šèµ„æºå®šä½ç¬¦ï¼ˆåŒ…æ‹¬ `file:///` çš„ URLï¼‰ï¼Œæˆ–ç±»åå’ŒåŒ…åç­‰ã€‚ä¾‹å¦‚ï¼š

```xml
&lt;!-- ä½¿ç”¨ç›¸å¯¹ç±»è·¯å¾„å®šä¹‰èµ„æº --&gt;  
&lt;mappers&gt;  
  &lt;mapper resource=&quot;org/mybatis/builder/AuthorMapper.xml&quot;/&gt;
&lt;/mappers&gt;  
&lt;!-- ä½¿ç”¨å®Œå…¨é™å®šèµ„æºå®šä½ç¬¦ --&gt;  
&lt;mappers&gt;  
  &lt;mapper url=&quot;file:///var/mappers/AuthorMapper.xml&quot;/&gt;
&lt;/mappers&gt;  
&lt;!-- ä½¿ç”¨åŒ…å+ç±»å --&gt;  
&lt;mappers&gt;  
  &lt;mapper class=&quot;org.mybatis.builder.AuthorMapper&quot;/&gt;
&lt;/mappers&gt;  
&lt;!-- æ³¨å†ŒåŒ…å†…æ‰€æœ‰mapper --&gt;  
&lt;mappers&gt;  
  &lt;package name=&quot;org.mybatis.builder&quot;/&gt;
&lt;/mappers&gt;  
```

### selectä¸å±æ€§çš„ç”¨æ³•ï¼Ÿ
ç®€å•æŸ¥è¯¢çš„ select å…ƒç´ æ˜¯éå¸¸ç®€å•çš„ã€‚æ¯”å¦‚ï¼š

```xml
&lt;select id=&quot;selectPerson&quot; parameterType=&quot;int&quot; resultType=&quot;hashmap&quot;&gt;
  SELECT * FROM PERSON WHERE ID = #{id}
&lt;/select&gt;    
&lt;!--
idï¼šæŸ¥è¯¢çš„åç§°
parameterTypeï¼šå‚æ•°ç±»å‹
resultTypeï¼šè¿”å›å€¼ç±»å‹
--&gt;
```
select å…ƒç´ æœ‰å¾ˆå¤šå±æ€§å…è®¸ä½ é…ç½®ï¼Œæ¥å†³å®šæ¯æ¡è¯­å¥çš„ä½œç”¨ç»†èŠ‚ã€‚

```xml
 &lt;select
  id=&quot;selectPerson&quot;
  parameterType=&quot;int&quot;
  parameterMap=&quot;deprecated&quot;
  resultType=&quot;hashmap&quot;
  resultMap=&quot;personResultMap&quot;
  flushCache=&quot;false&quot;
  useCache=&quot;true&quot;
  timeout=&quot;10000&quot;
  fetchSize=&quot;256&quot;
  statementType=&quot;PREPARED&quot;
  resultSetType=&quot;FORWARD_ONLY&quot;&gt;    
```

å±æ€§çš„å«ä¹‰ï¼š

| å±æ€§            | æè¿°                                                                                                                           |
|---------------|------------------------------------------------------------------------------------------------------------------------------|
| id            | åœ¨å‘½åç©ºé—´ä¸­å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¯ä»¥è¢«ç”¨æ¥å¼•ç”¨è¿™æ¡è¯­å¥ã€‚                                                                                                    |
| parameterType | å°†ä¼šä¼ å…¥è¿™æ¡è¯­å¥çš„å‚æ•°ç±»çš„å®Œå…¨é™å®šåæˆ–åˆ«åã€‚è¿™ä¸ªå±æ€§æ˜¯å¯é€‰çš„ï¼Œå› ä¸º MyBatis å¯ä»¥é€šè¿‡ TypeHandler æ¨æ–­å‡ºå…·ä½“ä¼ å…¥è¯­å¥çš„å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º unsetã€‚                                          |
| resultType    | ä»è¿™æ¡è¯­å¥ä¸­è¿”å›çš„æœŸæœ›ç±»å‹çš„ç±»çš„å®Œå…¨é™å®šåæˆ–åˆ«åã€‚æ³¨æ„å¦‚æœæ˜¯é›†åˆæƒ…å½¢ï¼Œé‚£åº”è¯¥æ˜¯é›†åˆå¯ä»¥åŒ…å«çš„ç±»å‹ï¼Œè€Œä¸èƒ½æ˜¯é›†åˆæœ¬èº«ã€‚ä½¿ç”¨ resultType æˆ– resultMapï¼Œä½†ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚                                 |
| resultMap     | å¤–éƒ¨ resultMap çš„å‘½åå¼•ç”¨ã€‚ç»“æœé›†çš„æ˜ å°„æ˜¯ MyBatis æœ€å¼ºå¤§çš„ç‰¹æ€§ï¼Œå¯¹å…¶æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç†è§£çš„è¯ï¼Œè®¸å¤šå¤æ‚æ˜ å°„çš„æƒ…å½¢éƒ½èƒ½è¿åˆƒè€Œè§£ã€‚ä½¿ç”¨ resultMap æˆ– resultTypeï¼Œä½†ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚                    |
| flushCache    | å°†å…¶è®¾ç½®ä¸º trueï¼Œä»»ä½•æ—¶å€™åªè¦è¯­å¥è¢«è°ƒç”¨ï¼Œéƒ½ä¼šå¯¼è‡´æœ¬åœ°ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºï¼Œé»˜è®¤å€¼ï¼šfalseã€‚                                                                         |
| useCache      | å°†å…¶è®¾ç½®ä¸º trueï¼Œå°†ä¼šå¯¼è‡´æœ¬æ¡è¯­å¥çš„ç»“æœè¢«äºŒçº§ç¼“å­˜ï¼Œé»˜è®¤å€¼ï¼šå¯¹ select å…ƒç´ ä¸º trueã€‚                                                                           |
| timeout       | è¿™ä¸ªè®¾ç½®æ˜¯åœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œé©±åŠ¨ç¨‹åºç­‰å¾…æ•°æ®åº“è¿”å›è¯·æ±‚ç»“æœçš„ç§’æ•°ã€‚é»˜è®¤å€¼ä¸º unsetï¼ˆä¾èµ–é©±åŠ¨ï¼‰ã€‚                                                                            |
| fetchSize     | è¿™æ˜¯å°è¯•å½±å“é©±åŠ¨ç¨‹åºæ¯æ¬¡æ‰¹é‡è¿”å›çš„ç»“æœè¡Œæ•°å’Œè¿™ä¸ªè®¾ç½®å€¼ç›¸ç­‰ã€‚é»˜è®¤å€¼ä¸º unsetï¼ˆä¾èµ–é©±åŠ¨ï¼‰ã€‚                                                                              |
| statementType | STATEMENTï¼ŒPREPARED æˆ– CALLABLE çš„ä¸€ä¸ªã€‚è¿™ä¼šè®© MyBatis åˆ†åˆ«ä½¿ç”¨ Statementï¼ŒPreparedStatement æˆ– CallableStatementï¼Œé»˜è®¤å€¼ï¼šPREPAREDã€‚             |
| resultSetType | FORWARD_ONLYï¼ŒSCROLL_SENSITIVE æˆ– SCROLL_INSENSITIVE ä¸­çš„ä¸€ä¸ªï¼Œé»˜è®¤å€¼ä¸º unset ï¼ˆä¾èµ–é©±åŠ¨ï¼‰ã€‚                                                   |
| databaseId    | å¦‚æœé…ç½®äº† databaseIdProviderï¼ŒMyBatis ä¼šåŠ è½½æ‰€æœ‰çš„ä¸å¸¦ databaseId æˆ–åŒ¹é…å½“å‰ databaseId çš„è¯­å¥ï¼›å¦‚æœå¸¦æˆ–è€…ä¸å¸¦çš„è¯­å¥éƒ½æœ‰ï¼Œåˆ™ä¸å¸¦çš„ä¼šè¢«å¿½ç•¥ã€‚                             |
| resultOrdered | è¿™ä¸ªè®¾ç½®ä»…é’ˆå¯¹åµŒå¥—ç»“æœ select è¯­å¥é€‚ç”¨ï¼šå¦‚æœä¸º trueï¼Œå°±æ˜¯å‡è®¾åŒ…å«äº†åµŒå¥—ç»“æœé›†æˆ–æ˜¯åˆ†ç»„äº†ï¼Œè¿™æ ·çš„è¯å½“è¿”å›ä¸€ä¸ªä¸»ç»“æœè¡Œçš„æ—¶å€™ï¼Œå°±ä¸ä¼šå‘ç”Ÿæœ‰å¯¹å‰é¢ç»“æœé›†çš„å¼•ç”¨çš„æƒ…å†µã€‚è¿™å°±ä½¿å¾—åœ¨è·å–åµŒå¥—çš„ç»“æœé›†çš„æ—¶å€™ä¸è‡³äºå¯¼è‡´å†…å­˜ä¸å¤Ÿç”¨ã€‚é»˜è®¤å€¼ï¼šfalseã€‚ |
| resultSets    | è¿™ä¸ªè®¾ç½®ä»…å¯¹å¤šç»“æœé›†çš„æƒ…å†µé€‚ç”¨ï¼Œå®ƒå°†åˆ—å‡ºè¯­å¥æ‰§è¡Œåè¿”å›çš„ç»“æœé›†å¹¶æ¯ä¸ªç»“æœé›†ç»™ä¸€ä¸ªåç§°ï¼Œåç§°æ˜¯é€—å·åˆ†éš”çš„ã€‚                                                                         |

### insertã€updateã€deleteçš„ç”¨æ³•ï¼Ÿ

æ•°æ®å˜æ›´è¯­å¥ insertï¼Œupdate å’Œ delete çš„å®ç°éå¸¸æ¥è¿‘ï¼š

```xml
&lt;insert
  id=&quot;insertAuthor&quot;
  parameterType=&quot;domain.blog.Author&quot;
  flushCache=&quot;true&quot;
  statementType=&quot;PREPARED&quot;
  keyProperty=&quot;&quot;
  keyColumn=&quot;&quot;
  useGeneratedKeys=&quot;&quot;
  timeout=&quot;20&quot;&gt;

&lt;update
  id=&quot;updateAuthor&quot;
  parameterType=&quot;domain.blog.Author&quot;
  flushCache=&quot;true&quot;
  statementType=&quot;PREPARED&quot;
  timeout=&quot;20&quot;&gt;

&lt;delete
  id=&quot;deleteAuthor&quot;
  parameterType=&quot;domain.blog.Author&quot;
  flushCache=&quot;true&quot;
  statementType=&quot;PREPARED&quot;
  timeout=&quot;20&quot;&gt;
```

Insert, Update å’Œ Delete çš„å±æ€§

| å±æ€§               | æè¿°                                                                                                                                          |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| id               | å‘½åç©ºé—´ä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¯è¢«ç”¨æ¥ä»£è¡¨è¿™æ¡è¯­å¥ã€‚                                                                                                                     |
| parameterType    | å°†è¦ä¼ å…¥è¯­å¥çš„å‚æ•°çš„å®Œå…¨é™å®šç±»åæˆ–åˆ«åã€‚è¿™ä¸ªå±æ€§æ˜¯å¯é€‰çš„ï¼Œå› ä¸º MyBatis å¯ä»¥é€šè¿‡ TypeHandler æ¨æ–­å‡ºå…·ä½“ä¼ å…¥è¯­å¥çš„å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º unsetã€‚                                                           |
| flushCache       | å°†å…¶è®¾ç½®ä¸º trueï¼Œä»»ä½•æ—¶å€™åªè¦è¯­å¥è¢«è°ƒç”¨ï¼Œéƒ½ä¼šå¯¼è‡´æœ¬åœ°ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºï¼Œé»˜è®¤å€¼ï¼štrueï¼ˆå¯¹åº”æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤è¯­å¥ï¼‰ã€‚                                                                           |
| timeout          | è¿™ä¸ªè®¾ç½®æ˜¯åœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œé©±åŠ¨ç¨‹åºç­‰å¾…æ•°æ®åº“è¿”å›è¯·æ±‚ç»“æœçš„ç§’æ•°ã€‚é»˜è®¤å€¼ä¸º unsetï¼ˆä¾èµ–é©±åŠ¨ï¼‰ã€‚                                                                                           |
| statementType    | STATEMENTï¼ŒPREPARED æˆ– CALLABLE çš„ä¸€ä¸ªã€‚è¿™ä¼šè®© MyBatis åˆ†åˆ«ä½¿ç”¨ Statementï¼ŒPreparedStatement æˆ– CallableStatementï¼Œé»˜è®¤å€¼ï¼šPREPAREDã€‚                            |
| useGeneratedKeys | ï¼ˆä»…å¯¹ insert å’Œ update æœ‰ç”¨ï¼‰è¿™ä¼šä»¤ MyBatis ä½¿ç”¨ JDBC çš„ getGeneratedKeys æ–¹æ³•æ¥å–å‡ºç”±æ•°æ®åº“å†…éƒ¨ç”Ÿæˆçš„ä¸»é”®ï¼ˆæ¯”å¦‚ï¼šåƒ MySQL å’Œ SQL Server è¿™æ ·çš„å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„è‡ªåŠ¨é€’å¢å­—æ®µï¼‰ï¼Œé»˜è®¤å€¼ï¼šfalseã€‚      |
| keyProperty      | ï¼ˆä»…å¯¹ insert å’Œ update æœ‰ç”¨ï¼‰å”¯ä¸€æ ‡è®°ä¸€ä¸ªå±æ€§ï¼ŒMyBatis ä¼šé€šè¿‡ getGeneratedKeys çš„è¿”å›å€¼æˆ–è€…é€šè¿‡ insert è¯­å¥çš„ selectKey å­å…ƒç´ è®¾ç½®å®ƒçš„é”®å€¼ï¼Œé»˜è®¤ï¼šunsetã€‚å¦‚æœå¸Œæœ›å¾—åˆ°å¤šä¸ªç”Ÿæˆçš„åˆ—ï¼Œä¹Ÿå¯ä»¥æ˜¯é€—å·åˆ†éš”çš„å±æ€§åç§°åˆ—è¡¨ã€‚ |
| keyColumn        | ï¼ˆä»…å¯¹ insert å’Œ update æœ‰ç”¨ï¼‰é€šè¿‡ç”Ÿæˆçš„é”®å€¼è®¾ç½®è¡¨ä¸­çš„åˆ—åï¼Œè¿™ä¸ªè®¾ç½®ä»…åœ¨æŸäº›æ•°æ®åº“ï¼ˆåƒ PostgreSQLï¼‰æ˜¯å¿…é¡»çš„ï¼Œå½“ä¸»é”®åˆ—ä¸æ˜¯è¡¨ä¸­çš„ç¬¬ä¸€åˆ—çš„æ—¶å€™éœ€è¦è®¾ç½®ã€‚å¦‚æœå¸Œæœ›å¾—åˆ°å¤šä¸ªç”Ÿæˆçš„åˆ—ï¼Œä¹Ÿå¯ä»¥æ˜¯é€—å·åˆ†éš”çš„å±æ€§åç§°åˆ—è¡¨ã€‚                       |
| databaseId       | å¦‚æœé…ç½®äº† databaseIdProviderï¼ŒMyBatis ä¼šåŠ è½½æ‰€æœ‰çš„ä¸å¸¦ databaseId æˆ–åŒ¹é…å½“å‰ databaseId çš„è¯­å¥ï¼›å¦‚æœå¸¦æˆ–è€…ä¸å¸¦çš„è¯­å¥éƒ½æœ‰ï¼Œåˆ™ä¸å¸¦çš„ä¼šè¢«å¿½ç•¥ã€‚                                            |

ä¸‹é¢å°±æ˜¯ insertï¼Œupdate å’Œ delete è¯­å¥çš„ç¤ºä¾‹ï¼š

```xml
&lt;insert id=&quot;insertAuthor&quot;&gt;
  insert into Author (id,username,password,email,bio)
  values (#{id},#{username},#{password},#{email},#{bio})
&lt;/insert&gt;

&lt;update id=&quot;updateAuthor&quot;&gt;
  update Author set
    username = #{username},
    password = #{password},
    email = #{email},
    bio = #{bio}
  where id = #{id}
&lt;/update&gt;

&lt;delete id=&quot;deleteAuthor&quot;&gt;
  delete from Author where id = #{id}
&lt;/delete&gt;
```

### ä¸¤ç§å­—ç¬¦ä¸²æ›¿æ¢çš„åŒºåˆ«ï¼Ÿ

| #{}                            | ${}                            |
|--------------------------------|--------------------------------|
| å‚æ•°å ä½ç¬¦ï¼Œå³é¢„ç¼–è¯‘                     | å­—ç¬¦ä¸²æ›¿æ¢ç¬¦ï¼Œå³SQLæ‹¼æ¥                  |
| å¾ˆå¤§ç¨‹åº¦ä¸Šèƒ½é˜²æ­¢sql æ³¨å…¥                 | ä¸èƒ½é˜²æ­¢sql æ³¨å…¥                     |
| å°†ä¼ å…¥çš„æ•°æ®éƒ½å½“æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šå¯¹ä¼ å…¥çš„å˜é‡è‡ªåŠ¨åŠ ä¸€ä¸ªå•å¼•å· | å°†ä¼ å…¥çš„å‚æ•°ç›´æ¥æ˜¾ç¤ºç”Ÿæˆåœ¨sqlä¸­ï¼Œä¸”ä¸åŠ ä»»ä½•å¼•å·      |
|                                | æ’åºæ—¶ä½¿ç”¨order by åŠ¨æ€å‚æ•°æ—¶éœ€è¦æ³¨æ„ï¼Œç”¨$è€Œä¸æ˜¯# |


### ä¸‰ç§è‡ªåŠ¨æ˜ å°„ç­‰çº§ï¼Ÿ
```xml
&lt;setting name=&quot;autoMappingBehavior&quot; value=&quot;PARTIAL&quot;/&gt;
```
 NONE è¡¨ç¤ºå–æ¶ˆè‡ªåŠ¨æ˜ å°„

 PARTIAL åªä¼šè‡ªåŠ¨æ˜ å°„æ²¡æœ‰å®šä¹‰åµŒå¥—ç»“æœé›†æ˜ å°„çš„ç»“æœé›†

 FULL ä¼šè‡ªåŠ¨æ˜ å°„ä»»æ„å¤æ‚çš„ç»“æœé›†ï¼ˆæ— è®ºæ˜¯å¦åµŒå¥—ï¼‰

### ifæ ‡ç­¾çš„ä½œç”¨ï¼Ÿ

```xml
&lt;select id=&quot;findActiveBlogWithTitleLike&quot;
     resultType=&quot;Blog&quot;&gt;
  SELECT * FROM BLOG 
  WHERE state = â€˜ACTIVEâ€™ 
  &lt;if test=&quot;title != null&quot;&gt;
&lt;!--      å¦‚æœtestä¸ºtrueåˆ™è¯­å¥åŒ…å«ifå†…çš„å†…å®¹--&gt;
    AND title like #{title}
  &lt;/if&gt;
&lt;/select&gt;
```

### foreachæ ‡ç­¾çš„ç”¨æ³•ï¼Ÿ

```xml
&lt;select id=&quot;selectPostIn&quot; resultType=&quot;domain.blog.Post&quot;&gt;
  SELECT *
  FROM POST P
  WHERE ID in
  &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;list&quot;
      open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;
        #{item}
  &lt;/foreach&gt;
&lt;/select&gt;
&lt;!--        foreach å…è®¸ä½ æŒ‡å®šä¸€ä¸ªé›†åˆï¼Œå£°æ˜å¯ä»¥ç”¨åœ¨å…ƒç´ ä½“å†…çš„é›†åˆé¡¹å’Œç´¢å¼•å˜é‡--&gt;
&lt;!--        ä¹Ÿå…è®¸ä½ æŒ‡å®šå¼€é—­åŒ¹é…çš„å­—ç¬¦ä¸²ä»¥åŠåœ¨è¿­ä»£ä¸­é—´æ”¾ç½®åˆ†éš”ç¬¦ã€‚--&gt;
```

### æ€ä¹ˆé…ç½®æ—¥å¿—çº§åˆ«ï¼Ÿ

```properties
# å…¨å±€æ—¥å¿—ç­‰çº§
log4j.rootLogger=ERROR, stdout
# mabatis mapperæ—¥å¿—ç­‰çº§
log4j.logger.org.mybatis.example.BlogMapper=TRACE
```

### ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜çš„å®šä¹‰ä¸åŒºåˆ«ï¼Ÿ

- ä¸€çº§ç¼“å­˜
  - å®šä¹‰
    - ä¸€çº§ç¼“å­˜ä½œç”¨åŸŸæ˜¯sqlsessionçº§åˆ«çš„ï¼ŒåŒä¸€ä¸ªsqlsessionä¸­æ‰§è¡Œç›¸åŒçš„sqlæŸ¥è¯¢ï¼ˆç›¸åŒçš„sqlå’Œå‚æ•°ï¼‰ï¼Œç¬¬ä¸€æ¬¡ä¼šå»æŸ¥è¯¢æ•°æ®åº“å¹¶å†™åˆ°ç¼“å­˜ä¸­ï¼Œç¬¬äºŒæ¬¡ä»ä¸€çº§ç¼“å­˜ä¸­å–ã€‚ 
    - ä¸€çº§ç¼“å­˜æ˜¯åŸºäº PerpetualCache çš„ HashMap æœ¬åœ°ç¼“å­˜ï¼Œé»˜è®¤æ‰“å¼€ä¸€çº§ç¼“å­˜ã€‚ 
  - æ¸…ç©ºä¸€çº§ç¼“å­˜ 
    - å¦‚æœä¸­é—´sqlSessionå»æ‰§è¡Œcommitæ“ä½œï¼ˆæ‰§è¡Œæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ï¼Œåˆ™ä¼šæ¸…ç©ºSqlSessionä¸­çš„ä¸€çº§ç¼“å­˜ï¼Œè¿™æ ·åšçš„ç›®çš„ä¸ºäº†è®©ç¼“å­˜ä¸­å­˜å‚¨çš„æ˜¯æœ€æ–°çš„ä¿¡æ¯ï¼Œé¿å…è„è¯»ã€‚ 
    - ä¸€çº§ç¼“å­˜æ—¶æ‰§è¡Œcommitï¼Œcloseï¼Œå¢åˆ æ”¹ç­‰æ“ä½œï¼Œå°±ä¼šæ¸…ç©ºå½“å‰çš„ä¸€çº§ç¼“å­˜ï¼›å½“å¯¹SqlSessionæ‰§è¡Œæ›´æ–°æ“ä½œï¼ˆupdateã€deleteã€insertï¼‰åå¹¶æ‰§è¡Œcommitæ—¶ï¼Œä¸ä»…æ¸…ç©ºå…¶è‡ªèº«çš„ä¸€çº§ç¼“å­˜ï¼ˆæ‰§è¡Œæ›´æ–°æ“ä½œçš„æ•ˆæœï¼‰ï¼Œä¹Ÿæ¸…ç©ºäºŒçº§ç¼“å­˜ï¼ˆæ‰§è¡Œcommit()çš„æ•ˆæœï¼‰ã€‚ 
  - ä¸€çº§ç¼“å­˜æ— è¿‡æœŸæ—¶é—´ï¼Œåªæœ‰ç”Ÿå‘½å‘¨æœŸ
- äºŒçº§ç¼“å­˜ 
  - ç®€ä»‹ 
    - å®ƒæŒ‡çš„æ˜¯Mybatisä¸­SqlSessionFactoryå¯¹è±¡çš„ç¼“å­˜ã€‚ç”±åŒä¸€ä¸ªSqlSessionFactoryå¯¹è±¡åˆ›å»ºçš„SqlSessionå…±äº«å…¶ç¼“å­˜ã€‚ 
    - äºŒçº§ç¼“å­˜æ˜¯ mapper æ˜ å°„çº§åˆ«çš„ç¼“å­˜ï¼Œå¤šä¸ª SqlSession å»æ“ä½œåŒä¸€ä¸ª Mapper æ˜ å°„çš„ sql è¯­å¥ï¼Œå¤šä¸ªSqlSession å¯ä»¥å…±ç”¨äºŒçº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜æ˜¯è·¨ SqlSession çš„ã€‚ ã€
  - ä½•æ—¶å­˜å…¥ 
    - åœ¨å…³é—­sqlsessionå(close)ï¼Œæ‰ä¼šæŠŠè¯¥sqlsessionä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®æ·»åŠ åˆ°namespaceçš„äºŒçº§ç¼“å­˜ä¸­ã€‚ 
    - å¼€å¯äº†äºŒçº§ç¼“å­˜åï¼Œè¿˜éœ€è¦å°†è¦ç¼“å­˜çš„pojoå®ç°Serializableæ¥å£ï¼Œä¸ºäº†å°†ç¼“å­˜æ•°æ®å–å‡ºæ‰§è¡Œååºåˆ—åŒ–æ“ä½œï¼Œå› ä¸ºäºŒçº§ç¼“å­˜æ•°æ®å­˜å‚¨ä»‹è´¨å¤šç§å¤šæ ·ï¼Œä¸ä¸€å®šåªå­˜åœ¨å†…å­˜ä¸­ï¼Œæœ‰å¯èƒ½å­˜åœ¨ç¡¬ç›˜ä¸­ã€‚ 
  - äºŒçº§ç¼“å­˜æœ‰è¿‡æœŸæ—¶é—´ï¼Œä½†æ²¡æœ‰åå°çº¿ç¨‹è¿›è¡Œæ£€æµ‹
    - éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯key-valueçš„è¿‡æœŸæ—¶é—´ï¼Œè€Œæ˜¯è¿™ä¸ªcacheçš„è¿‡æœŸæ—¶é—´ï¼Œæ˜¯flushIntervalï¼Œæ„å‘³ç€æ•´ä¸ªæ¸…ç©ºç¼“å­˜cacheï¼Œæ‰€ä»¥ä¸éœ€è¦åå°çº¿ç¨‹å»å®šæ—¶æ£€æµ‹ã€‚ 
    - æ¯å½“å­˜å–æ•°æ®çš„æ—¶å€™ï¼Œéƒ½è¦æ£€æµ‹ä¸€ä¸‹cacheçš„ç”Ÿå‘½æ—¶é—´ï¼Œé»˜è®¤æ˜¯1å°æ—¶ï¼Œå¦‚æœè¿™ä¸ªcacheå­˜æ´»äº†ä¸€ä¸ªå°æ—¶ï¼Œé‚£ä¹ˆå°†æ•´ä¸ªæ¸…ç©ºä¸€ä¸‹ã€‚ 
  - å½“ Mybatis è°ƒç”¨ Dao å±‚æŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œå…ˆæŸ¥è¯¢äºŒçº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜ä¸­æ— å¯¹åº”æ•°æ®ï¼Œå†å»æŸ¥è¯¢ä¸€çº§ç¼“å­˜ï¼Œä¸€çº§ç¼“å­˜ä¸­ä¹Ÿæ²¡æœ‰ï¼Œæœ€åå»æ•°æ®åº“æŸ¥æ‰¾ã€‚

### useCacheä¸flushCacheçš„ä½œç”¨ï¼Ÿ

```xml
 &lt;select
  flushCache=&quot;false&quot;
  useCache=&quot;true&quot;
  &gt;
&lt;!--useCache:å°†å…¶è®¾ç½®ä¸º trueï¼Œå°†ä¼šå¯¼è‡´æœ¬æ¡è¯­å¥çš„ç»“æœè¢«äºŒçº§ç¼“å­˜ï¼Œé»˜è®¤å€¼ï¼šå¯¹ select å…ƒç´ ä¸º trueã€‚--&gt;
&lt;!--flushCacheï¼šå°†å…¶è®¾ç½®ä¸º trueï¼Œä»»ä½•æ—¶å€™åªè¦è¯­å¥è¢«è°ƒç”¨ï¼Œéƒ½ä¼šå¯¼è‡´æœ¬åœ°ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºï¼Œé»˜è®¤å€¼ï¼šfalseã€‚--&gt;
```

### Redisçš„æ¦‚å¿µï¼Ÿ

Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„key-valueæ•°æ®åº“ã€‚ç»å¸¸ç”¨ä½œç¼“å­˜

### é‚£ä¸ªæ³¨è§£æ˜¯å¯¹daoç»„ä»¶çš„ä¿®é¥°ï¼Ÿ

```java
@Mapper //Mybatis éœ€è¦æ‰¾åˆ°å¯¹åº”çš„ mapperï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™åŠ¨æ€ç”Ÿæˆä»£ç†ç±»
@Repository //ç”¨äºæ ‡æ³¨æ•°æ®è®¿é—®ç»„ä»¶ï¼Œå³DAOç»„ä»¶
```

### JavaModelGeneratoré…ç½®ã€sqlMapperGeneratoré…ç½®ä¸JavaClientGeneratoré…ç½®çš„ä½œç”¨ï¼Ÿ

- JavaModelGeneratoré…ç½®ç”Ÿæˆçš„å®ä½“ç±»çš„å­˜æ”¾çš„ä½ç½®(entityå±‚çš„javaæ–‡ä»¶)
- sqlMapperGeneratoré…ç½®ç”Ÿæˆçš„æ˜ å°„æ–‡ä»¶çš„ä½ç½®(resources/daoä¸­çš„xmlæ–‡ä»¶)
- JavaClientGeneratoré…ç½®ç”Ÿæˆçš„mapperæ¥å£æ–‡ä»¶çš„ä½ç½®(daoå±‚ä¸­çš„javaæ–‡ä»¶)

### å¦‚ä½•å®ç°åˆ†é¡µï¼Ÿ

å¯¼å…¥ä¾èµ–åŒ…
```xml
&lt;dependency&gt;
    &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;
    &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;1.2.3&lt;/version&gt;
&lt;/dependency&gt;
```
é…ç½®properties
```properties
#pagehelperé…ç½®
pagehelper.helper-dialect=mysql
pagehelper.reasonable=true
pagehelper.support-methods-arguments=true
pagehelper.params=count=countSql
```
ä½¿ç”¨
```java
@Transactional(readOnly = true)
@Override
public PageInfo&lt;Student&gt; getStudentListByBatchName(String batchName, Integer pageNo) {
    //spring bootç¨‹åºä¸­ï¼Œæ·»åŠ äº†PageHelperçš„å¯åŠ¨ä¾èµ–åï¼Œç›´æ¥è°ƒç”¨å¯¹åº”æ–¹æ³•åˆ†é¡µæŸ¥è¯¢å³å¯
    PageHelper.startPage(pageNo, 5);
    List&lt;Student&gt; list = studentMapper.getListByBatchName(batchName);
    //ä¼ å…¥æŸ¥è¯¢çš„åˆ—è¡¨ï¼Œåˆ›å»ºä¸€ä¸ªPageInfoå¯¹è±¡ï¼Œç”¨äºåŒ…å«åˆ†é¡µçš„æ‰€æœ‰ä¿¡æ¯
    //è¿˜å¯ä»¥ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå¯¼èˆªé¡µç çš„æ•°é‡
    PageInfo&lt;Student&gt; pageInfo=new PageInfo&lt;&gt;(list,5);
    return pageInfo;
}
```

### åˆ†é¡µæœ€åå°è£…æˆä»€ä¹ˆæ•°æ®ï¼Ÿ

`PageInfo&lt;T&gt;`

## spring Framework 40é—®

### ä¾èµ–æ³¨å…¥çš„æ¦‚å¿µï¼Ÿ

Spring é€šè¿‡ IoC å®¹å™¨æ¥ç®¡ç†æ‰€æœ‰ Java å¯¹è±¡çš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–ï¼Œæ§åˆ¶å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³».

æ§åˆ¶åè½¬æ ¸å¿ƒæ€æƒ³å°±æ˜¯ç”± Spring è´Ÿè´£å¯¹è±¡çš„åˆ›å»ºã€‚DIæ˜¯IOCçš„ä¸€ç§ã€‚åœ¨å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ä¸­ï¼ŒSpring ä¼šè‡ªåŠ¨æ ¹æ®ä¾èµ–å…³ç³»ï¼Œå°†å®ƒä¾èµ–çš„å¯¹è±¡æ³¨å…¥åˆ°å½“å‰å¯¹è±¡ä¸­ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œä¾èµ–æ³¨å…¥â€ã€‚

### springCoreContaineræ˜¯ä»€ä¹ˆï¼Ÿ

![img.png](./ssm/core_container.png)

- Coreï¼šæ ¸å¿ƒå·¥å…·åŒ…ï¼ŒåŒ…æ‹¬å­—èŠ‚ç æ“ä½œcglibã€asmï¼Œèµ„æºçš„æŠ½è±¡Resourceï¼Œå¯¹è±¡å®ä¾‹åŒ–åŒ–å·¥å…·ç­‰ç­‰ã€‚ 
- Beansï¼šBean çš„å®šä¹‰ã€Bean çš„åˆ›å»ºä»¥åŠå¯¹ Bean çš„è§£æã€‚ 
- Contextï¼šContextæ¨¡å—å»ºç«‹åœ¨Coreå’ŒBeansæ¨¡å—ä¹‹ä¸Šï¼Œæ˜¯Beanè¿è¡Œç¯å¢ƒï¼ˆå³ä¿å­˜ç»´æŠ¤Beançš„çŠ¶æ€ã€æ•°æ®ï¼ŒBeanä¹‹é—´çš„å…³ç³»ï¼‰ï¼Œåˆç§°ä¹‹ä¸ºIocå®¹å™¨ã€‚ 
- SpELï¼šæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œå¯¹è±¡ã€‚

### springIoCå®¹å™¨çš„ç±»å‹ï¼Ÿ

#### spring BeanFactory å®¹å™¨
- æ˜¯Spring beanå®¹å™¨çš„æ ¹æ¥å£ï¼Œæä¾›è·å–beanï¼Œæ˜¯å¦åŒ…å«bean,æ˜¯å¦å•ä¾‹ä¸åŸå‹ï¼Œè·å–beanç±»å‹ï¼Œbean åˆ«åçš„æ–¹æ³• ã€‚
- BeanFactoryä¸æ”¯æŒå›½é™…åŒ–åŠŸèƒ½
- ä¸æ”¯æŒäº‹ä»¶æœºåˆ¶
- æ²¡æœ‰æ‰©å±•ResourceLoaderï¼Œåªèƒ½åŠ è½½ä¸€ä¸ªResource
- BeanFactoryé‡‡ç”¨çš„æ˜¯å»¶è¿ŸåŠ è½½å½¢å¼æ¥æ³¨å…¥Beançš„ï¼Œå³åªæœ‰åœ¨ä½¿ç”¨åˆ°æŸä¸ªBeanæ—¶(è°ƒç”¨getBean())ï¼Œæ‰å¯¹è¯¥Beanè¿›è¡ŒåŠ è½½å®ä¾‹åŒ–
- BeanFactoryéœ€è¦æ‰‹åŠ¨æ³¨å†Œ
#### Spring ApplicationContext å®¹å™¨
- ApplicationContextç»§æ‰¿äº†BeanFactory
- æ‰©å±•äº†MessageResourceæ¥å£ï¼Œå› è€Œå…·æœ‰æ¶ˆæ¯å¤„ç†çš„èƒ½åŠ›(i18N)
- é€šè¿‡ApplicationEventå’ŒApplicationListenerè¿™ä¸¤ä¸ªæ¥å£å®ç°äº‹ä»¶æœºåˆ¶
- æ‰©å±•äº†ResourceLoader(èµ„æºåŠ è½½å™¨)æ¥å£ï¼Œä»è€Œå¯ä»¥ç”¨æ¥åŠ è½½å¤šä¸ªResource
- åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€æ¬¡æ€§åˆ›å»ºäº†æ‰€æœ‰çš„Bean
- è€ŒApplicationContextåˆ™æ˜¯è‡ªåŠ¨æ³¨å†Œ
### ApplicationContextå®¹å™¨çš„å®ç°æœ‰å“ªäº›ï¼Ÿ

ApplicationContext æœ‰ä¸¤ä¸ªç›´æ¥å­æ¥å£ï¼šWebApplicationContext å’Œ ConfigurableApplicationContextã€‚

ConfigurableApplicationContextï¼šæ‰©å±•äºApplicationContext, æ–°å¢åŠ ä¸¤ä¸ªä¸»è¦æ–¹æ³•ã€‚refresh()å’Œclose()ï¼Œè®©ApplicationContextå…·æœ‰å¯åŠ¨ã€åˆ·æ–°å’Œå…³é—­ä¸Šä¸‹æ–‡çš„èƒ½åŠ›ã€‚ApplicationContextåœ¨åˆå§‹åŒ–ä¸Šä¸‹æ–‡æ—¶å°±å®ä¾‹åŒ–æ‰€æœ‰çš„å•ä¾‹Bean.

WebApplicationContextï¼šWebApplicationContextæ˜¯ä¸“é—¨ä¸ºWEBåº”ç”¨è€Œå‡†å¤‡çš„ï¼Œå®ƒå…è®¸ä»ç›¸å¯¹äºWEBæ ¹ç›®å½•çš„è·¯å¾„ä¸­å®Œæˆåˆå§‹åŒ–å·¥ä½œã€‚

æœ€å¸¸ç”¨çš„ä¸¤ä¸ªå®ç°ç±»ï¼š

ClassPathXmlApplicationContext : ä»ç±»è·¯å¾„ä¸‹åŠ è½½é…ç½®æ–‡ä»¶ã€‚

FileSystemXmlApplicationContext : ä»æ–‡ä»¶ç³»ç»Ÿä¸­åŠ è½½é…ç½®æ–‡ä»¶ã€‚

ä¸¤ä¸ªéƒ½æ˜¯ç»§æ‰¿ConfigurableApplicationContext

### beanæ ‡è®°çš„ä½¿ç”¨ï¼Ÿ

```xml
&lt;bean id=&quot;Bean å”¯ä¸€æ ‡å¿—ç¬¦&quot; class=&quot;åŒ…å+ç±»å&quot; p:æ™®é€šå±æ€§=&quot;æ™®é€šå±æ€§å€¼&quot; p:å¯¹è±¡å±æ€§-ref=&quot;å¯¹è±¡çš„å¼•ç”¨&quot;&gt;
```
Spring æ¡†æ¶æä¾›äº† 2 ç§çŸ­å‘½åç©ºé—´ï¼Œå¯ä»¥ç®€åŒ– Spring çš„ XML é…ç½®ï¼Œå¦‚ä¸‹è¡¨ã€‚

| çŸ­å‘½åç©ºé—´  | ç®€åŒ–çš„ XML é…ç½®                     | è¯´æ˜                       |
|--------|--------------------------------|--------------------------|
| p å‘½åç©ºé—´ | &lt;bean&gt; å…ƒç´ ä¸­åµŒå¥—çš„ &lt;property&gt; å…ƒç´     | æ˜¯ setter æ–¹å¼å±æ€§æ³¨å…¥çš„ä¸€ç§å¿«æ·å®ç°æ–¹å¼ |
| c å‘½åç©ºé—´ | &lt;bean&gt; å…ƒç´ ä¸­åµŒå¥—çš„ &lt;constructor&gt; å…ƒç´  | æ˜¯æ„é€ å‡½æ•°å±æ€§æ³¨å…¥çš„ä¸€ç§å¿«æ·å®ç°æ–¹å¼       |

### beançš„èŒƒå›´æœ‰å“ªäº›ï¼Ÿ

Spring 5 å…±æä¾›äº† 6 ç§ scope ä½œç”¨åŸŸï¼Œå¦‚ä¸‹è¡¨ã€‚

| ä½œç”¨èŒƒå›´        | æè¿°                                                                                                                                                                                                    |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| singleton   | é»˜è®¤å€¼ï¼Œå•ä¾‹æ¨¡å¼ï¼Œè¡¨ç¤ºåœ¨ Spring å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ª Bean å®ä¾‹                                                                                                                                                                   |
| prototype   | åŸå‹æ¨¡å¼ï¼Œè¡¨ç¤ºæ¯æ¬¡é€šè¿‡ Spring å®¹å™¨è·å– Bean æ—¶ï¼Œå®¹å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ã€‚                                                                                                                                                    |
| request     | æ¯æ¬¡ HTTP è¯·æ±‚ï¼Œå®¹å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ã€‚è¯¥ä½œç”¨åŸŸåªåœ¨å½“å‰ HTTP Request å†…æœ‰æ•ˆã€‚                                                                                                                                                |
| session     | åŒä¸€ä¸ª HTTP Session å…±äº«ä¸€ä¸ª Bean å®ä¾‹ï¼Œä¸åŒçš„ Session ä½¿ç”¨ä¸åŒçš„ Bean å®ä¾‹ã€‚è¯¥ä½œç”¨åŸŸä»…åœ¨å½“å‰ HTTP Session å†…æœ‰æ•ˆã€‚                                                                                                                    |
| application | åŒä¸€ä¸ª Web åº”ç”¨å…±äº«ä¸€ä¸ª Bean å®ä¾‹ï¼Œè¯¥ä½œç”¨åŸŸåœ¨å½“å‰ ServletContext å†…æœ‰æ•ˆã€‚ ä¸ singleton ç±»ä¼¼ï¼Œä½† singleton è¡¨ç¤ºæ¯ä¸ª IoC å®¹å™¨ä¸­ä»…æœ‰ä¸€ä¸ª Bean å®ä¾‹ï¼Œè€Œä¸€ä¸ª Web åº”ç”¨ä¸­å¯èƒ½ä¼šå­˜åœ¨å¤šä¸ª IoC å®¹å™¨ï¼Œä½†ä¸€ä¸ª Web åº”ç”¨åªä¼šæœ‰ä¸€ä¸ª ServletContextï¼Œä¹Ÿå¯ä»¥è¯´ application æ‰æ˜¯ Web åº”ç”¨ä¸­è´§çœŸä»·å®çš„å•ä¾‹æ¨¡å¼ã€‚ |
| websocket   | websocket çš„ä½œç”¨åŸŸæ˜¯ WebSocket ï¼Œå³åœ¨æ•´ä¸ª WebSocket ä¸­æœ‰æ•ˆã€‚                                                                                                                                                        |

### å¦‚ä½•è·å–beanï¼Ÿ

1. åœ¨åˆå§‹åŒ–æ—¶ä¿å­˜ApplicationContextå¯¹è±¡ 
2. é€šè¿‡Springæä¾›çš„utilsç±»è·å–ApplicationContextå¯¹è±¡ 
3. ç»§æ‰¿è‡ªæŠ½è±¡ç±»ApplicationObjectSupport 
4. ç»§æ‰¿è‡ªæŠ½è±¡ç±»WebApplicationObjectSupport 
5. å®ç°æ¥å£ApplicationContextAware 
6. é€šè¿‡Springæä¾›çš„ContextLoader

### beançš„ç”Ÿå‘½å‘¨æœŸå’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Ÿ

åœ¨ä¼ ç»Ÿçš„ Java åº”ç”¨ä¸­ï¼ŒBean çš„ç”Ÿå‘½å‘¨æœŸå¾ˆç®€å•ï¼Œä½¿ç”¨ Java å…³é”®å­— new è¿›è¡Œ Bean çš„å®ä¾‹åŒ–åï¼Œè¿™ä¸ª Bean å°±å¯ä»¥ä½¿ç”¨äº†ã€‚ä¸€æ—¦è¿™ä¸ª Bean é•¿æœŸä¸è¢«ä½¿ç”¨ï¼ŒJava è‡ªåŠ¨è¿›è¡Œåƒåœ¾å›æ”¶ã€‚

ç›¸æ¯”ä¹‹ä¸‹ï¼ŒSpring ä¸­ Bean çš„ç”Ÿå‘½å‘¨æœŸè¾ƒå¤æ‚ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ 5 ä¸ªé˜¶æ®µï¼š

1. Bean çš„å®ä¾‹åŒ–
2. Bean å±æ€§èµ‹å€¼
3. Bean çš„åˆå§‹åŒ–
4. Bean çš„ä½¿ç”¨
5. Bean çš„é”€æ¯

Spring æ ¹æ® Bean çš„ä½œç”¨åŸŸæ¥é€‰æ‹© Bean çš„ç®¡ç†æ–¹å¼ï¼Œ

- å¯¹äº singleton ä½œç”¨åŸŸçš„ Bean æ¥è¯´ï¼ŒSpring IoC å®¹å™¨èƒ½å¤Ÿç²¾ç¡®åœ°æ§åˆ¶ Bean ä½•æ—¶è¢«åˆ›å»ºã€ä½•æ—¶åˆå§‹åŒ–å®Œæˆä»¥åŠä½•æ—¶è¢«é”€æ¯ï¼›
- å¯¹äº prototype ä½œç”¨åŸŸçš„ Bean æ¥è¯´ï¼ŒSpring IoC å®¹å™¨åªè´Ÿè´£åˆ›å»ºï¼Œç„¶åå°±å°† Bean çš„å®ä¾‹äº¤ç»™å®¢æˆ·ç«¯ä»£ç ç®¡ç†ï¼ŒSpring IoC å®¹å™¨å°†ä¸å†è·Ÿè¸ªå…¶ç”Ÿå‘½å‘¨æœŸã€‚

![Spring ç”Ÿå‘½å‘¨æœŸæµç¨‹](./ssm/1F32KG1-0.png)
Bean çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼š

- åˆå§‹åŒ–å›è°ƒæ–¹æ³•ï¼šåœ¨ Spring Bean è¢«åˆå§‹åŒ–åè°ƒç”¨ï¼Œæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰çš„å›è°ƒæ“ä½œã€‚
- é”€æ¯å›è°ƒæ–¹æ³•ï¼šåœ¨ Spring Bean è¢«é”€æ¯å‰è°ƒç”¨ï¼Œæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰çš„å›è°ƒæ“ä½œã€‚

**é€šè¿‡æ¥å£å®ç°**
```java
//in bean class
@Override
public void afterPropertiesSet() throws Exception {
   System.out
           .println(&quot;ã€InitializingBeanæ¥å£ã€‘è°ƒç”¨InitializingBean.afterPropertiesSet()&quot;);
}

// è¿™æ˜¯DiposibleBeanæ¥å£æ–¹æ³•
@Override
public void destroy() throws Exception {
   System.out.println(&quot;ã€DiposibleBeanæ¥å£ã€‘è°ƒç”¨DiposibleBean.destory()&quot;);
}
```

**é€šè¿‡XMLé…ç½®å®ç°**

```java
//in bean class
public void myInit() {
    System.out.println(&quot;ã€init-methodã€‘è°ƒç”¨&lt;bean&gt;çš„init-methodå±æ€§æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•&quot;);
}
public void myDestory() {
    System.out.println(&quot;ã€destroy-methodã€‘è°ƒç”¨&lt;bean&gt;çš„destroy-methodå±æ€§æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•&quot;);
}
```
```xml
&lt;bean id=&quot;person&quot; class=&quot;springBeanTest.Person&quot; init-method=&quot;myInit&quot;
        destroy-method=&quot;myDestory&quot; scope=&quot;singleton&quot; p:name=&quot;å¼ ä¸‰&quot; p:address=&quot;å¹¿å·&quot;
        p:phone=&quot;15900000000&quot; /&gt;
```

**é€šè¿‡æ³¨è§£å®ç°**

| æ³¨è§£             | æè¿°                                                  |
| -------------- | --------------------------------------------------- |
| @PostConstruct | æŒ‡å®šåˆå§‹åŒ–å›è°ƒæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨ Spring Bean è¢«åˆå§‹åŒ–åè¢«è°ƒç”¨ï¼Œæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰çš„å›è°ƒæ“ä½œã€‚ |
| @PreDestroy    | æŒ‡å®šé”€æ¯å›è°ƒæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨ Spring Bean è¢«é”€æ¯å‰è¢«è°ƒç”¨ï¼Œæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰çš„å›è°ƒæ“ä½œã€‚   |

**é€šè¿‡åç½®å¤„ç†å™¨å®ç°**

```java
public interface BeanPostProcessor {   
    Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException;   
    Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException;
}
```

### ä¸¤ç§æ˜¾å¼è£…é…ï¼Ÿ

**æ„é€ å‡½æ•°æ³¨å…¥**&lt;/b&gt;

ä½¿ç”¨æ„é€ å‡½æ•°å®ç°å±æ€§æ³¨å…¥å¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š

1. åœ¨ Bean ä¸­æ·»åŠ ä¸€ä¸ªæœ‰å‚æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°å†…çš„æ¯ä¸€ä¸ªå‚æ•°ä»£è¡¨ä¸€ä¸ªéœ€è¦æ³¨å…¥çš„å±æ€§ï¼›
2. åœ¨ Spring çš„ XML é…ç½®æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ `&lt;beans&gt;` åŠå…¶å­å…ƒç´  `&lt;bean&gt;` å¯¹ Bean è¿›è¡Œå®šä¹‰ï¼›
3. åœ¨ `&lt;bean&gt;` å…ƒç´ å†…ä½¿ç”¨ `&lt;constructor-arg&gt;`å…ƒç´ ï¼Œå¯¹æ„é€ å‡½æ•°å†…çš„å±æ€§è¿›è¡Œèµ‹å€¼ï¼ŒBean çš„æ„é€ å‡½æ•°å†…æœ‰å¤šå°‘å‚æ•°ï¼Œå°±éœ€è¦ä½¿ç”¨å¤šå°‘ä¸ª `&lt;constructor-arg&gt;` å…ƒç´ ã€‚

&lt;b&gt;**setteræ³¨å…¥**&lt;/b&gt;

ä½¿ç”¨ setter æ³¨å…¥çš„æ–¹å¼è¿›è¡Œå±æ€§æ³¨å…¥ï¼Œå¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š

1. åœ¨ Bean ä¸­æä¾›ä¸€ä¸ªé»˜è®¤çš„æ— å‚æ„é€ å‡½æ•°ï¼ˆåœ¨æ²¡æœ‰å…¶ä»–å¸¦å‚æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¯çœç•¥ï¼‰ï¼Œå¹¶ä¸ºæ‰€æœ‰éœ€è¦æ³¨å…¥çš„å±æ€§æä¾›ä¸€ä¸ª setXxx() æ–¹æ³•ï¼›
2. åœ¨ Spring çš„ XML é…ç½®æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ `&lt;beans&gt;` åŠå…¶å­å…ƒç´  `&lt;bean&gt;`å¯¹ Bean è¿›è¡Œå®šä¹‰ï¼›
3. åœ¨ `&lt;bean&gt;`å…ƒç´ å†…ä½¿ç”¨ `&lt;property&gt;` å…ƒç´ å¯¹å„ä¸ªå±æ€§è¿›è¡Œèµ‹å€¼ã€‚

### valueå’Œrefçš„åŒºåˆ«ï¼Ÿ

valueç”¨äºæ³¨å…¥å­—é¢é‡å±æ€§ï¼Œrefç”¨äºæ³¨å…¥å¼•ç”¨å±æ€§

### å¦‚ä½•æ³¨å…¥é›†åˆï¼Ÿ

æ ‡ç­¾è¯´æ˜&lt;list&gt;ç”¨äºæ³¨å…¥ list ç±»å‹çš„å€¼ï¼Œå…è®¸é‡å¤&lt;set&gt;ç”¨äºæ³¨å…¥ set ç±»å‹çš„å€¼ï¼Œä¸å…è®¸é‡å¤&lt;map&gt;ç”¨äºæ³¨å…¥ key-value çš„é›†åˆï¼Œå…¶ä¸­ key å’Œ value éƒ½å¯ä»¥æ˜¯ä»»æ„ç±»å‹&lt;props&gt;ç”¨äºæ³¨å…¥ key-value çš„é›†åˆï¼Œå…¶ä¸­ key å’Œ value éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹

| æ ‡ç­¾        | è¯´æ˜                                         |
|-----------|--------------------------------------------|
| `&lt;list&gt;`  | ç”¨äºæ³¨å…¥ list ç±»å‹çš„å€¼ï¼Œå…è®¸é‡å¤                        |
| `&lt;set&gt;`   | ç”¨äºæ³¨å…¥ set ç±»å‹çš„å€¼ï¼Œä¸å…è®¸é‡å¤                        |
| `&lt;map&gt;`   | ç”¨äºæ³¨å…¥ key-value çš„é›†åˆï¼Œå…¶ä¸­ key å’Œ value éƒ½å¯ä»¥æ˜¯ä»»æ„ç±»å‹ |
| `&lt;props&gt;` | ç”¨äºæ³¨å…¥ key-value çš„é›†åˆï¼Œå…¶ä¸­ key å’Œ value éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹  |

### æ„é€ å‡½æ•°æ³¨å…¥ï¼Ÿ

```xml
&lt;bean id=&quot;beanå&quot; class=&quot;ç±»&quot;&gt;
  &lt;constructor-arg name=&quot;å±æ€§å&quot; value=&quot;å€¼&quot;/&gt;
  &lt;constructor-arg name=&quot;å±æ€§å&quot; ref=&quot;å¼•ç”¨&quot;/&gt;
&lt;/bean&gt;
```

æˆ–ä½¿ç”¨c:å‘½åç©ºé—´

### parentå±æ€§çš„ä½œç”¨ï¼Ÿ

åœ¨ Spring XML é…ç½®ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å­ Bean çš„ parent å±æ€§æ¥æŒ‡å®šéœ€è¦ç»§æ‰¿çš„çˆ¶ Beanï¼Œé…ç½®æ ¼å¼å¦‚ä¸‹ã€‚

```XML
&lt;!--çˆ¶Bean--&gt;
&lt;bean id=&quot;parentBean&quot; class=&quot;xxx.xxxx.xxx.ParentBean&quot; &gt;
  &lt;property name=&quot;xxx&quot; value=&quot;xxx&quot;/&gt;
  &lt;property name=&quot;xxx&quot; value=&quot;xxx&quot;/&gt;
&lt;/bean&gt; 
&lt;!--å­Bean--&gt;
&lt;bean id=&quot;childBean&quot; class=&quot;xxx.xxx.xxx.ChildBean&quot; parent=&quot;parentBean&quot;/&gt;
```

### å¦‚ä½•ä½¿ç”¨å·¥å‚æ–¹æ³•å®ç°DIï¼Ÿ

```java
public class AnimalFactory {

	public static Animal getAnimal1() {
		System.out.println(&quot;è°ƒç”¨AnimalFactoryç±»çš„é™æ€å·¥å‚æ–¹æ³•getAnimal1().................&quot;);
		return new Dog();
	}
	
	public Animal getAnimal2() {
		System.out.println(&quot;è°ƒç”¨AnimalFactoryç±»çš„å®ä¾‹å·¥å‚æ–¹æ³•getAnimal2().................&quot;);
		return new Pig();
	}
	
	private static Map&lt;Integer,Animal&gt; map;
	
	static {
		map=new HashMap&lt;&gt;();
		map.put(1,new Dog());
		map.put(2,new Pig());
		map.put(3,new Sheep());
	}
	
	public static Animal getAnimal3(int type) {
		System.out.println(&quot;è°ƒç”¨AnimalFactoryç±»çš„é™æ€å·¥å‚æ–¹æ³•getAnimal3().................&quot;);
		return map.get(type);
	}
}
```
ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•è¿”å›è‡ªèº«å®ä¾‹
```xml
&lt;!-- å¦‚æœæƒ³é€šè¿‡ä¸€ä¸ªå·¥å‚ç±»çš„é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºbean
     å¯é€šè¿‡factory-methodå±æ€§æŒ‡å®šåˆ›å»ºå®ä¾‹çš„æ–¹æ³•çš„åç§°
     classæŒ‡å®šå·¥å‚ç±»çš„ç±»å‹
--&gt;
&lt;bean class=&quot;com.qdu.bean.A&quot; factory-method=&quot;getA&quot; /&gt;
```
ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•è¿”å›å…¶ä»–ç±»å®ä¾‹
```xml
&lt;!-- å¦‚æœå¸Œæœ›è°ƒç”¨Aç±»çš„é™æ€æ–¹æ³•æ¥è·å–Bç±»çš„å®ä¾‹ --&gt;
&lt;!-- è¿™ç§æƒ…å†µä¸‹ï¼ŒclassæŒ‡å®šçš„åº”è¯¥æ˜¯å·¥å‚æ–¹æ³•æ‰€åœ¨çš„ç±»çš„åç§° --&gt;
&lt;!-- factory-methodå±æ€§æŒ‡å®šåˆ›å»ºå®ä¾‹çš„æ–¹æ³•çš„åç§° --&gt;
&lt;!-- å®é™…åˆ›å»ºçš„å¯¹è±¡ä¸æ˜¯AnimalFactoryç±»å‹ï¼Œè€Œæ˜¯Dogç±»å‹ --&gt;
&lt;bean id=&quot;animal&quot; class=&quot;com.qdu.bean.AnimalFactory&quot;
        factory-method=&quot;getAnimal1&quot; /&gt;

&lt;!-- å¸Œæœ›é€šè¿‡AnimalFactoryè¿™ä¸ªå·¥å‚ç±»çš„é™æ€æ–¹æ³•getAnimal3(int type) --&gt;
&lt;!-- æ¥åˆ›å»ºè¦æ‰˜ç»™springç®¡ç†çš„Dogæˆ–Pigæˆ–Sheepçš„å®ä¾‹ --&gt;
&lt;bean id=&quot;animal&quot; class=&quot;com.qdu.bean.AnimalFactory&quot; factory-method=&quot;getAnimal3&quot;&gt;
&lt;!-- constructor-argåœ¨æ„é€ å‡½æ•°æ³¨å…¥çš„æ—¶å€™æ˜¯æ„é€ å‡½æ•°å‚æ•°çš„åç§° --&gt;
&lt;!-- ä½†æ˜¯å¯¹äºå·¥å‚æ–¹æ³•ï¼Œå°±æ˜¯æŒ‡å®šä¸€ä¸ªæ™®é€šæ–¹æ³•å‚æ•°çš„ä¿¡æ¯ --&gt;
&lt;constructor-arg name=&quot;type&quot; value=&quot;2&quot; /&gt;
&lt;/bean&gt;
```
ä½¿ç”¨éé™æ€å·¥å‚æ–¹æ³•è¿”å›å…¶ä»–ç±»å®ä¾‹(ä¸è€ƒ)
```xml
&lt;!-- å¦‚æœå¸Œæœ›é€šè¿‡å·¥å‚ç±»Açš„éé™æ€æ–¹æ³•æ¥å®ä¾‹åŒ–B --&gt;
&lt;!-- å¿…é¡»å…ˆæœ‰ä¸€ä¸ªAçš„å¯¹è±¡æ‰å¯ä»¥ --&gt;

&lt;bean id=&quot;animalFactory&quot; class=&quot;com.qdu.bean.AnimalFactory&quot; /&gt;

&lt;!-- å¦‚æœå¸Œæœ›é€šè¿‡å·¥å‚ç±»Açš„éé™æ€æ–¹æ³•æ¥å®ä¾‹åŒ–B 
     è¿™æ—¶å€™ä¸å†ä½¿ç”¨classå±æ€§æ¥æŒ‡å®šç”Ÿæˆçš„beançš„ç±»å‹
     factory-beanå±æ€§æŒ‡å®šåˆ›å»ºbeanå®ä¾‹ï¼ˆå¦‚è¿™é‡Œçš„Pigï¼‰çš„å·¥å‚å¯¹è±¡æ˜¯å“ªä¸ªï¼ŒæŒ‡å®šå…¶idæˆ–name
     factory-methodå±æ€§æŒ‡å®šåˆ›å»ºbeanå®ä¾‹çš„å·¥å‚æ–¹æ³•çš„åç§° 
     idä¸ºanimalçš„beanå®é™…æ˜¯ä¸€ä¸ªPigå®ä¾‹ï¼Œä¹Ÿå³æ˜¯getAnimal2()æ–¹æ³•è¿”å›çš„å®ä¾‹
--&gt;
&lt;bean id=&quot;animal&quot; factory-bean=&quot;animalFactory&quot; factory-method=&quot;getAnimal2&quot; /&gt;
```

åœ¨javaä¸­è·å–bean
```java
public static void main(String[] args) {
    ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;config/beans1.xml&quot;);
    A a = ctx.getBean(A.class);
    a.methodOfA();
}
```

### è‡ªåŠ¨è£…é…çš„æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ

Spring å…±æä¾›äº† 5 ä¸­è‡ªåŠ¨è£…é…è§„åˆ™ï¼Œå®ƒä»¬åˆ†åˆ«ä¸ autowire å±æ€§çš„ 5 ä¸ªå–å€¼å¯¹åº”ï¼Œå…·ä½“è¯´æ˜å¦‚ä¸‹è¡¨ã€‚

| å±æ€§å€¼         | è¯´æ˜                                                                                                                                                    |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| byName      | æŒ‰åç§°è‡ªåŠ¨è£…é…ã€‚ Spring ä¼šæ ¹æ®çš„ Java ç±»ä¸­å¯¹è±¡å±æ€§çš„åç§°ï¼Œåœ¨æ•´ä¸ªåº”ç”¨çš„ä¸Šä¸‹æ–‡ ApplicationContextï¼ˆIoC å®¹å™¨ï¼‰ä¸­æŸ¥æ‰¾ã€‚è‹¥æŸä¸ª Bean çš„ id æˆ– name å±æ€§å€¼ä¸è¿™ä¸ªå¯¹è±¡å±æ€§çš„åç§°ç›¸åŒï¼Œåˆ™è·å–è¿™ä¸ª Beanï¼Œå¹¶ä¸å½“å‰çš„ Java ç±» Bean å»ºç«‹å…³è”å…³ç³»ã€‚ |
| byType      | æŒ‰ç±»å‹è‡ªåŠ¨è£…é…ã€‚ Spring ä¼šæ ¹æ® Java ç±»ä¸­çš„å¯¹è±¡å±æ€§çš„ç±»å‹ï¼Œåœ¨æ•´ä¸ªåº”ç”¨çš„ä¸Šä¸‹æ–‡ ApplicationContextï¼ˆIoC å®¹å™¨ï¼‰ä¸­æŸ¥æ‰¾ã€‚è‹¥æŸä¸ª Bean çš„ class å±æ€§å€¼ä¸è¿™ä¸ªå¯¹è±¡å±æ€§çš„ç±»å‹ç›¸åŒ¹é…ï¼Œåˆ™è·å–è¿™ä¸ª Beanï¼Œå¹¶ä¸å½“å‰çš„ Java ç±»çš„ Bean å»ºç«‹å…³è”å…³ç³»ã€‚   |
| constructor | ä¸ byType æ¨¡å¼ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨ä¸å®ƒåº”ç”¨äºæ„é€ å™¨å‚æ•°ï¼ˆä¾èµ–é¡¹ï¼‰ï¼Œå¦‚æœåœ¨å®¹å™¨ä¸­æ²¡æœ‰æ‰¾åˆ°ä¸æ„é€ å™¨å‚æ•°ç±»å‹ä¸€è‡´çš„ Beanï¼Œé‚£ä¹ˆå°†æŠ›å‡ºå¼‚å¸¸ã€‚ å…¶å®å°±æ˜¯æ ¹æ®æ„é€ å™¨å‚æ•°çš„æ•°æ®ç±»å‹ï¼Œè¿›è¡Œ byType æ¨¡å¼çš„è‡ªåŠ¨è£…é…ã€‚                                            |
| default     | è¡¨ç¤ºé»˜è®¤é‡‡ç”¨ä¸Šä¸€çº§å…ƒç´  &lt;beans&gt; è®¾ç½®çš„è‡ªåŠ¨è£…é…è§„åˆ™ï¼ˆdefault-autowireï¼‰è¿›è¡Œè£…é…ã€‚                                                                                                  |
| no          | é»˜è®¤å€¼ï¼Œè¡¨ç¤ºä¸ä½¿ç”¨è‡ªåŠ¨è£…é…ï¼ŒBean çš„ä¾èµ–å…³ç³»å¿…é¡»é€šè¿‡ &lt;constructor-arg&gt;å’Œ &lt;property&gt; å…ƒç´ çš„ ref å±æ€§æ¥å®šä¹‰ã€‚                                                                             |

**åŸºäºæ³¨è§£çš„è‡ªåŠ¨è£…é…**
```xml
&lt;!--å¼€å¯ç»„ä»¶æ‰«æ--&gt;
&lt;context:component-scan base-package=&quot;&quot;/&gt;
```
```java
@Autowired
```

### æ˜¾å¼è£…é…ä¸è‡ªåŠ¨è£…é…çš„å…³ç³»ï¼Ÿ

æ˜¾å¼è£…é…æ˜¯åœ¨ XML é…ç½®ä¸­é€šè¿‡ &lt;constructor-arg&gt;å’Œ &lt;property&gt; ä¸­çš„ ref å±æ€§ï¼Œæ‰‹åŠ¨ç»´æŠ¤ Bean ä¸ Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»çš„ã€‚

Spring çš„è‡ªåŠ¨è£…é…åŠŸèƒ½å¯ä»¥è®© Spring å®¹å™¨ä¾æ®æŸç§è§„åˆ™ï¼ˆè‡ªåŠ¨è£…é…çš„è§„åˆ™ï¼Œæœ‰äº”ç§ï¼‰ï¼Œä¸ºæŒ‡å®šçš„ Bean ä»åº”ç”¨çš„ä¸Šä¸‹æ–‡ï¼ˆAppplicationContext å®¹å™¨ï¼‰ä¸­æŸ¥æ‰¾å®ƒæ‰€ä¾èµ–çš„ Beanï¼Œå¹¶è‡ªåŠ¨å»ºç«‹ Bean ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚è€Œè¿™ä¸€è¿‡ç¨‹æ˜¯åœ¨å®Œå…¨ä¸ä½¿ç”¨ä»»ä½• &lt;constructor-arg&gt;å’Œ &lt;property&gt; å…ƒç´  ref å±æ€§çš„æƒ…å†µä¸‹è¿›è¡Œçš„ã€‚

### ä¾èµ–æ³¨å…¥ä½¿ç”¨å“ªäº›æ³¨è§£ï¼Ÿ

Spring æä¾›äº†ä»¥ä¸‹å¤šä¸ªæ³¨è§£ï¼Œè¿™äº›æ³¨è§£å¯ä»¥ç›´æ¥æ ‡æ³¨åœ¨ Java ç±»ä¸Šï¼Œå°†å®ƒä»¬å®šä¹‰æˆ Spring Beanã€‚

| æ³¨è§£          | è¯´æ˜                                                                                                          |
|-------------|-------------------------------------------------------------------------------------------------------------|
| @Component  | è¯¥æ³¨è§£ç”¨äºæè¿° Spring ä¸­çš„ Beanï¼Œå®ƒæ˜¯ä¸€ä¸ªæ³›åŒ–çš„æ¦‚å¿µï¼Œä»…ä»…è¡¨ç¤ºå®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼ˆBeanï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä½œç”¨åœ¨åº”ç”¨çš„ä»»ä½•å±‚æ¬¡ï¼Œä¾‹å¦‚ Service å±‚ã€Dao å±‚ç­‰ã€‚ ä½¿ç”¨æ—¶åªéœ€å°†è¯¥æ³¨è§£æ ‡æ³¨åœ¨ç›¸åº”ç±»ä¸Šå³å¯ã€‚ |
| @Repository | è¯¥æ³¨è§£ç”¨äºå°†æ•°æ®è®¿é—®å±‚ï¼ˆDao å±‚ï¼‰çš„ç±»æ ‡è¯†ä¸º Spring ä¸­çš„ Beanï¼Œå…¶åŠŸèƒ½ä¸ @Component ç›¸åŒã€‚                                                  |
| @Service    | è¯¥æ³¨è§£é€šå¸¸ä½œç”¨åœ¨ä¸šåŠ¡å±‚ï¼ˆService å±‚ï¼‰ï¼Œç”¨äºå°†ä¸šåŠ¡å±‚çš„ç±»æ ‡è¯†ä¸º Spring ä¸­çš„ Beanï¼Œå…¶åŠŸèƒ½ä¸ @Component ç›¸åŒã€‚                                       |
| @Controller | è¯¥æ³¨è§£é€šå¸¸ä½œç”¨åœ¨æ§åˆ¶å±‚ï¼ˆå¦‚ Struts2 çš„ Actionã€SpringMVC çš„ Controllerï¼‰ï¼Œç”¨äºå°†æ§åˆ¶å±‚çš„ç±»æ ‡è¯†ä¸º Spring ä¸­çš„ Beanï¼Œå…¶åŠŸèƒ½ä¸ @Component ç›¸åŒã€‚       |

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ³¨è§£å°†å®šä¹‰å¥½ Bean è£…é…åˆ°å…¶å®ƒçš„ Bean ä¸­ã€‚

| æ³¨è§£         | è¯´æ˜                                                                                                                                                                                                                                                                                                                   |
|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| @Autowired | å¯ä»¥åº”ç”¨åˆ° Bean çš„å±æ€§å˜é‡ã€setter æ–¹æ³•ã€é setter æ–¹æ³•åŠæ„é€ å‡½æ•°ç­‰ï¼Œé»˜è®¤æŒ‰ç…§ Bean çš„ç±»å‹è¿›è¡Œè£…é…ã€‚ @Autowired æ³¨è§£é»˜è®¤æŒ‰ç…§ Bean çš„ç±»å‹è¿›è¡Œè£…é…ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè¦æ±‚ä¾èµ–å¯¹è±¡å¿…é¡»å­˜åœ¨ï¼Œå¦‚æœå…è®¸ null å€¼ï¼Œå¯ä»¥è®¾ç½®å®ƒçš„ required å±æ€§ä¸º falseã€‚å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨æŒ‰ç…§åç§°ï¼ˆbyNameï¼‰æ¥è£…é…ï¼Œå¯ä»¥ç»“åˆ @Qualifier æ³¨è§£ä¸€èµ·ä½¿ç”¨                                                                                                                  |
| @Resource  | ä½œç”¨ä¸ Autowired ç›¸åŒï¼ŒåŒºåˆ«åœ¨äº @Autowired é»˜è®¤æŒ‰ç…§ Bean ç±»å‹è£…é…ï¼Œè€Œ @Resource é»˜è®¤æŒ‰ç…§ Bean çš„åç§°è¿›è¡Œè£…é…ã€‚ @Resource ä¸­æœ‰ä¸¤ä¸ªé‡è¦å±æ€§ï¼šname å’Œ typeã€‚ Spring å°† name å±æ€§è§£æä¸º Bean çš„å®ä¾‹åç§°ï¼Œtype å±æ€§è§£æä¸º Bean çš„å®ä¾‹ç±»å‹ã€‚å¦‚æœæŒ‡å®š name å±æ€§ï¼Œåˆ™æŒ‰å®ä¾‹åç§°è¿›è¡Œè£…é…ï¼›å¦‚æœæŒ‡å®š type å±æ€§ï¼Œåˆ™æŒ‰ Bean ç±»å‹è¿›è¡Œè£…é…ï¼›å¦‚æœéƒ½ä¸æŒ‡å®šï¼Œåˆ™å…ˆæŒ‰ Bean å®ä¾‹åç§°è£…é…ï¼Œå¦‚æœä¸èƒ½åŒ¹é…ï¼Œåˆ™å†æŒ‰ç…§ Bean ç±»å‹è¿›è¡Œè£…é…ï¼›å¦‚æœéƒ½æ— æ³•åŒ¹é…ï¼Œåˆ™æŠ›å‡º NoSuchBeanDefinitionException å¼‚å¸¸ã€‚ |
| @Qualifier | ä¸ @Autowired æ³¨è§£é…åˆä½¿ç”¨ï¼Œä¼šå°†é»˜è®¤çš„æŒ‰ Bean ç±»å‹è£…é…ä¿®æ”¹ä¸ºæŒ‰ Bean çš„å®ä¾‹åç§°è£…é…ï¼ŒBean çš„å®ä¾‹åç§°ç”± @Qualifier æ³¨è§£çš„å‚æ•°æŒ‡å®šã€‚                                                                                                                                                                                                                                |

### @Configurationå’Œ@Beanæ³¨è§£çš„ä½œç”¨

```java
/*
@Configration æ³¨è§£ä½œç”¨åœ¨ç±»ã€æ¥å£ï¼ˆåŒ…å«æ³¨è§£ï¼‰ä¸Š
@Configuration ç”¨äºå®šä¹‰é…ç½®ç±»ï¼Œå¯æ›¿æ¢ xml é…ç½®æ–‡ä»¶
@Configration æ³¨è§£ç±»ä¸­å¯ä»¥å£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ª @Bean æ–¹æ³•
*/
@Configuration
public class MyConfig {
  /*
    @Bean æ³¨è§£ä½œç”¨åœ¨æ–¹æ³•ä¸Š
    @Bean æŒ‡ç¤ºä¸€ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª Spring å®¹å™¨ç®¡ç†çš„ Beanï¼Œä¹Ÿå°±æ˜¯è¯´æ–¹æ³•è¿”å›å€¼å°±æ˜¯ç»™Springrå®¹å™¨è£…é…çš„bean
    @Bean ä¸€èˆ¬å’Œ @Component æˆ–è€… @Configuration ä¸€èµ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨ @Service é‡Œä½¿ç”¨ï¼Œæ²¡æœ‰ç‰¹å®šè¦æ±‚ï¼Œä¸»è¦çœ‹é¡¹ç›®çš„éœ€æ±‚ã€‚
    @Bean æ³¨è§£é»˜è®¤ä½œç”¨åŸŸä¸ºå•ä¾‹ singleton ä½œç”¨åŸŸï¼Œå¯é€šè¿‡ @Scope(â€œprototypeâ€) è®¾ç½®ä¸ºåŸå‹ä½œç”¨åŸŸ
  */
  @Bean
  public MyBean myBean() {
      return new MyBean();
  }
  @Bean
  public MyBean myBean1() {
      return new MyBean();
  }
}

```

### ä»€ä¹ˆæ˜¯AOPï¼Ÿ

AOP çš„å…¨ç§°æ˜¯â€œAspect Oriented Programmingâ€ï¼Œè¯‘ä¸ºâ€œé¢å‘åˆ‡é¢ç¼–ç¨‹â€ï¼Œå’Œ OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰ç±»ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ã€‚

### é€šçŸ¥çš„æ¦‚å¿µï¼Ÿ
AOPçš„ä¸€å¥—æœ¯è¯­

| åç§°             | è¯´æ˜                                                                                 |
|----------------|------------------------------------------------------------------------------------|
| Joinpointï¼ˆè¿æ¥ç‚¹ï¼‰ | AOP çš„æ ¸å¿ƒæ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç¨‹åºæ‰§è¡ŒæœŸé—´æ˜ç¡®å®šä¹‰çš„ä¸€ä¸ªç‚¹ï¼Œä¾‹å¦‚æ–¹æ³•çš„è°ƒç”¨ã€ç±»åˆå§‹åŒ–ã€å¯¹è±¡å®ä¾‹åŒ–ç­‰ã€‚  åœ¨ Spring ä¸­ï¼Œè¿æ¥ç‚¹åˆ™æŒ‡å¯ä»¥è¢«åŠ¨æ€ä»£ç†æ‹¦æˆªç›®æ ‡ç±»çš„æ–¹æ³•ã€‚ |
| Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰  | åˆç§°åˆ‡ç‚¹ï¼ŒæŒ‡è¦å¯¹å“ªäº› Joinpoint è¿›è¡Œæ‹¦æˆªï¼Œå³è¢«æ‹¦æˆªçš„è¿æ¥ç‚¹ã€‚                                                |
| Adviceï¼ˆé€šçŸ¥ï¼‰     | æŒ‡æ‹¦æˆªåˆ° Joinpoint ä¹‹åè¦æ‰§è¡Œçš„ä»£ç ï¼Œå³å¯¹åˆ‡å…¥ç‚¹å¢å¼ºçš„å†…å®¹ã€‚                                                |
| Targetï¼ˆç›®æ ‡ï¼‰     | æŒ‡ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼Œé€šå¸¸ä¹Ÿè¢«ç§°ä¸ºè¢«é€šçŸ¥ï¼ˆadvisedï¼‰å¯¹è±¡ã€‚                                                     |
| Weavingï¼ˆç»‡å…¥ï¼‰    | æŒ‡æŠŠå¢å¼ºä»£ç åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡ä¸Šï¼Œç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚                                                          |
| Proxyï¼ˆä»£ç†ï¼‰      | æŒ‡ç”Ÿæˆçš„ä»£ç†å¯¹è±¡ã€‚                                                                          |
| Aspectï¼ˆåˆ‡é¢ï¼‰     | åˆ‡é¢æ˜¯åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰å’Œé€šçŸ¥ï¼ˆAdviceï¼‰çš„ç»“åˆã€‚                                                    |

### è¿æ¥ç‚¹çš„æ¦‚å¿µï¼Ÿ

è§ä¸Šæ¡

### é€šçŸ¥çš„ç±»å‹ï¼ˆä½ç½®ï¼‰ï¼Ÿ

å…±æœ‰5ç§ï¼š

| é€šçŸ¥                     | è¯´æ˜                |
|------------------------|-------------------|
| beforeï¼ˆå‰ç½®é€šçŸ¥ï¼‰           | é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•è°ƒç”¨ä¹‹å‰æ‰§è¡Œ   |
| afterï¼ˆåç½®é€šçŸ¥ï¼‰            | é€šçŸ¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•è¿”å›æˆ–å¼‚å¸¸åè°ƒç”¨ |
| after-returningï¼ˆè¿”å›åé€šçŸ¥ï¼‰ | é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•è¿”å›åè°ƒç”¨   |
| after-throwingï¼ˆæŠ›å‡ºå¼‚å¸¸é€šçŸ¥ï¼‰ | é€šçŸ¥æ–¹æ³•ä¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨ |
| aroundï¼ˆç¯ç»•é€šçŸ¥ï¼‰           | é€šçŸ¥æ–¹æ³•ä¼šå°†ç›®æ ‡æ–¹æ³•å°è£…èµ·æ¥    |


### ç”¨æ¥åˆ›å»ºé€šçŸ¥çš„æ³¨è§£æœ‰å“ªäº›ï¼Ÿ

| åç§°              | è¯´æ˜                                           |
|-----------------|----------------------------------------------|
| @Aspect         | ç”¨äºå®šä¹‰ä¸€ä¸ªåˆ‡é¢ã€‚                                    |
| @Pointcut       | ç”¨äºå®šä¹‰ä¸€ä¸ªåˆ‡å…¥ç‚¹ã€‚                                   |
| @Before         | ç”¨äºå®šä¹‰å‰ç½®é€šçŸ¥ï¼Œç›¸å½“äº BeforeAdviceã€‚                   |
| @AfterReturning | ç”¨äºå®šä¹‰åç½®é€šçŸ¥ï¼Œç›¸å½“äº AfterReturningAdviceã€‚           |
| @Around         | ç”¨äºå®šä¹‰ç¯ç»•é€šçŸ¥ï¼Œç›¸å½“äº MethodInterceptorã€‚              |
| @AfterThrowing  | ç”¨äºå®šä¹‰æŠ›å‡ºé€šçŸ¥ï¼Œç›¸å½“äº ThrowAdviceã€‚                    |
| @After          | ç”¨äºå®šä¹‰æœ€ç»ˆé€šçŸ¥ï¼Œä¸ç®¡æ˜¯å¦å¼‚å¸¸ï¼Œè¯¥é€šçŸ¥éƒ½ä¼šæ‰§è¡Œã€‚                     |
| @DeclareParents | ç”¨äºå®šä¹‰å¼•ä»‹é€šçŸ¥ï¼Œç›¸å½“äº IntroductionInterceptorï¼ˆä¸è¦æ±‚æŒæ¡ï¼‰ã€‚ |


### å¦‚ä½•å£°æ˜åˆ‡å…¥ç‚¹ï¼Ÿ

```java
//Pointcutè¡¨ç¤ºå¼
//æˆ‘é™¤äº†å¯ä»¥é€šè¿‡åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆexecutionï¼‰ç›´æ¥å¯¹åˆ‡ç‚¹è¿›è¡Œå®šä¹‰å¤–
//è¿˜å¯ä»¥é€šè¿‡åˆ‡å…¥ç‚¹æ–¹æ³•çš„åç§°æ¥å¼•ç”¨å…¶ä»–çš„åˆ‡å…¥ç‚¹
//åœ¨ä½¿ç”¨æ–¹æ³•åå¼•ç”¨å…¶ä»–åˆ‡å…¥ç‚¹æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨â€œ&amp;&amp;â€ã€â€œ||â€å’Œâ€œ!â€ç­‰è¡¨ç¤ºâ€œä¸â€ã€â€œæˆ–â€ã€â€œéâ€çš„å«ä¹‰
@Pointcut(&quot;execution(* com.savage.aop.MessageSender.*(..))&quot;)
//å®šä¹‰ä¸ºåˆ‡ç‚¹çš„æ–¹æ³•ï¼Œå®ƒçš„è¿”å›å€¼ç±»å‹å¿…é¡»ä¸º void
private void log(){}
```

### åœ¨è¿”å›åé€šçŸ¥ä¸­å¦‚ä½•è·å–ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ï¼Ÿ

```java
@AfterReturning(value = &quot;pt()&quot;,returning = &quot;ret&quot;)
public void afterReturning(Object ret) {
    System.out.println(&quot;afterReturning advice ...&quot;+ret);
}
```

### XMLå¦‚ä½•é…ç½®AOPï¼Ÿ

åœ¨ Spring çš„ XML é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹å¯ç”¨ @AspectJ æ³¨è§£æ”¯æŒã€‚

```xml
&lt;!-- å¼€å¯æ³¨è§£æ‰«æ --&gt;
&lt;context:component-scan base-package=&quot;&quot;/&gt;
&lt;!--å¼€å¯AspectJ è‡ªåŠ¨ä»£ç†--&gt;
&lt;aop:aspectj-autoproxy/&gt;
```

```xml
&lt;!-- é»˜è®¤æ˜¯ä¸å¯ç”¨@AspectJçš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œ@Aspectç­‰æ³¨è§£æ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå¯ç”¨AspectJæ”¯æŒåæ‰ä¼šèµ·ä½œç”¨ --&gt;
&lt;!-- è¯¥æ³¨è§£çš„ä½œç”¨æ˜¯å¯ç”¨@AspectJé£æ ¼çš„Spring AOP --&gt;
&lt;!-- å¦‚æœæ˜¯åŸºäºxml schemaçš„aopæ˜¯å¦è¿˜éœ€è¦ä½¿ç”¨è¯¥æ ‡è®°: ä¸ç”¨ --&gt;
&lt;!-- &lt;aop:aspectj-autoproxy /&gt; --&gt;

&lt;!-- æ–¹é¢å¯¹åº”çš„ç±»éœ€è¦æ³¨å†Œä¸ºspringç®¡ç†çš„beanï¼Œæ‰èƒ½å°†æ–¹é¢åˆ‡å…¥åˆ°éœ€è¦çš„åœ°æ–¹ --&gt;
&lt;bean id=&quot;logAspect1&quot; class=&quot;com.qdu.aop.LogAspect1&quot; /&gt;

&lt;bean id=&quot;logAspect2&quot; class=&quot;com.qdu.aop.LogAspect2&quot; /&gt;

&lt;bean class=&quot;com.qdu.service.impl.StudentServiceImpl&quot; /&gt;

&lt;bean class=&quot;com.qdu.service.impl.TeacherServiceImpl&quot; /&gt;

&lt;bean class=&quot;com.qdu.service.impl.MathServiceImpl&quot; /&gt;

&lt;!-- execution(* com.qdu.service.StudentService.*(..)) --&gt;
&lt;!-- execution(* com.qdu.service.MathService.add(..)) --&gt;
&lt;!-- execution(* com.qdu.service.MathService.divide(..)) --&gt;
&lt;!-- execution(* com.qdu.service.MathService.multiply(..)) --&gt;

&lt;!-- aop:configç”¨äºä»¥xmlæ ¼å¼é…ç½®aop --&gt;
&lt;aop:config&gt;
    &lt;!-- aop:configæ ‡è®°ä¸­å¯ä»¥å®šä¹‰åˆ‡å…¥ç‚¹ï¼Œè¿™æ ·çš„åˆ‡å…¥ç‚¹å¯ä»¥åœ¨å¤šä¸ªaop:aspectæ ‡è®°ä¸­ä½¿ç”¨ --&gt;
    &lt;aop:pointcut
        expression=&quot;execution(* com.qdu.service.StudentService.*(..))&quot;
        id=&quot;pt1&quot; /&gt;
    &lt;!-- aop:aspectç”¨äºé…ç½®ä¸€ä¸ªæ–¹é¢å¯¹åº”çš„ç±» --&gt;
    &lt;!-- refæŒ‡å®šæ–¹é¢ç±»beançš„idæˆ–name --&gt;
    &lt;!-- orderç”¨äºæ§åˆ¶é€šçŸ¥çš„æ‰§è¡Œé¡ºåºï¼Œå€¼è¶Šå°ï¼Œè¯¥æ–¹é¢ç±»ä¸­å¯¹åº”çš„é€šçŸ¥å°±ä¼šå…ˆæ‰§è¡Œ --&gt;
    &lt;aop:aspect ref=&quot;logAspect1&quot; order=&quot;2&quot;&gt;
        &lt;!-- åœ¨aop:aspectæ ‡è®°å†…å®šä¹‰çš„åˆ‡å…¥ç‚¹åªèƒ½åœ¨è¯¥aop:aspectæ ‡è®°ä¸­ä½¿ç”¨ --&gt;
        &lt;aop:pointcut
            expression=&quot;execution(* com.qdu.service.MathService.add(..))&quot; id=&quot;pt2&quot; /&gt;
        &lt;aop:pointcut
            expression=&quot;execution(* com.qdu.service.MathService.divide(..))&quot; id=&quot;pt3&quot; /&gt;
        &lt;aop:pointcut
            expression=&quot;execution(* com.qdu.service.MathService.multiply(..))&quot; id=&quot;pt4&quot; /&gt;
        &lt;!-- aop:beforeç”¨äºé…ç½®å‰ç½®é€šçŸ¥ï¼ŒmethodæŒ‡å®šä½œä¸ºå‰ç½®é€šçŸ¥çš„æ–¹æ³•çš„åç§° --&gt;
        &lt;!-- pointcutå±æ€§ç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œpointcut-refç”¨äºæŒ‡å®šå¼•ç”¨çš„åˆ‡å…¥ç‚¹çš„id --&gt;
        &lt;aop:before method=&quot;before1&quot; pointcut-ref=&quot;pt1&quot; /&gt;
        &lt;aop:before method=&quot;before2&quot; pointcut-ref=&quot;pt1&quot; /&gt;
        &lt;!-- aop:after-returningç”¨äºé…ç½®è¿”å›åé€šçŸ¥ï¼Œreturningç”¨äºæŒ‡å®šä¸€ä¸ªå‚æ•°åï¼ˆå¯éšä¾¿èµ·ï¼Œå°½é‡æœ‰æ„ä¹‰ï¼‰ --&gt;
        &lt;!-- è¿™æ ·å¯ä»¥åœ¨è¿”å›åé€šçŸ¥å¯¹åº”çš„æ–¹æ³•ä¸Šæ·»åŠ ä¸€ä¸ªè¯¥åç§°çš„å‚æ•°ï¼Œç”¨äºæ¥æ”¶ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ --&gt;
        &lt;aop:after-returning method=&quot;afterReturning&quot; pointcut-ref=&quot;pt2&quot; 
                returning=&quot;returnValue&quot; /&gt;
        &lt;!-- aop:after-throwingç”¨äºé…ç½®æŠ›å‡ºåé€šçŸ¥ï¼Œthrowingå±æ€§æŒ‡å®šä¸€ä¸ªå‚æ•°åï¼ˆå¯éšä¾¿èµ·ï¼Œå°½é‡æœ‰æ„ä¹‰ï¼‰ --&gt; 
        &lt;!-- è¿™æ ·å¯ä»¥æŠ›å‡ºåé€šçŸ¥å¯¹åº”çš„æ–¹æ³•ä¸Šæ·»åŠ ä¸€ä¸ªè¯¥åç§°çš„å‚æ•°ï¼Œç”¨äºæ¥æ”¶æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡ --&gt;	
        &lt;aop:after-throwing method=&quot;afterThrowing&quot; pointcut-ref=&quot;pt3&quot; throwing=&quot;ex&quot; /&gt;
        &lt;!-- aop:afterç”¨äºé…ç½®æœ€ç»ˆé€šçŸ¥/åç½®é€šçŸ¥ --&gt;
        &lt;aop:after method=&quot;after&quot; pointcut-ref=&quot;pt3&quot;/&gt;
        &lt;!-- aop:aroundç”¨äºé…ç½®ç¯ç»•é€šçŸ¥ --&gt;
        &lt;aop:around method=&quot;around&quot; pointcut-ref=&quot;pt4&quot;/&gt;
    &lt;/aop:aspect&gt;
    &lt;aop:aspect ref=&quot;logAspect2&quot; order=&quot;1&quot;&gt;
        &lt;aop:before method=&quot;before3&quot; pointcut-ref=&quot;pt1&quot; /&gt;
        &lt;aop:before method=&quot;before4&quot; pointcut-ref=&quot;pt1&quot; /&gt;
    &lt;/aop:aspect&gt;
&lt;/aop:config&gt;
```

### JDBC Templateçš„CRUDæ“ä½œæœ‰å“ªäº›ï¼Ÿ

| æ–¹æ³•                                                                                        | è¯´æ˜                                                                                              |
|-------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|
| public int update(String sql)                                                             | ç”¨äºæ‰§è¡Œæ–°å¢ã€æ›´æ–°ã€åˆ é™¤ç­‰è¯­å¥ï¼›sqlï¼šéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼›args è¡¨ç¤ºéœ€è¦ä¼ å…¥åˆ° SQL è¯­å¥ä¸­çš„å‚æ•°ã€‚                                       |
| public int update(String sql,Object... args)                                              |                                                                                                 |
| public void execute(String sql)                                                           | å¯ä»¥æ‰§è¡Œä»»æ„ SQLï¼Œä¸€èˆ¬ç”¨äºæ‰§è¡Œ DDL è¯­å¥ï¼› sqlï¼šéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼›action è¡¨ç¤ºæ‰§è¡Œå®Œ SQL è¯­å¥åï¼Œè¦è°ƒç”¨çš„å‡½æ•°ã€‚                         |
| public T execute(String sql, PreparedStatementCallback action)                            |                                                                                                 |
| public &lt;T&gt; List&lt;T&gt; query(String sql, RowMapper&lt;T&gt; rowMapper, @Nullable Object... args)    | ç”¨äºæ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›sqlï¼šéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼›rowMapperï¼šç”¨äºç¡®å®šè¿”å›çš„é›†åˆï¼ˆListï¼‰çš„ç±»å‹ï¼›argsï¼šè¡¨ç¤ºéœ€è¦ä¼ å…¥åˆ° SQL è¯­å¥çš„å‚æ•°ã€‚                  |
| public &lt;T&gt; T queryForObject(String sql, RowMapper&lt;T&gt; rowMapper, @Nullable Object... args) |                                                                                                 |
| public int[] batchUpdate(String sql, List&lt;Object[]&gt; batchArgs, final int[] argTypes)      | ç”¨äºæ‰¹é‡æ‰§è¡Œæ–°å¢ã€æ›´æ–°ã€åˆ é™¤ç­‰è¯­å¥ï¼› sqlï¼šéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼›argTypesï¼šéœ€è¦æ³¨å…¥çš„ SQL å‚æ•°çš„ JDBC ç±»å‹ï¼›batchArgsï¼šè¡¨ç¤ºéœ€è¦ä¼ å…¥åˆ° SQL è¯­å¥çš„å‚æ•°ã€‚ |


### å¦‚ä½•åˆ›å»ºå¤„ç†å…¨å±€å¼‚å¸¸ï¼Ÿ

å±€éƒ¨å¼‚å¸¸
```java
//å¯ä»¥åœ¨æ§åˆ¶å™¨ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼Œç”¨äºå¤„ç†å¼‚å¸¸ï¼Œè¿™ä¸ªæ–¹æ³•å°±å«åšå±€éƒ¨å¼‚å¸¸å¤„ç†ç¨‹åº
//è¿™æ ·è¯¥æ–¹æ³•å¯ä»¥å¤„ç†è¿™ä¸ªæ§åˆ¶å™¨ç±»é‡Œå‘ç”Ÿçš„å¼‚å¸¸
//å¼‚å¸¸å¤„ç†ç¨‹åºä½¿ç”¨@ExceptionHandleræ³¨è§£ä¿®é¥°ï¼Œè¯´æ˜è¿™ä¸ªæ–¹æ³•ç”¨äºå¤„ç†å¼‚å¸¸
//valueå±æ€§ç”¨äºæŒ‡å®šå¤„ç†çš„å¼‚å¸¸ç±»å‹ï¼Œå¤šä¸ªç±»å‹ä½¿ç”¨ä¸€ä¸ªæ•°ç»„ç»™å‡º
//åœ¨å¼‚å¸¸å¤„ç†ç¨‹åºä¸­ï¼Œå¯ä»¥è·³è½¬åˆ°æŸä¸ªé”™è¯¯é¡µé¢ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‡å®šè§†å›¾åç§°å³å¯
//åœ¨å¼‚å¸¸å¤„ç†ç¨‹åºä¸­ï¼Œå¯ä»¥ä½¿ç”¨Modelç­‰å¯¹è±¡è¿”å›ä¸€äº›æ•°æ®ç»™é¡µé¢
//å¦‚æœå¸Œæœ›è·å–å¼‚å¸¸ä¿¡æ¯ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä¸Šæ·»åŠ ä¸€ä¸ªå¯¹åº”å¼‚å¸¸ç±»å‹(å¦‚ArithmeticException)çš„å‚æ•°
//ä¹Ÿå¯ä½¿ç”¨Throwableæ¥æ¥æ”¶æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸å¯¹è±¡ 
@ExceptionHandler({ArithmeticException.class,NumberFormatException.class})
public String handleException(Model model, Throwable ex) {
    //å¯ä»¥è€ƒè™‘ä½¿ç”¨Log4J2ç­‰æ—¥å¿—æ¡†æ¶å°†å¼‚å¸¸è®°å½•åˆ°æ—¥å¿—
    logger.error(&quot;å‘ç”Ÿå¼‚å¸¸ï¼Œå¼‚å¸¸æ¶ˆæ¯ï¼š &quot;+ex.getMessage());
    //å¦‚æœéœ€è¦è¿”å›ä¸€äº›æ•°æ®æ˜¾ç¤ºåœ¨é¡µé¢ï¼Œå¯ä»¥æ·»åŠ åˆ°Modelå¯¹è±¡ä¸­
    model.addAttribute(&quot;msg&quot;, &quot;å±€éƒ¨å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œå¼‚å¸¸æ¶ˆæ¯ï¼š &quot;+ex.getMessage());
    return &quot;error&quot;; //æŒ‡å®šè¦è·³è½¬çš„è§†å›¾çš„åç§°
}
```
å…¨å±€å¼‚å¸¸
```java
//å…¨å±€å¼‚å¸¸å¤„ç†ç¨‹åºæ‰€åœ¨çš„ç±»ä¹Ÿè¦æˆä¸ºspring mvcå®¹å™¨ç®¡ç†çš„bean
//@Controllerã€@Serviceã€@Repositoryã€@Component
//@RestControllerã€@Configurationã€@ControllerAdvice
//@ControllerAdviceä¹Ÿä¼šå°†ä¸€ä¸ªç±»æ³¨å†Œä¸ºspringç®¡ç†çš„bean
//@ControllerAdviceä½œç”¨å¾ˆå¤šï¼Œå…¶ä¸­ä¸€ä¸ªä½œç”¨æ˜¯ä¿®é¥°åŒ…å«å…¨å±€å¼‚å¸¸å¤„ç†ç¨‹åºç±»
//è¿™æ ·ï¼Œéœ€è¦å¼€å¯å¯¹è¿™ä¸ªç±»æ‰€åœ¨çš„åŒ…çš„æ‰«æï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ç›´æ¥å°†ç±»æ”¾åˆ°äº†com.qdu.controllerçš„å­åŒ…
//com.qdu.controller.adviceåŒ…ä¸‹ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–å¼€å¯åŒ…æ‰«æ
@ControllerAdvice
public class GlobalExceptionHandler {
	private static Logger logger=LoggerFactory.getLogger(GlobalExceptionHandler.class);
	
	//æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œä½œä¸ºå¼‚å¸¸å¤„ç†ç¨‹åº
	//æ–¹æ³•éœ€è¦ä½¿ç”¨@ExceptionHandleræ³¨è§£è¿›è¡Œä¿®é¥°
	//å¯ä»¥è€ƒè™‘å¤„ç†å¼‚å¸¸åï¼Œè·³è½¬åˆ°ä¸€ä¸ªå‹å¥½çš„é”™è¯¯é¡µé¢ï¼Œå¦‚æœéœ€è¦ï¼Œä¹Ÿå¯åœ¨é”™è¯¯é¡µé¢æ˜¾ç¤ºä¸€äº›ä¿¡æ¯
	//å¦‚æœåŒæ—¶å®šä¹‰äº†å…¨å±€å¼‚å¸¸å¤„ç†å’Œå±€éƒ¨å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œé‚£ä¹ˆä¼šä½¿ç”¨å±€éƒ¨å¼‚å¸¸å¤„ç†ç¨‹åº
	@ExceptionHandler({ArithmeticException.class})
	public String handleException(Model model, ArithmeticException e) {
		logger.error(&quot;å…¨å±€å¼‚å¸¸å¤„ç†ç¨‹åºï¼šç¨‹åºå‘ç”Ÿå¼‚å¸¸ï¼Œå¼‚å¸¸æ¶ˆæ¯-&quot;+e.getMessage());
		model.addAttribute(&quot;msg&quot;, &quot;å…¨å±€å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œå¼‚å¸¸æ¶ˆæ¯ï¼š &quot;+e.getMessage());
		return &quot;error&quot;;
	}
	
	//å¼‚å¸¸å¤„ç†ç¨‹åºå‰ä¹Ÿå¯ä½¿ç”¨@ResponseBodyæ³¨è§£ï¼Œè®©è¿”å›çš„å†…å®¹æˆä¸ºå“åº”æ­£æ–‡å†…å®¹æ˜¾ç¤º
	//è€Œä¸æ˜¯è¦è·³è½¬çš„é¡µé¢çš„åç§°
	@ExceptionHandler({IOException.class,ArrayIndexOutOfBoundsException.class})
	@ResponseBody
	public String exceptionHandler2(Throwable ex) {
		return &quot;Exception occurred, exception message: &quot;+ex.getMessage();
	}
}
```
### JDBC Template å’Œ NamedParameterJDBCTemplateçš„åŒºåˆ«

JDBC Templateï¼šæœ€åŸºæœ¬çš„JDBCæ¨¡æ¿ï¼Œæ”¯æŒåŸºäºç´¢å¼•å‚æ•°ï¼ˆ`?`ï¼‰çš„æŸ¥è¯¢

NamedParameterJdbcTemplateï¼šä½¿ç”¨è¯¥æ¨¡æ¿ç±»æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ä½¿ç”¨å‘½åå‚æ•°çš„æ–¹å¼ç»‘å®šåˆ°SQLè€Œä¸æ˜¯ç´¢å¼•å‚æ•°

### äº‹åŠ¡çš„ç‰¹å¾ï¼Ÿ

äº‹åŠ¡å…·æœ‰ 4 ä¸ªç‰¹æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ï¼Œç®€ç§°ä¸º ACID ç‰¹æ€§ã€‚

- åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­åŒ…æ‹¬çš„åŠ¨ä½œè¦ä¹ˆéƒ½åšè¦ä¹ˆéƒ½ä¸åšã€‚
- ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å¿…é¡»ä¿è¯æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ï¼Œä¸€è‡´æ€§å’ŒåŸå­æ€§æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚
- éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶å®ƒäº‹åŠ¡å¹²æ‰°ï¼Œå³ä¸€ä¸ªäº‹åŠ¡å†…éƒ¨çš„æ“ä½œåŠä½¿ç”¨çš„æ•°æ®å¯¹å¹¶å‘çš„å…¶å®ƒäº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¹¶å‘æ‰§è¡Œçš„å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½äº’ç›¸æ‰“æ‰°ã€‚
- æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šæŒä¹…æ€§ä¹Ÿç§°ä¸ºæ°¸ä¹…æ€§ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œåé¢çš„å…¶å®ƒæ“ä½œå’Œæ•…éšœéƒ½ä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚

### äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ

äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼ˆpropagation behaviorï¼‰æŒ‡çš„æ˜¯ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªäº‹åŠ¡æ–¹æ³•åº”è¯¥å¦‚ä½•è¿è¡Œã€‚
Spring æä¾›äº†ä»¥ä¸‹ 7 ç§ä¸åŒçš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚

| åç§°                        | è¯´æ˜                                                           |
|---------------------------|--------------------------------------------------------------|
| PROPAGATION_MANDATORY     | æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨å½“å‰äº‹åŠ¡ï¼Œåˆ™å¼•å‘å¼‚å¸¸ã€‚                                      |
| PROPAGATION_NESTED        | å¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡ä¸­æ‰§è¡Œã€‚                                          |
| PROPAGATION_NEVER         | ä¸æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™å¼•å‘å¼‚å¸¸ã€‚                                      |
| PROPAGATION_NOT_SUPPORTED | ä¸æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå§‹ç»ˆä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚                                          |
| PROPAGATION_REQUIRED      | é»˜è®¤ä¼ æ’­è¡Œä¸ºï¼Œå¦‚æœå­˜åœ¨å½“å‰äº‹åŠ¡ï¼Œåˆ™å½“å‰æ–¹æ³•å°±åœ¨å½“å‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¹¶åœ¨è¿™ä¸ªæ–°å»ºçš„äº‹åŠ¡ä¸­è¿è¡Œã€‚ |
| PROPAGATION_REQUIRES_NEW  | åˆ›å»ºæ–°äº‹åŠ¡ï¼Œå¦‚æœå·²ç»å­˜åœ¨äº‹åŠ¡åˆ™æš‚åœå½“å‰äº‹åŠ¡ã€‚                                       |
| PROPAGATION_SUPPORTS      | æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚                                    |

### äº‹åŠ¡å¹¶å‘å¯èƒ½å¯¼è‡´çš„é—®é¢˜ï¼Ÿ

äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–å¹¶å‘äº‹åŠ¡å½±å“çš„ç¨‹åº¦ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç»å¸¸ä¼šå‡ºç°å¤šä¸ªäº‹åŠ¡åŒæ—¶å¯¹åŒä¸€æ•°æ®æ‰§è¡Œä¸åŒæ“ä½œï¼Œæ¥å®ç°å„è‡ªçš„ä»»åŠ¡çš„æƒ…å†µã€‚æ­¤æ—¶å°±æœ‰å¯èƒ½å¯¼è‡´è„è¯»ã€å¹»è¯»ä»¥åŠä¸å¯é‡å¤è¯»ç­‰é—®é¢˜çš„å‡ºç°ã€‚

åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œè¿™è‡ªç„¶ä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜ã€‚ä½†å®Œå…¨çš„äº‹åŠ¡éš”ç¦»ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œè€Œä¸”å¹¶ä¸æ˜¯æ‰€æœ‰çš„åº”ç”¨éƒ½éœ€è¦äº‹åŠ¡çš„å®Œå…¨éš”ç¦»ï¼Œå› æ­¤æœ‰æ—¶åº”ç”¨ç¨‹åºåœ¨äº‹åŠ¡éš”ç¦»ä¸Šä¹Ÿæœ‰ä¸€å®šçš„çµæ´»æ€§ã€‚

Spring ä¸­æä¾›äº†ä»¥ä¸‹éš”ç¦»çº§åˆ«ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªèº«çš„éœ€æ±‚è‡ªè¡Œé€‰æ‹©åˆé€‚çš„éš”ç¦»çº§åˆ«ã€‚

| æ–¹æ³•                         | è¯´æ˜                                           |
|----------------------------|----------------------------------------------|
| ISOLATION_DEFAULT          | ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«                               |
| ISOLATION_READ_UNCOMMITTED | å…è®¸è¯»å–å°šæœªæäº¤çš„æ›´æ”¹ï¼Œå¯èƒ½å¯¼è‡´è„è¯»ã€å¹»è¯»å’Œä¸å¯é‡å¤è¯»                  |
| ISOLATION_READ_COMMITTED   | Oracle é»˜è®¤çº§åˆ«ï¼Œå…è®¸è¯»å–å·²æäº¤çš„å¹¶å‘äº‹åŠ¡ï¼Œé˜²æ­¢è„è¯»ï¼Œå¯èƒ½å‡ºç°å¹»è¯»å’Œä¸å¯é‡å¤è¯»   |
| ISOLATION_REPEATABLE_READ  | MySQL é»˜è®¤çº§åˆ«ï¼Œå¤šæ¬¡è¯»å–ç›¸åŒå­—æ®µçš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œé˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œå¯èƒ½å‡ºç°å¹»è¯» |
| ISOLATION_SERIALIZABLE     | å®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ï¼Œé˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»                |

### PlatformTransactionManageræ¥å£çš„ä½œç”¨ï¼Ÿ

Spring å¹¶ä¸ä¼šç›´æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œæ˜¯é€šè¿‡äº‹åŠ¡ç®¡ç†å™¨å¯¹äº‹åŠ¡è¿›è¡Œç®¡ç†çš„ã€‚

åœ¨ Spring ä¸­æä¾›äº†ä¸€ä¸ª org.springframework.transaction.PlatformTransactionManager æ¥å£ï¼Œè¿™ä¸ªæ¥å£è¢«ç§°ä¸º Spring çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œå…¶æºç å¦‚ä¸‹ã€‚

```java
public interface PlatformTransactionManager extends TransactionManager {
    TransactionStatus getTransaction(@Nullable TransactionDefinition definition) throws TransactionException;

    void commit(TransactionStatus status) throws TransactionException;

    void rollback(TransactionStatus status) throws TransactionException;
}
```

è¯¥æ¥å£ä¸­å„æ–¹æ³•è¯´æ˜å¦‚ä¸‹ï¼š

| åç§°                                                                 | è¯´æ˜          |
|--------------------------------------------------------------------|-------------|
| TransactionStatus getTransaction(TransactionDefinition definition) | ç”¨äºè·å–äº‹åŠ¡çš„çŠ¶æ€ä¿¡æ¯ |
| void commit(TransactionStatus status)                              | ç”¨äºæäº¤äº‹åŠ¡      |
| void rollback(TransactionStatus status)                            | ç”¨äºå›æ»šäº‹åŠ¡      |

Spring ä¸ºä¸åŒçš„æŒä¹…åŒ–æ¡†æ¶æˆ–å¹³å°ï¼ˆä¾‹å¦‚ JDBCã€Hibernateã€JPA ä»¥åŠ JTA ç­‰ï¼‰æä¾›äº†ä¸åŒçš„ PlatformTransactionManager æ¥å£å®ç°ï¼Œè¿™äº›å®ç°ç±»è¢«ç§°ä¸ºäº‹åŠ¡ç®¡ç†å™¨å®ç°ã€‚

| å®ç°ç±»                                                                        | è¯´æ˜                                          |
|----------------------------------------------------------------------------|---------------------------------------------|
| org.springframework.&lt;br/&gt;jdbc.datasource.&lt;br/&gt;DataSourceTransactionManager | ä½¿ç”¨ Spring JDBC æˆ– iBatis è¿›è¡ŒæŒä¹…åŒ–æ•°æ®æ—¶ä½¿ç”¨ã€‚         |
| org.springframework.&lt;br/&gt;orm.hibernate3.&lt;br/&gt;HibernateTransactionManager   | ä½¿ç”¨ Hibernate 3.0 åŠä»¥ä¸Šç‰ˆæœ¬è¿›è¡ŒæŒä¹…åŒ–æ•°æ®æ—¶ä½¿ç”¨ã€‚           |
| org.springframework&lt;br/&gt;.orm.jpa.&lt;br/&gt;JpaTransactionManager                | ä½¿ç”¨ JPA è¿›è¡ŒæŒä¹…åŒ–æ—¶ä½¿ç”¨ã€‚                            |
| org.springframework&lt;br/&gt;.jdo.&lt;br/&gt;JdoTransactionManager                    | å½“æŒä¹…åŒ–æœºåˆ¶æ˜¯ Jdo æ—¶ä½¿ç”¨ã€‚                            |
| org.springframework.&lt;br/&gt;transaction.&lt;br/&gt;jta.JtaTransactionManager        | ä½¿ç”¨ JTA æ¥å®ç°äº‹åŠ¡ç®¡ç†ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡è·¨è¶Šå¤šä¸ªä¸åŒçš„èµ„æºï¼ˆå³åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰ä½¿ç”¨è¯¥å®ç°ã€‚ |

è¿™äº›äº‹åŠ¡ç®¡ç†å™¨çš„ä½¿ç”¨æ–¹å¼ååˆ†ç®€å•ï¼Œæˆ‘ä»¬åªè¦æ ¹æ®æŒä¹…åŒ–æ¡†æ¶ï¼ˆæˆ–å¹³å°ï¼‰é€‰ç”¨ç›¸åº”çš„äº‹åŠ¡ç®¡ç†å™¨å®ç°ï¼Œå³å¯å®ç°å¯¹äº‹ç‰©çš„ç®¡ç†ï¼Œè€Œä¸å¿…å…³å¿ƒå®é™…äº‹åŠ¡å®ç°åˆ°åº•æ˜¯ä»€ä¹ˆã€‚

### å¦‚ä½•ä½¿ç”¨XMLé…ç½®äº‹åŠ¡ï¼Ÿ

#### 1. å¼•å…¥ tx å‘½åç©ºé—´

Spring æä¾›äº†ä¸€ä¸ª tx å‘½åç©ºé—´ï¼Œå€ŸåŠ©å®ƒå¯ä»¥æå¤§åœ°ç®€åŒ– Spring ä¸­çš„å£°æ˜å¼äº‹åŠ¡çš„é…ç½®ã€‚

æƒ³è¦ä½¿ç”¨ tx å‘½åç©ºé—´ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯è¦åœ¨ XML é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  tx å‘½åç©ºé—´çš„çº¦æŸã€‚

```xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd&quot;&gt;    
```

&gt; **æ³¨æ„ï¼š**ç”±äº Spring æä¾›çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ˜¯ä¾èµ–äº Spring AOP å®ç°çš„ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ XML é…ç½®æ–‡ä»¶ä¸­è¿˜åº”è¯¥æ·»åŠ ä¸ aop å‘½åç©ºé—´ç›¸å…³çš„é…ç½®ã€‚

#### 2. é…ç½®äº‹åŠ¡ç®¡ç†å™¨

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©æ•°æ®æºé…ç½®ï¼Œå®šä¹‰ç›¸åº”çš„äº‹åŠ¡ç®¡ç†å™¨å®ç°ï¼ˆPlatformTransactionManager æ¥å£çš„å®ç°ç±»ï¼‰çš„ Beanï¼Œé…ç½®å†…å®¹å¦‚ä¸‹ã€‚

```xml
&lt;!--é…ç½®æ•°æ®æº --&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
    &lt;!--æ•°æ®åº“è¿æ¥åœ°å€--&gt;
    &lt;property name=&quot;url&quot; value=&quot;xxx&quot;/&gt;
    &lt;!--æ•°æ®åº“çš„ç”¨æˆ·å--&gt;
    &lt;property name=&quot;username&quot; value=&quot;xxx&quot;/&gt;
    &lt;!--æ•°æ®åº“çš„å¯†ç --&gt;
    &lt;property name=&quot;password&quot; value=&quot;xxx&quot;/&gt;
    &lt;!--æ•°æ®åº“é©±åŠ¨--&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;xxx&quot;/&gt;
&lt;/bean&gt;

&lt;!--é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œä»¥ JDBC ä¸ºä¾‹--&gt;
&lt;bean id=&quot;transactionManager&quot;
      class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;
```

åœ¨ä»¥ä¸Šé…ç½®ä¸­ï¼Œé…ç½®çš„äº‹åŠ¡ç®¡ç†å™¨å®ç°ä¸º DataSourceTransactionManagerï¼Œå³ä¸º JDBC å’Œ iBatis æä¾›çš„ PlatformTransactionManager æ¥å£å®ç°ã€‚

#### 3. é…ç½®äº‹åŠ¡é€šçŸ¥

åœ¨ Spring çš„ XML é…ç½®æ–‡ä»¶ä¸­é…ç½®äº‹åŠ¡é€šçŸ¥ï¼ŒæŒ‡å®šäº‹åŠ¡ä½œç”¨çš„æ–¹æ³•ä»¥åŠæ‰€éœ€çš„äº‹åŠ¡å±æ€§ã€‚

```xml
&lt;!--é…ç½®é€šçŸ¥--&gt;
&lt;tx:advice id=&quot;tx-advice&quot; transaction-manager=&quot;transactionManager&quot;&gt;
    &lt;!--é…ç½®äº‹åŠ¡å‚æ•°--&gt;
    &lt;tx:attributes&gt;
        &lt;tx:method name=&quot;create*&quot; propagation=&quot;REQUIRED&quot; isolation=&quot;DEFAULT&quot; read-only=&quot;false&quot; timeout=&quot;10&quot;/&gt;
    &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;
```

##### äº‹åŠ¡ç®¡ç†å™¨é…ç½®

å½“æˆ‘ä»¬ä½¿ç”¨ &lt;tx:advice&gt; æ¥å£°æ˜äº‹åŠ¡æ—¶ï¼Œéœ€è¦é€šè¿‡ transaction-manager å‚æ•°æ¥å®šä¹‰ä¸€ä¸ªäº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™ä¸ªå‚æ•°çš„å–å€¼é»˜è®¤ä¸º transactionManagerã€‚

å¦‚æœæˆ‘ä»¬è‡ªå·±è®¾ç½®çš„äº‹åŠ¡ç®¡ç†å™¨ï¼ˆç¬¬ 2 æ­¥ä¸­è®¾ç½®çš„äº‹åŠ¡ç®¡ç†å™¨ idï¼‰æ°å¥½ä¸é»˜è®¤å€¼ç›¸åŒï¼Œåˆ™å¯ä»¥çœç•¥å¯¹æ”¹å‚æ•°çš„é…ç½®ã€‚

```xml
&lt;tx:advice id=&quot;tx-advice&quot; &gt;
    &lt;!--é…ç½®äº‹åŠ¡å‚æ•°--&gt;
    &lt;tx:attributes&gt;
        &lt;tx:method name=&quot;create*&quot; propagation=&quot;REQUIRED&quot; isolation=&quot;DEFAULT&quot; read-only=&quot;false&quot; timeout=&quot;10&quot;/&gt;
    &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;
```

ä½†å¦‚æœæˆ‘ä»¬è‡ªå·±è®¾ç½®çš„äº‹åŠ¡ç®¡ç†å™¨ id ä¸é»˜è®¤å€¼ä¸åŒï¼Œåˆ™å¿…é¡»æ‰‹åŠ¨åœ¨ &lt;tx:advice&gt; å…ƒç´ ä¸­é€šè¿‡ transaction-manager å‚æ•°æŒ‡å®šã€‚

##### äº‹åŠ¡å±æ€§é…ç½®

å¯¹äº&lt;tx:advice&gt; æ¥è¯´ï¼Œäº‹åŠ¡å±æ€§æ˜¯è¢«å®šä¹‰åœ¨&lt;tx:attributes&gt; ä¸­çš„ï¼Œè¯¥å…ƒç´ å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª &lt;tx:method&gt; å…ƒç´ ã€‚

&lt;tx:method&gt; å…ƒç´ åŒ…å«å¤šä¸ªå±æ€§å‚æ•°ï¼Œå¯ä»¥ä¸ºæŸä¸ªæˆ–æŸäº›æŒ‡å®šçš„æ–¹æ³•ï¼ˆname å±æ€§å®šä¹‰çš„æ–¹æ³•ï¼‰å®šä¹‰äº‹åŠ¡å±æ€§ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

| äº‹åŠ¡å±æ€§            | è¯´æ˜                                                          |
|-----------------|-------------------------------------------------------------|
| propagation     | æŒ‡å®šäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚                                                  |
| isolation       | æŒ‡å®šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚                                                  |
| read-only       | æŒ‡å®šæ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ã€‚                                                  |
| timeout         | è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºâ€œç§’â€ï¼›å£°æ˜çš„äº‹åŠ¡åœ¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´åï¼Œè‡ªåŠ¨å›æ»šï¼Œé¿å…äº‹åŠ¡é•¿æ—¶é—´ä¸æäº¤ä¼šå›æ»šå¯¼è‡´çš„æ•°æ®åº“èµ„æºçš„å ç”¨ã€‚ |
| rollback-for    | æŒ‡å®šäº‹åŠ¡å¯¹äºé‚£äº›ç±»å‹çš„å¼‚å¸¸åº”å½“å›æ»šï¼Œè€Œä¸æäº¤ã€‚                                     |
| no-rollback-for | æŒ‡å®šäº‹åŠ¡å¯¹äºé‚£äº›å¼‚å¸¸åº”å½“ç»§ç»­è¿è¡Œï¼Œè€Œä¸å›æ»šã€‚                                      |

### 4. é…ç½®åˆ‡ç‚¹åˆ‡é¢

&lt;tx:advice&gt; å…ƒç´ åªæ˜¯å®šä¹‰äº†ä¸€ä¸ª AOP é€šçŸ¥ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„äº‹åŠ¡æ€§åˆ‡é¢ã€‚æˆ‘ä»¬åœ¨ &lt;tx:advice&gt; å…ƒç´ ä¸­å¹¶æ²¡æœ‰å®šä¹‰å“ªäº› Bean åº”è¯¥è¢«é€šçŸ¥ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ‡ç‚¹æ¥åšè¿™ä»¶äº‹ã€‚

åœ¨ Spring çš„ XML é…ç½®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Spring AOP æŠ€æœ¯å°†äº‹åŠ¡é€šçŸ¥ï¼ˆtx-adviceï¼‰å’Œåˆ‡ç‚¹é…ç½®åˆ°åˆ‡é¢ä¸­ï¼Œé…ç½®å†…å®¹å¦‚ä¸‹ã€‚

```xml
&lt;!--é…ç½®åˆ‡ç‚¹å’Œåˆ‡é¢--&gt;
&lt;aop:config&gt;
    &lt;!--é…ç½®åˆ‡ç‚¹--&gt;
    &lt;aop:pointcut id=&quot;tx-pt&quot; expression=&quot;execution(* net.biancheng.c.service.impl.OrderServiceImpl.*(..))&quot;/&gt;
    &lt;!--é…ç½®åˆ‡é¢--&gt;
    &lt;aop:advisor advice-ref=&quot;tx-advice&quot; pointcut-ref=&quot;tx-pt&quot;&gt;&lt;/aop:advisor&gt;
&lt;/aop:config&gt;
```

### å¦‚ä½•å¯ç”¨æ³¨è§£é©±åŠ¨çš„äº‹åŠ¡ç¼–ç¨‹æ¨¡å‹ï¼Ÿ

#### 1. å¼€å¯æ³¨è§£äº‹åŠ¡

tx å‘½åç©ºé—´æä¾›äº†ä¸€ä¸ª &lt;tx:annotation-driven&gt; å…ƒç´ ï¼Œç”¨æ¥å¼€å¯æ³¨è§£äº‹åŠ¡ï¼Œç®€åŒ– Spring å£°æ˜å¼äº‹åŠ¡çš„ XML é…ç½®ã€‚

&lt;tx:annotation-driven&gt; å…ƒç´ çš„ä½¿ç”¨æ–¹å¼ä¹Ÿååˆ†çš„ç®€å•ï¼Œæˆ‘ä»¬åªè¦åœ¨ Spring çš„ XML é…ç½®ä¸­æ·»åŠ è¿™æ ·ä¸€è¡Œé…ç½®å³å¯ã€‚

```xml
&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;
```

ä¸ &lt;tx:advice&gt; å…ƒç´ ä¸€æ ·ï¼Œ&lt;tx:annotation-driven&gt; ä¹Ÿéœ€è¦é€šè¿‡ transaction-manager å±æ€§æ¥å®šä¹‰ä¸€ä¸ªäº‹åŠ¡ç®¡ç†å™¨ï¼Œè¿™ä¸ªå‚æ•°çš„å–å€¼é»˜è®¤ä¸º transactionManagerã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„äº‹åŠ¡ç®¡ç†å™¨çš„ id ä¸é»˜è®¤å€¼ç›¸åŒï¼Œåˆ™å¯ä»¥çœç•¥å¯¹è¯¥å±æ€§çš„é…ç½®ï¼Œå½¢å¼å¦‚ä¸‹ã€‚

```xml
&lt;tx:annotation-driven/&gt;
```

é€šè¿‡ &lt;tx:annotation-driven&gt; å…ƒç´ å¼€å¯æ³¨è§£äº‹åŠ¡åï¼ŒSpring ä¼šè‡ªåŠ¨å¯¹å®¹å™¨ä¸­çš„ Bean è¿›è¡Œæ£€æŸ¥ï¼Œæ‰¾åˆ°ä½¿ç”¨ @Transactional æ³¨è§£çš„ Beanï¼Œå¹¶ä¸ºå…¶æä¾›äº‹åŠ¡æ”¯æŒã€‚

#### 2. ä½¿ç”¨ @Transactional æ³¨è§£

@Transactional æ³¨è§£æ˜¯ Spring å£°æ˜å¼äº‹åŠ¡ç¼–ç¨‹çš„æ ¸å¿ƒæ³¨è§£ï¼Œè¯¥æ³¨è§£æ—¢å¯ä»¥åœ¨ç±»ä¸Šä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ã€‚

```java
@Transactional
public class XXX {

    @Transactional
    public void A(Order order) {
    â€¦â€¦
    }

    public void B(Order order) {
    â€¦â€¦
    }
}
```

è‹¥ @Transactional æ³¨è§£åœ¨ç±»ä¸Šä½¿ç”¨ï¼Œåˆ™è¡¨ç¤ºç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½æ”¯æŒäº‹åŠ¡ï¼›è‹¥ @Transactional æ³¨è§£åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ï¼Œåˆ™è¡¨ç¤ºå½“å‰æ–¹æ³•æ”¯æŒäº‹åŠ¡ã€‚

Spring åœ¨å®¹å™¨ä¸­æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨äº† @Transactional æ³¨è§£çš„ Beanï¼Œå¹¶è‡ªåŠ¨ä¸ºå®ƒä»¬æ·»åŠ äº‹åŠ¡é€šçŸ¥ï¼Œé€šçŸ¥çš„äº‹åŠ¡å±æ€§åˆ™æ˜¯é€šè¿‡ @Transactional æ³¨è§£çš„å±æ€§æ¥å®šä¹‰çš„ã€‚

@Transactional æ³¨è§£åŒ…å«å¤šä¸ªå±æ€§ï¼Œå…¶ä¸­å¸¸ç”¨å±æ€§å¦‚ä¸‹è¡¨ã€‚

| äº‹åŠ¡å±æ€§            | è¯´æ˜                                                          |
|-----------------|-------------------------------------------------------------|
| propagation     | æŒ‡å®šäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚                                                  |
| isolation       | æŒ‡å®šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚                                                  |
| read-only       | æŒ‡å®šæ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ã€‚                                                  |
| timeout         | è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºâ€œç§’â€ï¼›å£°æ˜çš„äº‹åŠ¡åœ¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´åï¼Œè‡ªåŠ¨å›æ»šï¼Œé¿å…äº‹åŠ¡é•¿æ—¶é—´ä¸æäº¤ä¼šå›æ»šå¯¼è‡´çš„æ•°æ®åº“èµ„æºçš„å ç”¨ã€‚ |
| rollback-for    | æŒ‡å®šäº‹åŠ¡å¯¹äºé‚£äº›ç±»å‹çš„å¼‚å¸¸åº”å½“å›æ»šï¼Œè€Œä¸æäº¤ã€‚                                     |
| no-rollback-for | æŒ‡å®šäº‹åŠ¡å¯¹äºé‚£äº›å¼‚å¸¸åº”å½“ç»§ç»­è¿è¡Œï¼Œè€Œä¸å›æ»šã€‚                                      |

### SQLSessionFactoryçš„åˆ›å»ºä¸ä½¿ç”¨ï¼Ÿ

```java
public class MybatisUtil {

    private static SqlSessionFactory sqlSessionFactory;

    static {
        try {
            InputStream is = Resources.getResourceAsStream(&quot;config/mybatis-config.xml&quot;);
            SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();
            sqlSessionFactory = builder.build(is);
        } catch (IOException ex) {
            ex.printStackTrace();
        }
    }
    
    public static SqlSessionFactory getSqlSessionFactory(){
        return sqlSessionFactory;
    }
    
    public static SqlSession openSession(){
        return sqlSessionFactory.openSession();
    }
}
```

### å¦‚ä½•ä½¿ç”¨Javaç±»æ›¿æ¢web.xmlï¼Ÿ
web.xmlå¯¹åº”çš„é…ç½®
```java
public class MyWebAppInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {

	// springçš„é…ç½®
	@Override
	protected Class&lt;?&gt;[] getRootConfigClasses() {
		return new Class[] { SpringConfig.class };
	}

	// springMVCçš„é…ç½®
	@Override
	protected Class&lt;?&gt;[] getServletConfigClasses() {
		return new Class[] { SpringMvcConfig.class };
	}

	// servleté…ç½®
	@Override
	protected String[] getServletMappings() {
		return new String[] { &quot;/&quot; };
	}

	// servletè¿‡æ»¤å™¨
	@Override
	protected Filter[] getServletFilters() {
		return new Filter[] {
			new CharacterEncodingFilter(&quot;utf-8&quot;,true,true)	
		};
	}
}
```
springApplication.xmlç›¸åº”çš„é…ç½®
```java
@Configuration
//å¼€å¯å¯¹serviceç»„ä»¶æ‰€åœ¨åŒ…çš„æ‰«æ
@ComponentScan(basePackages= {&quot;com.qdu.service&quot;})
//æŒ‡å®šè¦ä½¿ç”¨çš„å±æ€§æ–‡ä»¶çš„ä½ç½®ï¼Œsrcç›®å½•ä¸‹çš„æ–‡ä»¶è¦æ·»åŠ classpath:ä½œä¸ºå‰ç¼€
@PropertySource({&quot;classpath:config/jdbc.properties&quot;})
//å¼€å¯å¯¹Mapperæ¥å£æ‰€åœ¨åŒ…çš„æ‰«æï¼Œè¿™æ ·mybatis-springå¯ä»¥å¸®ä½ å‘ç°æ˜ å°„å™¨
//å¸®ä½ åˆ›å»ºMapperæ¥å£çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ˜ å°„å™¨å®ä¾‹
@MapperScan(basePackages= {&quot;com.qdu.mapper&quot;})
//å¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼–ç¨‹æ¨¡å‹ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡ä½¿ç”¨@Transactionalæ³¨è§£æ¥å®ç°äº‹åŠ¡
@EnableTransactionManagement
public class SpringConfig {
	
	//æ³¨å…¥ä¸€ä¸ªEnvironmentå¯¹è±¡ï¼Œç”¨äºè¯»å–å±æ€§æ–‡ä»¶ä¸­çš„å±æ€§
	@Autowired
	Environment env;
	
	//1. é…ç½®æ•°æ®æº
	@Bean
	public DruidDataSource dataSource() {
		
		//å±æ€§æ–‡ä»¶ä¸­å±æ€§çš„å€¼éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦è½¬æ¢ç±»å‹ï¼Œéœ€è¦æ‰‹åŠ¨è½¬æ¢
		DruidDataSource dataSource = new DruidDataSource();
		dataSource.setDriverClassName(env.getProperty(&quot;jdbc.driver&quot;));
		dataSource.setUrl(env.getProperty(&quot;jdbc.url&quot;));
		dataSource.setUsername(env.getProperty(&quot;jdbc.username&quot;));
		dataSource.setPassword(env.getProperty(&quot;jdbc.password&quot;));

		dataSource.setInitialSize(Integer.parseInt(env.getProperty(&quot;initialSize&quot;)));
		dataSource.setMaxActive(Integer.parseInt(env.getProperty(&quot;maxActive&quot;)));
		dataSource.setMaxWait(Integer.parseInt(env.getProperty(&quot;maxWait&quot;)));
		dataSource.setMinIdle(Integer.parseInt(env.getProperty(&quot;minIdle&quot;)));
		dataSource.setTimeBetweenEvictionRunsMillis(Long.parseLong(env.getProperty(&quot;timeBetweenEvictionRunsMillis&quot;)));
		dataSource.setMinEvictableIdleTimeMillis(Long.parseLong(env.getProperty(&quot;minEvictableIdleTimeMillis&quot;)));

		dataSource.setValidationQuery(env.getProperty(&quot;validationQuery&quot;));
		dataSource.setTestWhileIdle(Boolean.parseBoolean(env.getProperty(&quot;minEvictableIdleTimeMillis&quot;)));
		dataSource.setTestOnBorrow(Boolean.parseBoolean(env.getProperty(&quot;testOnBorrow&quot;)));
		dataSource.setTestOnReturn(Boolean.parseBoolean(env.getProperty(&quot;testOnReturn&quot;)));

		return dataSource;
	}
	
	//2. é…ç½®SqlSessionFactory
	@Bean
	public SqlSessionFactory sqlSessionFactory(DataSource ds) throws Exception {
		//é€šè¿‡SqlSessionFactoryBeanæ¥åˆ›å»ºSqlSessionFactoryå¯¹è±¡
		SqlSessionFactoryBean factoryBean=new SqlSessionFactoryBean();
		//ç”¨ä¼ å…¥çš„DataSourceå¯¹è±¡è®¾ç½®ä¸ºä¾èµ–çš„æ•°æ®æº
		factoryBean.setDataSource(ds);
		//æŒ‡å®šè¦ä½¿ç”¨åˆ«åçš„ç±»å‹æ‰€åœ¨çš„åŒ…ï¼Œè¿™æ ·åœ¨mybatisæ˜ å°„æ–‡ä»¶ç­‰æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨ç±»å‹çš„åˆ«å
		factoryBean.setTypeAliasesPackage(&quot;com.qdu.entity&quot;);
		//è¿”å›åˆ›å»ºçš„SqlSessionFactoryå¯¹è±¡ï¼Œæˆä¸ºspringå®¹å™¨ç®¡ç†çš„bean
		return factoryBean.getObject(); 
	}
	
	//3. é…ç½®äº‹åŠ¡ç®¡ç†å™¨
	@Bean
	public DataSourceTransactionManager txManager(DataSource ds) {
		return new DataSourceTransactionManager(ds);
	}
}
```
springMVC.xmlå¯¹åº”çš„é…ç½®
```java
@Configuration
@ComponentScan(basePackages = {&quot;com.qdu.controller&quot;})
@EnableWebMvc
public class SpringMvcConfig implements WebMvcConfigurer {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(&quot;/static/**&quot;).addResourceLocations(&quot;/static/&quot;);
    }

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController(&quot;/&quot;).setViewName(&quot;index&quot;);
        registry.addViewController(&quot;/index&quot;).setViewName(&quot;index&quot;);
    }

    @Bean
    public SpringResourceTemplateResolver templateResolver() {
        SpringResourceTemplateResolver templateResolver = new SpringResourceTemplateResolver();
        templateResolver.setPrefix(&quot;/WEB-INF/templates/&quot;);
        templateResolver.setSuffix(&quot;.html&quot;);
        templateResolver.setTemplateMode(TemplateMode.HTML); 
        templateResolver.setCacheable(false);
        templateResolver.setCharacterEncoding(&quot;UTF-8&quot;);
        return templateResolver;
    }

    @Bean
    public SpringTemplateEngine templateEngine() {
        SpringTemplateEngine templateEngine = new SpringTemplateEngine();
        templateEngine.setTemplateResolver(templateResolver());
        templateEngine.setEnableSpringELCompiler(true);
        return templateEngine;
    }

    @Bean
    public ThymeleafViewResolver viewResolver() {
        ThymeleafViewResolver viewResolver = new ThymeleafViewResolver();
        viewResolver.setTemplateEngine(templateEngine());
        viewResolver.setCharacterEncoding(&quot;UTF-8&quot;);
        return viewResolver;
    }
}
```
### å¦‚ä½•é›†æˆSSMï¼Ÿ

#### javaé…ç½®ç±»é…ç½®ssm
è§ä¸Šæ¡
#### xmlé…ç½®ssm
web.xml
```xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
	xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
	xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;
	version=&quot;4.0&quot;&gt; 
	&lt;listener&gt; 
		&lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
	&lt;/listener&gt; 
     
	&lt;filter&gt;
		&lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
		&lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
		&lt;init-param&gt;
			&lt;param-name&gt;encoding&lt;/param-name&gt;
			&lt;param-value&gt;UTF-8&lt;/param-value&gt;
		&lt;/init-param&gt;
		&lt;init-param&gt;
			&lt;param-name&gt;forceEncoding&lt;/param-name&gt;
			&lt;param-value&gt;true&lt;/param-value&gt;
		&lt;/init-param&gt;
	&lt;/filter&gt;
		&lt;filter-mapping&gt;
			&lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
			&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
		&lt;/filter-mapping&gt;

	&lt;context-param&gt;
		&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
		&lt;param-value&gt;classpath:config/spring-config.xml&lt;/param-value&gt;
	&lt;/context-param&gt;

	&lt;servlet&gt;
		&lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
		&lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
		&lt;init-param&gt;
			&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
			&lt;param-value&gt;classpath:config/spring-mvc.xml&lt;/param-value&gt;
		&lt;/init-param&gt;
		&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
	&lt;/servlet&gt;
	&lt;servlet-mapping&gt;
		&lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
		&lt;url-pattern&gt;/&lt;/url-pattern&gt;
	&lt;/servlet-mapping&gt;
	&lt;session-config&gt;
		&lt;session-timeout&gt;
			30
		&lt;/session-timeout&gt;
	&lt;/session-config&gt;
&lt;/web-app&gt;
```
spring-config
```xml
&lt;beans ç•¥&gt;
	
	&lt;!-- 1. å¼€å¯åŒ…æ‰«æ --&gt;
	&lt;!-- å› ä¸ºåé¢ä½¿ç”¨MapperScannerConfigurerè¿™ä¸ªç±»çš„é…ç½®å¼€å¯äº†å¯¹Mapperæ¥å£æ‰€åœ¨åŒ…çš„æ‰«æ --&gt;
	&lt;!-- è€Œä¸”æˆ‘ä»¬å·²ç»æ²¡æœ‰Mapperçš„å®ç°ç±»äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦æ‰«æmapperåŒ…äº† --&gt;
	&lt;context:component-scan base-package=&quot;com.qdu.service&quot; /&gt;
	
	&lt;!-- 2. æŒ‡å®šè¦åŠ è½½çš„å±æ€§æ–‡ä»¶çš„ä½ç½®ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªï¼Œé€—å·éš”å¼€ --&gt;	
	&lt;context:property-placeholder location=&quot;classpath:config/jdbc.properties&quot; /&gt;
	
	&lt;!-- 3. é…ç½®æ•°æ®æºï¼Œè¿™é‡Œä½¿ç”¨alibabaçš„DruidDataSource --&gt;
	&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; init-method=&quot;init&quot; destroy-method=&quot;close&quot;&gt;

		&lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driverClass}&quot; /&gt;
		&lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot; /&gt;
		&lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot; /&gt;
		&lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot; /&gt;

		&lt;property name=&quot;initialSize&quot; value=&quot;${initialSize}&quot; /&gt;
		&lt;property name=&quot;maxActive&quot; value=&quot;${maxActive}&quot; /&gt;
		&lt;property name=&quot;maxWait&quot; value=&quot;${maxWait}&quot; /&gt;
		&lt;property name=&quot;minIdle&quot; value=&quot;${minIdle}&quot; /&gt;

		&lt;property name=&quot;timeBetweenEvictionRunsMillis&quot;
			value=&quot;${timeBetweenEvictionRunsMillis}&quot; /&gt;
		&lt;property name=&quot;minEvictableIdleTimeMillis&quot;
			value=&quot;${minEvictableIdleTimeMillis}&quot; /&gt;

		&lt;property name=&quot;validationQuery&quot; value=&quot;${validationQuery}&quot; /&gt;
		&lt;property name=&quot;testWhileIdle&quot; value=&quot;${testWhileIdle}&quot; /&gt;
		&lt;property name=&quot;testOnBorrow&quot; value=&quot;${testOnBorrow}&quot; /&gt;
		&lt;property name=&quot;testOnReturn&quot; value=&quot;${testOnReturn}&quot; /&gt;
	&lt;/bean&gt;
	
	&lt;!-- 4. é…ç½®SqlSessionFactoryBeanï¼Œå‘ŠçŸ¥springå¦‚ä½•åˆ›å»ºSqlSessionFactoryå¯¹è±¡ --&gt;
	&lt;!-- å¹¶å°†åˆ›å»ºçš„SqlSessionFactoryäº¤ç»™springå®¹å™¨ç®¡ç†ï¼Œç„¶åå¯ä»¥åœ¨éœ€è¦çš„åœ°æ–¹ä¾èµ–æ³¨å…¥ --&gt;
	
	&lt;!-- è¿™é‡ŒclassæŒ‡å®šçš„SqlSessionFactoryBeanï¼Œè¿™æ˜¯ä¸€ä¸ªå·¥å‚beanï¼Œè´Ÿè´£ç”Ÿäº§æŸç§ç±»å‹çš„å¯¹è±¡ --&gt;
	&lt;!-- å®ƒè´Ÿè´£åˆ›å»ºSqlSessionFactoryå¯¹è±¡å¹¶äº¤ç»™springç®¡ç†è¯¥å¯¹è±¡ --&gt;
	&lt;!-- è¿™é‡Œçš„idæ˜¯å®ƒåˆ›å»ºçš„SqlSessionFactoryè¿™ä¸ªbeançš„idï¼Œè€Œä¸æ˜¯SqlSessionFactoryBeançš„id --&gt;
	&lt;bean id=&quot;sqlSessionFactory&quot; 
	      class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
  		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
  		&lt;!-- å¦‚æœè¿˜éœ€è¦ä½¿ç”¨mybatisé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨configLocationå±æ€§æŒ‡å®šå…¶ä½ç½® --&gt;
  		&lt;!-- &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot; /&gt; --&gt;
  		&lt;!-- typeAliasesPackageå±æ€§ç”¨äºæŒ‡å®šå®ä½“ç±»æ‰€åœ¨çš„åŒ…ï¼Œè¿™æ ·åœ¨mybatisæ˜ å°„æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨åˆ«åæ¥ä½¿ç”¨å®ä½“ç±» --&gt;
  		&lt;property name=&quot;typeAliasesPackage&quot; value=&quot;com.qdu.entity&quot; /&gt;
  		&lt;!-- mapperLocationså±æ€§ç”¨äºæŒ‡å®šmybatisæ˜ å°„æ–‡ä»¶çš„ä½ç½® --&gt;
  		&lt;!-- &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:com/qdu/mapper/**/*.xml&quot; /&gt; --&gt;
	&lt;/bean&gt;
	
	&lt;!-- 5. é…ç½®MapperScannerConfigurerï¼Œæ‰«æMapperæ¥å£æ‰€åœ¨çš„åŒ…ï¼Œè¿™æ ·å¯ä»¥å‘ç°æ˜ å°„å™¨ --&gt;
	
	&lt;!-- å¯ä»¥ä¸ç”¨ä¸€ä¸ªä¸ªæ³¨å†Œæ˜ å°„å™¨ï¼Œè€Œæ˜¯ç›´æ¥æŒ‡å®šMapperæ¥å£æ‰€åœ¨çš„åŒ… --&gt;
	&lt;!-- è®©springæ‰«æMapperæ¥å£æ‰€åœ¨çš„åŒ…ï¼Œæ ¹æ®æ¯ä¸ªMapperæ¥å£åˆ›å»ºå¯¹åº”çš„Mapperå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ˜ å°„å™¨å®ä¾‹ --&gt;
	&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
		&lt;!-- éœ€è¦ä½¿ç”¨basePackageå±æ€§æŒ‡å®šMapperæ¥å£æ‰€åœ¨çš„åŒ…
			 è¿™æ ·æ˜ å°„å™¨ä¼šè‡ªåŠ¨è¢«åˆ›å»ºï¼Œåœ¨éœ€è¦çš„åœ°æ–¹ç›´æ¥æ³¨å…¥æ˜ å°„å™¨ï¼ˆMapperå®ä¾‹ï¼‰å³å¯--&gt;
		&lt;property name=&quot;basePackage&quot; value=&quot;com.qdu.mapper&quot; /&gt;
	&lt;/bean&gt;
	
	&lt;!-- 6. springé›†æˆmybatisåº”è¯¥å°†äº‹åŠ¡äº¤ç»™springç®¡ç† --&gt;
	
	&lt;!-- 6.1 é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œäº‹åŠ¡ç®¡ç†å™¨æä¾›æ–¹æ³•æ“ä½œäº‹åŠ¡ --&gt;
	
	&lt;bean id=&quot;txManager&quot; 
	      class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
	    &lt;!-- äº‹åŠ¡ç®¡ç†å™¨å’ŒSqlSessionFactoryBeanä½¿ç”¨çš„æ•°æ®æºå¿…é¡»æ˜¯åŒä¸€ä¸ª --&gt;
		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
	&lt;/bean&gt;	
	
	&lt;!-- 6.2 é…ç½®äº‹åŠ¡é€šçŸ¥ --&gt;
	&lt;!-- é…ç½®äº‹åŠ¡é€šçŸ¥å…¶å®å°±æ˜¯é…ç½®é€šçŸ¥çš„beanï¼Œä½†æ˜¯ä¸ä½¿ç”¨beanæ ‡è®° --&gt;
	&lt;!-- è€Œæ˜¯ä½¿ç”¨tx:adviceæ ‡è®°ç®€åŒ–äº‹åŠ¡é…ç½®ï¼Œéœ€è¦æŒ‡å®šé€šçŸ¥beançš„idå’Œä¾èµ–çš„äº‹åŠ¡ç®¡ç†å™¨--&gt;
	&lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;txManager&quot;&gt;
		&lt;tx:attributes&gt;
			&lt;!-- tx:methodæ ‡è®°ç”¨äºæŒ‡å®šæ¯ä¸ªè¦åŠ äº‹åŠ¡çš„æ–¹æ³•å¦‚ä½•åº”ç”¨äº‹åŠ¡ --&gt;
			&lt;!-- æŸ¥è¯¢æ“ä½œå¯åŠ äº‹åŠ¡ï¼Œå¯ä¸åŠ äº‹åŠ¡ï¼Œä½†æ˜¯å¦‚æœæŸ¥è¯¢æ“ä½œå¯èƒ½å—å¹¶å‘äº‹åŠ¡å½±å“ --&gt;
			&lt;!-- é‚£å°±è¦è€ƒè™‘åŠ äº‹åŠ¡ --&gt;
			&lt;tx:method name=&quot;add*&quot; propagation=&quot;REQUIRED&quot; /&gt;
			&lt;tx:method name=&quot;update*&quot; /&gt;
			&lt;tx:method name=&quot;delete*&quot; /&gt;
			&lt;tx:method name=&quot;transfer*&quot; /&gt;
			&lt;!-- å¦‚æœæŸ¥è¯¢åŠ äº†äº‹åŠ¡ï¼Œæœ€å¥½ä½¿ç”¨åªè¯»äº‹åŠ¡ï¼Œæ–¹ä¾¿ä¼˜åŒ–æŸ¥è¯¢ --&gt;
			&lt;tx:method name=&quot;get*&quot; read-only=&quot;true&quot; /&gt;
		&lt;/tx:attributes&gt;
	&lt;/tx:advice&gt;
	
	&lt;!-- 6.3 é…ç½®äº‹åŠ¡é€šçŸ¥å™¨ï¼ŒæŒ‡å®šäº‹åŠ¡é€šçŸ¥åº”ç”¨åˆ°ä»€ä¹ˆåˆ‡å…¥ç‚¹ --&gt;
	&lt;aop:config&gt;
		&lt;aop:pointcut expression=&quot;within(com.qdu.service..*)&quot; id=&quot;pt&quot;/&gt;
		&lt;!-- é…ç½®é€šçŸ¥å™¨ï¼ŒæŒ‡å®šå“ªä¸ªé€šçŸ¥åº”ç”¨åˆ°å“ªä¸ªåˆ‡å…¥ç‚¹ --&gt;
		&lt;aop:advisor advice-ref=&quot;txAdvice&quot;  pointcut-ref=&quot;pt&quot; /&gt;
	&lt;/aop:config&gt;
	
&lt;/beans&gt;
```
spring-mvc
```xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans ç•¥&gt;
    &lt;!--1. å¼€å¯åŒ…æ‰«æï¼Œæ‰«ææ§åˆ¶å™¨æ‰€åœ¨åŒ… --&gt;
    &lt;context:component-scan base-package=&quot;com.qdu.controller&quot; /&gt;
    &lt;!--2. å¯ç”¨æ³¨è§£é©±åŠ¨çš„æ§åˆ¶å™¨ç¼–ç¨‹æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯å¯ç”¨Web MVCé…ç½® --&gt;
    &lt;mvc:annotation-driven /&gt;
    &lt;!--3. é…ç½®Thymeleafç›¸å…³çš„bean --&gt;   
    &lt;!-- é…ç½®æ¨¡æ¿è§£æå™¨ --&gt;
    &lt;bean id=&quot;templateResolver&quot;
		class=&quot;org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver&quot;&gt;
		&lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/templates/&quot; /&gt;
		&lt;property name=&quot;suffix&quot; value=&quot;.html&quot; /&gt;
		&lt;!-- templateModeæŒ‡å®šThymeleafå¤„ç†çš„æ¨¡æ¿ç±»å‹ --&gt;
		&lt;property name=&quot;templateMode&quot; value=&quot;HTML&quot; /&gt;
		&lt;!-- cacheableæŒ‡å®šæ˜¯å¦å¯ä»¥ç¼“å­˜æ¨¡æ¿é¡µé¢å†…å®¹
			å¼€å‘çš„æ—¶å€™è®¾ç½®ä¸ºfalseï¼Œå®é™…å‘å¸ƒç¨‹åºå¯ä»¥è®¾ç½®ä¸ºtrue
			è®¾ç½®trueçš„è¯ï¼Œé¡µé¢è¢«ç¼“å­˜ï¼Œå¦‚æœæ›´æ”¹äº†é¡µé¢å†…å®¹ï¼Œåˆ·æ–°é¡µé¢ä¸ä¼šæ”¹å˜
			è®¾ç½®falseçš„è¯ï¼Œå¦‚æœæ›´æ”¹äº†é¡µé¢å†…å®¹ï¼Œåˆ·æ–°é¡µé¢å†…å®¹ä¼šæ›´æ”¹
		 --&gt;
		&lt;property name=&quot;cacheable&quot; value=&quot;false&quot; /&gt; 
        &lt;property name=&quot;characterEncoding&quot; value=&quot;UTF-8&quot; /&gt;
	&lt;/bean&gt;
	&lt;!-- é…ç½®æ¨¡æ¿å¼•æ“ --&gt;
	&lt;bean id=&quot;templateEngine&quot;
		class=&quot;org.thymeleaf.spring5.SpringTemplateEngine&quot;&gt;
		&lt;property name=&quot;templateResolver&quot; ref=&quot;templateResolver&quot; /&gt;
		&lt;!-- enableSpringELCompilerå±æ€§è®¾ç½®ä¸ºtrueæ˜¯ä¸ºäº†æé«˜æ€§èƒ½ --&gt;
		&lt;!-- åªæœ‰è€ƒè™‘å‘åå…¼å®¹çš„æ—¶å€™æ‰ä¼šè®¾ç½®ä¸ºfalse --&gt;
		&lt;property name=&quot;enableSpringELCompiler&quot; value=&quot;true&quot; /&gt;
	&lt;/bean&gt;
	&lt;!-- é…ç½®Thymeleafè§†å›¾è§£æå™¨ --&gt;
	&lt;bean class=&quot;org.thymeleaf.spring5.view.ThymeleafViewResolver&quot;&gt;
		&lt;property name=&quot;templateEngine&quot; ref=&quot;templateEngine&quot; /&gt;
		&lt;property name=&quot;characterEncoding&quot; value=&quot;UTF-8&quot; /&gt;
	&lt;/bean&gt;
    &lt;!-- 4. å¤„ç†é™æ€èµ„æº --&gt;
    &lt;mvc:resources mapping=&quot;/static/**&quot; location=&quot;/static/&quot; /&gt;
    
    &lt;!-- 5. é…ç½®è·³è½¬åˆ°é¦–é¡µ --&gt;
    &lt;mvc:view-controller path=&quot;/&quot; view-name=&quot;index&quot; /&gt;
    &lt;mvc:view-controller path=&quot;/index&quot; view-name=&quot;index&quot; /&gt;
&lt;/beans&gt;
```
### å¦‚ä½•é…ç½®Spring Securityï¼Ÿ

1.æ·»åŠ å¯åŠ¨ä¾èµ–
```xml
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
```
2.é…ç½®spring security
```java
@Configuration
@EnableWebSecurity
public class SpringSecurityConfig extends WebSecurityConfigurerAdapter {

	@Bean
	public BCryptPasswordEncoder passwordEncoder() {
		return new BCryptPasswordEncoder();
	}

	//æ³¨å…¥è¦ä½¿ç”¨çš„UserDetailsServiceå¯¹è±¡
	@Autowired
	private CustomUserDetailsService userDetailsService;
	
	@Override
	protected void configure(AuthenticationManagerBuilder auth) throws Exception {
		//æŒ‡å®šè¦ä½¿ç”¨UserDetailsServiceå¯¹è±¡ï¼Œä»è€Œå®ç°ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·ä¿¡æ¯(ç”¨æˆ·åã€å¯†ç å’Œè§’è‰²/æˆæƒ)
		//å¹¶æŒ‡å®šè¦ä½¿ç”¨çš„å¯†ç åŠ å¯†å™¨
		auth
		   .userDetailsService(userDetailsService)
		   .passwordEncoder(passwordEncoder());
	}

	@Override
	public void configure(WebSecurity web) throws Exception {
		web.ignoring().antMatchers(&quot;/css/**&quot;, &quot;/js/**&quot;, &quot;/img/**&quot;);
	}

	@Override
	protected void configure(HttpSecurity http) throws Exception {

		http.authorizeRequests()
				.antMatchers(&quot;/&quot;, &quot;/index&quot;, &quot;/toLogin&quot;, &quot;/login_failed&quot;).permitAll()
				.antMatchers(&quot;/user/**&quot;).hasRole(&quot;user&quot;)
				.antMatchers(&quot;/admin/**&quot;).hasAnyRole(&quot;admin&quot;, &quot;sadmin&quot;)
				.antMatchers(&quot;/sadmin/**&quot;).hasRole(&quot;sadmin&quot;)
				.anyRequest().authenticated()
				.and()
				.formLogin()
				.loginPage(&quot;/toLogin&quot;)
				.failureUrl(&quot;/login_failed&quot;)
				.and()
				.rememberMe()
				.rememberMeCookieName(&quot;remember&quot;)
				.rememberMeParameter(&quot;rememberMe&quot;)
				.tokenValiditySeconds(7 * 24 * 60 * 60)
				.and()
				.httpBasic()
				.and()
				.csrf().disable();
				

//		http.httpBasic();
//		http.csrf().disable();
	}
}
```
3.è‡ªå®šä¹‰securityåŠŸèƒ½
```java
//å¦‚æœä½¿ç”¨spring securityéªŒè¯ç”¨æˆ·ï¼Œç”¨æˆ·çš„ä¿¡æ¯æ¥è‡ªæ•°æ®åº“
//å¯ä»¥åˆ›å»ºä¸€ä¸ªUserDetailsServiceç±»æ¥æŒ‡å®šå¦‚ä½•åŠ è½½ç”¨æˆ·ä¿¡æ¯
//éœ€è¦å°†å…¶æ³¨å†Œä¸ºspringç®¡ç†çš„beanï¼Œåœ¨éœ€è¦çš„åœ°æ–¹ä¾èµ–æ³¨å…¥å³å¯
@Component
public class CustomUserDetailsService implements UserDetailsService{

	@Autowired
	private UserInfoMapper mapper;
	
	//loadUserByUsername()æ–¹æ³•ä¸­æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå°è£…æˆéªŒè¯è¦ç”¨çš„ç”¨æˆ·ä¿¡æ¯
	@Override
	public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
		//å¦‚æœéœ€è¦spring securityè¿›è¡Œç”¨æˆ·çš„éªŒè¯å’Œæˆæƒ
		//spring securityéœ€è¦çŸ¥é“ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç å’Œè§’è‰²
		//è¿™é‡Œæ ¹æ®ä¼ å…¥çš„ç”¨æˆ·åï¼ˆç›´æ¥ä½¿ç”¨å³å¯ï¼Œä¼šå¸®ä½ ä¼ å…¥è¾“å…¥çš„ç”¨æˆ·å)
		//æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ä¸ºäº†è·å–å¯†ç 
		UserInfo userinfo=mapper.selectByPrimaryKey(username);
		
		//å¦‚æœæŸ¥ä¸åˆ°è¯¥ç”¨æˆ·ï¼ŒæŠ›å‡ºä¸€ä¸ªç”¨æˆ·åæ‰¾ä¸åˆ°å¼‚å¸¸
		if(null==userinfo)
			throw new UsernameNotFoundException(&quot;æ— æ­¤ç”¨æˆ·&quot;);
		
		//æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·æ‰€å±çš„è§’è‰²åˆ—è¡¨
		List&lt;String&gt; roles=mapper.selectRoleNamesById(username);
		
		//ç”¨æˆ·è§’è‰²åˆ—è¡¨éœ€è¦å°è£…æˆä¸€ä¸ªList&lt;GrantedAuthority&gt;åˆ—è¡¨
		List&lt;GrantedAuthority&gt; authorities=new ArrayList&lt;&gt;();
		//éå†æ¯ä¸ªè§’è‰²åç§°ï¼Œå°†æ¯ä¸ªè§’è‰²åç§°å°è£…æˆä¸€ä¸ªGrantedAuthorityå¯¹è±¡
		//æ·»åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œè¡¨ç¤ºå¯¹ç”¨æˆ·çš„ä¸€é¡¹æˆæƒï¼Œå¦‚æœå¤šä¸ªè§’è‰²ï¼Œåˆ™æœ‰å¤šé¡¹æˆæƒ
		for(String role:roles) {
			//è§’è‰²åå¿…é¡»è¦æ·»åŠ ROLE_å‰ç¼€ï¼Œè¿™æ˜¯spring securityçš„å·¥ä½œæœºåˆ¶å†³å®šçš„
			authorities.add(new SimpleGrantedAuthority(&quot;ROLE_&quot;+role));
		}
		//æœ€ç»ˆè¦è¿”å›ä¸€ä¸ªUserDetailså¯¹è±¡ï¼Œå°è£…äº†éªŒè¯å’Œæˆæƒç”¨çš„ç”¨æˆ·åã€å¯†ç å’Œæˆæƒä¿¡æ¯
		//UserDetailsæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥ä½¿ç”¨å…¶å®ç°ç±»User
		return new User(userinfo.getUid(),userinfo.getUpassword(),authorities);
	}
}
```
## spring MVC 12é—®

### MVCæ¨¡å¼çš„æ¦‚å¿µï¼Ÿ

MVC è®¾è®¡æ¨¡å¼ä¸€èˆ¬æŒ‡ MVC æ¡†æ¶ï¼ŒMï¼ˆModelï¼‰æŒ‡æ•°æ®æ¨¡å‹å±‚ï¼ŒVï¼ˆViewï¼‰æŒ‡è§†å›¾å±‚ï¼ŒCï¼ˆControllerï¼‰æŒ‡æ§åˆ¶å±‚ã€‚ä½¿ç”¨ MVC çš„ç›®çš„æ˜¯å°† M å’Œ V çš„å®ç°ä»£ç åˆ†ç¦»ï¼Œä½¿åŒä¸€ä¸ªç¨‹åºå¯ä»¥æœ‰ä¸åŒçš„è¡¨ç°å½¢å¼ã€‚å…¶ä¸­ï¼ŒView çš„å®šä¹‰æ¯”è¾ƒæ¸…æ™°ï¼Œå°±æ˜¯ç”¨æˆ·ç•Œé¢ã€‚

### Spring MVCåŒ…å«çš„ç»„ä»¶åŠå…¶ä½œç”¨ï¼Ÿ

#### 1ï¼‰DispatcherServlet

DispatcherServlet æ˜¯å‰ç«¯æ§åˆ¶å™¨ï¼Œä»å›¾ 1 å¯ä»¥çœ‹å‡ºï¼ŒSpring MVC çš„æ‰€æœ‰è¯·æ±‚éƒ½è¦ç»è¿‡ DispatcherServlet æ¥ç»Ÿä¸€åˆ†å‘ã€‚DispatcherServlet ç›¸å½“äºä¸€ä¸ªè½¬å‘å™¨æˆ–ä¸­å¤®å¤„ç†å™¨ï¼Œæ§åˆ¶æ•´ä¸ªæµç¨‹çš„æ‰§è¡Œï¼Œå¯¹å„ä¸ªç»„ä»¶è¿›è¡Œç»Ÿä¸€è°ƒåº¦ï¼Œä»¥é™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œæœ‰åˆ©äºç»„ä»¶ä¹‹é—´çš„æ‹“å±•ã€‚

#### 2ï¼‰HandlerMapping

HandlerMapping æ˜¯å¤„ç†å™¨æ˜ å°„å™¨ï¼Œå…¶ä½œç”¨æ˜¯æ ¹æ®è¯·æ±‚çš„ URL è·¯å¾„ï¼Œé€šè¿‡æ³¨è§£æˆ–è€… XML é…ç½®ï¼Œå¯»æ‰¾åŒ¹é…çš„å¤„ç†å™¨ï¼ˆHandlerï¼‰ä¿¡æ¯ã€‚

#### 3ï¼‰HandlerAdapter

HandlerAdapter æ˜¯å¤„ç†å™¨é€‚é…å™¨ï¼Œå…¶ä½œç”¨æ˜¯æ ¹æ®æ˜ å°„å™¨æ‰¾åˆ°çš„å¤„ç†å™¨ï¼ˆHandlerï¼‰ä¿¡æ¯ï¼ŒæŒ‰ç…§ç‰¹å®šè§„åˆ™æ‰§è¡Œç›¸å…³çš„å¤„ç†å™¨ï¼ˆHandlerï¼‰ã€‚

#### 4ï¼‰Handler

Handler æ˜¯å¤„ç†å™¨ï¼Œå’Œ Java Servlet æ‰®æ¼”çš„è§’è‰²ä¸€è‡´ã€‚å…¶ä½œç”¨æ˜¯æ‰§è¡Œç›¸å…³çš„è¯·æ±‚å¤„ç†é€»è¾‘ï¼Œå¹¶è¿”å›ç›¸åº”çš„æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œå°†å…¶å°è£…è‡³ ModelAndView å¯¹è±¡ä¸­ã€‚

#### 5ï¼‰View Resolver

View Resolver æ˜¯è§†å›¾è§£æå™¨ï¼Œå…¶ä½œç”¨æ˜¯è¿›è¡Œè§£ææ“ä½œï¼Œé€šè¿‡ ModelAndView å¯¹è±¡ä¸­çš„ View ä¿¡æ¯å°†é€»è¾‘è§†å›¾åè§£ææˆçœŸæ­£çš„è§†å›¾ Viewï¼ˆå¦‚é€šè¿‡ä¸€ä¸ª JSP è·¯å¾„è¿”å›ä¸€ä¸ªçœŸæ­£çš„ JSP é¡µé¢ï¼‰ã€‚

#### 6ï¼‰View

View æ˜¯è§†å›¾ï¼Œå…¶æœ¬èº«æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ç°ç±»æ”¯æŒä¸åŒçš„ View ç±»å‹ï¼ˆJSPã€FreeMarkerã€Excel ç­‰ï¼‰ã€‚

ä»¥ä¸Šç»„ä»¶ä¸­ï¼Œéœ€è¦å¼€å‘äººå‘˜è¿›è¡Œå¼€å‘çš„æ˜¯å¤„ç†å™¨ï¼ˆHandlerï¼Œå¸¸ç§°Controllerï¼‰å’Œè§†å›¾ï¼ˆViewï¼‰ã€‚é€šä¿—çš„è¯´ï¼Œè¦å¼€å‘å¤„ç†è¯¥è¯·æ±‚çš„å…·ä½“ä»£ç é€»è¾‘ï¼Œä»¥åŠæœ€ç»ˆå±•ç¤ºç»™ç”¨æˆ·çš„ç•Œé¢ã€‚

### Spring MVCå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ï¼Ÿ

![Spring MVCæ‰§è¡Œæµç¨‹](./ssm/1139441444-0.png)

SpringMVC çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ã€‚

1. ç”¨æˆ·ç‚¹å‡»æŸä¸ªè¯·æ±‚è·¯å¾„ï¼Œå‘èµ·ä¸€ä¸ª HTTP request è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¼šè¢«æäº¤åˆ° DispatcherServletï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰ï¼›
2. ç”± DispatcherServlet è¯·æ±‚ä¸€ä¸ªæˆ–å¤šä¸ª HandlerMappingï¼ˆå¤„ç†å™¨æ˜ å°„å™¨ï¼‰ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ‰§è¡Œé“¾ï¼ˆHandlerExecutionChainï¼‰ã€‚
3. DispatcherServlet å°†æ‰§è¡Œé“¾è¿”å›çš„ Handler ä¿¡æ¯å‘é€ç»™ HandlerAdapterï¼ˆå¤„ç†å™¨é€‚é…å™¨ï¼‰ï¼›
4. HandlerAdapter æ ¹æ® Handler ä¿¡æ¯æ‰¾åˆ°å¹¶æ‰§è¡Œç›¸åº”çš„ Handlerï¼ˆå¸¸ç§°ä¸º Controllerï¼‰ï¼›
5. Handler æ‰§è¡Œå®Œæ¯•åä¼šè¿”å›ç»™ HandlerAdapter ä¸€ä¸ª ModelAndView å¯¹è±¡ï¼ˆSpring MVCçš„åº•å±‚å¯¹è±¡ï¼ŒåŒ…æ‹¬ Model æ•°æ®æ¨¡å‹å’Œ View è§†å›¾ä¿¡æ¯ï¼‰ï¼›
6. HandlerAdapter æ¥æ”¶åˆ° ModelAndView å¯¹è±¡åï¼Œå°†å…¶è¿”å›ç»™ DispatcherServlet ï¼›
7. DispatcherServlet æ¥æ”¶åˆ° ModelAndView å¯¹è±¡åï¼Œä¼šè¯·æ±‚ ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼‰å¯¹è§†å›¾è¿›è¡Œè§£æï¼›
8. ViewResolver æ ¹æ® View ä¿¡æ¯åŒ¹é…åˆ°ç›¸åº”çš„è§†å›¾ç»“æœï¼Œå¹¶è¿”å›ç»™ DispatcherServletï¼›
9. DispatcherServlet æ¥æ”¶åˆ°å…·ä½“çš„ View è§†å›¾åï¼Œè¿›è¡Œè§†å›¾æ¸²æŸ“ï¼Œå°† Model ä¸­çš„æ¨¡å‹æ•°æ®å¡«å……åˆ° View è§†å›¾ä¸­çš„ request åŸŸï¼Œç”Ÿæˆæœ€ç»ˆçš„ Viewï¼ˆè§†å›¾ï¼‰ï¼›
10. è§†å›¾è´Ÿè´£å°†ç»“æœæ˜¾ç¤ºåˆ°æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ã€‚

### servletåˆæ³•çš„URLæ¨¡å¼ï¼Ÿ

servletçš„urlæ¨¡å¼åˆæ³•çš„å†™æ³•æœ‰ï¼š
- ç²¾å‡†åŒ¹é…
  - ./index.jsp
- æ‰©å±•ååŒ¹é…
  - `*.xxx` åŒ¹é…ä»¥xxxç»“å°¾çš„è¯·æ±‚url
- è·¯å¾„åŒ¹é…
  - `/xxx/*` ç”¨äºåŒ¹é…è·¯å¾„åŒ…å«xxxçš„æ‰€æœ‰è¯·æ±‚ï¼Œxxxå¯ä»¥æ˜¯ä¸€çº§æˆ–è€…å¤šçº§
  - `/*` åŒ¹é…ä»¥/å¼€å¤´ï¼Œä»»æ„ç»“å°¾çš„è¯·æ±‚urlã€‚
- ç¼ºçœåŒ¹é…
  - `/` åŒ¹é…é™¤JSPä¹‹å¤–çš„æ‰€æœ‰è¯·æ±‚

### å¦‚ä½•é…ç½®DispatcherServletï¼Ÿ

xmlé…ç½®
```xml
&lt;!--web.xml--&gt;
&lt;web-app&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
    &lt;/listener&gt;
&lt;!--  å¦‚æœä¸æŒ‡å®š&lt;context-param&gt;, å°†ä¼šé»˜è®¤åŠ è½½/WEB-INF/applicationContext.xmlæ–‡ä»¶.--&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;/WEB-INF/app-context.xml&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;app&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;app&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/app/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
```


Javaé…ç½®:å®ç°WebApplicationInitializeræ¥å£
```java
public class MyWebApplicationInitializer implements WebApplicationInitializer {

    @Override
    public void onStartup(ServletContext servletCxt) {

        // åŠ è½½spring å®¹å™¨
        AnnotationConfigWebApplicationContext ac = new AnnotationConfigWebApplicationContext();
        ac.register(AppConfig.class);
        ac.refresh();

        // åˆ›å»ºå¹¶æ³¨å†ŒDispatcherServlet
        DispatcherServlet servlet = new DispatcherServlet(ac);
        ServletRegistration.Dynamic registration = servletCxt.addServlet(&quot;app&quot;, servlet);
        registration.setLoadOnStartup(1);
        registration.addMapping(&quot;/app/*&quot;);
    }
}
```

### å¦‚ä½•é…ç½®Spring MVCé…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Ÿ

Spring MVC é…ç½®ï¼šåœ¨ web.xml ä¸­é…ç½® Servletï¼Œåˆ›å»º Spring MVC çš„é…ç½®æ–‡ä»¶
```xml
&lt;!-- é…ç½® SpringMVC çš„å‰ç«¯æ§åˆ¶å™¨ï¼Œå¯¹æµè§ˆå™¨å‘é€çš„è¯·æ±‚ç»Ÿä¸€è¿›è¡Œå¤„ç† --&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;!--é…ç½® DispatcherServlet çš„ä¸€ä¸ªåˆå§‹åŒ–å‚æ•°ï¼šspring mvc é…ç½®æ–‡ä»¶æŒ‰çš„ä½ç½®å’Œåç§°--&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;classpath:springMVC.xml&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;!--ä½œä¸ºæ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ï¼Œåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æœ‰å¤§é‡çš„åˆå§‹åŒ–æ“ä½œè¦åš
            è€Œè¿™äº›æ“ä½œæ”¾åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ‰æ‰§è¡Œä¼šä¸¥é‡å½±å“è®¿é—®é€Ÿåº¦
            å› æ­¤éœ€è¦é€šè¿‡æ­¤æ ‡ç­¾å°†å¯åŠ¨æ§åˆ¶DispatcherServletçš„åˆå§‹åŒ–æ—¶é—´æå‰åˆ°æœåŠ¡å™¨å¯åŠ¨æ—¶--&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
```

### Springå’ŒSpring MVCé…ç½®æ–‡ä»¶çš„é»˜è®¤åç§°ï¼Ÿ

springMVCé…ç½®æ–‡ä»¶é»˜è®¤åç§°ï¼š`&lt;servlet-name&gt;-servlet.xml`
servlet-nameæ˜¯åœ¨web.xml`&lt;servlet&gt;`æ ‡ç­¾ä¸­å®šä¹‰çš„
springé…ç½®æ–‡ä»¶åç§°ï¼š`applicationContext.xml`

### å¦‚ä½•é…ç½®è§†å›¾è§£æå™¨ï¼Ÿ
in *-.servlet
```xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;

    &lt;!--å¼€å¯ç»„ä»¶æ‰«æ--&gt;
  &lt;context:component-scan base-package=&quot;&quot;/&gt;

    &lt;!-- é…ç½® Thymeleaf è§†å›¾è§£æå™¨ --&gt;
    &lt;bean id=&quot;viewResolver&quot;
          class=&quot;org.thymeleaf.spring5.view.ThymeleafViewResolver&quot;&gt;
        &lt;property name=&quot;order&quot; value=&quot;1&quot;/&gt;
        &lt;property name=&quot;characterEncoding&quot; value=&quot;UTF-8&quot;/&gt;
        &lt;property name=&quot;templateEngine&quot;&gt;
            &lt;bean class=&quot;org.thymeleaf.spring5.SpringTemplateEngine&quot;&gt;
                &lt;property name=&quot;templateResolver&quot;&gt;
                    &lt;bean class=&quot;org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver&quot;&gt;
                        &lt;!-- è§†å›¾å‰ç¼€ --&gt;
                        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/templates/&quot;/&gt;
                        &lt;!-- è§†å›¾åç¼€ --&gt;
                        &lt;property name=&quot;suffix&quot; value=&quot;.html&quot;/&gt;
                        &lt;property name=&quot;templateMode&quot; value=&quot;HTML5&quot;/&gt;
                        &lt;property name=&quot;characterEncoding&quot; value=&quot;UTF-8&quot;/&gt;
                    &lt;/bean&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
&lt;/beans&gt;
```

è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰æ˜¯ Spring MVC çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè´Ÿè´£å°†é€»è¾‘è§†å›¾åè§£æä¸ºå…·ä½“çš„è§†å›¾å¯¹è±¡ã€‚

Spring MVC æä¾›äº†å¾ˆå¤šè§†å›¾è§£æç±»ï¼Œå…¶ä¸­æ¯ä¸€é¡¹éƒ½å¯¹åº” Java Web åº”ç”¨ä¸­ç‰¹å®šçš„æŸäº›è§†å›¾æŠ€æœ¯ã€‚ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„è§†å›¾è§£æç±»ã€‚

#### URLBasedViewResolver

UrlBasedViewResolver æ˜¯å¯¹ ViewResolver çš„ä¸€ç§ç®€å•å®ç°ï¼Œä¸»è¦æä¾›äº†ä¸€ç§æ‹¼æ¥ URL çš„æ–¹å¼æ¥è§£æè§†å›¾ã€‚

UrlBasedViewResolver é€šè¿‡ prefix å±æ€§æŒ‡å®šå‰ç¼€ï¼Œsuffix å±æ€§æŒ‡å®šåç¼€ã€‚å½“ ModelAndView å¯¹è±¡è¿”å›å…·ä½“çš„ View åç§°æ—¶ï¼Œå®ƒä¼šå°†å‰ç¼€ prefix å’Œåç¼€ suffix ä¸å…·ä½“çš„è§†å›¾åç§°æ‹¼æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªè§†å›¾èµ„æºæ–‡ä»¶çš„å…·ä½“åŠ è½½è·¯å¾„ï¼Œä»è€ŒåŠ è½½çœŸæ­£çš„è§†å›¾æ–‡ä»¶å¹¶åé¦ˆç»™ç”¨æˆ·ã€‚

ä½¿ç”¨ UrlBasedViewResolver é™¤äº†è¦é…ç½®å‰ç¼€å’Œåç¼€å±æ€§ä¹‹å¤–ï¼Œè¿˜éœ€è¦é…ç½®â€œviewClassâ€ï¼Œè¡¨ç¤ºè§£ææˆå“ªç§è§†å›¾ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹

```xml
&lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.UrlBasedViewResolver&quot;&gt;            
    &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;/&gt; &lt;!--ä¸èƒ½çœç•¥--&gt;
    &lt;!--å‰ç¼€--&gt;
    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;
    &lt;!--åç¼€--&gt;
    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;  
 &lt;/bean&gt;
```

#### InternalResourceViewResolver

InternalResourceViewResolver ä¸ºâ€œå†…éƒ¨èµ„æºè§†å›¾è§£æå™¨â€ï¼Œæ˜¯æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸ç”¨çš„è§†å›¾è§£æå™¨ç±»å‹ã€‚å®ƒæ˜¯ URLBasedViewResolver çš„å­ç±»ï¼Œæ‹¥æœ‰ URLBasedViewResolver çš„ä¸€åˆ‡ç‰¹æ€§ã€‚

InternalResourceViewResolver èƒ½è‡ªåŠ¨å°†è¿”å›çš„è§†å›¾åç§°è§£æä¸º InternalResourceView ç±»å‹çš„å¯¹è±¡ã€‚InternalResourceView ä¼šæŠŠ Controller å¤„ç†å™¨æ–¹æ³•è¿”å›çš„æ¨¡å‹å±æ€§éƒ½å­˜æ”¾åˆ°å¯¹åº”çš„ request å±æ€§ä¸­ï¼Œç„¶åé€šè¿‡ RequestDispatcher åœ¨æœåŠ¡å™¨ç«¯æŠŠè¯·æ±‚ forword é‡å®šå‘åˆ°ç›®æ ‡ URLã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ InternalResourceViewResolver è§†å›¾è§£ææ—¶ï¼Œæ— éœ€å†å•ç‹¬æŒ‡å®š viewClass å±æ€§ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ã€‚

```xml
&lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
    &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;/&gt; &lt;!--å¯ä»¥çœç•¥--&gt;
    &lt;!--å‰ç¼€--&gt;
    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;
    &lt;!--åç¼€--&gt;
    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;  
 &lt;/bean&gt;
```

### åˆ›å»ºå’Œä½¿ç”¨æ§åˆ¶å™¨ï¼Ÿ

@Controller æ³¨è§£ç”¨äºå£°æ˜æŸç±»çš„å®ä¾‹æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºæ§åˆ¶å™¨ç±» IndexControllerï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹

```java
@Controller
public class IndexController {
    // å¤„ç†è¯·æ±‚çš„æ–¹æ³•
}
```

Spring MVC ä½¿ç”¨æ‰«ææœºåˆ¶æ‰¾åˆ°åº”ç”¨ä¸­æ‰€æœ‰åŸºäºæ³¨è§£çš„æ§åˆ¶å™¨ç±»ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†è®©æ§åˆ¶å™¨ç±»è¢« Spring MVC æ¡†æ¶æ‰«æåˆ°ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜ spring-contextï¼Œå¹¶ä½¿ç”¨ `&lt;context:component-scan/&gt;` å…ƒç´ æŒ‡å®šæ§åˆ¶å™¨ç±»çš„åŸºæœ¬åŒ…ï¼ˆè¯·ç¡®ä¿æ‰€æœ‰æ§åˆ¶å™¨ç±»éƒ½åœ¨åŸºæœ¬åŒ…åŠå…¶å­åŒ…ä¸‹ï¼‰ã€‚

ä¾‹å¦‚ï¼Œåœ¨ springmvcDemo åº”ç”¨çš„é…ç½®æ–‡ä»¶ springmvc-servlet.xml ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```xml
&lt;!-- ä½¿ç”¨æ‰«ææœºåˆ¶æ‰«ææ§åˆ¶å™¨ç±»ï¼Œæ§åˆ¶å™¨ç±»éƒ½åœ¨net.biancheng.controlleråŒ…åŠå…¶å­åŒ…ä¸‹ --&gt;
&lt;context:component-scan base-package=&quot;com.example.controller&quot; /&gt;
```

### å¦‚ä½•æ˜ å°„ä¸åŒçš„è¯·æ±‚ï¼Ÿ

åœ¨åŸºäºæ³¨è§£çš„æ§åˆ¶å™¨ç±»ä¸­å¯ä»¥ä¸ºæ¯ä¸ªè¯·æ±‚ç¼–å†™å¯¹åº”çš„å¤„ç†æ–¹æ³•ã€‚ä½¿ç”¨ @RequestMapping æ³¨è§£å°†è¯·æ±‚ä¸å¤„ç†æ–¹æ³•ä¸€ ä¸€å¯¹åº”å³å¯ã€‚

@RequestMapping æ³¨è§£å¯ç”¨äºç±»æˆ–æ–¹æ³•ä¸Šã€‚ç”¨äºç±»ä¸Šï¼Œè¡¨ç¤ºç±»ä¸­çš„æ‰€æœ‰å“åº”è¯·æ±‚çš„æ–¹æ³•éƒ½ä»¥è¯¥åœ°å€ä½œä¸ºçˆ¶è·¯å¾„ã€‚

@RequestMapping æ³¨è§£å¸¸ç”¨å±æ€§å¦‚ä¸‹ã€‚

#### 1. value å±æ€§

value å±æ€§æ˜¯ @RequestMapping æ³¨è§£çš„é»˜è®¤å±æ€§ï¼Œå› æ­¤å¦‚æœåªæœ‰ value å±æ€§æ—¶ï¼Œå¯ä»¥çœç•¥è¯¥å±æ€§åï¼Œå¦‚æœæœ‰å…¶å®ƒå±æ€§ï¼Œåˆ™å¿…é¡»å†™ä¸Š value å±æ€§åç§°ã€‚å¦‚ä¸‹ã€‚

```java
@RequestMapping(value=&quot;toUser&quot;)
//or
@RequestMapping(&quot;toUser&quot;)
```

value å±æ€§æ”¯æŒé€šé…ç¬¦åŒ¹é…ï¼Œå¦‚ `@RequestMapping(value=&quot;toUser/*&quot;)` è¡¨ç¤º http://localhost:8080/toUser/1 æˆ– http://localhost:8080/toUser/hahaha éƒ½èƒ½å¤Ÿæ­£å¸¸è®¿é—®ã€‚

#### 2. pathå±æ€§

path å±æ€§å’Œ value å±æ€§éƒ½ç”¨æ¥ä½œä¸ºæ˜ å°„ä½¿ç”¨ã€‚å³ `@RequestMapping(value=&quot;toUser&quot;)` å’Œ `@RequestMapping(path=&quot;toUser&quot;)` éƒ½èƒ½è®¿é—® toUser() æ–¹æ³•ã€‚

path å±æ€§æ”¯æŒé€šé…ç¬¦åŒ¹é…ï¼Œå¦‚ `@RequestMapping(path=&quot;toUser/*&quot;)` è¡¨ç¤º http://localhost:8080/toUser/1 æˆ– http://localhost:8080/toUser/hahaha éƒ½èƒ½å¤Ÿæ­£å¸¸è®¿é—®ã€‚

#### 3. nameå±æ€§

nameå±æ€§ç›¸å½“äºæ–¹æ³•çš„æ³¨é‡Šï¼Œä½¿æ–¹æ³•æ›´æ˜“ç†è§£ã€‚å¦‚ `@RequestMapping(value = &quot;toUser&quot;,name = &quot;è·å–ç”¨æˆ·ä¿¡æ¯&quot;)`ã€‚

#### 4. methodå±æ€§

method å±æ€§ç”¨äºè¡¨ç¤ºè¯¥æ–¹æ³•æ”¯æŒå“ªäº› HTTP è¯·æ±‚ã€‚å¦‚æœçœç•¥ method å±æ€§ï¼Œåˆ™è¯´æ˜è¯¥æ–¹æ³•æ”¯æŒå…¨éƒ¨çš„ HTTP è¯·æ±‚ã€‚

`@RequestMapping(value = &quot;toUser&quot;,method = RequestMethod.GET)`è¡¨ç¤ºè¯¥æ–¹æ³•åªæ”¯æŒ GET è¯·æ±‚ã€‚

ä¹Ÿå¯æŒ‡å®šå¤šä¸ª HTTP è¯·æ±‚ï¼Œå¦‚ `@RequestMapping(value = &quot;toUser&quot;,method = {RequestMethod.GET,RequestMethod.POST})`ï¼Œè¯´æ˜è¯¥æ–¹æ³•åŒæ—¶æ”¯æŒ GET å’Œ POST è¯·æ±‚ã€‚

#### 5. paramså±æ€§

params å±æ€§ç”¨äºæŒ‡å®šè¯·æ±‚ä¸­è§„å®šçš„å‚æ•°ï¼Œä»£ç å¦‚ä¸‹ã€‚

```java
@RequestMapping(value = &quot;toUser&quot;,params = &quot;type&quot;)
public String toUser() {
    return &quot;showUser&quot;;
}
```

ä»¥ä¸Šä»£ç è¡¨ç¤ºè¯·æ±‚ä¸­å¿…é¡»åŒ…å« type å‚æ•°æ—¶æ‰èƒ½æ‰§è¡Œè¯¥è¯·æ±‚ã€‚å³ http://localhost:8080/toUser?type=xxx èƒ½å¤Ÿæ­£å¸¸è®¿é—® toUser() æ–¹æ³•ï¼Œè€Œ http://localhost:8080/toUser åˆ™ä¸èƒ½æ­£å¸¸è®¿é—® toUser() æ–¹æ³•ã€‚

```java
@RequestMapping(value = &quot;toUser&quot;,params = &quot;type=1&quot;)
public String toUser() {        
    return &quot;showUser&quot;;
}
```

ä»¥ä¸Šä»£ç è¡¨ç¤ºè¯·æ±‚ä¸­å¿…é¡»åŒ…å« type å‚æ•°ï¼Œä¸” type å‚æ•°ä¸º 1 æ—¶æ‰èƒ½å¤Ÿæ‰§è¡Œè¯¥è¯·æ±‚ã€‚å³ http://localhost:8080/toUser?type=1 èƒ½å¤Ÿæ­£å¸¸è®¿é—® toUser() æ–¹æ³•ï¼Œè€Œ http://localhost:8080/toUser?type=2 åˆ™ä¸èƒ½æ­£å¸¸è®¿é—® toUser() æ–¹æ³•ã€‚

#### 6. headerå±æ€§

header å±æ€§è¡¨ç¤ºè¯·æ±‚ä¸­å¿…é¡»åŒ…å«æŸäº›æŒ‡å®šçš„ header å€¼ã€‚

`@RequestMapping(value = &quot;toUser&quot;,headers = &quot;Referer=http://www.xxx.com&quot;)` è¡¨ç¤ºè¯·æ±‚çš„ header ä¸­å¿…é¡»åŒ…å«äº†æŒ‡å®šçš„â€œRefererâ€è¯·æ±‚å¤´ï¼Œä»¥åŠå€¼ä¸ºâ€œhttp://www.xxx.comâ€æ—¶ï¼Œæ‰èƒ½æ‰§è¡Œè¯¥è¯·æ±‚ã€‚

#### 7. consumerså±æ€§

consumers å±æ€§ç”¨äºæŒ‡å®šå¤„ç†è¯·æ±‚çš„æäº¤å†…å®¹ç±»å‹ï¼ˆContent-Typeï¼‰ï¼Œä¾‹å¦‚ï¼šapplication/jsonã€text/htmlã€‚å¦‚
`@RequestMapping(value = &quot;toUser&quot;,consumes = &quot;application/json&quot;)`ã€‚

#### 8. produceså±æ€§

produces å±æ€§ç”¨äºæŒ‡å®šè¿”å›çš„å†…å®¹ç±»å‹ï¼Œè¿”å›çš„å†…å®¹ç±»å‹å¿…é¡»æ˜¯ request è¯·æ±‚å¤´ï¼ˆAcceptï¼‰ä¸­æ‰€åŒ…å«çš„ç±»å‹ã€‚å¦‚ @RequestMapping(value = &quot;toUser&quot;,produces = &quot;application/json&quot;)ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œproduces å±æ€§è¿˜å¯ä»¥æŒ‡å®šè¿”å›å€¼çš„ç¼–ç ã€‚å¦‚ `@RequestMapping(value = &quot;toUser&quot;,produces = &quot;application/json,charset=utf-8&quot;)`ï¼Œè¡¨ç¤ºè¿”å› utf-8 ç¼–ç ã€‚

ä½¿ç”¨ @RequestMapping æ¥å®Œæˆæ˜ å°„ï¼Œå…·ä½“åŒ…æ‹¬ 4 ä¸ªæ–¹é¢çš„ä¿¡æ¯é¡¹ï¼šè¯·æ±‚ URLã€è¯·æ±‚å‚æ•°ã€è¯·æ±‚æ–¹æ³•å’Œè¯·æ±‚å¤´ã€‚

### å¦‚ä½•é…ç½®é™æ€èµ„æºï¼Ÿ

```xml
&lt;mvc:resources mapping=&quot;/js/**&quot; location=&quot;/js/&quot;&gt;&lt;/mvc:resources&gt;
	&lt;mvc:resources mapping=&quot;/css/**&quot; location=&quot;/css/&quot;&gt;&lt;/mvc:resources&gt;
	&lt;mvc:resources mapping=&quot;/img/**&quot; location=&quot;/img/&quot;&gt;&lt;/mvc:resources&gt;
	&lt;!-- åœ¨é…ç½®äº†mvc:resourcesæ ‡ç­¾ä¹‹åå¿…é¡»é…ç½®mvc:annotation-drivenæ ‡ç­¾é™æ€èµ„æº
	æ‰å¯ä»¥è®¿é—®ï¼Œå¦åˆ™ä¸ä»…é™æ€èµ„æºä¸èƒ½è®¿é—®ï¼Œå…¶ä»–çš„æ‰€æœ‰è¯·æ±‚ä¹Ÿéƒ½æ— æ³•æ­£å¸¸å¤„ç†äº† --&gt;
    &lt;mvc:annotation-driven/&gt;
```

### å¦‚ä½•æ„å»ºRestful APIï¼Ÿ

RESTï¼ˆRepresentational State Transferï¼‰å³è¡¨è¿°æ€§è½¬ç§»ï¼Œæ˜¯ç›®å‰æœ€æµè¡Œçš„ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ã€‚å®ƒç»“æ„æ¸…æ™°ã€æ˜“äºç†è§£ã€æœ‰è¾ƒå¥½çš„æ‰©å±•æ€§ã€‚

Spring REST é£æ ¼å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šä½¿ç”¨ URL è¡¨ç¤ºèµ„æºæ—¶ï¼Œæ¯ä¸ªèµ„æºéƒ½ç”¨ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ URL æ¥è¡¨ç¤ºï¼Œå¹¶ä½¿ç”¨ HTTP æ–¹æ³•è¡¨ç¤ºæ“ä½œï¼Œå³å‡†ç¡®æè¿°æœåŠ¡å™¨å¯¹èµ„æºçš„å¤„ç†åŠ¨ä½œï¼ˆGETã€POSTã€PUTã€DELETEï¼‰ï¼Œå®ç°èµ„æºçš„å¢åˆ æ”¹æŸ¥ã€‚

- GETï¼šè¡¨ç¤ºè·å–èµ„æº
- POSTï¼šè¡¨ç¤ºæ–°å»ºèµ„æº
- PUTï¼šè¡¨ç¤ºæ›´æ–°èµ„æº
- DELETEï¼šè¡¨ç¤ºåˆ é™¤èµ„æº

# Spring Boot 65é—®

## æ¡†æ¶22é—®

### å¯åŠ¨ä¾èµ–æ˜¯ä»€ä¹ˆï¼Ÿ

Spring Bootå°±å¯ä»¥æŒ‡å®šåŸºäºåŠŸèƒ½ä¾èµ–ã€‚Spring Booté€šè¿‡èµ·æ­¥ä¾èµ–ä¸ºé¡¹ç›®çš„ä¾èµ–ç®¡ç†æä¾›å¸®åŠ©ã€‚å¦‚æœåº”ç”¨ç¨‹åºæ˜¯Webåº”ç”¨ç¨‹åºï¼ˆåŠŸèƒ½ï¼‰ï¼Œä¸éœ€è¦å‘é¡¹ç›®pom.xmlæ–‡ä»¶ä¸­æ·»åŠ ä¸€å †å•ç‹¬çš„ä¾èµ–ï¼Œå¯ä»¥ç›´æ¥å‘é¡¹ç›®ä¸­æ·»åŠ Webèµ·æ­¥ä¾èµ–ã€‚å¦‚æœåº”ç”¨ç¨‹åºéœ€è¦ç”¨åˆ°JPAæŒä¹…åŒ–ï¼ˆåŠŸèƒ½ï¼‰ï¼ŒåŠ å…¥jpaèµ·æ­¥ä¾èµ–ï¼›å¦‚æœéœ€è¦å®‰å…¨åŠŸèƒ½ï¼ˆåŠŸèƒ½ï¼‰ï¼Œå°±åŠ å…¥securityèµ·æ­¥ä¾èµ–ã€‚æ·»åŠ ä¾èµ–æ—¶ä¸éœ€è¦æŒ‡å®šä¾èµ–çš„ç‰ˆæœ¬å·ï¼Œä¾èµ–çš„ç‰ˆæœ¬å·ç”±å½“å‰æ˜¯ä½¿ç”¨çš„Spring Bootç‰ˆæœ¬å·æ¥å†³å®šã€‚

èµ·æ­¥ä¾èµ–å°±æ˜¯ç‰¹æ®Šçš„Mavenä¾èµ–ï¼Œåˆ©ç”¨äº†ä¼ é€’ä¾èµ–è§£æï¼ŒæŠŠå¸¸ç”¨åº“èšåˆåœ¨ä¸€èµ·ï¼Œç»„æˆå‡ ä¸ªä¸ºç‰¹å®šåŠŸèƒ½è€Œå®šåˆ¶çš„ä¾èµ–ã€‚Spring Booté€šè¿‡èµ·æ­¥ä¾èµ–ï¼šç›´æ¥å¼•å…¥ç›¸å…³èµ·æ­¥ä¾èµ–å°±è¡Œï¼Œæˆ‘ä»¬ä¸éœ€è¦è€ƒè™‘æ”¯æŒæŸç§åŠŸèƒ½éœ€è¦ä»€ä¹ˆåº“ï¼Œ å‡å°‘äº†ä¾èµ–æ•°é‡ï¼Œè€Œä¸”ä¸éœ€è¦è€ƒè™‘è¿™äº›åº“çš„é‚£äº›ç‰ˆæœ¬ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä»€ä¹ˆåŠŸèƒ½ï¼Œå°±å¾€é¡¹ç›®ä¸­åŠ å…¥è¯¥åŠŸèƒ½çš„èµ·æ­¥ä¾èµ–å°±å¥½äº†ã€‚


### Actuatorçš„ä½œç”¨ï¼Ÿ

Actuatorç”¨äºç›‘è§†å’Œç®¡ç†åº”ç”¨ç¨‹åº

ç›‘æ§çš„å†…å®¹ï¼š
- Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­é…ç½®çš„Bean 
- Spring Bootçš„è‡ªåŠ¨é…ç½®åšçš„å†³ç­– 
- åº”ç”¨ç¨‹åºå¯ç”¨çš„ç¯å¢ƒå˜é‡ã€ç³»ç»Ÿå±æ€§ã€é…ç½®å±æ€§å’Œå‘½ä»¤è¡Œå‚æ•°ç­‰ 
- åº”ç”¨ç¨‹åºé‡Œçº¿ç¨‹çš„å½“å‰çŠ¶æ€ 
- åº”ç”¨ç¨‹åºæœ€è¿‘å¤„ç†çš„HTTPè¯·æ±‚çš„è¿½è¸ªæƒ…å†µ 
- å„ç§å’Œå†…å­˜ä½¿ç”¨ã€åƒåœ¾å›æ”¶ã€Webè¯·æ±‚ç­‰ç›¸å…³çš„æŒ‡æ ‡
### Spring Boot é…ç½®ä¾èµ–ï¼Ÿ

```xml
&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
```

### å¦‚ä½•ä¿®é¥°å¯åŠ¨ç±»ï¼Ÿ

```xml
&lt;!--æ’é™¤ä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; 
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;
```
```xml
&lt;!--ç”¨æŒ‡å®šä¾èµ–ç‰ˆæœ¬ è¦†ç›– ä¼ é€’ä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
    &lt;version&gt;2.4.3&lt;/version&gt;
&lt;/dependency&gt;
```

### @SpringBootApplicationæ˜¯å“ªä¸‰åˆä¸€ï¼Ÿ

@SpringBootApplication = (é»˜è®¤å±æ€§)@Configuration + @EnableAutoConfiguration + @ComponentScanã€‚

@Configurationï¼šå»ºä¸€ä¸ªç®€å•çš„springé…ç½®ç±»ï¼Œå¯ä»¥ç”¨æ¥æ›¿ä»£ç›¸åº”çš„xmlé…ç½®æ–‡ä»¶ï¼Œè§è¯æ¡ @Configurationå’Œ@Beanæ³¨è§£çš„ä½œç”¨

@EnableAutoConfigurationï¼šèƒ½å¤Ÿè‡ªåŠ¨é…ç½®springçš„ä¸Šä¸‹æ–‡ï¼Œè¯•å›¾çŒœæµ‹å’Œé…ç½®ä½ æƒ³è¦çš„beanç±»ï¼Œé€šå¸¸ä¼šè‡ªåŠ¨æ ¹æ®ä½ çš„ç±»è·¯å¾„å’Œä½ çš„beanå®šä¹‰è‡ªåŠ¨é…ç½®

@ComponentScanï¼šä¼šè‡ªåŠ¨æ‰«ææŒ‡å®šåŒ…ä¸‹çš„å…¨éƒ¨æ ‡æœ‰@Componentçš„ç±»ï¼Œå¹¶æ³¨å†Œæˆbeanï¼Œå½“ç„¶åŒ…æ‹¬@Componentä¸‹çš„å­æ³¨è§£@Service,@Repository,@Controller

### å¦‚ä½•æ’é™¤æŒ‡å®šçš„è‡ªåŠ¨é…ç½®ï¼Ÿ

```java
@SpringBootApplication(exclude={RedisAutoConfiguration.class})
```

### ä¸€ä¸ªå¯åŠ¨ç±»èƒ½å¦åŒæ—¶ä½œä¸ºæ§åˆ¶å™¨ç±»ï¼Ÿ

èƒ½

### å¦‚ä½•è‡ªå®šä¹‰bannerï¼Ÿ

å°†`banner.txt`ï¼ˆæˆ–`banner,jpg`ï¼‰æ”¾å…¥`src/main/resources`

### SpringBootå¦‚ä½•å®ç°è‡ªåŠ¨é…ç½®ï¼Ÿ

åŠ è½½spring.factories

### SpringBootå¦‚ä½•é…ç½®è§†å›¾è§£æå™¨ï¼Ÿ

**é…ç½®æ–‡ä»¶**
```properties
spring.mvc.view.prefix=/pages/
spring.mvc.view.suffix=.html
```
æˆ–
```yaml
spring:
  mvc:
    view:
      prefix: /pages/
      suffix: .html
```

**é…ç½®ç±»**

```java
@Configuration
public class MvcConfig implements WebMvcConfigurer {
    @Bean
    public InternalResourceViewResolver configureInternalResourceViewResolver() {
        InternalResourceViewResolver resolver = new InternalResourceViewResolver();
        resolver.setPrefix(&quot;/pages/&quot;);
        resolver.setSuffix(&quot;.html&quot;);
        return resolver;
    }
}
```

### å¦‚ä½•é…ç½®ç«¯å£å·ï¼Ÿ

```properties
server.port=8081
```
æˆ–
```yaml
server:
    port: 8081
```

### propertiesä¸ymlçš„å¼‚åŒï¼Ÿ

&lt;mark&gt;propertiesçš„ä¼˜å…ˆçº§ä¼šé«˜äºyml&lt;/mark&gt;

ymlé‡‡ç”¨æ ‘å½¢ç»“æ„ï¼Œæ›´æœ‰å±‚æ¬¡æ„Ÿï¼Œå¯è¯»æ€§å¾ˆå¼ºï¼›ç›¸åï¼Œproperties åˆ™æ›´ä¸ºç›´æ¥

properties çš„åŸºæœ¬è¯­æ³•æ ¼å¼æ˜¯â€œkey=valueâ€çš„å½¢å¼ï¼›yml çš„åŸºæœ¬è¯­æ³•æ ¼å¼æ˜¯â€œkey: valueâ€çš„å½¢å¼,å†’å·åé¢éœ€è¦åŠ ç©ºæ ¼

### é™æ€èµ„æºé»˜è®¤ä½ç½®åœ¨å“ªï¼Ÿ

classpath:/META-INF/resources/

classpath:/resources/

classpath:/static/

classpath:/public/

### å¦‚ä½•è‡ªå®šä¹‰é™æ€èµ„æºçš„ä½ç½®ï¼Ÿ

**åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®**
```properties
#é™æ€èµ„æºè®¿é—®è·¯å¾„
spring.mvc.static-path-pattern=/upload/**
#é™æ€èµ„æºæ˜ å°„è·¯å¾„
spring.resources.static-locations=classpath:/upload/
```

**é…ç½®ç±»**

```java
@Configuration
public class MvcConfig extends WebMvcConfigurerAdapter {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {ã€€ã€€ã€€ã€€ã€€// è¿™é‡Œä¹‹æ‰€ä»¥å¤šäº†ä¸€&quot;/&quot;,æ˜¯ä¸ºäº†è§£å†³æ‰“waræ—¶è®¿é—®ä¸åˆ°é—®é¢˜
        registry.addResourceHandler(&quot;/**&quot;).addResourceLocations(&quot;/&quot;,&quot;classpath:/&quot;);
    }
}
```

### æœ‰å“ªäº›å¸¸ç”¨çš„JSONè§£æå™¨ï¼Ÿ

1ï¼‰json-lib

json-lib æœ€æ—©ä¹Ÿæ˜¯åº”ç”¨å¹¿æ³›çš„ JSON è§£æå·¥å…·ï¼Œç¼ºç‚¹æ˜¯ä¾èµ–å¾ˆå¤šçš„ç¬¬ä¸‰æ–¹åŒ…

å¯¹äºå¤æ‚ç±»å‹çš„è½¬æ¢ï¼Œjson-lib åœ¨å°† JSON è½¬æ¢æˆ Bean æ—¶è¿˜æœ‰ç¼ºé™·ï¼Œæ¯”å¦‚ä¸€ä¸ªç±»é‡ŒåŒ…å«å¦ä¸€ä¸ªç±»çš„ List æˆ–è€… Map é›†åˆï¼Œjson-lib ä» JSON åˆ° Bean çš„è½¬æ¢å°±ä¼šå‡ºç°é—®é¢˜ã€‚

#### 2ï¼‰å¼€æºçš„Jackson

å¼€æºçš„ Jackson æ˜¯ Spring MVC å†…ç½®çš„ JSON è½¬æ¢å·¥å…·ã€‚

ä½†æ˜¯ Jackson å¯¹äºå¤æ‚ç±»å‹çš„ JSON è½¬æ¢ Bean ä¼šå‡ºç°é—®é¢˜

#### 3ï¼‰Googleçš„Gson

Gson æ˜¯ç›®å‰åŠŸèƒ½æœ€å…¨çš„ JSON è§£æç¥å™¨

Gson å®Œå…¨å¯ä»¥å°†å¤æ‚ç±»å‹çš„ JSON åˆ° Bean æˆ– Bean åˆ° JSON çš„è½¬æ¢ï¼Œæ˜¯ JSON è§£æçš„ç¥å™¨ã€‚Gson åœ¨åŠŸèƒ½ä¸Šé¢æ— å¯æŒ‘å‰”ï¼Œä½†æ€§èƒ½æ¯” FastJson æœ‰æ‰€å·®è·ã€‚

#### 4ï¼‰é˜¿é‡Œå·´å·´çš„FastJson

FastJson æ˜¯ç”¨ Java è¯­è¨€ç¼–å†™çš„é«˜æ€§èƒ½ JSON å¤„ç†å™¨ï¼Œç”±é˜¿é‡Œå·´å·´å…¬å¸å¼€å‘ã€‚

FastJson åœ¨å¤æ‚ç±»å‹çš„ Bean è½¬æ¢ JSON ä¸Šä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œå¯èƒ½ä¼šå‡ºç°å¼•ç”¨çš„ç±»å‹ï¼Œå¯¼è‡´ JSON è½¬æ¢å‡ºé”™ï¼Œéœ€è¦åˆ¶å®šå¼•ç”¨ã€‚

### ä¸ºå“ªäº›JSONè§£æå™¨æä¾›äº†è‡ªåŠ¨é…ç½®ï¼Ÿ

Gson ã€Jackson ã€JSON-B

### å¦‚ä½•ä½¿ç”¨fastjsonï¼Ÿ

å¯¼å…¥ä¾èµ–
```xml
&lt;dependency&gt;
      &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
      &lt;artifactId&gt;fastjson&lt;/artifactId&gt;
      &lt;version&gt;1.2.15&lt;/version&gt;
    &lt;/dependency&gt;
```
åœ¨springMVCçš„é…ç½®ç±»ä¸­é…ç½®JSONè§£æå™¨ä¸ºfastJSON
```java
//é€šè¿‡é…ç½®HttpMessageConverteræ¥é…ç½®ä½¿ç”¨çš„JSONå¤„ç†å™¨
//æ¯ä¸ªJSONå¤„ç†å™¨éƒ½æœ‰å¯¹åº”çš„æ¶ˆæ¯è½¬æ¢å™¨å®ç°ç±»ï¼Œç”¨äºå®ç°javaå¯¹è±¡å’Œjsonå¯¹è±¡çš„è½¬æ¢
@Override
public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
    
    FastJsonHttpMessageConverter converter=new FastJsonHttpMessageConverter();
    //è®¾ç½®è½¬æ¢å™¨çš„å­—ç¬¦é›†ç¼–ç ï¼Œè§£å†³ä¸­æ–‡ä¹±ç 
    
    converter.setDefaultCharset(Charset.forName(&quot;UTF-8&quot;));
    //å› ä¸ºspring bootæ²¡æœ‰æä¾›fastjsonçš„é›†æˆå’Œè‡ªåŠ¨é…ç½®ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨application.properties
    //ä¸­é…ç½®fastjsonçš„å±æ€§
    
    //åˆ›å»ºä¸€ä¸ªFastJsonConfigå¯¹è±¡ï¼Œå®šåˆ¶fastjsonçš„é…ç½®
    FastJsonConfig config=new FastJsonConfig();
    config.setDateFormat(&quot;yyyy-MM-dd&quot;);
    //setSerializerFeatures()ç”¨äºæŒ‡å®šåºåˆ—åŒ–åjsonæ•°æ®çš„ç‰¹å¾
    //WriteMapNullValue: æ˜¯å¦è¾“å‡ºå€¼ä¸ºnullçš„å­—æ®µ,é»˜è®¤ä¸ºfalse  
    //WriteNullStringAsEmpty: nullå­—ç¬¦ä¸²æ˜¯å¦æ˜¾ç¤ºä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯null
    //WriteNullNumberAsZero: æ˜¯å¦å°†nullçš„æ•°å€¼æ˜¾ç¤ºä¸º0ï¼Œè€Œä¸æ˜¯null
    //WriteNullListAsEmpty: æ˜¯å¦å°†nullçš„Listæ˜¾ç¤ºä¸º[]ï¼Œè€Œä¸æ˜¯null
    //DisableCircularReferenceDetect: ç¦ç”¨å¯¹åŒä¸€ä¸ªå¯¹è±¡çš„å¾ªç¯å¼•ç”¨ï¼Œå¦‚æœä½¿ç”¨Hibernateç­‰æ¡†æ¶æ˜ å°„äº†å…³ç³»ï¼Œå¯èƒ½ä¼šå‡ºç°å¾ªç¯å¼•ç”¨ 
    config.setSerializerFeatures(
            SerializerFeature.WriteMapNullValue,
            SerializerFeature.WriteNullStringAsEmpty,
            SerializerFeature.WriteNullNumberAsZero,
            SerializerFeature.WriteNullListAsEmpty,
            SerializerFeature.DisableCircularReferenceDetect
            );
    
    //åº”ç”¨fastjsoné…ç½®
    converter.setFastJsonConfig(config);
    
    converters.add(converter);
    
    for(HttpMessageConverter c:converters)
        System.out.println(c.getClass()); //æ‰“å°ä¸€ä¸‹è½¬æ¢å™¨çš„ç±»å‹
}
```

ç›´æ¥ç”¨ã€‚ã€‚ã€‚

### å¦‚ä½•è‡ªå®šä¹‰é”™è¯¯ç•Œé¢çš„ä½ç½®ï¼Ÿ

**é™æ€**

åœ¨ resource/static ç›®å½•ä¸‹åˆ›å»º error ç›®å½•ï¼Œç„¶ååœ¨ error ç›®å½•ä¸­åˆ›å»ºé”™è¯¯å±•ç¤ºé¡µé¢ã€‚é”™è¯¯å±•ç¤ºé¡µé¢å‘½åè§„åˆ™æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š

ä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨å…·ä½“çš„å“åº”ç å‘½åæ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š404.htmlã€405.htmlã€500.html
å¦ä¸€ç§å¯ä»¥ä½¿ç”¨ 4xx.htmlã€5xx.html è¿™æ ·çš„å‘½å

**åŠ¨æ€**

åœ¨ resource/templates ç›®å½•ä¸‹åˆ›å»º error ç›®å½•ï¼Œç„¶ååœ¨ error ç›®å½•ä¸­åˆ›å»ºé”™è¯¯å±•ç¤ºé¡µé¢ã€‚

### é”™è¯¯ç•Œé¢ä½¿ç”¨çš„é¡ºåºå¦‚ä½•ï¼Ÿ

ä¼˜å…ˆçº§ï¼š

åŠ¨æ€é”™è¯¯ç &gt;é™æ€é”™è¯¯ç &gt;åŠ¨æ€æ¨¡ç³Šé”™è¯¯ç &gt;é™æ€æ¨¡ç³Šé”™è¯¯ç 

æ‰¾åˆ°ä¸€ä¸ªåä¾¿ä¸å¾€ä¸‹å¯»æ‰¾

### å¦‚ä½•å®šä¹‰å±€éƒ¨å¼‚å¸¸handlerï¼Ÿ

```java
@ExceptionHandler(value = {java.lang.ArithmeticException.class})
public ModelAndView arithmeticExceptionHandler(Exception e){
    ModelAndView mv = new ModelAndView();
    mv.addObject(&quot;errorMsg&quot;,e);
    mv.setViewName(&quot;error&quot;);
    return mv;
}
```

### å¦‚ä½•å®šä¹‰å…¨å±€å¼‚å¸¸handlerï¼Ÿ

```
//åˆ›å»ºä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†ç¨‹åº
//å…¨å±€å¼‚å¸¸å¤„ç†ç¨‹åºæ‰€åœ¨çš„ç±»ä½¿ç”¨@ControllerAdviceæˆ–@RestControllerAdviceæ³¨è§£ä¿®é¥°
//@ControllerAdviceæ³¨è§£ä½œç”¨å¾ˆå¤šï¼Œå…¶ä¸­ä¸€ä¸ªä½œç”¨æ˜¯ä¿®é¥°å…¨å±€å¼‚å¸¸å¤„ç†ç¨‹åºæ‰€åœ¨çš„ç±»
@ControllerAdvice
public class GlobalExceptionHandler {

	@ExceptionHandler({ ArithmeticException.class })
	public String handleException(Exception ex, Model model) {
		// åœ¨æ­¤æ”¶é›†å¼‚å¸¸ä¿¡æ¯ï¼Œæ¯”å¦‚å°†å¼‚å¸¸ä¿¡æ¯å†™å…¥æ—¥å¿—ç­‰
		model.addAttribute(&quot;msg&quot;, &quot;å…¨å±€å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œå¼‚å¸¸æ¶ˆæ¯ï¼š&quot;+ex.getMessage());
		return &quot;err&quot;; // å¤„ç†å®Œå¼‚å¸¸ï¼Œå¯ä»¥è·³è½¬åˆ°æŒ‡å®šçš„é¡µé¢/è§†å›¾
	}
	
	//å¼‚å¸¸å¤„ç†ç¨‹åºå¯¹åº”çš„æ–¹æ³•å‰å¯ä»¥ä½¿ç”¨@ResponseBodyæ³¨è§£ï¼Œå°†è¿”å›å€¼ä½œä¸ºå“åº”å†…å®¹è¿”å›
	@ExceptionHandler({ArrayIndexOutOfBoundsException.class})
	@ResponseBody
	public Map&lt;String,Object&gt; handleException2(Exception e) {
		Map&lt;String,Object&gt; map=new HashMap&lt;&gt;();
		map.put(&quot;status&quot;, 500);
		map.put(&quot;msg&quot;, &quot;æ•°ç»„ç´¢å¼•å‡ºç•Œï¼Œç´¢å¼•ï¼š &quot;+e.getMessage());
		map.put(&quot;reason&quot;, &quot;ç´¢å¼•å€¼è¶…å‡ºæ•°ç»„é•¿åº¦&quot;);
		return map;
	}
}
```

### å¦‚ä½•ä½¿ç”¨RestControllerï¼Ÿ

å¦‚æœåœ¨ç±»ä¸ŠåŠ ä¸Š@RestControllerï¼Œè¯¥ç±»ä¸­çš„æ‰€æœ‰SpringMVCUrlæ¥å£æ˜ å°„éƒ½æ˜¯è¿”å›jsonæ ¼å¼

```java
@RestController
public class hello{
  //something
}
```

## Thymeleaf 11é—®

### Thymeleafå¦‚ä½•ä½¿ç”¨å˜é‡è¡¨è¾¾å¼é¡µé¢è·å–ä¸åŒèŒƒå›´çš„å±æ€§ï¼Ÿ

```html
å˜é‡è¡¨è¾¾å¼${.....}
&lt;p&gt;
&lt;!--  èƒ½å¤Ÿç›´æ¥è·å–modelçš„å±æ€§å€¼--&gt;
  user1å±æ€§å€¼ï¼š
  &lt;span th:text=&quot;${user1.id}&quot;&gt;&lt;/span&gt; |
  &lt;span th:text=&quot;${user1.password}&quot; &gt;&lt;/span&gt; |
  &lt;span th:text=&quot;${user1.gender}&quot; &gt;&lt;/span&gt;
&lt;/p&gt;
&lt;p&gt;
  user2å±æ€§å€¼ï¼š
  &lt;!-- ä¼šè¯èŒƒå›´çš„å±æ€§éœ€è¦æ·»åŠ sessionçš„ä½¿ç”¨ --&gt;
  &lt;span th:text=&quot;${session.user2.id}&quot;&gt;&lt;/span&gt; |
  &lt;span th:text=&quot;${session.user2.password}&quot; &gt;&lt;/span&gt; |
  &lt;span th:text=&quot;${session.user2.gender}&quot; &gt;&lt;/span&gt;
&lt;/p&gt;
```

### Thymeleafçš„äº”ç§è¡¨è¾¾å¼ï¼Ÿ

- å˜é‡è¡¨è¾¾å¼${.....}
- é€‰æ‹©å˜é‡è¡¨è¾¾å¼*{.....}
  - é€‰æ‹©å˜é‡è¡¨è¾¾å¼ä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ–ä¹¦å†™
  - th:objectå±æ€§ç”¨äºç»‘å®šä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ ·åœ¨å½“å‰å…ƒç´ ï¼ˆpå…ƒç´ ï¼‰å†…å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å¯¹è±¡çš„å±æ€§
  - é€‰æ‹©å˜é‡è¡¨è¾¾å¼ç”¨äºä½¿ç”¨å¤–å›´ç»‘å®šçš„å¯¹è±¡çš„å±æ€§ï¼Œä»¥ç®€åŒ–ä¹¦å†™
- æ¶ˆæ¯è¡¨è¾¾å¼#{.....}
  - æ¶ˆæ¯è¡¨è¾¾å¼ç”¨äºæ˜¾ç¤ºæ¶ˆæ¯ï¼Œä¸»è¦æ˜¯æ¥è‡ªå±æ€§æ–‡ä»¶çš„å±æ€§ï¼Œå¯ç”¨äºå®ç°å›½é™…åŒ–ç­‰åŠŸèƒ½ 
  - {å±æ€§å}æ¥æ˜¾ç¤ºæ¥è‡ªå±æ€§æ–‡ä»¶çš„ä¸€ä¸ªæ¶ˆæ¯
- URLé“¾æ¥å˜é‡è¡¨è¾¾å¼@{.....}
  - ç”¨äºæŒ‡å®šä¸€ä¸ªé“¾æ¥ï¼ŒæŒ‡å®šä¸€ä¸ªèµ„æºçš„url
- ç‰‡æ®µ(fragment)è¡¨è¾¾å¼~{.....}
  - é¡µé¢åç§°::ç‰‡æ®µåç§°

### å¦‚ä½•ä½¿ç”¨é€‰æ‹©å˜é‡è¡¨è¾¾å¼ï¼Ÿ

```html
&lt;p th:object=&quot;${user1}&quot;&gt;
    user1å±æ€§å€¼ï¼š
    &lt;span th:text=&quot;*{id}&quot;&gt;&lt;/span&gt; |
    &lt;span th:text=&quot;*{password}&quot; &gt;&lt;/span&gt; |
    &lt;span th:text=&quot;*{gender}&quot; &gt;&lt;/span&gt;
&lt;/p&gt;
```

### é“¾æ¥è¡¨è¾¾å¼çš„å››ç§å†™æ³•ï¼Ÿ

```html
&lt;div class=&quot;content&quot;&gt;
    &lt;a th:href=&quot;@{https://www.baidu.com}&quot; class=&quot;btn btn-sm btn-danger&quot;&gt;æµ‹è¯•1-ç»å¯¹è·¯å¾„&lt;/a&gt; &amp;nbsp;
    &lt;!-- è¯·æ±‚/é¡µé¢ç›¸å¯¹è·¯å¾„ï¼šç›´æ¥å†™èµ„æºçš„è·¯å¾„ --&gt;
    &lt;!-- ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè¦æ³¨æ„404é—®é¢˜ --&gt;
    &lt;a th:href=&quot;@{static/img/lxh01.gif}&quot; class=&quot;btn btn-sm btn-warning&quot;&gt;æµ‹è¯•2-é¡µé¢/è¯·æ±‚ç›¸å¯¹è·¯å¾„&lt;/a&gt; &amp;nbsp;
    &lt;!-- ä¸Šä¸‹æ–‡ç›¸å¯¹è·¯å¾„ï¼Œä»¥/å¼€å¤´ï¼Œè¡¨ç¤ºç›¸å¯¹ç¨‹åºçš„ä¸Šä¸‹æ–‡è·¯å¾„ --&gt;
    &lt;a th:href=&quot;@{/static/img/lxh02.gif}&quot; class=&quot;btn btn-sm btn-success&quot;&gt;æµ‹è¯•3-ä¸Šä¸‹æ–‡ç›¸å¯¹è·¯å¾„&lt;/a&gt; &amp;nbsp;
    &lt;!-- æœåŠ¡å™¨ç›¸å¯¹è·¯å¾„ï¼Œä»¥~/å¼€å¤´ï¼Œè¡¨ç¤ºç›¸å¯¹æœåŠ¡å™¨çš„è·¯å¾„ --&gt;
    &lt;a th:href=&quot;@{~/static/img/lxh03.gif}&quot; class=&quot;btn btn-sm btn-primary&quot;&gt;æµ‹è¯•4-æœåŠ¡å™¨ç›¸å¯¹è·¯å¾„&lt;/a&gt; &amp;nbsp;
    &lt;!-- åè®®ç›¸å¯¹è·¯å¾„ï¼š ä»¥//å¼€å¤´ï¼Œè¡¨ç¤ºç›¸å¯¹åè®®çš„è·¯å¾„ --&gt;
    &lt;a th:href=&quot;@{//static/img/lxh04.gif}&quot; class=&quot;btn btn-sm btn-info&quot;&gt;æµ‹è¯•5-åè®®ç›¸å¯¹è·¯å¾„&lt;/a&gt; &amp;nbsp;
&lt;/div&gt;
```

### æ€ä¹ˆå®šä¹‰å’Œå¼•ç”¨ç‰‡æ®µï¼Ÿ
**å®šä¹‰**
```html
&lt;div th:fragment=&quot;f1&quot; id=&quot;frag1&quot; class=&quot;bg-primary padding10 margin10&quot;&gt;
    è¿™æ˜¯æ¨¡æ¿ç‰‡æ®µ1å†…å®¹~~~~~~~~~~~~~~~~~~~&lt;br&gt; 
    è¿™æ˜¯æ¨¡æ¿ç‰‡æ®µ1å†…å®¹~~~~~~~~~~~~~~~~~~~&lt;br&gt;
    è¿™æ˜¯æ¨¡æ¿ç‰‡æ®µ1å†…å®¹~~~~~~~~~~~~~~~~~~~&lt;br&gt;
&lt;/div&gt;
```
**å¼•ç”¨**
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;!-- th:insertç”¨äºæ’å…¥ä¸€ä¸ªæ¨¡æ¿ç‰‡æ®µï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç è¡¨ç¤ºå°†f1ç‰‡æ®µå†…å®¹æ’å…¥div1 --&gt;
    &lt;!-- é¡µé¢åç§°::ç‰‡æ®µåç§° --&gt;
    &lt;div id=&quot;div1&quot; th:insert=&quot;~{footer::f1}&quot;&gt;&lt;/div&gt;
    &lt;!-- th:replaceç”¨äºä½¿ç”¨æŒ‡å®šçš„æ¨¡æ¿ç‰‡æ®µæ›¿æ¢åŸæœ‰å†…å®¹ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç è¡¨ç¤ºä½¿ç”¨f1çš„ç‰‡æ®µå†…å®¹æ›¿æ¢div2 --&gt;
    &lt;div id=&quot;div2&quot; th:replace=&quot;~{footer::f1}&quot;&gt;&lt;/div&gt;
    &lt;!-- ä¹Ÿå¯é€šè¿‡é¡µé¢åç§°::#idé€šè¿‡å…ƒç´ çš„idæ¥ä½¿ç”¨ä¸€ä¸ªç‰‡æ®µ --&gt;
    &lt;div id=&quot;div3&quot; th:insert=&quot;~{footer::#frag2}&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;div4&quot; th:insert=&quot;~{footer}&quot;&gt;&lt;/div&gt;
    &lt;!-- ä½¿ç”¨å½“å‰é¡µé¢å®šä¹‰çš„ç‰‡æ®µï¼Œå¯ä¸åŠ é¡µé¢åç§°æˆ–ä½¿ç”¨this --&gt;
    &lt;div id=&quot;div5&quot; th:insert=&quot;~{::frag3}&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;div5&quot; th:insert=&quot;~{this::#fragment3}&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
```

### å“ªäº›å­—é¢æ ‡è®°ä¸åˆæ³•ï¼Ÿ

å­—é¢æ ‡è®°å€¼ç±»ä¼¼æ–‡æœ¬å­—é¢å€¼: åŒºåˆ«æ˜¯ä¸ä½¿ç”¨å•å¼•å·æ‹¬èµ·æ¥å€¼ï¼Œ
åªèƒ½å…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ä¸­åˆ’çº¿ã€ç‚¹å·ã€ä¸­æ‹¬å·ï¼Œ 
ä¸èƒ½åŒ…å«é€—å·ã€ç©ºæ ¼ä»¥åŠå…¶ä»–ç‰¹æ®Šå­—ç¬¦
```html
å­—é¢æ ‡è®°ï¼š&lt;span th:text=&quot;Anna&quot;&gt;&lt;/span&gt;&lt;br&gt;
å­—é¢æ ‡è®°ï¼š&lt;span th:text=&quot;Annabelle_Lee&quot;&gt;&lt;/span&gt;&lt;br&gt;
å­—é¢æ ‡è®°ï¼š&lt;span th:text=&quot;www.baidu.com&quot;&gt;&lt;/span&gt;&lt;br&gt;
å­—é¢æ ‡è®°ï¼š&lt;span th:text=&quot;a-b_c.d&quot;&gt;&lt;/span&gt;&lt;br&gt;
&lt;!-- ç©ºæ ¼ä¸å…è®¸ --&gt;
&lt;!-- å­—é¢æ ‡è®°ï¼š&lt;span th:text=&quot;[kite runner]&quot;&gt;&lt;/span&gt;&lt;br&gt; --&gt;
&lt;!-- é€—å·ä¸å…è®¸ --&gt;
&lt;!-- å­—é¢æ ‡è®°ï¼š&lt;span th:text=&quot;a,b&quot;&gt;&lt;/span&gt;&lt;br&gt; 
```
### thï¼š*å±æ€§çš„ä½œç”¨ï¼Ÿ

th:* ä¿®æ”¹å•ä¸ªå±æ€§çš„å€¼
```html
&lt;!-- ç»å¤§éƒ¨åˆ†htmlå±æ€§éƒ½æœ‰å¯¹åº”çš„th:*å±æ€§ï¼Œåœ¨th:*å±æ€§ä¸­æ‰èƒ½ä½¿ç”¨Thymeleafçš„è¯­æ³• --&gt;
&lt;div class=&quot;content&quot;&gt;
    &lt;p&gt;
        &lt;!--æ˜¾ç¤ºuser5çš„å¤´åƒï¼Œé¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºå…¶id--&gt;
        &lt;img th:src=&quot;&#39;static/img/&#39;+${user5.img}&quot; th:title=&quot;${user5.id}&quot;
             src=&quot;static/img/lxh01.gif&quot; title=&quot;å°èƒ–&quot; width=&quot;60&quot; height=&quot;60&quot;&gt;
             
        &lt;img th:src=&quot;@{&#39;/static/img/&#39;+${user5.img}}&quot; th:title=&quot;${user5.id}&quot;
             src=&quot;static/img/lxh01.gif&quot; title=&quot;å°èƒ–&quot; width=&quot;60&quot; height=&quot;60&quot;&gt;
    &lt;/p&gt;
&lt;/div&gt;
```
th:attr ä¿®æ”¹ä¸€ä¸ªæ ‡ç­¾å¤šä¸ªå±æ€§çš„å€¼
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;p&gt;
        &lt;!--æ˜¾ç¤ºuser5çš„å¤´åƒï¼Œé¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºå…¶id--&gt;
         &lt;img th:attr=&quot;src=@{&#39;/static/img/&#39;+${user5.img}},title=${user5.id}&quot;
             src=&quot;static/img/lxh01.gif&quot; title=&quot;å°èƒ–&quot; width=&quot;60&quot; height=&quot;60&quot;&gt;
    &lt;/p&gt;
&lt;/div&gt;
```
th:object ç»‘å®šä¸€ä¸ªå¯¹è±¡ï¼Œæ–¹ä¾¿åœ¨å­æ ‡è®°ä¸­ä½¿ç”¨é€‰æ‹©å˜é‡è¡¨è¾¾å¼
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;p th:object=&quot;${user5}&quot;&gt;
        user5å±æ€§å€¼ï¼š
        &lt;span th:text=&quot;*{id}&quot;&gt;&lt;/span&gt; |
        &lt;span th:text=&quot;*{password}&quot;&gt;&lt;/span&gt; |
        &lt;span th:text=&quot;*{gender}&quot;&gt;&lt;/span&gt; |
        &lt;span th:text=&quot;*{img}&quot;&gt;&lt;/span&gt; 
    &lt;/p&gt;
&lt;/div&gt;
```
th:if åˆ¤æ–­ä¸€ä¸ªæ¡ä»¶ï¼Œæ¡ä»¶æˆç«‹ï¼Œæ˜¾ç¤ºæ ‡è®°å†…å®¹
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;p th:if=&quot;${age}&gt;=18&quot;&gt;æ­å–œä½ ï¼Œæˆä¸ºå¤§äººäº†ï¼ï¼ï¼&lt;/p&gt;
&lt;/div&gt;
```
th:switch+th:case ç±»ä¼¼switch-caseç»“æ„ä½œç”¨çš„å±æ€§
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;!-- th:switché€šå¸¸ç”¨äºåˆ¤æ–­ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ --&gt;
    &lt;div th:switch=&quot;${type}&quot;&gt;
        &lt;p th:case=&quot;1&quot;&gt;å†°ç®±&lt;/p&gt;
        &lt;p th:case=&quot;2&quot;&gt;ç©ºè°ƒ&lt;/p&gt;
        &lt;p th:case=&quot;3&quot;&gt;ç”µè§†&lt;/p&gt;
        &lt;!-- *è¡¨ç¤ºå…¶ä»–æƒ…å†µ --&gt;
        &lt;p th:case=&quot;*&quot;&gt;å…¶ä»–&lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;
```
th:each ç±»ä¼¼foreachå¾ªç¯
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;table class=&quot;table table-striped table-hover text-center&quot;&gt;
        &lt;tr&gt;
            &lt;th&gt;å­¦å·&lt;/th&gt;
            &lt;th&gt;å§“å&lt;/th&gt;
            &lt;th&gt;æ€§åˆ«&lt;/th&gt;
        &lt;/tr&gt;
        &lt;!--1ï¼‰éå†åˆ—è¡¨--&gt;
        &lt;tr th:each=&quot;s:${studentList}&quot;&gt;
            &lt;!-- th:å±æ€§åå†™æ³• --&gt;
            &lt;td th:text=&quot;${s.sid}&quot;&gt;&lt;/td&gt;
            &lt;!-- data-th-å±æ€§åå†™æ³• --&gt;
            &lt;td data-th-text=&quot;${s.sname}&quot;&gt;&lt;/td&gt;
            &lt;!-- å†…è”è¡¨è¾¾å¼å†™æ³• --&gt;
            &lt;td&gt;[[${s.sgender}]]&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    &lt;!--2ï¼‰è·å–çŠ¶æ€ä¿¡æ¯--&gt;
    &lt;!-- sæ˜¯ä¸€ä¸ªå˜é‡åï¼Œå¯ä»¥éšæ„å‘½åï¼Œè¡¨ç¤ºå½“å‰éå†çš„å…ƒç´  --&gt;
    &lt;!-- statæ˜¯ä¸€ä¸ªå˜é‡åï¼Œå¯ä»¥éšæ„å‘½åï¼Œç”¨äºè·å–å½“å‰éå†çš„å…ƒç´ çš„çŠ¶æ€ä¿¡æ¯ --&gt;
    &lt;div th:each=&quot;s,stat:${studentList}&quot; th:class=&quot;${stat.odd}?&#39;bg-danger&#39;:&#39;bg-success&#39;&quot;&gt;
        [[${s.sid}]] | [[${s.sname}]] |
        &lt;!-- indexï¼šè·å–å½“å‰å…ƒç´ çš„ç´¢å¼•ï¼Œä»0å¼€å§‹ --&gt;
        [[${stat.index}]] |
        &lt;!-- countï¼š è·å–å½“å‰å…ƒç´ çš„åºå·ï¼Œä¹Ÿå°±æ˜¯ç¬¬å‡ ä¸ªå…ƒç´  --&gt; 
        [[${stat.count}]] |
        &lt;!-- sizeï¼š è·å–é›†åˆå¤§å° --&gt; 
        [[${stat.size}]] |
        &lt;!-- firstï¼š è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ˜¯ç¬¬ä¸€é¡¹å…ƒç´  --&gt;
        [[${stat.first}]] |
        &lt;!-- lastï¼š è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ˜¯æœ€åä¸€é¡¹å…ƒç´  --&gt;
        [[${stat.last}]] |
        &lt;!-- oddï¼š è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ˜¯å¥‡æ•°é¡¹å…ƒç´  --&gt;
        [[${stat.odd}]] |
        &lt;!-- evenï¼š è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ˜¯å¶æ•°é¡¹å…ƒç´  --&gt;
        [[${stat.even}]] | 
    &lt;/div&gt;
    &lt;!--3ï¼‰éå†Mapé›†åˆ--&gt;
    &lt;hr&gt;
    &lt;!-- éå†Mapé›†åˆï¼Œé€šè¿‡keyè·å–é”®ï¼Œé€šè¿‡valueè·å–å€¼ --&gt;
    &lt;div th:each=&quot;entry,status:${map1}&quot;&gt;
        [[${entry.key}]] | [[${entry.value}]] | [[${status.index}]] 
    &lt;/div&gt;
    &lt;!-- éå†map2é›†åˆï¼Œæ‰“å°é”®å’Œå€¼çš„å„é¡¹ä¿¡æ¯ --&gt;
    &lt;!-- valueå¦‚æœä¸æ˜¯ç®€å•ç±»å‹ï¼Œå¯ç»§ç»­è·å–å…·ä½“å±æ€§ --&gt;
&lt;/div&gt;
```
th:textå’Œth:utext
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;!-- th:textå¦‚æœå†…å®¹æ˜¯htmlå†…å®¹ï¼Œåˆ™ä¸ä¼šè§£æhtmlå†…å®¹ï¼Œä½œä¸ºæ–‡æœ¬æ˜¾ç¤º --&gt;
    &lt;p th:text=&quot;${content1}&quot;&gt;&lt;/p&gt;
    &lt;!--th:textç­‰æ•ˆå†™æ³•ï¼šå†…è”è¡¨è¾¾å¼å†™æ³•--&gt;
    [[${content1}]]
    &lt;!-- th:utextå¦‚æœå†…å®¹æ˜¯htmlå†…å®¹ï¼Œä¼šè§£æhtmlå†…å®¹ï¼Œæ˜¾ç¤ºè§£æåçš„å†…å®¹ --&gt;
    &lt;p th:utext=&quot;${content2}&quot;&gt;&lt;/p&gt;
    &lt;!--th:utextç­‰æ•ˆå†™æ³•ï¼šå†…è”è¡¨è¾¾å¼å†™æ³•--&gt;
    [(${content2})]
&lt;/div&gt;
```
th:with ç”¨äºå®šä¹‰å±€éƒ¨å˜é‡
```html
&lt;!-- th:withç”¨äºå®šä¹‰å±€éƒ¨å˜é‡ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå±€éƒ¨å˜é‡ --&gt;
  &lt;!-- å®šä¹‰çš„å˜é‡åªèƒ½åœ¨æ ‡è®°å†…ä½¿ç”¨ --&gt;
&lt;div th:with=&quot;firstStudent=${studentList[0]}&quot;&gt;
  [[${firstStudent.sid}]] | [[${firstStudent.sname}]] | [[${firstStudent.sgender}]]
&lt;/div&gt;
&lt;!--å®šä¹‰å¤šä¸ªå˜é‡--&gt;
&lt;div th:with=&quot;a=10,b=20,c=30&quot;&gt;
  [[${a+b+c}]]
&lt;/div&gt;
```
th:inline å¯ç”¨å’Œç¦ç”¨å†…è”è¡¨è¾¾å¼
```html
&lt;div th:inline=&quot;none&quot;&gt;
     [[1+2+3]] 
     &lt;br&gt;
     [(1+2+3)]
&lt;/div&gt;
&lt;div&gt;
  &lt;!-- å¦‚æœéœ€è¦åœ¨jsä»£ç ä¸­ä½¿ç”¨å†…è”è¡¨è¾¾å¼ï¼Œå¯å°†inlineå±æ€§è®¾ç½®ä¸ºjavascript --&gt;
  &lt;script th:inline=&quot;javascript&quot;&gt;
    document.write([[${user5.id}]]);
    document.write(&quot;&lt;br&gt;&quot;);
    document.write([[${age}]]);
  &lt;/script&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;!-- é»˜è®¤ï¼Œå¯ä»¥åœ¨cssæ ·å¼ä¸­ä½¿ç”¨å†…è”è¡¨è¾¾å¼ --&gt;
  &lt;!-- å¦‚æœè®¾ç½®å€¼æ˜¯noneï¼Œcssä¸­çš„å†…è”è¡¨è¾¾å¼ä¸ä¼šè¢«è§£æ --&gt;
  &lt;style th:text=&quot;css&quot;&gt;
    .bg-red{
      color: [[${color}]];
    }
  &lt;/style&gt;
  &lt;p class=&quot;bg-red&quot;&gt;æµ‹è¯•æ ·å¼&lt;/p&gt;
&lt;/div&gt;
```
### Thymeleafçš„åç§°ç©ºé—´ï¼Ÿ
Thymeleafæä¾›ä¸€äº›åç§°ç©ºé—´ï¼Œç”¨äºè·å–å¯¹åº”çš„ä¿¡æ¯ã€‚æ¯ä¸ªåç§°ç©ºé—´éƒ½å¯¹åº”ä¸€ä¸ªMapé›†åˆï¼Œå­˜å‚¨äº†å¯¹åº”çš„å±æ€§ã€å‚æ•°æˆ–å…¶ä»–ä¿¡æ¯
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;!-- ä¸ä½¿ç”¨ä»»ä½•åç§°ç©ºé—´å°±æ˜¯è¯·æ±‚èŒƒå›´çš„å±æ€§ --&gt;
    &lt;!--è·å–è¯·æ±‚èŒƒå›´å±æ€§--&gt;
    &lt;p th:text=&quot;${num1}&quot;&gt;&lt;/p&gt;
    &lt;p th:text=&quot;${num2}&quot;&gt;&lt;/p&gt;
    &lt;!--è·å–ä¼šè¯èŒƒå›´å±æ€§--&gt;
    &lt;p th:text=&quot;${session.num3}&quot;&gt;&lt;/p&gt;
    &lt;!--è·å–åº”ç”¨ç¨‹åºèŒƒå›´å±æ€§--&gt;
    &lt;p th:text=&quot;${application.num4}&quot;&gt;&lt;/p&gt;
    &lt;!--è·å–ä¸€ä¸ªè¯·æ±‚å‚æ•°çš„å•ä¸ªå€¼--&gt;
    &lt;p th:text=&quot;${param.name}&quot;&gt;&lt;/p&gt;
    &lt;!--è·å–ä¸€ä¸ªè¯·æ±‚å‚æ•°çš„å¤šä¸ªå€¼--&gt;
    &lt;p th:text=&quot;${param.hobbies}&quot;&gt;&lt;/p&gt;
    &lt;!--è·å–ä¸€ä¸ªè¯·æ±‚å‚æ•°çš„å¤šä¸ªå€¼ä¸­çš„æŸä¸ªå€¼ï¼ŒåŠ ä¸Šæ•°ç»„ç´¢å¼•å³å¯--&gt;
    &lt;p th:text=&quot;${param.hobbies[0]}&quot;&gt;&lt;/p&gt;
&lt;/div&gt;
```

### æœ‰å“ªäº›åŸºæœ¬å¯¹è±¡ï¼Ÿ
Thymeleaf ä¸­å¸¸ç”¨çš„å†…ç½®åŸºæœ¬å¯¹è±¡å¦‚ä¸‹ï¼š
- ctx ï¼šä¸Šä¸‹æ–‡å¯¹è±¡
- vars ï¼šä¸Šä¸‹æ–‡å˜é‡ 
- localeï¼šä¸Šä¸‹æ–‡çš„è¯­è¨€ç¯å¢ƒ 
- requestï¼šHttpServletRequest å¯¹è±¡ï¼ˆä»…åœ¨ Web åº”ç”¨ä¸­å¯ç”¨ï¼‰ 
- responseï¼šHttpServletResponse å¯¹è±¡ï¼ˆä»…åœ¨ Web åº”ç”¨ä¸­å¯ç”¨ï¼‰ 
- sessionï¼šHttpSession å¯¹è±¡ï¼ˆä»…åœ¨ Web åº”ç”¨ä¸­å¯ç”¨ï¼‰ 
- servletContextï¼šServletContext å¯¹è±¡ï¼ˆä»…åœ¨ Web åº”ç”¨ä¸­å¯ç”¨ï¼‰
### è¡¨è¾¾å¼å·¥å…·å¯¹è±¡å¦‚ä½•ä½¿ç”¨ï¼Ÿ
#### numbersï¼šæ•°å­—å·¥å…·å¯¹è±¡
```html
formatDecimal()æ–¹æ³•: ç”¨äºæ ¼å¼åŒ–å°æ•°æ•°å€¼
&lt;div class=&quot;content&quot;&gt;
    &lt;!-- è¿™é‡Œçš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºï¼šè¦æ ¼å¼åŒ–çš„å€¼ï¼Œè‡³å°‘ä¿ç•™å‡ ä½æ•´æ•°ï¼Œä¿ç•™å‡ ä½å°æ•° --&gt;
    &lt;p th:text=&quot;${#numbers.formatDecimal(num1,1,3)}&quot;&gt;&lt;/p&gt;
&lt;/div&gt;
```
formatCurrency()æ–¹æ³•ï¼šç”¨äºæ ¼å¼åŒ–é‡‘é¢ï¼Œä¼šåŠ è´§å¸ç¬¦å·
```html
&lt;p th:text=&quot;${#numbers.formatCurrency(num1)}&quot;&gt;&lt;/p&gt;
```
sequence()æ–¹æ³•: ç”¨äºäº§ç”Ÿä¸€ä¸ªæ•´æ•°åºåˆ—/æ•°ç»„, å¯ä»¥é€šè¿‡äº§ç”Ÿä¸€ä¸ªæ•´æ•°åºåˆ—å®ç°æ™®é€šå¾ªç¯ï¼Œå¦‚æ‰“å°åˆ†é¡µçš„é¡µç  
```html
    &lt;!-- å¯ä»¥æŒ‡å®šä¸¤ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºfromå’Œtoï¼Œæœ€å°å€¼å’Œæœ€å¤§å€¼ --&gt;
    &lt;!-- å¯ä»¥æŒ‡å®šä¸‰ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºfromã€toå’Œstepï¼Œæœ€å°å€¼ã€æœ€å¤§å€¼å’Œæ­¥é•¿ --&gt;
&lt;span th:each=&quot;i:${#numbers.sequence(1,10)}&quot;&gt;
    | &lt;a th:href=&quot;&#39;findByPageNo?pageNo=&#39;+${i}&quot;&gt;[[${i}]]&lt;/a&gt; |
&lt;/span&gt;
```
#### stringsï¼šå­—ç¬¦ä¸²å·¥å…·å¯¹è±¡
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;!-- æ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²å†…å®¹æ˜¯å¦ä¸ºç©º --&gt;
    &lt;p th:text=&quot;${#strings.isEmpty(&#39;&#39;)}&quot;&gt;&lt;/p&gt;
    &lt;p th:text=&quot;${#strings.isEmpty(&#39;anna&#39;)}&quot;&gt;&lt;/p&gt;
    &lt;!-- è·å–å­—ç¬¦ä¸²é•¿åº¦ --&gt;
    &lt;p th:text=&quot;${#strings.length(bookName)}&quot;&gt;&lt;/p&gt;
    &lt;!-- æˆªå–å­å­—ç¬¦ä¸² ä»ç´¢å¼•ä¸º0çš„å­—ç¬¦å¼€å§‹ï¼Œæˆªå–5-0ä¸ªå­—ç¬¦--&gt;
    &lt;p th:text=&quot;${#strings.substring(bookName,0,5)}&quot;&gt;&lt;/p&gt;
    &lt;!-- æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŒ‡å®šå†…å®¹ --&gt;
    &lt;p th:text=&quot;${#strings.contains(bookName,&#39;kite&#39;)}&quot;&gt;&lt;/p&gt;
&lt;/div&gt;
```
#### datesï¼šæ—¥æœŸå·¥å…·å¯¹è±¡
```html
&lt;!-- æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ --&gt;
&lt;p th:text=&quot;${#dates.format(now)}&quot;&gt;&lt;/p&gt;
&lt;!-- æ ¼å¼åŒ–çš„æ—¶å€™å¯æŒ‡å®šæ˜¾ç¤ºæ ¼å¼ --&gt;
&lt;p th:text=&quot;${#dates.format(now,&#39;yyyy-MM-dd HH:mm:ss D E&#39;)}&quot;&gt;&lt;/p&gt;
&lt;!-- è·å–æ—¥æœŸæ—¶é—´çš„æŒ‡å®šéƒ¨åˆ†, å¦‚å¹´ä»½ã€æœˆä»½ã€æ—¥ã€æœˆä»½åç§°ã€æ˜ŸæœŸå‡ ç­‰ --&gt;
&lt;p th:text=&quot;${#dates.year(now)}&quot;&gt;&lt;/p&gt;
&lt;p th:text=&quot;${#dates.month(now)}&quot;&gt;&lt;/p&gt;
&lt;p th:text=&quot;${#dates.day(now)}&quot;&gt;&lt;/p&gt;
&lt;p th:text=&quot;${#dates.monthName(now)}&quot;&gt;&lt;/p&gt;
&lt;p th:text=&quot;${#dates.dayOfWeek(now)}&quot;&gt;&lt;/p&gt;
&lt;p th:text=&quot;${#dates.hour(now)}&quot;&gt;&lt;/p&gt;
```
#### lists/setsï¼šList/Set é›†åˆå·¥å…·å¯¹è±¡
```html
&lt;div class=&quot;content&quot;&gt;
    &lt;!-- #listså¯¹è±¡ç”¨äºæ“ä½œListç±»å‹çš„æ•°æ®ï¼Œæ¯”å¦‚sort()æ–¹æ³•å¯ç”¨äºå¯¹é›†åˆæ’åº--&gt;
    &lt;span th:each=&quot;name:${#lists.sort(nameList)}&quot;&gt;
        [[${name}]] | 
    &lt;/span&gt;     
    &lt;p th:text=&quot;${#lists.sort(scoreList)}&quot;&gt;&lt;/p&gt;
&lt;/div&gt;
```
#### aggregates
```html
&lt;!-- #aggregatesç”¨äºå¯¹æ•°ç»„æˆ–é›†åˆè¿›è¡Œæ±‡æ€»è¿ç®—ï¼Œå¦‚æ±‚å’Œæˆ–æ±‚å¹³å‡ --&gt;
&lt;div class=&quot;content&quot;&gt;
    &lt;p th:text=&quot;${#aggregates.avg(scoreList)}&quot;&gt;&lt;/p&gt;                
    &lt;p th:text=&quot;${#aggregates.sum(scoreList)}&quot;&gt;&lt;/p&gt;                
&lt;/div&gt;
```
#### mapsï¼šMap é›†åˆå·¥å…·å¯¹è±¡
å¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šsizeã€isEmptyã€containsKey å’Œ containsValue ç­‰
## Spring Boot JPA 13é—®

### SpringBootæ”¯æŒçš„ä¸‰ç§æ•°æ®æºæ˜¯ä»€ä¹ˆï¼Ÿ

HikariCPï¼šé»˜è®¤å†…ç½®æ•°æ®æºå¯¹è±¡

Tomcatæä¾›DataSourceï¼šHikariCPä¸å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œåœ¨webç¯å¢ƒä¸­ï¼Œå°†tomcatæœåŠ¡å™¨é…ç½®çš„æ•°æ®æºå¯¹è±¡ã€‚

Commons DBCPï¼šHikariCPä¸å¯ç”¨ï¼Œtomcatæ•°æ®æºä¹Ÿä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨dbcpæ•°æ®æºã€‚


### å¦‚ä½•é…ç½®æ•°æ®æºï¼Ÿ
å¯¼å…¥ä¾èµ–é¡¹
```xml
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
```
```yaml
spring:
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://localhost:3306/blog?useUnicode=true&amp;characterEncoding=utf-8
    username: root
    password: root
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
```
### SpringDataJPAæ˜¯ä»€ä¹ˆï¼Ÿ

spring data jpaæ˜¯springæä¾›çš„ä¸€å¥—ç®€åŒ–JPAå¼€å‘çš„æ¡†æ¶ï¼ŒæŒ‰ç…§çº¦å®šå¥½çš„ã€æ–¹æ³•å‘½åè§„åˆ™ã€‘å†™daoå±‚æ¥å£ï¼Œå°±å¯ä»¥åœ¨ä¸å†™æ¥å£å®ç°çš„æƒ…å†µä¸‹ï¼Œå®ç°å¯¹æ•°æ®åº“çš„è®¿é—®å’Œæ“ä½œã€‚åŒæ—¶æä¾›äº†å¾ˆå¤šé™¤äº†CRUDä¹‹å¤–çš„åŠŸèƒ½ï¼Œå¦‚åˆ†é¡µã€æ’åºã€å¤æ‚æŸ¥è¯¢ç­‰ç­‰ã€‚

### SpringData JPA éœ€ä¸éœ€è¦JPAæä¾›ç¨‹åºï¼Ÿ

éœ€è¦

Spring Data JPA å¯ä»¥ç†è§£ä¸º JPA è§„èŒƒçš„å†æ¬¡å°è£…æŠ½è±¡ï¼Œåº•å±‚è¿˜æ˜¯ä½¿ç”¨äº† Hibernate çš„ JPA æŠ€æœ¯å®ç°ã€‚

### JPAä¸ªå„ä¸ªå±æ€§éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ
```properties
# æŒ‡å®šæ˜¯å¦åœ¨æ§åˆ¶å°æ‰“å°ç”Ÿæˆçš„sqlè¯­å¥ï¼Œä»¥æ–¹ä¾¿è·Ÿè¸ªç¨‹åºæ‰§è¡Œå’Œè°ƒè¯•ç¨‹åºï¼Œé»˜è®¤å€¼ä¸ºfalse
spring.jpa.show-sql=true
# æŒ‡å®šæ˜¯å¦æ ¼å¼åŒ–åœ¨æ§åˆ¶å°æ‰“å°çš„sq|è¯­å¥
spring.jpa.properties.hibernate.format_sql=true
# æŒ‡å®šä½¿ç”¨çš„æ–¹è¨€ï¼Œæ˜¯ä¸€ä¸ªç±»çš„åç§°ï¼Œæ ¹æ®æ“ä½œçš„æ•°æ®åº“é€‰æ‹©
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL57InnoDBDialect
# æŒ‡å®šç¨‹åºè¿è¡Œæ—¶æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®åº“è¡¨
spring.jpa.hibernate.ddl-auto=update
```
ddl-autoçš„æœ‰æ•ˆå€¼æœ‰ï¼š
- create: æ¯æ¬¡åŠ è½½hibernateæ—¶ï¼Œå…ˆåˆ é™¤å·²å­˜åœ¨çš„æ•°æ®åº“è¡¨ç»“æ„å†é‡æ–°ç”Ÿæˆ 
- create-drop:æ¯æ¬¡åŠ è½½hibernateæ—¶ï¼Œå…ˆåˆ é™¤å·²å­˜åœ¨çš„æ•°æ®åº“è¡¨ç»“æ„å†é‡æ–°ç”Ÿæˆï¼Œå¹¶ä¸”å½“sessionFactoryå…³é—­æ—¶è‡ªåŠ¨åˆ é™¤ç”Ÿæˆçš„æ•°æ®åº“è¡¨ç»“æ„:
- update: åªåœ¨ç¬¬ä¸€æ¬¡åŠ è½½hibernateæ—¶è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨ç»“æ„ï¼Œä»¥åå†æ¬¡åŠ è½½hibernateæ—¶æ ¹æ® modelç±»è‡ªåŠ¨æ›´æ–°è¡¨ç»“æ„ 
- validate:æ¯æ¬¡åŠ è½½hibermateæ—¶ï¼ŒéªŒè¯æ•°æ®åº“è¡¨ç»“æ„ï¼Œä»…ä»…å’Œæ•°æ®åº“ä¸­çš„è¡¨è¿›è¡Œæ¯”è¾ƒï¼Œä¸ä¼š åˆ›å»ºæ–°è¡¨ï¼Œä½†æ˜¯ä¼šæ’å…¥æ–°å€¼ 
- none:ç¦ç”¨DDLæ“ä½œ
### æœ‰å“ªäº›å¸¸ç”¨çš„æ³¨è§£ï¼Ÿ

- @Entityå®šä¹‰å¯¹è±¡å°†ä¼šæˆä¸ºè¢«JPAç®¡ç†çš„å®ä½“ï¼Œå°†æ˜ å°„åˆ°æŒ‡å®šçš„æ•°æ®åº“è¡¨ã€‚ 
- @TableæŒ‡å®šæ•°æ®åº“çš„è¡¨åã€‚ 
- @Idå®šä¹‰å±æ€§ä¸ºæ•°æ®åº“çš„ä¸»é”®ï¼Œä¸€ä¸ªå®ä½“é‡Œé¢å¿…é¡»æœ‰ä¸€ä¸ªã€‚ 
- @IdClassåˆ©ç”¨å¤–éƒ¨ç±»çš„è”åˆä¸»é”®ã€‚ 
- @GeneratedValueä¸ºä¸»é”®ç”Ÿæˆç­–ç•¥ 
- @Basicè¡¨ç¤ºå±æ€§æ˜¯åˆ°æ•°æ®åº“è¡¨çš„å­—æ®µçš„æ˜ å°„ã€‚å¦‚æœå®ä½“çš„å­—æ®µä¸Šæ²¡æœ‰ä»»ä½•æ³¨è§£ï¼Œé»˜è®¤å³ä¸º@Basicã€‚ 
- @Transientè¡¨ç¤ºè¯¥å±æ€§å¹¶éä¸€ä¸ªåˆ°æ•°æ®åº“è¡¨çš„å­—æ®µçš„æ˜ å°„ï¼Œè¡¨ç¤ºéæŒä¹…åŒ–å±æ€§ï¼Œä¸@Basicä½œç”¨ç›¸åã€‚JPAæ˜ å°„æ•°æ®åº“çš„æ—¶å€™å¿½ç•¥å®ƒã€‚ 
- @Columnå®šä¹‰è¯¥å±æ€§å¯¹åº”æ•°æ®åº“ä¸­çš„åˆ—åã€‚ 
- @Temporalç”¨æ¥è®¾ç½®Dateç±»å‹çš„å±æ€§æ˜ å°„åˆ°å¯¹åº”ç²¾åº¦çš„å­—æ®µã€‚ 
- @Lob å°†å±æ€§æ˜ å°„æˆæ•°æ®åº“æ”¯æŒçš„å¤§å¯¹è±¡ç±»å‹ï¼Œæ”¯æŒä»¥ä¸‹ä¸¤ç§æ•°æ®åº“ç±»å‹çš„å­—æ®µã€‚

å…³è”å…³ç³»æ³¨è§£ 
- @JoinColumnå®šä¹‰å¤–é”®å…³è”çš„å­—æ®µåç§° 
- @OneToOneå…³è”å…³ç³» 
- @OneToManyä¸@ManyToOneå¯ä»¥ç›¸å¯¹å­˜åœ¨ï¼Œä¹Ÿå¯åªå­˜åœ¨ä¸€æ–¹ã€‚ 
- @ManyToManyè¡¨ç¤ºå¤šå¯¹å¤šï¼Œå’Œ@OneToOneã€@ManyToOneä¸€æ ·ä¹Ÿæœ‰å•å‘ã€åŒå‘ä¹‹åˆ†ã€‚å•å‘åŒå‘å’Œæ³¨è§£æ²¡æœ‰å…³ç³»ï¼Œåªçœ‹å®ä½“ç±»ä¹‹é—´æ˜¯å¦ç›¸äº’å¼•ç”¨ã€‚

### Repositoryæ¥å£å’Œä»–çš„æ´¾ç”Ÿç±»å‹ï¼Ÿ

**Repository**ï¼š æ˜¯ spring Data çš„ä¸€ä¸ªæ ¸å¿ƒæ¥å£ï¼Œå®ƒä¸æä¾›ä»»ä½•æ–¹æ³•ï¼Œå¼€å‘è€…éœ€è¦åœ¨è‡ªå·±å®šä¹‰çš„æ¥å£ä¸­å£°æ˜éœ€è¦çš„æ–¹æ³•
ä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œè¡¨æ˜ä»»ä½•ç»§æ‰¿å®ƒçš„å‡ä¸ºä»“åº“æ¥å£ç±»ï¼Œæ–¹ä¾¿Springè‡ªåŠ¨æ‰«æè¯†åˆ«

**CrudRepository**ï¼š ç»§æ‰¿ Repositoryï¼Œå®ç°äº†ä¸€ç»„ CRUD ç›¸å…³çš„æ–¹æ³•

**PagingAndSortingRepository**ï¼š ç»§æ‰¿ CrudRepositoryï¼Œå®ç°äº†ä¸€ç»„åˆ†é¡µæ’åºç›¸å…³çš„æ–¹æ³•

**JpaRepository**ï¼š ç»§æ‰¿ PagingAndSortingRepositoryï¼Œå®ç°ä¸€ç»„ JPA è§„èŒƒç›¸å…³çš„æ–¹æ³•

### å¦‚ä½•æ„å»ºç®€å•çš„æ¡ä»¶æŸ¥è¯¢ï¼Ÿ

```java
//resposity

List&lt;Student&gt; findByUserDepUuid(String uuid);

//æ¡†æ¶åœ¨è§£æè¯¥æ–¹æ³•æ—¶ï¼Œæµç¨‹å¦‚ä¸‹ï¼š
/*
é¦–å…ˆå‰”é™¤ findByï¼Œç„¶åå¯¹å‰©ä¸‹çš„å±æ€§è¿›è¡Œè§£æï¼Œå‡è®¾æŸ¥è¯¢å®ä½“ä¸ºDoc
å…ˆåˆ¤æ–­ userDepUuidï¼ˆæ ¹æ® POJO è§„èŒƒï¼Œé¦–å­—æ¯å˜ä¸ºå°å†™ï¼‰æ˜¯å¦ä¸ºæŸ¥è¯¢å®ä½“çš„ä¸€ä¸ªå±æ€§ï¼Œ
å¦‚æœæ˜¯ï¼Œåˆ™è¡¨ç¤ºæ ¹æ®è¯¥å±æ€§è¿›è¡ŒæŸ¥è¯¢ï¼›å¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œç»§ç»­å¾€ä¸‹èµ°

ä»å³å¾€å·¦æˆªå–ç¬¬ä¸€ä¸ªå¤§å†™å­—æ¯å¼€å¤´çš„å­—ç¬¦ä¸²(æ­¤å¤„ä¸ºUuid)ï¼Œ
ç„¶åæ£€æŸ¥å‰©ä¸‹çš„å­—ç¬¦ä¸²æ˜¯å¦ä¸ºæŸ¥è¯¢å®ä½“çš„ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœæ˜¯ï¼Œ
åˆ™è¡¨ç¤ºæ ¹æ®è¯¥å±æ€§è¿›è¡ŒæŸ¥è¯¢ï¼›å¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œåˆ™é‡å¤è¿™ä¸€æ­¥ï¼Œç»§ç»­ä»å³å¾€å·¦æˆªå–ï¼›
æœ€åå‡è®¾ user ä¸ºæŸ¥è¯¢å®ä½“çš„ä¸€ä¸ªå±æ€§
æ¥ç€å¤„ç†å‰©ä¸‹éƒ¨åˆ†ï¼ˆDepUuidï¼‰ï¼Œ
å…ˆåˆ¤æ–­ user æ‰€å¯¹åº”çš„ç±»å‹æ˜¯å¦æœ‰depUuidå±æ€§ï¼Œ
å¦‚æœæœ‰ï¼Œåˆ™è¡¨ç¤ºè¯¥æ–¹æ³•æœ€ç»ˆæ˜¯æ ¹æ® &quot;Doc.user.depUuid&quot; 
çš„å–å€¼è¿›è¡ŒæŸ¥è¯¢ï¼›å¦åˆ™ç»§ç»­æŒ‰ç…§æ­¥éª¤3çš„è§„åˆ™ä»å³å¾€å·¦æˆªå–ï¼Œ
æœ€ç»ˆè¡¨ç¤ºæ ¹æ® &quot;Doc.user.dep.uuid&quot; çš„å€¼è¿›è¡ŒæŸ¥è¯¢ã€‚
*/

//ä»¥ä¸‹æ˜¯æ¡ä»¶æŸ¥è¯¢ä¸­å¯ç”¨çš„å…³é”®å­—

//5. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æ ¹æ®æ€§åˆ«å’Œç­çº§æŸ¥è¯¢å­¦ç”Ÿåˆ—è¡¨
//å¦‚æœå¤šä¸ªå‚æ•°ï¼Œåˆ™å‚æ•°é¡ºåºå’Œæ–¹æ³•åç§°è¦å¯¹åº”èµ·æ¥ï¼Œæ¯”å¦‚è¿™é‡Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ç­çº§
List&lt;Student&gt; findBySbatchAndSgender(String batchName, String gender);

//6. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æ ¹æ®å­¦å·æˆ–å§“åæŸ¥è¯¢å­¦ç”Ÿ
List&lt;Student&gt; findBySidOrSname(String id, String name);

//7. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æ ¹æ®ä¸¤ä¸ªå­¦å·æŸ¥è¯¢å­¦å·ä»‹äºè¯¥åŒºé—´çš„å­¦ç”Ÿçš„åˆ—è¡¨
List&lt;Student&gt; findBySidBetween(String start, String end);

//8. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æŸ¥è¯¢å­¦å·å°äºæŒ‡å®šå­¦å·çš„å­¦ç”Ÿåˆ—è¡¨
List&lt;Student&gt; findBySidLessThan(String id);

//9. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æŸ¥è¯¢å­¦å·å°äºç­‰äºæŒ‡å®šå­¦å·çš„å­¦ç”Ÿåˆ—è¡¨
List&lt;Student&gt; findBySidLessThanEqual(String id);

//10. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æŸ¥è¯¢å­¦å·å¤§äºæŒ‡å®šå­¦å·çš„å­¦ç”Ÿåˆ—è¡¨
List&lt;Student&gt; findBySidGreaterThan(String id);

//11. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æŸ¥è¯¢å­¦å·å¤§äºç­‰äºæŒ‡å®šå­¦å·çš„å­¦ç”Ÿåˆ—è¡¨
List&lt;Student&gt; findBySidGreaterThanEqual(String id);

//12. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æŸ¥è¯¢ç­çº§ä¸ºnullçš„å­¦ç”Ÿçš„åˆ—è¡¨
List&lt;Student&gt; findBySbatchNull();

//13. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æŸ¥è¯¢å­¦å·åŒ…å«æŒ‡å®šå…³é”®å­—çš„å­¦ç”Ÿåˆ—è¡¨
List&lt;Student&gt; findBySidLike(String id);

//14. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æŸ¥è¯¢åå­—åŒ…å«æŒ‡å®šå…³é”®å­—çš„å­¦ç”Ÿåˆ—è¡¨
List&lt;Student&gt; findBySnameLike(String name);

//15. æ„å»ºæ¡ä»¶æŸ¥è¯¢-æŸ¥è¯¢åå­—ä»¥æŒ‡å®šå­—ç¬¦ä¸²ç»“å°¾çš„å­¦ç”Ÿåˆ—è¡¨
List&lt;Student&gt; findBySnameEndingWith(String name);
```

```java
//server
//æ ¹æ®ä¸»é”®æŸ¥æ‰¾æŸ¥æ‰¾æ—¶
public Product get(Long id) {
    //findById()è¿”å›çš„æ˜¯ä¸€ä¸ªOptionalå¯¹è±¡ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒç”¨get()è¿”å›å®é™…æ•°æ®å¯¹è±¡
    return repo.findById(id).get(); 
}
@Override
public List&lt;Student&gt; getStudentListByUuid(String Uuid) {
    return studentRepository.findByUuid(Uuid);
}
```

### å¦‚ä½•ä½¿ç”¨@QueryæŸ¥è¯¢ï¼Ÿ

```java
// 1. æŸ¥è¯¢idæœ€å¤§çš„å‘˜å·¥çš„ä¿¡æ¯
// ä½¿ç”¨@Queryæ³¨è§£å®šä¹‰JPQLæŸ¥è¯¢
// JPQL(Java Persistence Querying Language-JavaæŒä¹…åŒ–è¯­è¨€)æˆ–è€…å«åšJPA Querying
// Language-æ“ä½œçš„æ˜¯å¯¹è±¡å’Œå¯¹è±¡çš„å±æ€§
// Native Query-æœ¬åœ°/åŸç”ŸSQLè¯­å¥-æ“ä½œçš„æ˜¯è¡¨å’Œè¡¨ä¸­çš„åˆ—

// select empç›¸å½“äºæŸ¥è¯¢å‘˜å·¥å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œemp.å±æ€§å è¡¨ç¤ºæŸ¥è¯¢å¯¹åº”çš„å±æ€§
@Query(&quot;select emp from Employee emp where id=(select max(id) from Employee)&quot;)
Employee query1();

// 2. æ ¹æ®æ€§åˆ«å’Œéƒ¨é—¨ç¼–å·æŸ¥è¯¢å‘˜å·¥åˆ—è¡¨
// ä½¿ç”¨å ä½ç¬¦å‚æ•° ?X è¡¨ç¤ºæŸ¥è¯¢å‚æ•°
// Employeeç±»ä¸­é€šè¿‡deptå±æ€§æ˜ å°„äº†å…³ç³»ï¼Œä½†æ˜¯Employeeç±»ä¸­æ²¡æœ‰deptIdå±æ€§
// æ‰€ä»¥å¦‚æœéœ€è¦ä½¿ç”¨deptIdå±æ€§ï¼Œéœ€è¦å†™dept.deptId
@Query(&quot;select emp from Employee emp where gender=?1 and dept.deptId=?2&quot;)
List&lt;Employee&gt; query2(String gender, Integer deptId);

// 3. æ ¹æ®æ€§åˆ«å’Œéƒ¨é—¨ç¼–å·æŸ¥è¯¢å‘˜å·¥åˆ—è¡¨
// ä½¿ç”¨å‘½åå‚æ•° :å‚æ•°å
// å¯é€šè¿‡@Paramæ³¨è§£æŒ‡å®šæŸ¥è¯¢å‚æ•°çš„åç§°
@Query(&quot;select emp from Employee emp where gender=:gen and dept.deptId=:did&quot;)
List&lt;Employee&gt; query3(@Param(&quot;gen&quot;) String gender, @Param(&quot;did&quot;) Integer deptId);

// 4. æŸ¥è¯¢å§“ååŒ…å«æŒ‡å®šå…³é”®å­—å’ŒæŒ‡å®šæ€§åˆ«çš„å‘˜å·¥
// Spring Dataæ”¯æŒåœ¨å ä½ç¬¦å‚æ•°ä¸¤ç«¯æ·»åŠ %çš„ä½¿ç”¨
@Query(&quot;select emp from Employee emp where name like %?1% and gender=?2&quot;)
List&lt;Employee&gt; query4(String name, String gender);

// 5. æŸ¥è¯¢å§“ååŒ…å«æŒ‡å®šå…³é”®å­—å’ŒæŒ‡å®šæ€§åˆ«çš„å‘˜å·¥
// Spring Dataæ”¯æŒåœ¨å‘½åå‚æ•°ä¸¤ç«¯æ·»åŠ %çš„ä½¿ç”¨
@Query(&quot;select emp from Employee emp where name like %:name% and gender=:gender&quot;)
List&lt;Employee&gt; query5(@Param(&quot;name&quot;) String name, @Param(&quot;gender&quot;) String gender);

// 6. æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥
// JPQL: æ“ä½œçš„æ˜¯å¯¹è±¡å’Œå¯¹è±¡çš„å±æ€§
// åŸç”ŸSQLï¼š æ“ä½œçš„æ˜¯è¡¨å’Œè¡¨ä¸­çš„åˆ—
// ä½¿ç”¨æœ¬åœ°æŸ¥è¯¢/åŸç”ŸSQLè¯­å¥ï¼Œéœ€è¦è®¾ç½®nativeQueryå±æ€§ä¸ºtrue
// Spring Data JPAä¸ä»…ä»…æ”¯æŒJPQLè¯­å¥ï¼Œä¹Ÿæ”¯æŒåŸç”ŸSQLè¯­å¥
@Query(value = &quot;select * from emp&quot;, nativeQuery = true)
List&lt;Employee&gt; query6();

// 7. è”æ¥è¡¨æŸ¥è¯¢æŒ‡å®šåˆ—
//   æŸ¥è¯¢æŒ‡å®šåˆ—ï¼Œå¯ä»¥è€ƒè™‘å°†æ¯è¡Œæ•°æ®å°è£…åˆ°ä¸€ä¸ªObject[]æ•°ç»„
@Query(&quot;select e.id,e.name,e.gender,d.deptId,d.deptName from Employee e, Department d where e.dept.deptId=d.deptId&quot;)
List&lt;Object[]&gt; query7();
```

### å¦‚ä½•è¿›è¡Œå¢åˆ æ”¹ï¼Ÿ

ç›´æ¥è°ƒç”¨JPAç»™å®šçš„ CRUD æ–¹æ³•
```java
@Override
public void addStudent(Student student) {
    studentRepository.save(student);
}

@Override
public void updateStudent(Student student) {
    studentRepository.save(student);
}

@Override
public void deleteStudent(String id) {
    studentRepository.deleteById(id);
}
```
æˆ–è€…åœ¨repositoryå±‚ä¸­å®šä¹‰Query
```java
// 8. ä¿®æ”¹æŒ‡å®šå‘˜å·¥çš„å§“å
// éœ€è¦ä½¿ç”¨@Modifyingæ³¨è§£å’Œ@Transactionalæ³¨è§£
// @Query(&quot;select emp from Employee emp&quot;)
// å¦‚æœæ‰§è¡Œçš„æ˜¯ä¸€ä¸ªå¢åˆ æ”¹æ“ä½œï¼Œåˆ™å¿…é¡»æ·»åŠ @Modifyingå’Œ@Transactionalæ³¨è§£çš„ä½¿ç”¨
// @Transactionalæ³¨è§£å»ºè®®åŠ åˆ°Serviceå±‚çš„æ–¹æ³•ä¸Šï¼Œæœ‰æ—¶å€™ä¸€ä¸ªServiceåŠŸèƒ½å¯èƒ½æ¶‰åŠå¤šä¸ªDaoçš„è°ƒç”¨ï¼Œéœ€è¦ä½œä¸ºä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œ
@Modifying
@Query(&quot;update Employee set name=:name where id=:id&quot;)
void update1(@Param(&quot;id&quot;) Integer id, @Param(&quot;name&quot;) String name);

// 9. æ·»åŠ ä¸€ä¸ªæ–°å‘˜å·¥
// éœ€è¦ä½¿ç”¨@Modifyingæ³¨è§£å’Œ@Transactionalæ³¨è§£
// JPQLä¸æ”¯æŒinsertè¯­å¥
@Modifying
@Query(value = &quot;insert into emp(name,gender,dept_id) values(:name,:gender,:deptId)&quot;, nativeQuery = true)
void insert(@Param(&quot;name&quot;) String name, @Param(&quot;gender&quot;) String gender, @Param(&quot;deptId&quot;) Integer deptId);

// 10. åˆªé™¤ä¸€ä¸ªå‘˜å·¥
// éœ€è¦ä½¿ç”¨@Modifyingæ³¨è§£å’Œ@Transactionalæ³¨è§£
@Modifying
@Query(&quot;delete Employee where id=?1&quot;)
void delete(Integer id);
```

### å¦‚ä½•å£°æ˜äº‹åŠ¡ï¼Ÿ

```java
//ä¾‹
@Transactional(propagation=Propagation.SUPPORTS, readOnly=true)
public List&lt;PayInfo&gt; findAll() {
    return payInfoDao.findAll();
}
```

| å±æ€§                      | ç±»å‹                           | æè¿°                   |
|-------------------------|------------------------------|----------------------|
| value                   | 	String                      | 	å¯é€‰çš„é™å®šæè¿°ç¬¦ï¼ŒæŒ‡å®šä½¿ç”¨çš„äº‹åŠ¡ç®¡ç†å™¨ |
| propagation             | 	enum: Propagation           | 	å¯é€‰çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºè®¾ç½®         |
| isolation               | 	enum: Isolation             | 	å¯é€‰çš„äº‹åŠ¡éš”ç¦»çº§åˆ«è®¾ç½®         |
| readOnly	               | boolean                      | 	è¯»å†™æˆ–åªè¯»äº‹åŠ¡ï¼Œé»˜è®¤è¯»å†™        |
| timeout	                | int (in seconds granularity) | 	äº‹åŠ¡è¶…æ—¶æ—¶é—´è®¾ç½®            |
| rollbackFor             | 	Classå¯¹è±¡æ•°ç»„ï¼Œå¿…é¡»ç»§æ‰¿è‡ªThrowable    | 	å¯¼è‡´äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»æ•°ç»„        |
| rollbackForClassName    | 	ç±»åæ•°ç»„ï¼Œå¿…é¡»ç»§æ‰¿è‡ªThrowable         | 	å¯¼è‡´äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»åå­—æ•°ç»„      |
| noRollbackFor	          | Classå¯¹è±¡æ•°ç»„ï¼Œå¿…é¡»ç»§æ‰¿è‡ªThrowable     | 	ä¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»æ•°ç»„      |
| noRollbackForClassName	 | ç±»åæ•°ç»„ï¼Œå¿…é¡»ç»§æ‰¿è‡ªThrowable          | 	ä¸ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šçš„å¼‚å¸¸ç±»åå­—æ•°ç»„    |

### å¦‚ä½•é…ç½®mapperæ˜ å°„æ–‡ä»¶çš„ä½ç½®ï¼Ÿ

åœ¨é…ç½®æ–‡ä»¶ä¸­
```properties
mybatis.mapper-locations=classpath:com/qdu/mapper/**/*.xml
```

### å¦‚ä½•å¼€å¯å¯¹mapperåŒ…çš„æ‰«æï¼Ÿ

åœ¨å¯åŠ¨ç±»ä¸­
```java
@MapperScan(&quot;com.qdu.mapper&quot;)
```

## æ¶ˆæ¯ä¼ é€’ 10é—®

### æ¶ˆæ¯ä¼ é€’çš„æ¦‚å¿µï¼Ÿ

æ¶ˆæ¯ä¼ é€’æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå®ä½“ä¹‹é—´è¿›è¡Œé€šä¿¡çš„ä¸€-ç§æ–¹å¼ï¼Œå®ƒæ— å¤„ä¸åœ¨ã€‚è‡ªè®¡ç®—æœºå‘æ˜ä»¥æ¥ï¼Œä»¥ä¸€ç§æˆ–
å¦ä¸€ç§å½¢å¼è¿›è¡Œçš„è®¡ç®—æœºæ¶ˆæ¯ä¼ é€’å°±å·²ç»å­˜åœ¨ã€‚å®ƒè¢«å®šä¹‰ä¸ºç¡¬ä»¶å’Œ/æˆ–è½¯ä»¶ç»„ä»¶æˆ–åº”ç”¨ç¨‹åºä¹‹é—´çš„é€š
ä¿¡æ–¹æ³•ã€‚æ€»ä¼šæœ‰ä¸€ä¸ªå‘é€è€…å’Œä¸€ä¸ªæˆ–å¤šä¸ªæ¥æ”¶è€…ã€‚æ¶ˆæ¯ä¼ é€’å¯ä»¥æ˜¯åŒæ­¥å’Œå¼‚æ­¥ï¼Œå‘å¸ƒ/è®¢é˜…ï¼Œ RPC
åŸºäºä¼ä¸šçš„æ¶ˆæ¯ä¼ é€’ï¼ŒESB (ä¼ä¸šæœåŠ¡æ€»çº¿)ï¼ŒMOM (é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶)ç­‰ç­‰ã€‚


### JMSçš„æ¦‚å¿µï¼Ÿ

JMSå³Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJava Message Serviceï¼‰åº”ç”¨ç¨‹åºæ¥å£ï¼Œæ˜¯ä¸€ä¸ªJavaå¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚Javaæ¶ˆæ¯æœåŠ¡æ˜¯ä¸€ä¸ªä¸å…·ä½“å¹³å°æ— å…³çš„APIï¼Œç»å¤§å¤šæ•°MOMæä¾›å•†éƒ½å¯¹JMSæä¾›æ”¯æŒã€‚

### ç‚¹å¯¹ç‚¹æ¨¡å‹æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ

1.  ä¸€ä¸ªæ¶ˆæ¯ç”±ä¸€ä¸ª&lt;b&gt;æ¶ˆæ¯ç”Ÿäº§è€…(producer)&lt;/b&gt;ä¼ é€ç»™ä¸€ä¸ª&lt;b&gt;æ¶ˆæ¯ä½¿ç”¨è€…(consumer)&lt;/b&gt;ã€‚&lt;/a&gt;&lt;/li&gt;
2. æ¶ˆæ¯ç”±ç”Ÿäº§è€…å‘é€åˆ°&lt;b&gt;é˜Ÿåˆ—(Queue)&lt;/b&gt;ç›®çš„åœ°ï¼Œç„¶åä¼ é€ç»™åœ¨è¯¥é˜Ÿåˆ—ä¸Šæ³¨å†Œäº†çš„&lt;b&gt;æ¶ˆæ¯ä½¿ç”¨è€…ä¹‹ä¸€ &lt;/b&gt;ã€‚&lt;/a&gt;&lt;/li&gt;
3. ä»»æ„å¤šæ•°é‡çš„æ¶ˆæ¯ç”Ÿäº§è€…éƒ½å¯ä»¥å‘é€æ¶ˆæ¯åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½å¯ä»¥ç¡®ä¿è¢«ä¼ é€æˆåŠŸï¼Œä¸”&lt;b&gt;æ¯æ¡æ¶ˆæ¯ä»…ç”±ä¸€ä¸ªæ¶ˆæ¯ä½¿ç”¨è€…æ”¶åˆ°å’Œä½¿ç”¨&lt;/b&gt;ã€‚&lt;/a&gt;&lt;/li&gt;
4. å¦‚æœæ²¡æœ‰æ¶ˆæ¯ä½¿ç”¨è€…æ³¨å†Œæ¥å—é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œåˆ™&lt;b&gt;é˜Ÿåˆ—ä¿ç•™è¯¥æ¶ˆæ¯&lt;/b&gt;ï¼Œç›´åˆ°æœ‰ä½¿ç”¨è€…è¯»å–è¯¥æ¶ˆæ¯ï¼Œä¸€æ—¦è¯»å–ï¼Œè¯¥æ¶ˆæ¯ä¾¿ä¸åœ¨é˜Ÿåˆ—ä¸­ï¼Œä¸å¯å†æœ‰å…¶ä»–ä½¿ç”¨è€…è¯»å–ã€‚&lt;/a&gt;&lt;/li&gt;

### å‘å¸ƒè®¢é˜…æ¨¡å‹çš„ç‰¹ç‚¹ï¼Ÿ

1.  ä¸€ä¸ªæ¶ˆæ¯ç”±ä¸€ä¸ª&lt;b&gt;æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆProducer/Publisherï¼‰&lt;/b&gt;ä¼ é€ç»™&lt;b&gt;ä»»æ„æ•°é‡çš„æ¶ˆæ¯ä½¿ç”¨è€…(Consumer/Subscriber)&lt;/b&gt;ã€‚&lt;/a&gt;&lt;/li&gt;
2. æ¶ˆæ¯ç”±ç”Ÿäº§è€…å‘é€åˆ°&lt;b&gt;ä¸»é¢˜ï¼ˆTopicï¼‰&lt;/b&gt;ç›®çš„åœ°ï¼Œ ç„¶åç”±&lt;b&gt;è®¢é˜…äº†è¯¥ä¸»é¢˜çš„æ´»è·ƒæ¶ˆæ¯ä½¿ç”¨è€…è¯»å–å’Œä½¿ç”¨&lt;/b&gt;ã€‚&lt;/a&gt;&lt;/li&gt;
3. ä»»æ„æ•°é‡çš„æ¶ˆæ¯ç”Ÿäº§è€…å¯ä»¥å‘é€æ¶ˆæ¯åˆ°&lt;b&gt;ä¸»é¢˜&lt;/b&gt;ç›®çš„åœ°ï¼Œ&lt;b&gt;æ¯æ¡æ¶ˆæ¯&lt;/b&gt;ä¼ é€ç»™&lt;b&gt;ä»»æ„æ•°é‡è®¢é˜…äº†è¯¥ä¸»é¢˜çš„æ¶ˆæ¯ä½¿ç”¨è€…&lt;/b&gt;ã€‚&lt;/a&gt;&lt;/li&gt;
4. å¦‚æœæ²¡æœ‰è®¢é˜…è¯¥ä¸»é¢˜çš„æ¶ˆæ¯ä½¿ç”¨è€…ï¼Œåˆ™Topicç›®çš„åœ°ä¸ä¼šä¿ç•™è¯¥æ¶ˆæ¯ï¼ˆé™¤éæœ‰éæ´»è·ƒä½¿ç”¨è€…è¿›è¡Œäº†æŒä¹…æ€§è®¢é˜…ï¼‰ï¼Œåç»­è®¢é˜…è¯¥ä¸»é¢˜çš„æ¶ˆæ¯ä½¿ç”¨è€…ä¹Ÿä¸ä¼šå†æ”¶åˆ°ä½¿ç”¨è€…ä¹‹å‰å‘çš„æ¶ˆæ¯ã€‚&lt;/a&gt;&lt;/li&gt;
5. ä¸€ä¸ªæŒä¹…æ€§è®¢é˜…è¡¨ç¤ºæ³¨å†Œäº†è¯¥ä¸»é¢˜çš„ä½¿ç”¨è€…å¯ä»¥åœ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™å¤„äºéæ´»è·ƒçŠ¶æ€ï¼Œè¿™æ ·ï¼Œä½¿ç”¨è€…å¯ä»¥åœ¨å˜æˆæ´»è·ƒçŠ¶æ€æ—¶æ”¶åˆ°ä¹‹å‰å‘é€çš„æ¶ˆæ¯ã€‚&lt;/a&gt;&lt;/li&gt;

### ActiveMQæ˜¯ä»€ä¹ˆï¼Ÿ

ActiveMQæ˜¯ä¸€ç§å¼€æºçš„åŸºäºJMSï¼ˆJava Message Servieï¼‰è§„èŒƒçš„ä¸€ç§æ¶ˆæ¯ä¸­é—´ä»¶çš„å®ç°ï¼ŒActiveMQçš„è®¾è®¡ç›®æ ‡æ˜¯æä¾›æ ‡å‡†çš„ã€é¢å‘æ¶ˆæ¯çš„ã€èƒ½å¤Ÿè·¨è¶Šå¤šè¯­è¨€å’Œå¤šç³»ç»Ÿçš„åº”ç”¨é›†æˆæ¶ˆæ¯é€šä¿¡ä¸­é—´ä»¶ã€‚

å®ƒä¸ºä¼ä¸šåº”ç”¨ä¸­æ¶ˆæ¯ä¼ é€’æä¾›é«˜å¯ç”¨ã€å‡ºè‰²æ€§èƒ½ã€å¯æ‰©å±•ã€ç¨³å®šå’Œå®‰å…¨ä¿éšœã€‚

ActiveMQå®ç°JMSè§„èŒƒå¹¶åœ¨æ­¤ä¹‹ä¸Šæä¾›å¤§é‡é¢å¤–çš„ç‰¹æ€§ã€‚ActiveMQæ”¯æŒé˜Ÿåˆ—å’Œè®¢é˜…ä¸¤ç§æ¨¡å¼çš„æ¶ˆæ¯å‘é€ã€‚

### å¦‚ä½•å¯åŠ¨ActiveMQï¼Ÿ

```shell
cd &lt;activeMQ_dir&gt;/bin
./activemq start
```
### JMSåˆ›å»ºä»€ä¹ˆé“¾æ¥å®ä¾‹ï¼Ÿ

`javax.jms.Connection`

ï¼ˆç”±äºä½¿ç”¨SpringBootï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ï¼‰

### å¦‚ä½•é…ç½®ActiveMQï¼Ÿ

é¦–å…ˆé…ç½®propertiesæ–‡ä»¶
```properties
#activemqé€šè®¯åœ°å€
spring.activemq.broker-url=tcp://localhost:61616
#ç”¨æˆ·å
spring.activemq.user=admin
#å¯†ç 
spring.activemq.password=admin
#æ˜¯å¦å¯ç”¨å†…å­˜æ¨¡å‹(å°±æ˜¯ä¸å®‰è£…mq,é¡¹ç›®å¯åŠ¨æ—¶åŒæ—¶å¯åŠ¨ä¸€ä¸ªmqå®ä¾‹)
spring.activemq.in-memory=false
#ä¿¡ä»»æ‰€æœ‰åŒ…
spring.activemq.packages.trust-all=true
#æ˜¯å¦æ›¿æ¢é»˜è®¤çš„è¿æ¥æ± ï¼Œä½¿ç”¨activemqçš„è¿æ¥æ± éœ€å¼•å…¥ä¾èµ–
spring.activemq.pool.enabled=false
```

ç„¶åé…ç½®activeMQ
```java
@Configuration
@EnableJms
public class ActiveMQConfig {
    @Bean
    public Queue queue() {
        return new ActiveMQQueue(&quot;springboot.queue&quot;) ;
    }

    //springbooté»˜è®¤åªé…ç½®queueç±»å‹æ¶ˆæ¯ï¼Œå¦‚æœè¦ä½¿ç”¨topicç±»å‹çš„æ¶ˆæ¯ï¼Œåˆ™éœ€è¦é…ç½®è¯¥bean
    @Bean
    public JmsListenerContainerFactory jmsTopicListenerContainerFactory(ConnectionFactory connectionFactory){
        DefaultJmsListenerContainerFactory factory = new DefaultJmsListenerContainerFactory();
        factory.setConnectionFactory(connectionFactory);
        //è¿™é‡Œå¿…é¡»è®¾ç½®ä¸ºtrueï¼Œfalseåˆ™è¡¨ç¤ºæ˜¯queueç±»å‹
        factory.setPubSubDomain(true);
        return factory;
    }

    @Bean
    public Topic topic() {
        return new ActiveMQTopic(&quot;springboot.topic&quot;) ;
    }
}
```
æˆ–è€…åœ¨propertiesä¸­é…ç½®
```propeties
# ä½¿ç”¨ç‚¹å¯¹ç‚¹æ¨¡å‹
spring.jms.pub-sub-domain=false
```

é…ç½®æ–‡ä»¶çš„å…¶ä»–é…ç½®ï¼š
```properties
# æ˜¯å¦ä¿¡ä»»æ‰€æœ‰åŒ…
spring.activemq.packages.trust-all=
# è¦ä¿¡ä»»çš„ç‰¹å®šåŒ…çš„é€—å·åˆ†éš”åˆ—è¡¨ï¼ˆå½“ä¸ä¿¡ä»»æ‰€æœ‰åŒ…æ—¶ï¼‰
spring.activemq.packages.trusted=
# å½“è¿æ¥è¯·æ±‚å’Œæ± æ»¡æ—¶æ˜¯å¦é˜»å¡ã€‚è®¾ç½®falseä¼šæŠ›â€œJMSExceptionå¼‚å¸¸â€ã€‚
spring.activemq.pool.block-if-full=true
# å¦‚æœæ± ä»ç„¶æ»¡ï¼Œåˆ™åœ¨æŠ›å‡ºå¼‚å¸¸å‰é˜»å¡æ—¶é—´ã€‚
spring.activemq.pool.block-if-full-timeout=-1ms
# æ˜¯å¦åœ¨å¯åŠ¨æ—¶åˆ›å»ºè¿æ¥ã€‚å¯ä»¥åœ¨å¯åŠ¨æ—¶ç”¨äºåŠ çƒ­æ± ã€‚
spring.activemq.pool.create-connection-on-startup=true
# æ˜¯å¦ç”¨Pooledconnectionfactoryä»£æ›¿æ™®é€šçš„ConnectionFactoryã€‚
spring.activemq.pool.enabled=false
# è¿æ¥è¿‡æœŸè¶…æ—¶ã€‚
spring.activemq.pool.expiry-timeout=0ms
# è¿æ¥ç©ºé—²è¶…æ—¶
spring.activemq.pool.idle-timeout=30s
# è¿æ¥æ± æœ€å¤§è¿æ¥æ•°
spring.activemq.pool.max-connections=1
# æ¯ä¸ªè¿æ¥çš„æœ‰æ•ˆä¼šè¯çš„æœ€å¤§æ•°ç›®ã€‚
spring.activemq.pool.maximum-active-session-per-connection=500
# å½“æœ‰&quot;JMSException&quot;æ—¶å°è¯•é‡æ–°è¿æ¥
spring.activemq.pool.reconnect-on-exception=true
# åœ¨ç©ºé—²è¿æ¥æ¸…é™¤çº¿ç¨‹ä¹‹é—´è¿è¡Œçš„æ—¶é—´ã€‚å½“ä¸ºè´Ÿæ•°æ—¶ï¼Œæ²¡æœ‰ç©ºé—²è¿æ¥é©±é€çº¿ç¨‹è¿è¡Œã€‚
spring.activemq.pool.time-between-expiration-check=-1ms
# æ˜¯å¦åªä½¿ç”¨ä¸€ä¸ªMessageProducer
spring.activemq.pool.use-anonymous-producers=true
```


### @JMSListeneræœ‰ä»€ä¹ˆç”¨ï¼Ÿ

```java
//è¯¥æ³¨è§£ç”¨äºå°†ä¸€ä¸ªæ–¹æ³•è®¾ç½®ä¸ºç›‘å¬ç«¯ç‚¹ï¼Œç”¨äºæ¥æ”¶æ¶ˆæ¯
//destinationç”¨äºæŒ‡å®šæ¥æ”¶æ¶ˆæ¯çš„ç›®çš„åœ°ï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯æ¥è‡ªå“ªä¸ªç›®çš„åœ°ï¼Œç»™å‡ºå…¶åç§°
@JmsListener(destination=&quot;queue2&quot;) 
public void receiveMsg1(String msg) {
    System.out.println(&quot;ç›‘å¬ç«¯ç‚¹1æ”¶åˆ°æ¶ˆæ¯ï¼Œæ¶ˆæ¯å†…å®¹ï¼š&quot;+msg);
}
```

### å¦‚ä½•ä½¿ç”¨å‘å¸ƒè®¢é˜…æ¨¡å‹ï¼Ÿ

```properties
# è®¾ç½®ä¸ºtureä½¿ç”¨å‘å¸ƒè®¢é˜…æ¨¡å‹, i.e
spring.jms.pub-sub-domain=true
```

## æµ‹è¯• 9é—®

### å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•ï¼Ÿ

è§[è½¯ä»¶å·¥ç¨‹ç¬¬åä¸€ç« å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•éƒ¨åˆ†](https://charlesix59.github.io/2023/02/07/subject/software_project/chapter11/#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95)

### Junit5çš„ä¸‰ä¸ªç»„ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ

JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage

- JUnit Platform: æ˜¯åœ¨JVMä¸Šå¯åŠ¨æµ‹è¯•æ¡†æ¶çš„åŸºç¡€ï¼Œä¸ä»…æ”¯æŒJunitè‡ªåˆ¶çš„æµ‹è¯•å¼•æ“ï¼Œå…¶ä»–æµ‹è¯•å¼•æ“ä¹Ÿéƒ½å¯ä»¥æ¥å…¥ã€‚ 
- JUnit Jupiter: æä¾›äº†JUnit5çš„æ–°çš„ç¼–ç¨‹æ¨¡å‹ï¼Œæ˜¯JUnit5æ–°ç‰¹æ€§çš„æ ¸å¿ƒã€‚å†…éƒ¨åŒ…å«äº†ä¸€ä¸ªæµ‹è¯•å¼•æ“ï¼Œç”¨äºåœ¨Junit Platformä¸Šè¿è¡Œã€‚ 
- JUnit Vintage: ç”±äºJUintå·²ç»å‘å±•å¤šå¹´ï¼Œä¸ºäº†ç…§é¡¾è€çš„é¡¹ç›®ï¼Œå…¶æä¾›äº†å…¼å®¹JUnit4.x,Junit3.xçš„æµ‹è¯•å¼•æ“ã€‚

### Junitçš„å¸¸ç”¨æ³¨è§£ï¼Ÿ

@Test :è¡¨ç¤ºæ–¹æ³•æ˜¯æµ‹è¯•æ–¹æ³•
```java
@Test
void contextLoads() {
}
```
@DisplayName :ä¸ºæµ‹è¯•ç±»æˆ–è€…æµ‹è¯•æ–¹æ³•è®¾ç½®å±•ç¤ºåç§°
```java
@DisplayName(&quot;æµ‹è¯•displaynameæ³¨è§£&quot;)
@Test
void testDisplayName() {
    System.out.println(1);
}
```
@BeforeEachï¼šè¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒæµ‹è¯•ä¹‹å‰æ‰§è¡Œ

@AfterEachï¼šè¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒæµ‹è¯•ä¹‹åæ‰§è¡Œ 

@BeforeAllï¼šè¡¨ç¤ºåœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•ä¹‹å‰æ‰§è¡Œ

@AfterAllï¼šè¡¨ç¤ºåœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•ä¹‹åæ‰§è¡Œ
```java
@BeforeEach
    void testBeforeEach() {
        System.out.println(&quot;æµ‹è¯•å°±è¦å¼€å§‹ã€‚ã€‚ã€‚&quot;);
    }
 
    @AfterEach
    void testAfterEach() {
        System.out.println(&quot;æµ‹è¯•å°±è¦ç»“æŸã€‚ã€‚ã€‚&quot;);
    }
 
    @BeforeAll
    static void testBeforeAll() {
        System.out.println(&quot;æ‰€æœ‰æµ‹è¯•å°±è¦å¼€å§‹ã€‚ã€‚ã€‚&quot;);
    }
 
    @AfterAll
    static void testAfterAll() {
        System.out.println(&quot;æ‰€æœ‰æµ‹è¯•å·²ç»ç»“æŸã€‚ã€‚ã€‚&quot;);
    }
```
@Disabled :è¡¨ç¤ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•ä¸æ‰§è¡Œ
```java
@Disabled
@Test
void test2() {
    System.out.println(2);
    System.out.println(jdbcTemplate.getClass());
}
```
@Timeout :è¡¨ç¤ºæµ‹è¯•æ–¹æ³•è¿è¡Œå¦‚æœè¶…è¿‡äº†æŒ‡å®šæ—¶é—´å°†ä¼šè¿”å›é”™è¯¯
```java
@Test
@Timeout(value = 500, unit = TimeUnit.MILLISECONDS)
void testTimeOut() throws InterruptedException {
    Thread.sleep(520);
}
```
@RepeatedTest :è¡¨ç¤ºæ–¹æ³•å¯é‡å¤æ‰§è¡Œ
```java
@RepeatedTest(5)    //é‡å¤æµ‹è¯•5æ¬¡
@DisplayName(&quot;æµ‹è¯•3&quot;)
@Test
void test3() {
    System.out.println(3);
    System.out.println(jdbcTemplate.getClass());
}
```
@ParameterizedTest :è¡¨ç¤ºæ–¹æ³•æ˜¯å‚æ•°åŒ–æµ‹è¯•

@Tag :è¡¨ç¤ºå•å…ƒæµ‹è¯•ç±»åˆ«

@ExtendWith :ä¸ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•æä¾›æ‰©å±•ç±»å¼•ç”¨
### Junitçš„æµ‹è¯•æ–¹æ³•ä¸æ³¨æ„äº‹é¡¹ï¼Ÿ

å°±è¿™ä¹ˆæµ‹ã€‚ã€‚ã€‚

æ³¨æ„æ³¨æ„å°±è¡Œäº†ã€‚ã€‚ã€‚

### Testä¾èµ–åŒ…å«çš„åº“æœ‰å“ªäº›ï¼Ÿ

![img.png](./ssm/dependencies.png)

### å¦‚ä½•æµ‹è¯•Spring Bootç¨‹åºï¼Ÿ

@SpringBootTestæ³¨è§£ï¼šæ·»åŠ åœ¨éœ€è¦ä¾èµ–spring bootæ¡†æ¶çš„æµ‹è¯•ç±»ä¸Šï¼Œ ä¸ç„¶ä¸èƒ½ä½¿ç”¨Spring bootçš„ç›¸å…³å¼€å‘åŠŸèƒ½
@Testæ³¨è§£ï¼šæ·»åŠ åœ¨æµ‹è¯•æ–¹æ³•ä¸Š
```java
@SpringBootTest
class Boot05WebAdminApplicationTests {
    @Test
    void contextLoads() {
    }
}
```

### MockMvcæ˜¯ä»€ä¹ˆï¼Ÿ

MockMvcå®ç°äº†å¯¹Httpè¯·æ±‚çš„æ¨¡æ‹Ÿï¼Œèƒ½å¤Ÿç›´æ¥ä½¿ç”¨ç½‘ç»œçš„å½¢å¼ï¼Œè½¬æ¢åˆ°Controllerçš„è°ƒç”¨ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—æµ‹è¯•é€Ÿåº¦å¿«ã€ä¸ä¾èµ–ç½‘ç»œç¯å¢ƒï¼Œè€Œä¸”æä¾›äº†ä¸€å¥—éªŒè¯çš„å·¥å…·ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—è¯·æ±‚çš„éªŒè¯ç»Ÿä¸€è€Œä¸”å¾ˆæ–¹ä¾¿ã€‚

### @WebMvcTestæœ‰ä»€ä¹ˆç”¨ï¼Ÿ

```java
//è¯¥æ³¨è§£çš„ä½¿ç”¨å®ç°é’ˆå¯¹spring mvcç»„ä»¶çš„åˆ‡ç‰‡æµ‹è¯•ï¼Œè¿™æ ·åªåŠ è½½mvcç›¸å…³çš„é…ç½®çš„å³å¯
@WebMvcTest(controllers= {HelloController.class})
```
å¦‚æœä½¿ç”¨@SpringBootTestæ¥ä¿®é¥°ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œ
åˆ™ä¼šåŠ è½½æ‰€æœ‰é…ç½®ï¼Œå¹¶æ³¨å†Œç›¸å…³çš„beanæˆä¸ºspringç®¡ç†çš„beanï¼Œ
åŒ…æ‹¬serviceç»„ä»¶ã€mapperç»„ä»¶ã€æ•°æ®æºç­‰

ä½†æ˜¯å¦‚æœæµ‹è¯•åªæ¶‰åŠéƒ¨åˆ†ç»„ä»¶ï¼Œå¦‚æ§åˆ¶å™¨ï¼Œä¸éœ€è¦ä½¿ç”¨serviceæˆ–mapperç­‰ç»„ä»¶ï¼Œ
å¯ä»¥ä½¿ç”¨åˆ‡ç‰‡æµ‹è¯•å¯¹åº”çš„æ³¨è§£æ¥å®æ–½æµ‹è¯•ï¼Œè¿™æ ·åªåŠ è½½éœ€è¦çš„é…ç½®å³å¯

æ¯”å¦‚ä½¿ç”¨@WebMvcTestï¼Œå®ç°å¯¹spring mvcç»„ä»¶çš„åˆ‡ç‰‡æµ‹è¯•ï¼Œ
è¿™æ ·å°±ä¸èƒ½æ³¨å…¥serviceç­‰ç»„ä»¶ï¼Œå› ä¸ºä¸ä¼šåŠ è½½serviceç­‰çš„é…ç½®</p> </div> </div> </a>  </div> </div>  </main> <footer data-astro-cid-sz7xmlte>
&copy; 2026 @charlesix59. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte> <a href="https://https://github.com/charlesix59" target="_blank" data-astro-cid-sz7xmlte> <span class="sr-only" data-astro-cid-sz7xmlte>find me on Github</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" astro-icon="social/github" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg> </a> </div> </footer>  </body></html>