<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>使用node.js创建一个todo列表——node.js服务器搭建、json读写以及使用pm2保持服务运行</title>
    <link href="/2022/08/30/to-do-list-by-nodeJS/"/>
    <url>/2022/08/30/to-do-list-by-nodeJS/</url>
    
    <content type="html"><![CDATA[<h1 id="使用node-js创建一个todo列表——node-js服务器搭建以及json读写"><a href="#使用node-js创建一个todo列表——node-js服务器搭建以及json读写" class="headerlink" title="使用node.js创建一个todo列表——node.js服务器搭建以及json读写"></a>使用node.js创建一个todo列表——node.js服务器搭建以及json读写</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前些日子学习了 nodejs ，顺理成章的想要找点东西练练手。恰好最近需要一个简介的todo list网页，因为之前用的一些todo list应用都被墙了，访问速度感人，于是就想自己搞一个todo。</p><p>而恰好，我要搞的todo是一个非常简单的程序，非常适合用nodejs这样的解释型脚本语言来实现，比起java这样光搭框架就要半天的专注大型项目的语言，nodejs 的优势就是非明显了。</p><p>nodejs搭建服务器只需要去nodejs官网复制这样的一块代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Hi!&#x27;</span>)<br>&#125;)<br><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server ready&#x27;</span>))<br></code></pre></td></tr></table></figure><p>所以我们可以把更多的经历放在我们的业务实现上。</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><p>在开始动工之前，要先列出需求。当时我的需求如下：</p><ul><li><p>添加需要做的事情</p></li><li><p>展示需要做的事情</p></li><li><p>完成需要做的事情</p></li><li><p>查看曾经完成的事情</p></li></ul><h3 id="解决方案分析"><a href="#解决方案分析" class="headerlink" title="解决方案分析"></a>解决方案分析</h3><p>对于上述需求，我打算这样实现：</p><ul><li><p>使用json文件系统实现持久化操作</p></li><li><p>使用nodejs来获取数据</p></li><li><p>使用nodejs来处理数据并储存数据</p></li></ul><p>这样的话。明确了需求与实现方式，我们就可以动工了。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="json读写"><a href="#json读写" class="headerlink" title="json读写"></a>json读写</h3><p>nodejs提供了一套文件的读写的模块：<code>fs</code>。使用fs可以很简单的实现文本文件的读写。但是为了我们在开发的时候更加方便，我又将他封装成了一个专注json读写的方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//in jsonHandler.js</span><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Hello world!&quot;</span>)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">readJson</span>(<span class="hljs-params">name</span>)&#123;<br>    <span class="hljs-keyword">let</span> jsonFile = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;./&quot;</span>+name);<br>    <span class="hljs-keyword">let</span> toDoList = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonFile);    <span class="hljs-comment">//解析json，并直接返回json对象</span><br>    <span class="hljs-keyword">return</span> toDoList;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">writeJson</span>(<span class="hljs-params">name,data</span>)&#123;<br>    fs.<span class="hljs-title function_">writeFileSync</span>(<span class="hljs-string">&quot;./&quot;</span>+name,<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));<br>&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>    readJson,<br>    writeJson<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="服务器搭建"><a href="#服务器搭建" class="headerlink" title="服务器搭建"></a>服务器搭建</h3><p>还记得我们的服务器的格式吗？我们先定义一下我们的服务器接口：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//in index.js</span><br><span class="hljs-keyword">const</span> jh = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./jsonHandler&quot;</span>)<br><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;url&#x27;</span>);<br><span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;util&#x27;</span>);<br><br><span class="hljs-keyword">let</span> workList = jh.<span class="hljs-title function_">readJson</span>(<span class="hljs-string">&quot;list.json&quot;</span>);<br><br><span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span><br><br><span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">//设置响应头与请求编码</span><br>    res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">200</span><br>    <span class="hljs-comment">//设置字节流编码为utf-8</span><br>    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/plain;charset=utf8&#x27;</span>)<br>    <span class="hljs-comment">//设置允许跨域</span><br>    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>,<span class="hljs-string">&#x27;*&#x27;</span>)<br>    req.<span class="hljs-title function_">setEncoding</span>(<span class="hljs-string">&#x27;utf8&#x27;</span>);<br><br>    <span class="hljs-comment">//write your code here</span><br><br>    <span class="hljs-keyword">let</span> ret=<span class="hljs-string">&quot;&quot;</span>;    <span class="hljs-comment">//这是需要返回的数据</span><br>    res.<span class="hljs-title function_">end</span>(ret)<br>&#125;)<br><br>server.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> &#123;<br>&#125;)<br></code></pre></td></tr></table></figure><p>然后根据我们的需求分析，先来确定以下API接口：</p><ul><li><p><code>addWork()</code>:用来添加一个任务并将数据保存到json</p></li><li><p><code>deleteWord(res)</code>:用来将一个任务删除并将数据保存到json</p></li><li><p><code>writeHistory(work)</code>:将完成的任务添加到历史记录中</p></li><li><p><code>getAllWork()</code>:获取目前正在运行中的任务</p></li></ul><p>首先我们先开始addWork()的编写，要添加的话，首先要接受并解析客户端发送的请求，然后再储存到json中，代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//用来增加一个任务</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">addWork</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-keyword">let</span> work=<span class="hljs-string">&quot;&quot;</span>;<br>        req.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> &#123;    <span class="hljs-comment">//接受客户端发送的请求流</span><br>            <span class="hljs-comment">//这里要取子串的原因是请求会带key，我这里是work=xxx，所以要将&#x27;work=&#x27;去掉</span><br>            work=chunk.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">substring</span>(<span class="hljs-number">5</span>);<br>            <span class="hljs-comment">//设置编码，不然中文会乱码</span><br>            work = <span class="hljs-built_in">decodeURIComponent</span>(work);<br>            <span class="hljs-comment">//解析worklist</span><br>            <span class="hljs-keyword">let</span> jsonObj=<span class="hljs-built_in">eval</span>(workList)<br>            jsonObj.<span class="hljs-title function_">push</span>(&#123;<span class="hljs-string">&quot;work&quot;</span>:work&#125;)<br>            <span class="hljs-comment">//将数据写回</span><br>            jh.<span class="hljs-title function_">writeJson</span>(<span class="hljs-string">&quot;list.json&quot;</span>,jsonObj)<br>        &#125;)<br>    &#125;<br></code></pre></td></tr></table></figure><p>任务历史与添加任务几乎同理，只不过这个方法获取的数据是deleteWork提供的，我们不需要再去监控客户端的请求。代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//任务历史</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">writeHistory</span>(<span class="hljs-params">work</span>) &#123;<br>        <span class="hljs-keyword">let</span> jsonStr = jh.<span class="hljs-title function_">readJson</span>(<span class="hljs-string">&quot;history.json&quot;</span>);<br>        <span class="hljs-keyword">let</span> jsonObj = <span class="hljs-built_in">eval</span>(jsonStr);<br>        <span class="hljs-keyword">let</span> event = &#123;&#125;<br>        event.<span class="hljs-property">work</span> = work;<br>        event.<span class="hljs-property">finishTime</span> =<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>        jsonObj.<span class="hljs-title function_">push</span>(event);<br>        jh.<span class="hljs-title function_">writeJson</span>(<span class="hljs-string">&quot;history.json&quot;</span>,jsonObj)<br>    &#125;<br></code></pre></td></tr></table></figure><p>删除任务也是同理，我们要在前端给每个任务隐性的标上index，然后就可以用来删除了：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//删除任务</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteWork</span>(<span class="hljs-params">res</span>)&#123;<br>        req.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`可用的数据块: <span class="hljs-subst">$&#123;chunk&#125;</span>`</span>)<br>            <span class="hljs-comment">//获取点击事件的位置</span><br>            <span class="hljs-keyword">let</span> index=chunk.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">substring</span>(<span class="hljs-number">3</span>);<br>            <span class="hljs-keyword">let</span> jsonObj=<span class="hljs-built_in">eval</span>(workList)<br>            <span class="hljs-comment">//添加历史</span><br>            <span class="hljs-keyword">let</span> work = jsonObj[index].<span class="hljs-property">work</span><br>            <span class="hljs-title function_">writeHistory</span>(work)<br>            <span class="hljs-comment">//删除</span><br>            jsonObj.<span class="hljs-title function_">splice</span>(index,<span class="hljs-number">1</span>);<br>            <span class="hljs-comment">// console.log(jsonObj)</span><br>            jh.<span class="hljs-title function_">writeJson</span>(<span class="hljs-string">&quot;list.json&quot;</span>,jsonObj)<br>        &#125;)<br>    &#125;<br></code></pre></td></tr></table></figure><p>获取任务就非常简单了，我们只需要从json中拿到数据并转发给客户端就可以了：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//获取所有任务</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllWork</span>(<span class="hljs-params"></span>)&#123;<br>        workList=jh.<span class="hljs-title function_">readJson</span>(<span class="hljs-string">&quot;list.json&quot;</span>);<br>        ret=<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(workList);<br>    &#125;<br></code></pre></td></tr></table></figure><p>最后呢，我们需要写一个路由解析，因为js非常小，所以这些东西都写在一个文件里面就可以：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">/解析路由<br>    <span class="hljs-keyword">let</span> pathname = url.<span class="hljs-title function_">parse</span>(req.<span class="hljs-property">url</span>).<span class="hljs-property">pathname</span>;<br>    <span class="hljs-comment">//路由配置</span><br>    <span class="hljs-keyword">if</span> (pathname===<span class="hljs-string">&quot;/getAllWork&quot;</span>)&#123;<br>        <span class="hljs-title function_">getAllWork</span>()<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pathname===<span class="hljs-string">&quot;/addWork&quot;</span>)&#123;<br>        <span class="hljs-title function_">addWork</span>()<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(pathname===<span class="hljs-string">&quot;/deleteWork&quot;</span>)&#123;<br>        <span class="hljs-title function_">deleteWork</span>()<br>    &#125;<br></code></pre></td></tr></table></figure><p>随下贴出前端源码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;-- in index.html --&gt;<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ch&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://cdn.simplecss.org/simple.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;technological.css&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tech-background&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;text-align: center&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> wish you a substantial day<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>to do list<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;add-work&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;add-work&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tech-input&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 70%&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&#x27;addWork()&#x27;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tech-btn&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: inline;&quot;</span>&gt;</span>增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-meta"></span></span><br><span class="hljs-meta"><span class="language-javascript">        &#x27;use strict&#x27;</span></span><br><span class="language-javascript">        $.<span class="hljs-title function_">ajax</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">url</span>:<span class="hljs-string">&quot;http://localhost:3000/getAllWork&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">method</span>:<span class="hljs-string">&quot;GET&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">crossDomain</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">success</span>:<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>&#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">let</span> con=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;container&quot;</span>);</span><br><span class="language-javascript">                <span class="hljs-keyword">let</span> workList=<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(res)</span><br><span class="language-javascript">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(workList)</span><br><span class="language-javascript">                workList=<span class="hljs-built_in">eval</span>(workList)</span><br><span class="language-javascript">                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>;i&lt;workList.<span class="hljs-property">length</span>;i++)&#123;</span><br><span class="language-javascript">                    <span class="hljs-keyword">let</span> list=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;label&quot;</span>);</span><br><span class="language-javascript">                    list.<span class="hljs-property">innerHTML</span>=<span class="hljs-string">&quot;&lt;input name=\&quot;work-list\&quot; id=\&quot;work&quot;</span>+i+<span class="hljs-string">&quot;\&quot; value=&#x27;&quot;</span>+workList[i].<span class="hljs-property">work</span>+<span class="hljs-string">&quot;&#x27; class=&#x27;tech-input&#x27; style=\&quot;width: 70%\&quot;&gt; &quot;</span> +</span><br><span class="language-javascript">                        <span class="hljs-string">&quot;&lt;button onclick=&#x27;deleteWork(this)&#x27; id=&#x27;&quot;</span>+i+<span class="hljs-string">&quot;&#x27; class=&#x27;tech-btn&#x27; style=\&quot;display: inline;\&quot;&gt;完成&lt;/button&gt;&quot;</span>;</span><br><span class="language-javascript">                    con.<span class="hljs-title function_">appendChild</span>(list);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">addWork</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">let</span> work=<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;add-work&quot;</span>).<span class="hljs-property">value</span>;</span><br><span class="language-javascript">            $.<span class="hljs-title function_">ajax</span>(&#123;</span><br><span class="language-javascript">                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://localhost:3000/addWork&quot;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">crossDomain</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">                    <span class="hljs-string">&quot;work&quot;</span>:work</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-attr">success</span>:<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>&#123;</span><br><span class="language-javascript">                    <span class="hljs-comment">// alert(&quot;success&quot;);</span></span><br><span class="language-javascript">                    location.<span class="hljs-title function_">reload</span>();</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;)</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteWork</span>(<span class="hljs-params">res</span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">let</span> index=res.<span class="hljs-property">id</span>;</span><br><span class="language-javascript">            $.<span class="hljs-title function_">ajax</span>(&#123;</span><br><span class="language-javascript">                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;http://localhost:3000/deleteWork&quot;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;POST&quot;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">crossDomain</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">data</span>:&#123;</span><br><span class="language-javascript">                    <span class="hljs-string">&quot;id&quot;</span>:index</span><br><span class="language-javascript">                &#125;,</span><br><span class="language-javascript">                <span class="hljs-attr">success</span>:<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>&#123;</span><br><span class="language-javascript">                    <span class="hljs-comment">// alert(&quot;success&quot;);</span></span><br><span class="language-javascript">                    location.<span class="hljs-title function_">reload</span>();</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;)</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>这个项目的源码我也会放在GitHub（因为项目实在太小我甚至都没有建一个文件夹）</p><p><a href="https://github.com/charlesix59/todo_list_by_nodeJS">项目地址</a></p><h2 id="保持代码运行"><a href="#保持代码运行" class="headerlink" title="保持代码运行"></a>保持代码运行</h2><p>我们服务器代码当然要有一个服务器去运行，而这个迷你的项目显然不值得让我们去分配他一个云服务器加一个域名，那么我们是否可以把这个服务运行在本地呢？</p><p>可是运行在本地就需要频繁的重启服务，每次开机都要启动一次，这未免也太麻烦了。于是我们就可以使用<strong>pm2</strong>来使我们的项目保持运行</p><p>关于pm2我在此不多赘述了，大家有兴趣的可以自行百度搜索，我只给出部署的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install pm2 -g #全局安装pm2<br>cd &lt;项目目录&gt;<br>pm2 start index.js --watch<br>pm2 save<br>pm2 list<br></code></pre></td></tr></table></figure><p>如果你部署成功，那么当你运行<code>pm2 list</code>之后你就可以看到你的项目了</p>]]></content>
    
    
    
    <tags>
      
      <tag>前端</tag>
      
      <tag>node.js</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
